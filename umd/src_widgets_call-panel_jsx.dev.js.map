{"version":3,"file":"src_widgets_call-panel_jsx.dev.js","mappings":"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","sources":["webpack://tinode-webapp/./src/widgets/call-panel.jsx"],"sourcesContent":["// CallPanel displays call in progress: local and remote viewports and controls.\nimport React from 'react';\nimport { FormattedMessage, defineMessages, injectIntl } from 'react-intl';\n\nimport LetterTile from './letter-tile.jsx';\n\nimport { MAX_PEER_TITLE_LENGTH } from '../config.js';\nimport { CALL_STATE_OUTGOING_INITATED, CALL_STATE_IN_PROGRESS } from '../constants.js';\nimport { truncateString } from '../lib/strformat.js';\n\nconst RING_SOUND = new Audio('audio/call-out.m4a');\nRING_SOUND.loop = true;\nconst CALL_ENDED_SOUND = new Audio('audio/call-end.m4a');\nCALL_ENDED_SOUND.loop = true;\nconst DIALING_SOUND = new Audio('audio/dialing.m4a');\n\nconst VIDEO_MUTED_EVENT = 'video:muted';\nconst VIDEO_UNMUTED_EVENT = 'video:unmuted';\n\nconst messages = defineMessages({\n  already_in_call: {\n    id: 'already_in_call',\n    defaultMessage: 'You already in an ongoing call!',\n    description: 'Error message when the user tried to accept a new call without finishing pervious one',\n  }\n});\n\nclass CallPanel extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      localStream: undefined,\n      remoteStream: undefined,\n      pc: undefined,\n      dataChannel: undefined,\n\n      previousOnInfo: undefined,\n      waitingForPeer: false,\n      // If true, the client has received a remote SDP from the peer and has sent a local SDP to the peer.\n      callInitialSetupComplete: false,\n      audioOnly: props.callAudioOnly,\n      // Video mute/unmute in progress.\n      videoToggleInProgress: false,\n      // Indicates if the remote peer has informed us that their camera is on.\n      remoteVideoLive: false,\n    };\n\n    this.localStreamConstraints = {\n      audio: true,\n      video: !props.callAudioOnly\n    };\n    this.isOutgoingCall = props.callState == CALL_STATE_OUTGOING_INITATED;\n\n    this.containerRef = React.createRef();\n    this.localRef = React.createRef();\n    this.remoteRef = React.createRef();\n\n    // Cache for remote ice candidates until initial setup gets completed.\n    this.remoteIceCandidatesCache = [];\n\n    this.onInfo = this.onInfo.bind(this);\n    this.start = this.start.bind(this);\n    this.stop = this.stop.bind(this);\n\n    this.createPeerConnection = this.createPeerConnection.bind(this);\n    this.canSendOffer = this.canSendOffer.bind(this);\n    this.drainRemoteIceCandidatesCache = this.drainRemoteIceCandidatesCache.bind(this);\n\n    this.handleNegotiationNeededEvent = this.handleNegotiationNeededEvent.bind(this);\n    this.handleICECandidateEvent = this.handleICECandidateEvent.bind(this);\n    this.handleNewICECandidateMsg = this.handleNewICECandidateMsg.bind(this);\n    this.handleICEConnectionStateChangeEvent = this.handleICEConnectionStateChangeEvent.bind(this);\n    this.handleSignalingStateChangeEvent = this.handleSignalingStateChangeEvent.bind(this);\n    this.handleICEGatheringStateChangeEvent = this.handleICEGatheringStateChangeEvent.bind(this);\n    this.handleIceCandidateErrorEvent = this.handleIceCandidateErrorEvent.bind(this);\n    this.handleTrackEvent = this.handleTrackEvent.bind(this);\n\n    this.handleVideoOfferMsg = this.handleVideoOfferMsg.bind(this);\n    this.handleVideoAnswerMsg = this.handleVideoAnswerMsg.bind(this);\n    this.handleNewICECandidateMsg = this.handleNewICECandidateMsg.bind(this);\n\n    this.reportError = this.reportError.bind(this);\n    this.handleGetUserMediaError = this.handleGetUserMediaError.bind(this);\n\n    this.stopTracks = this.stopTracks.bind(this);\n    this.disconnectMedia = this.disconnectMedia.bind(this);\n\n    this.handleCloseClick = this.handleCloseClick.bind(this);\n    this.handleToggleCameraClick = this.handleToggleCameraClick.bind(this);\n    this.handleToggleMicClick = this.handleToggleMicClick.bind(this);\n\n    this.handleRemoteHangup = this.handleRemoteHangup.bind(this);\n    this.handleVideoCallAccepted = this.handleVideoCallAccepted.bind(this);\n\n    this.muteVideo = this.muteVideo.bind(this);\n    this.unmuteVideo = this.unmuteVideo.bind(this);\n    this.emptyVideoTrack = this.emptyVideoTrack.bind(this);\n\n    this.handleDataChannelEvent = this.handleDataChannelEvent.bind(this);\n    this.handleDataChannelError = this.handleDataChannelError.bind(this);\n    this.handleDataChannelMessage = this.handleDataChannelMessage.bind(this);\n    this.handleDataChannelOpen = this.handleDataChannelOpen.bind(this);\n    this.handleDataChannelClose = this.handleDataChannelClose.bind(this);\n\n    this.bounds = {};\n\n    this.dragStart = (event) => {\n      if (!event.target.classList.contains('draggable')) {\n        // Prevent dragging when clicking on buttons or other non-draggable elements.\n        return;\n      }\n      if (window.matchMedia('(width<=640px)')) {\n        // No dragging on small screens.\n        return;\n      }\n      if (this.props.minimized && this.containerRef) {\n        event.stopPropagation();\n        this.containerRef.current.setPointerCapture(event.pointerId);\n        this.containerRef.current.style.cursor = 'grabbing';\n        this.bounds.left = this.containerRef.current.offsetLeft;\n        this.bounds.top = this.containerRef.current.offsetTop;\n        this.bounds.width = this.containerRef.current.offsetWidth;\n        this.bounds.height = this.containerRef.current.offsetHeight;\n\n        const parent = this.containerRef.current.offsetParent;\n        this.bounds.maxX = parent.offsetWidth;\n        this.bounds.maxY = parent.offsetHeight;\n      }\n    };\n    this.drag = (event) => {\n      event.stopPropagation();\n      const el = this.containerRef.current;\n      if (this.props.minimized && this.containerRef && el.hasPointerCapture(event.pointerId)) {\n        // Calculate new position. Restrict to the visible area of the parent element.\n        this.bounds.left = Math.min(Math.max(this.bounds.left + event.movementX, 0),\n          this.bounds.maxX - this.bounds.width);\n        this.bounds.top = Math.min(Math.max(this.bounds.top + event.movementY, 0),\n          this.bounds.maxY - this.bounds.height);\n\n        el.style.left = `${this.bounds.left}px`;\n        el.style.top = `${this.bounds.top}px`;\n      }\n    };\n    this.dragEnd = (event) => {\n      event.stopPropagation();\n      if (this.props.minimized && this.containerRef) {\n        this.containerRef.current.releasePointerCapture(event.pointerId);\n        this.containerRef.current.style.cursor = 'grab';\n      }\n    };\n  }\n\n  componentDidMount() {\n    const topic = this.props.tinode.getTopic(this.props.topic);\n    this.previousOnInfo = topic.onInfo;\n    topic.onInfo = this.onInfo;\n    if ((this.props.callState == CALL_STATE_OUTGOING_INITATED ||\n         this.props.callState == CALL_STATE_IN_PROGRESS) && this.localRef.current) {\n      this.start();\n    }\n\n    if (this.containerRef) {\n      this.containerRef.current.addEventListener('pointerdown', this.dragStart);\n      this.containerRef.current.addEventListener('pointermove', this.drag);\n      this.containerRef.current.addEventListener('pointerup', this.dragEnd);\n    }\n  }\n\n  componentWillUnmount() {\n    const topic = this.props.tinode.getTopic(this.props.topic);\n    topic.onInfo = this.previousOnInfo;\n    this.stop();\n\n    if (this.containerRef) {\n      this.containerRef.current.removeEventListener('pointerdown', this.dragStart);\n      this.containerRef.current.removeEventListener('pointermove', this.drag);\n      this.containerRef.current.removeEventListener('pointerup', this.dragEnd);\n    }\n  }\n\n  handleVideoCallAccepted(info) {\n    RING_SOUND.pause();\n    // Create peer connection with a data channel.\n    const pc = this.createPeerConnection(true);\n    const stream = this.state.localStream;\n    stream.getTracks().forEach(track => {\n      pc.addTrack(track, stream);\n\n      if (track.kind == 'video' && this.state.audioOnly) {\n        // This is an audio-only call.\n        // Remove dummy video track (placeholder remains).\n        track.enabled = false;\n        track.stop();\n        stream.removeTrack(track);\n      }\n    });\n  }\n\n  onInfo(info) {\n    if (info.what != 'call') {\n      return;\n    }\n    switch (info.event) {\n      case 'accept':\n        this.handleVideoCallAccepted(info);\n        break;\n      case 'answer':\n        this.handleVideoAnswerMsg(info);\n        break;\n      case 'ice-candidate':\n        this.handleNewICECandidateMsg(info);\n        break;\n      case 'hang-up':\n        this.handleRemoteHangup(info);\n        break;\n      case 'offer':\n        this.handleVideoOfferMsg(info);\n        break;\n      case 'ringing':\n        // play() throws if the user did not click the app first: https://goo.gl/xX8pDD.\n        RING_SOUND.play().catch(_ => {});\n        break;\n      default:\n        console.warn(\"Unknown call event\", info.event);\n        break;\n    }\n  }\n\n  // Creates an empty video track placeholder.\n  emptyVideoTrack() {\n    const width = 640;\n    const height = 480;\n    const canvas = Object.assign(document.createElement(\"canvas\"), {width, height});\n    canvas.getContext('2d').fillRect(0, 0, width, height);\n    const stream = canvas.captureStream(0);\n    return Object.assign(stream.getVideoTracks()[0], {enabled: false});\n  }\n\n  start() {\n    if (this.state.localStream) {\n      this.props.onError(this.props.intl.formatMessage(messages.already_in_call), 'info');\n      return;\n    }\n\n    if (this.props.callState == CALL_STATE_IN_PROGRESS) {\n      // We apparently just accepted the call.\n      this.props.onInvite(this.props.topic, this.props.seq, CALL_STATE_IN_PROGRESS, this.props.callAudioOnly);\n      return;\n    }\n\n    // This is an outgoing call waiting for the other side to pick up.\n    // Start local video.\n    navigator.mediaDevices.getUserMedia(this.localStreamConstraints)\n      .then(stream => {\n        if (!this.localStreamConstraints.video) {\n          // Starting an audio-only call. Create a dummy video track\n          // (so video can be enabled during the call if the user desires).\n          stream.addTrack(this.emptyVideoTrack());\n        }\n        this.setState({localStream: stream, waitingForPeer: true});\n        this.localRef.current.srcObject = stream;\n\n        DIALING_SOUND.play();\n\n        // Send call invitation.\n        this.props.onInvite(this.props.topic, this.props.seq, this.props.callState, this.props.callAudioOnly);\n      })\n      .catch(this.handleGetUserMediaError);\n  }\n\n  stop() {\n    CALL_ENDED_SOUND.pause();\n    CALL_ENDED_SOUND.currentTime = 0;\n    RING_SOUND.pause();\n    RING_SOUND.currentTime = 0;\n\n    this.stopTracks(this.state.localStream);\n    this.stopTracks(this.state.remoteStream);\n    this.disconnectMedia(this.localRef.current);\n    this.disconnectMedia(this.remoteRef.current);\n    if (this.state.pc) {\n      this.state.pc.ontrack = null;\n      this.state.pc.onremovetrack = null;\n      this.state.pc.onremovestream = null;\n      this.state.pc.onicecandidate = null;\n      this.state.pc.oniceconnectionstatechange = null;\n      this.state.pc.onsignalingstatechange = null;\n      this.state.pc.onicegatheringstatechange = null;\n      this.state.pc.onnegotiationneeded = null;\n      this.state.pc.onicecandidateerror = null;\n      this.state.pc.ondatachannel = null;\n\n      if (this.state.dataChannel && (this.state.dataChannel.readyState == 'open' || this.state.dataChannel.readyState == 'connecting')) {\n        this.state.dataChannel.close();\n      }\n      this.state.pc.close();\n    }\n    this.setState({pc: null, waitingForPeer: false});\n  }\n\n  disconnectMedia(el) {\n    if (!el) {\n      return;\n    }\n\n    el.srcObject = null;\n    el.src = '';\n  }\n\n  stopTracks(stream) {\n    if (!stream) {\n      return;\n    }\n\n    let tracks = stream.getTracks();\n    if (tracks) {\n      tracks.forEach(track => {\n        track.stop();\n        track.enabled = false;\n      });\n    }\n  }\n\n  handleDataChannelError(error) {\n    console.error('data channel error', error);\n  }\n\n  handleDataChannelMessage(event) {\n    switch (event.data) {\n    case VIDEO_MUTED_EVENT:\n      this.setState({remoteVideoLive: false}, _ => { this.remoteRef.current.srcObject = this.state.remoteStream; });\n      break;\n    case VIDEO_UNMUTED_EVENT:\n      this.setState({remoteVideoLive: true}, _ => { this.remoteRef.current.srcObject = this.state.remoteStream; });\n      break;\n    default:\n      break;\n    }\n  }\n\n  handleDataChannelOpen(event) {\n    if (!this.state.audioOnly) {\n      event.target.send(VIDEO_UNMUTED_EVENT);\n    }\n  }\n\n  handleDataChannelClose(event) {\n    console.info('close data channel:', event);\n  }\n\n  handleDataChannelEvent(event) {\n    console.info('data channel event:', event);\n    const channel = event.channel;\n    channel.onerror = this.handleDataChannelError;\n    channel.onmessage = this.handleDataChannelMessage;\n    channel.onopen = this.handleDataChannelOpen;\n    channel.onclose = this.handleDataChannelClose;\n    this.setState({dataChannel: channel});\n  }\n\n  createPeerConnection(withDataChannel) {\n    const iceServers = this.props.tinode.getServerParam('iceServers', null);\n    const pc = iceServers ? new RTCPeerConnection({iceServers: iceServers}) : new RTCPeerConnection();\n\n    pc.onicecandidate = this.handleICECandidateEvent;\n    pc.oniceconnectionstatechange = this.handleICEConnectionStateChangeEvent;\n    pc.onicegatheringstatechange = this.handleICEGatheringStateChangeEvent;\n    pc.onsignalingstatechange = this.handleSignalingStateChangeEvent;\n    pc.onnegotiationneeded = this.handleNegotiationNeededEvent;\n    pc.onicecandidateerror = this.handleIceCandidateErrorEvent;\n    pc.ontrack = this.handleTrackEvent;\n    pc.ondatachannel = this.handleDataChannelEvent;\n\n    let stateUpdate = {pc: pc, waitingForPeer: false};\n    if (withDataChannel) {\n      // Create data channel for exchanging events.\n      const channel = pc.createDataChannel(\"events\", {ordered: true});\n      channel.onerror = this.handleDataChannelError;\n      channel.onmessage = this.handleDataChannelMessage;\n      channel.onopen = this.handleDataChannelOpen;\n      channel.onclose = this.handleDataChannelClose;\n      stateUpdate.dataChannel = channel;\n    }\n    this.setState(stateUpdate);\n    return pc;\n  }\n\n  handleVideoAnswerMsg(info) {\n    // Configure the remote description, which is the SDP payload\n    // in 'info' message.\n    const desc = new RTCSessionDescription(info.payload);\n    this.state.pc.setRemoteDescription(desc)\n      .then(_ => {\n        this.setState({ callInitialSetupComplete: true }, _ => this.drainRemoteIceCandidatesCache());\n      })\n      .catch(err => this.reportError(err));\n  }\n\n  reportError(err) {\n    this.props.onError(err.message, 'err');\n  }\n\n  canSendOffer() {\n    return this.isOutgoingCall || this.state.callInitialSetupComplete;\n  }\n\n  handleNegotiationNeededEvent(event) {\n    const pc = event.target;\n    if (!this.canSendOffer()) {\n      return;\n    }\n    pc.createOffer().then(offer => {\n      return pc.setLocalDescription(offer);\n    })\n    .then(_ => {\n      this.props.onSendOffer(this.props.topic, this.props.seq, pc.localDescription.toJSON());\n    })\n    .catch(err => this.reportError(err));\n  }\n\n  handleIceCandidateErrorEvent(event) {\n    console.warn(\"ICE candidate error:\", event);\n  }\n\n  handleICECandidateEvent(event) {\n    if (event.candidate) {\n      this.props.onIceCandidate(this.props.topic, this.props.seq, event.candidate.toJSON());\n    }\n  }\n\n  handleNewICECandidateMsg(info) {\n    const candidate = new RTCIceCandidate(info.payload);\n    if (this.state.callInitialSetupComplete) {\n      this.state.pc.addIceCandidate(candidate)\n        .catch(err => {\n          if (candidate.candidate) {\n            this.reportError(err);\n          }\n          console.warn(\"Error adding new ice candidate\", candidate, err);\n        });\n    } else {\n      this.remoteIceCandidatesCache.push(candidate);\n    }\n  }\n\n  drainRemoteIceCandidatesCache() {\n    this.remoteIceCandidatesCache.forEach(candidate => {\n      this.state.pc.addIceCandidate(candidate)\n        .catch(err => {\n          if (candidate.candidate) {\n            this.reportError(err);\n          }\n          console.warn(\"Error adding cached ice candidate\", candidate, err);\n        });\n    });\n    this.remoteIceCandidatesCache = [];\n  }\n\n  handleICEConnectionStateChangeEvent(event) {\n    switch (event.target.iceConnectionState) {\n      case 'closed':\n      case 'failed':\n        this.handleCloseClick();\n        break;\n    }\n  }\n\n  handleSignalingStateChangeEvent(event) {\n    if (event.target.signalingState == 'closed') {\n      this.handleCloseClick();\n    }\n  }\n\n  handleICEGatheringStateChangeEvent(event) {\n    // ICE gathering change state\n  }\n\n  handleTrackEvent(event) {\n    // Remote video becomes available.\n    this.remoteRef.current.srcObject = event.streams[0];\n    this.setState({remoteStream: event.streams[0]});\n  }\n\n  handleGetUserMediaError(e) {\n    console.error(\"Error opening camera and/or microphone\", e);\n    switch(e.name) {\n      case 'NotFoundError':\n        // Cannot start the call b/c no camera and/or microphone found.\n        this.reportError(e);\n        break;\n      case 'SecurityError':\n      case 'PermissionDeniedError':\n        // Do nothing; this is the same as the user canceling the call.\n        break;\n      default:\n        this.reportError(e);\n        break;\n    }\n\n    // Make sure we shut down our end of the RTCPeerConnection so we're\n    // ready to try again.\n    this.handleCloseClick();\n  }\n\n  handleVideoOfferMsg(info) {\n    let localStream = null;\n    // If needed, create peer connection.\n    // Not creating data channel since it should be created by the peer.\n    const pc = this.state.pc ? this.state.pc : this.createPeerConnection(false);\n    const desc = new RTCSessionDescription(info.payload);\n\n    pc.setRemoteDescription(desc).then(_ => {\n      return navigator.mediaDevices.getUserMedia(this.localStreamConstraints);\n    })\n    .then(stream => {\n      let dummyVideo;\n      if (!this.localStreamConstraints.video) {\n        // Starting an audio-only call. Create an empty video track so\n        // so the user can enable the video during the call.\n        dummyVideo = this.emptyVideoTrack();\n        stream.addTrack(dummyVideo);\n      }\n      localStream = stream;\n      this.localRef.current.srcObject = stream;\n      this.setState({localStream: stream});\n\n      localStream.getTracks().forEach(track => {\n        pc.addTrack(track, localStream);\n      });\n\n      if (dummyVideo) {\n        dummyVideo.enabled = false;\n        dummyVideo.stop();\n        stream.removeTrack(dummyVideo);\n      }\n    })\n    .then(_ => {\n      return pc.createAnswer();\n    })\n    .then(answer => {\n      return pc.setLocalDescription(answer);\n    })\n    .then(_ => {\n      this.props.onSendAnswer(this.props.topic, this.props.seq, pc.localDescription.toJSON());\n      this.setState({ callInitialSetupComplete: true }, _ => this.drainRemoteIceCandidatesCache());\n    })\n    .catch(this.handleGetUserMediaError);\n  }\n\n  // Call disconnected by remote.\n  handleRemoteHangup() {\n    if (!this.state.waitingForPeer) {\n      // This is live call, just hang up.\n      this.handleCloseClick();\n    } else {\n      // This is a call which is not yet connected.\n      // Stop pulse animation.\n      this.setState({waitingForPeer: false});\n      // Change sound and wait a bit before ending it.\n      RING_SOUND.pause();\n      RING_SOUND.currentTime = 0;\n      CALL_ENDED_SOUND.loop = true;\n      CALL_ENDED_SOUND.play().catch(_ => {});\n      setTimeout(_ => {\n        this.handleCloseClick();\n      }, 2000);\n    }\n  }\n\n  handleCloseClick() {\n    this.stop();\n    this.props.onHangup(this.props.topic, this.props.seq);\n  }\n\n  // Ends video track and turns off the camera.\n  muteVideo() {\n    if (!this.state.pc || !this.state.dataChannel) {\n      return;\n    }\n\n    const stream = this.state.localStream;\n    const t = stream.getVideoTracks()[0];\n    t.enabled = false;\n    t.stop();\n\n    stream.removeTrack(t);\n    this.state.dataChannel.send(VIDEO_MUTED_EVENT);\n    this.setState({videoToggleInProgress: false});\n  }\n\n  unmuteVideo() {\n    if (!this.state.pc || !this.state.dataChannel) {\n      return;\n    }\n    navigator.mediaDevices.getUserMedia({ video: true })\n      .then(stream => {\n        // Will extract video track from stream and throw stream away,\n        // and replace video track in the media sender.\n        this.localRef.current.srcObject = null;\n        const sender = this.state.pc.getSenders().find(s => s.track.kind == 'video');\n        const track = stream.getVideoTracks()[0];\n        // Remote track from new stream.\n        stream.removeTrack(track);\n        // Add this track to the existing local stream.\n        this.state.localStream.addTrack(track);\n        return sender.replaceTrack(track);\n      })\n      .then(_ => {\n        this.localRef.current.srcObject = this.state.localStream;\n        this.state.dataChannel.send(VIDEO_UNMUTED_EVENT);\n      })\n      .catch(err => this.handleGetUserMediaError(err))\n      .finally(_ => { this.setState({videoToggleInProgress: false}); }); // Make sure we redraw the mute/unmute icons (e.g. camera -> camera_off).\n  }\n\n  handleToggleCameraClick() {\n    if (this.state.videoToggleInProgress) {\n      // Toggle currently in progress.\n      return;\n    }\n    const tracks = this.state.localStream.getVideoTracks();\n    this.setState({videoToggleInProgress: true}, _ => {\n      if (tracks && tracks.length > 0 && tracks[0].enabled && tracks[0].readyState == 'live') {\n        this.muteVideo();\n      } else {\n        this.unmuteVideo();\n      }\n      this.setState({audioOnly: !this.state.audioOnly});\n    });\n  }\n\n  handleToggleMicClick() {\n    const stream = this.state.localStream;\n    const t = stream.getAudioTracks()[0];\n    t.enabled = !t.enabled;\n    // Make sure we redraw the mute/unmute icons (e.g. mic -> mic_off).\n    this.forceUpdate();\n  }\n\n  render() {\n    const audioTracks = this.state.localStream && this.state.localStream.getAudioTracks();\n    const videoTracks = !this.state.audioOnly && this.state.localStream && this.state.localStream.getVideoTracks();\n    const disabled = !this.state.pc || !this.state.dataChannel || !(audioTracks && audioTracks[0]);\n    const audioIcon = audioTracks && audioTracks[0] && audioTracks[0].enabled ? 'mic' : 'mic_off';\n    const videoIcon = videoTracks && videoTracks[0] && videoTracks[0].enabled && videoTracks[0].readyState == 'live' ? 'videocam' : 'videocam_off';\n    const peerTitle = truncateString(this.props.title, MAX_PEER_TITLE_LENGTH);\n    const pulseAnimation = this.state.waitingForPeer ? ' pulse' : '';\n\n    let remoteActive = false;\n    if (this.remoteRef.current && this.remoteRef.current.srcObject && this.state.remoteVideoLive) {\n      const rstream = this.remoteRef.current.srcObject;\n      if (rstream.getVideoTracks().length > 0) {\n        const t = rstream.getVideoTracks()[0];\n        remoteActive = t.enabled && t.readyState == 'live';\n      }\n    }\n\n    const minimizedClass = this.props.minimized ? 'minimized' : null;\n    const fullScreen = this.props.minimized ? 'fullscreen' : 'fullscreen_exit';\n\n    return (\n      <div id=\"video-container\" className={minimizedClass} ref={this.containerRef}>\n        <div id=\"video-container-panel\">\n          <div className=\"call-party self\" disabled={this.state.audioOnly || this.props.minimized}>\n            <video ref={this.localRef} autoPlay muted playsInline />\n            <div className=\"caller-name inactive\">\n              <FormattedMessage id=\"calls_you_label\"\n                defaultMessage=\"You\" description=\"Shown over the local video screen\" />\n            </div>\n          </div>\n          <div className=\"call-party peer\" disabled={!remoteActive}>\n            {remoteActive ?\n              <>\n                <video ref={this.remoteRef} autoPlay playsInline />\n                <div className=\"caller-name inactive\">{peerTitle}</div>\n              </> :\n              <>\n                <audio ref={this.remoteRef} autoPlay />\n                <div className={`caller-card${pulseAnimation} draggable`}>\n                  <div className=\"avatar-box\">\n                    <LetterTile\n                      authorizeURL={this.props.tinode.authorizeURL}\n                      avatar={this.props.avatar}\n                      topic={this.props.topic}\n                      title={this.props.title} />\n                  </div>\n                  <div className=\"caller-name\">{peerTitle}</div>\n                </div>\n              </>\n            }\n          </div>\n        </div>\n        <button className=\"full-screen\" onClick={this.props.onToggleMinimize}>\n          <i className=\"m-icon\">{fullScreen}</i>\n        </button>\n        <div id=\"controls\" className={minimizedClass}>\n          <button className=\"danger\" onClick={this.handleCloseClick}>\n            <i className=\"m-icon\">call_end</i>\n          </button>\n          <button className=\"secondary\" onClick={this.handleToggleCameraClick} disabled={disabled}>\n            <i className=\"m-icon\">{videoIcon}</i>\n          </button>\n          <button className=\"secondary\" onClick={this.handleToggleMicClick} disabled={disabled}>\n            <i className=\"m-icon\">{audioIcon}</i>\n          </button>\n        </div>\n      </div>\n    );\n  }\n};\n\nexport default injectIntl(CallPanel);\n"],"names":["React","FormattedMessage","defineMessages","injectIntl","LetterTile","MAX_PEER_TITLE_LENGTH","CALL_STATE_OUTGOING_INITATED","CALL_STATE_IN_PROGRESS","truncateString","RING_SOUND","Audio","loop","CALL_ENDED_SOUND","DIALING_SOUND","VIDEO_MUTED_EVENT","VIDEO_UNMUTED_EVENT","messages","already_in_call","id","defaultMessage","CallPanel","PureComponent","constructor","props","state","localStream","undefined","remoteStream","pc","dataChannel","previousOnInfo","waitingForPeer","callInitialSetupComplete","audioOnly","callAudioOnly","videoToggleInProgress","remoteVideoLive","localStreamConstraints","audio","video","isOutgoingCall","callState","containerRef","createRef","localRef","remoteRef","remoteIceCandidatesCache","onInfo","bind","start","stop","createPeerConnection","canSendOffer","drainRemoteIceCandidatesCache","handleNegotiationNeededEvent","handleICECandidateEvent","handleNewICECandidateMsg","handleICEConnectionStateChangeEvent","handleSignalingStateChangeEvent","handleICEGatheringStateChangeEvent","handleIceCandidateErrorEvent","handleTrackEvent","handleVideoOfferMsg","handleVideoAnswerMsg","reportError","handleGetUserMediaError","stopTracks","disconnectMedia","handleCloseClick","handleToggleCameraClick","handleToggleMicClick","handleRemoteHangup","handleVideoCallAccepted","muteVideo","unmuteVideo","emptyVideoTrack","handleDataChannelEvent","handleDataChannelError","handleDataChannelMessage","handleDataChannelOpen","handleDataChannelClose","bounds","dragStart","event","target","classList","contains","window","matchMedia","minimized","stopPropagation","current","setPointerCapture","pointerId","style","cursor","left","offsetLeft","top","offsetTop","width","offsetWidth","height","offsetHeight","parent","offsetParent","maxX","maxY","drag","el","hasPointerCapture","Math","min","max","movementX","movementY","dragEnd","releasePointerCapture","componentDidMount","topic","tinode","getTopic","addEventListener","componentWillUnmount","removeEventListener","info","pause","stream","getTracks","forEach","track","addTrack","kind","enabled","removeTrack","what","play","catch","_","console","warn","canvas","Object","assign","document","createElement","getContext","fillRect","captureStream","getVideoTracks","onError","intl","formatMessage","onInvite","seq","navigator","mediaDevices","getUserMedia","then","setState","srcObject","currentTime","ontrack","onremovetrack","onremovestream","onicecandidate","oniceconnectionstatechange","onsignalingstatechange","onicegatheringstatechange","onnegotiationneeded","onicecandidateerror","ondatachannel","readyState","close","src","tracks","error","data","send","channel","onerror","onmessage","onopen","onclose","withDataChannel","iceServers","getServerParam","RTCPeerConnection","stateUpdate","createDataChannel","ordered","desc","RTCSessionDescription","payload","setRemoteDescription","err","message","createOffer","offer","setLocalDescription","onSendOffer","localDescription","toJSON","candidate","onIceCandidate","RTCIceCandidate","addIceCandidate","push","iceConnectionState","signalingState","streams","e","name","dummyVideo","createAnswer","answer","onSendAnswer","setTimeout","onHangup","t","sender","getSenders","find","s","replaceTrack","finally","length","getAudioTracks","forceUpdate","render","audioTracks","videoTracks","disabled","audioIcon","videoIcon","peerTitle","title","pulseAnimation","remoteActive","rstream","minimizedClass","fullScreen","className","ref","autoPlay","muted","playsInline","Fragment","authorizeURL","avatar","onClick","onToggleMinimize"],"ignoreList":[],"sourceRoot":""}