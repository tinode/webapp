{"version":3,"file":"371.prod.js","mappings":"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","sources":["webpack://tinode-webapp/./src/widgets/video-preview.jsx"],"sourcesContent":["import React from 'react';\nimport { FormattedMessage, defineMessages, injectIntl } from 'react-intl';\nimport SendMessage from './send-message.jsx';\n\nimport { bytesToHumanSize } from '../lib/strformat.js';\n\nconst messages = defineMessages({\n  unrecognized_video_format: {\n    id: 'unrecognized_video_format',\n    defaultMessage: 'Format of this video is not recognized',\n    description: 'Error message when uploaded video is invalid',\n  }\n});\n\nclass VideoPreview extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.videoRef = React.createRef();\n\n    this.handleSendVideo = this.handleSendVideo.bind(this);\n    this.handleKeyDown = this.handleKeyDown.bind(this);\n  }\n\n  componentDidMount() {\n    document.addEventListener('keydown', this.handleKeyDown);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('keydown', this.handleKeyDown);\n  }\n\n  handleKeyDown(e) {\n    if (this.props.onSendMessage) {\n      return;\n    }\n\n    e.preventDefault();\n    if (e.key === 'Escape') {\n      this.props.onClose();\n    }\n  }\n\n  handleSendVideo(caption) {\n    this.props.onClose();\n    const params = {\n      width: this.videoRef.current.videoWidth,\n      height: this.videoRef.current.videoHeight,\n      duration: (this.videoRef.current.duration * 1000) | 0,\n      mime: this.props.content.mime,\n      name: this.props.content.filename\n    }\n\n    if (params.width == 0 || params.height == 0) {\n      this.props.onError(this.props.intl.formatMessage(messages.unrecognized_video_format), 'err');\n      return;\n    }\n\n    // Capture screen from a video.\n    const canvas = document.createElement('canvas');\n    canvas.width = params.width;\n    canvas.height = params.height;\n    const ctx = canvas.getContext('2d');\n    ctx.drawImage(this.videoRef.current, 0, 0, canvas.width, canvas.height);\n    ctx.canvas.toBlob(\n        preview => this.props.onSendMessage(caption, this.props.content.blob, preview, params),\n        'image/jpeg', 0.75\n    );\n  }\n\n  render() {\n    if (!this.props.content) {\n      return null;\n    }\n\n    const width = this.props.content.width || '-';\n    const height = this.props.content.height || '-';\n\n    const controlist = this.props.onSendMessage ? 'nodownload' : '';\n    const autoPlay = !this.props.onSendMessage;\n\n    return (\n      <div id=\"image-preview\">\n        <div id=\"preview-caption-panel\">\n          <span>{this.props.content.filename}</span>\n          <a href=\"#\" onClick={e => {e.preventDefault(); this.props.onClose();}}><i className=\"material-icons gray\">close</i></a>\n        </div>\n        <div id=\"image-preview-container\">\n          <video\n            className=\"image-preview\"\n            controls controlsList={controlist}\n            disablePictureInPicture ref={this.videoRef}\n            autoPlay={autoPlay}\n            src={this.props.tinode.authorizeURL(this.props.content.url)}\n            poster={this.props.content.preview}\n            alt={this.props.content.filename} />\n        </div>\n        {this.props.onSendMessage ?\n        <SendMessage\n          messagePrompt=\"add_image_caption\"\n          acceptBlank={true}\n          tinode={this.props.tinode}\n          reply={this.props.reply}\n          onCancelReply={this.props.onCancelReply}\n          onSendMessage={this.handleSendVideo}\n          onError={this.props.onError} />\n          :\n          <div id=\"image-preview-footer\">\n            <div>\n              <div><b><FormattedMessage id=\"label_file_name\" defaultMessage=\"File name:\"\n                description=\"Label for a file name\" /></b></div>\n              <div><span title={this.props.content.filename}>{this.props.content.filename}</span></div>\n            </div>\n            <div>\n              <div><b><FormattedMessage id=\"label_content_type\" defaultMessage=\"Content type:\"\n                description=\"Label for file content type (mime)\" /></b></div>\n              <div>{this.props.content.type}</div>\n            </div>\n            <div>\n              <div><b><FormattedMessage id=\"label_size\" defaultMessage=\"Size:\"\n                description=\"Label for file size\" /></b></div>\n              <div>{width} &times; {height} px; {bytesToHumanSize(this.props.content.size)}</div>\n            </div>\n          </div>}\n      </div>\n    );\n  }\n};\n\nexport default injectIntl(VideoPreview);\n"],"names":["messages","defineMessages","unrecognized_video_format","id","defaultMessage","VideoPreview","React","constructor","props","super","this","videoRef","handleSendVideo","bind","handleKeyDown","componentDidMount","document","addEventListener","componentWillUnmount","removeEventListener","e","onSendMessage","preventDefault","key","onClose","caption","params","width","current","videoWidth","height","videoHeight","duration","mime","content","name","filename","onError","intl","formatMessage","canvas","createElement","ctx","getContext","drawImage","toBlob","preview","blob","render","controlist","autoPlay","href","onClick","className","controls","controlsList","disablePictureInPicture","ref","src","tinode","authorizeURL","url","poster","alt","SendMessage","messagePrompt","acceptBlank","reply","onCancelReply","FormattedMessage","title","type","bytesToHumanSize","size","injectIntl"],"ignoreList":[],"sourceRoot":""}