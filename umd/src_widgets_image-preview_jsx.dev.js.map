{"version":3,"file":"src_widgets_image-preview_jsx.dev.js","mappings":"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","sources":["webpack://tinode-webapp/./src/widgets/image-preview.jsx"],"sourcesContent":["import React from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport SendMessage from './send-message.jsx';\n\nimport { REM_SIZE } from '../config.js';\nimport { fitImageSize } from '../lib/blob-helpers.js';\nimport { bytesToHumanSize, shortenFileName } from '../lib/strformat.js';\nimport { urlAsAttachment } from '../lib/utils.js';\n\nexport default class ImagePreview extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      width: 0,\n      height: 0\n    };\n\n    this.handleSendImage = this.handleSendImage.bind(this);\n    this.handleKeyDown = this.handleKeyDown.bind(this);\n  }\n\n  componentDidMount() {\n    document.addEventListener('keydown', this.handleKeyDown);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('keydown', this.handleKeyDown);\n  }\n\n  handleKeyDown(e) {\n    if (this.props.onSendMessage) {\n      return;\n    }\n\n    e.preventDefault();\n    if (e.key === 'Escape') {\n      this.props.onClose();\n    }\n  }\n\n  assignWidth(node) {\n    if (node && !this.state.width) {\n      const bounds = node.getBoundingClientRect();\n      this.setState({\n        width: bounds.width | 0,\n        height: bounds.height | 0\n      });\n    }\n  }\n\n  handleSendImage(caption) {\n    this.props.onClose();\n    this.props.onSendMessage(caption, this.props.content.blob);\n  }\n\n  render() {\n    if (!this.props.content) {\n      return null;\n    }\n\n    const dim = fitImageSize(this.props.content.width, this.props.content.height,\n      this.state.width, this.state.height, false);\n    const size = dim ? { width: dim.dstWidth + 'px', height: dim.dstHeight + 'px' } :\n      ((this.props.content.width > this.props.content.height) ? {width: '100%'} : {height: '100%'});\n    size.maxWidth = '100%';\n    size.maxHeight = '100%';\n\n    // Average font aspect ratio is ~0.5; File name takes 1/3 of the viewport width.\n    const maxlength = Math.max(((this.state.width / REM_SIZE / 1.5) | 0) - 2, 12);\n    const fname = shortenFileName(this.props.content.filename, maxlength) || '-';\n\n    const width = this.props.content.width || '-';\n    const height = this.props.content.height || '-';\n\n    const download_url = urlAsAttachment(this.props.content.url);\n\n    return (\n      <div id=\"image-preview\">\n        <div id=\"preview-caption-panel\">\n          {this.props.onSendMessage ?\n            <span>{fname}</span>\n            :\n            <a href={download_url} download={this.props.content.filename}>\n              <i className=\"material-icons\">file_download</i> <FormattedMessage\n                id=\"download_action\" defaultMessage=\"download\" description=\"Call to action [download]\" />\n            </a>\n          }\n          <a href=\"#\" onClick={(e) => {e.preventDefault(); this.props.onClose();}}><i className=\"material-icons gray\">close</i></a>\n        </div>\n        <div id=\"image-preview-container\" ref={node => this.assignWidth(node)}>\n          <img src={this.props.content.url} style={size} className=\"image-preview\" alt={this.props.content.filename} />\n        </div>\n        {this.props.onSendMessage ?\n          <SendMessage\n            messagePrompt=\"add_image_caption\"\n            acceptBlank={true}\n            tinode={this.props.tinode}\n            reply={this.props.reply}\n            onCancelReply={this.props.onCancelReply}\n            onSendMessage={this.handleSendImage}\n            onError={this.props.onError} />\n          :\n          <div id=\"image-preview-footer\">\n            <div>\n              <div><b><FormattedMessage id=\"label_file_name\" defaultMessage=\"File name:\"\n                description=\"Label for a file name\" /></b></div>\n              <div><span title={this.props.content.filename}>{fname}</span></div>\n            </div>\n            <div>\n              <div><b><FormattedMessage id=\"label_content_type\" defaultMessage=\"Content type:\"\n                description=\"Label for file content type (mime)\" /></b></div>\n              <div>{this.props.content.type}</div>\n            </div>\n            <div>\n              <div><b><FormattedMessage id=\"label_size\" defaultMessage=\"Size:\"\n                description=\"Label for file size\" /></b></div>\n              <div>{width} &times; {height} px; {bytesToHumanSize(this.props.content.size)}</div>\n            </div>\n          </div>}\n      </div>\n    );\n  }\n};\n"],"names":["React","FormattedMessage","SendMessage","REM_SIZE","fitImageSize","bytesToHumanSize","shortenFileName","urlAsAttachment","ImagePreview","PureComponent","constructor","props","state","width","height","handleSendImage","bind","handleKeyDown","componentDidMount","document","addEventListener","componentWillUnmount","removeEventListener","e","onSendMessage","preventDefault","key","onClose","assignWidth","node","bounds","getBoundingClientRect","setState","caption","content","blob","render","dim","size","dstWidth","dstHeight","maxWidth","maxHeight","maxlength","Math","max","fname","filename","download_url","url","createElement","id","href","download","className","defaultMessage","onClick","ref","src","style","alt","messagePrompt","acceptBlank","tinode","reply","onCancelReply","onError","title","type"],"ignoreList":[],"sourceRoot":""}