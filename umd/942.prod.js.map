{"version":3,"file":"942.prod.js","mappings":"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","sources":["webpack://tinode-webapp/./src/widgets/the-card-preview.jsx"],"sourcesContent":["import React from 'react';\nimport { defineMessages, FormattedMessage } from 'react-intl';\nimport { parsePhoneNumber } from 'libphonenumber-js/mobile';\n\nimport SendMessage from './send-message.jsx';\nimport LetterTile from './letter-tile.jsx';\n\nimport { TheCard } from 'tinode-sdk';\nimport { importVCard } from '../lib/blob-helpers.js';\n\nconst messages = defineMessages({\n  unknown_name: {\n    id: 'unknown_name',\n    defaultMessage: 'Unknown',\n    description: 'Name to show when the name is missing'\n  }\n});\n\nexport default class TheCardPreview extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      content: props.content.object\n    };\n\n    if (!props.content.object) {\n      importVCard(props.content.file)\n        .then(card => {\n          this.setState({ content: card });\n        });\n    }\n\n    this.handleSendCard = this.handleSendCard.bind(this);\n    this.handleKeyDown = this.handleKeyDown.bind(this);\n  }\n\n  componentDidMount() {\n    document.addEventListener('keydown', this.handleKeyDown);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('keydown', this.handleKeyDown);\n  }\n\n  handleKeyDown(e) {\n    e.preventDefault();\n    if (e.key === 'Escape') {\n      this.props.onClose();\n    }\n  }\n\n  handleSendCard() {\n    this.props.onClose();\n    this.props.onSendMessage(this.props.content);\n  }\n\n  render() {\n    const card = this.state.content;\n\n    const fullName = TheCard.getFn(card);\n    const photoUrl = TheCard.getPhotoUrl(card) || null;\n    const note = card?.note;\n    const org = TheCard.getOrg(card);\n\n    // Get communication methods\n    const emails = TheCard.getComm(card, 'email') || [];\n    const phones = TheCard.getComm(card, 'tel') || [];\n    const tinodeIds = TheCard.getComm(card, 'tinode') || [];\n    const urls = TheCard.getComm(card, 'http') || [];\n\n    const contacts = [];\n\n    // Add emails\n    emails.forEach((email, idx) => {\n      const types = Array.isArray(email.des) ? email.des.join(', ') : '';\n      contacts.push(\n        <div className=\"group quoted\" key={`email-${idx}`}>\n          <tt>{email.value}</tt>\n          <span className=\"small gray\"> {types ? `(${types})` : ''}</span>\n        </div>\n      );\n    });\n\n    // Add phones\n    phones.forEach((phone, idx) => {\n      let val = phone.value;\n      try {\n        const number = parsePhoneNumber(phone.value);\n        val = number ? number.formatInternational() : phone.value;\n      } catch (err) {\n        // Use original value if parsing fails\n      }\n      const types = Array.isArray(phone.des) ? phone.des.join(', ') : '';\n      contacts.push(\n        <div className=\"group quoted\" key={`tel-${idx}`}>\n          <tt>{val}</tt>\n          <span className=\"small gray\"> {types ? `(${types})` : ''}</span>\n        </div>\n      );\n    });\n\n    // Add Tinode IDs\n    tinodeIds.forEach((tid, idx) => {\n      const types = Array.isArray(tid.des) ? tid.des.join(', ') : '';\n      contacts.push(\n        <div className=\"group quoted\" key={`tinode-${idx}`}>\n          <tt>{tid.value}</tt>\n          <span className=\"small gray\"> {types ? `(${types})` : ''}</span>\n        </div>\n      );\n    });\n\n    // Add URLs\n    urls.forEach((url, idx) => {\n      const types = Array.isArray(url.des) ? url.des.join(', ') : '';\n      contacts.push(\n        <div className=\"group quoted\" key={`url-${idx}`}>\n          <tt>{url.value}</tt>\n          <span className=\"small gray\"> {types ? `(${types})` : ''}</span>\n        </div>\n      );\n    });\n\n    return (\n      <div id=\"image-preview\">\n        <div id=\"preview-caption-panel\">\n          <span><FormattedMessage id=\"label_contact_card\" defaultMessage=\"Contact Card\"\n            description=\"Label for contact card preview\" /></span>\n          <a href=\"#\" onClick={(e) => {e.preventDefault(); this.props.onClose();}}>\n            <i className=\"m-icon gray\">close</i>\n          </a>\n        </div>\n        <div id=\"image-preview-container\">\n          <div className=\"doc-card\">\n            <div className=\"panel-form-column\">\n              <center>\n                <div className=\"avatar-box\">\n                  <LetterTile\n                    authorizeURL={this.props.tinode.authorizeURL}\n                    avatar={photoUrl || true}\n                    topic=\"usrXXX123\"\n                    title={fullName} />\n                </div>\n              </center>\n              <div className=\"group\">\n                <div className=\"large ellipsized\">{fullName || <FormattedMessage {...messages.unknown_name} />}</div>\n              </div>\n              {org ?\n                <div className=\"group\">\n                  <div>{org}</div>\n                </div>\n                : null}\n              {note ?\n                <div className=\"group\">\n                  <label className=\"small\">\n                    <FormattedMessage id=\"label_description\" defaultMessage=\"Description\"\n                      description=\"Label for description of user or topic\" />\n                  </label>\n                  <div className=\"quoted\">{note}</div>\n                </div>\n                : null}\n              {contacts.length > 0 ?\n                <div className=\"group\">\n                  <label className=\"small\">\n                    <FormattedMessage id=\"label_contacts\" defaultMessage=\"Contacts\"\n                      description=\"Label for contact information\" />\n                  </label>\n                  {contacts}\n                </div>\n                : null}\n            </div>\n          </div>\n        </div>\n        <SendMessage\n          noInput={true}\n          tinode={this.props.tinode}\n          reply={this.props.reply}\n          onCancelReply={this.props.onCancelReply}\n          onSendMessage={this.handleSendCard}\n          onError={this.props.onError} />\n      </div>\n    );\n  }\n}\n"],"names":["messages","defineMessages","unknown_name","id","defaultMessage","TheCardPreview","React","constructor","props","super","this","state","content","object","importVCard","file","then","card","setState","handleSendCard","bind","handleKeyDown","componentDidMount","document","addEventListener","componentWillUnmount","removeEventListener","e","preventDefault","key","onClose","onSendMessage","render","fullName","TheCard","getFn","photoUrl","getPhotoUrl","note","org","getOrg","emails","getComm","phones","tinodeIds","urls","contacts","forEach","email","idx","types","Array","isArray","des","join","push","className","value","phone","val","number","parsePhoneNumber","formatInternational","err","tid","url","FormattedMessage","href","onClick","LetterTile","authorizeURL","tinode","avatar","topic","title","length","SendMessage","noInput","reply","onCancelReply","onError"],"ignoreList":[],"sourceRoot":""}