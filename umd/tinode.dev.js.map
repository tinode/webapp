{"version":3,"file":"tinode.dev.js","mappings":"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CAAC7xB,GAAG,IAAI/B,GAAG,CAAC8B,EAAE,IAAI8xB,IAAI,CAAC9xB,EAAE,EAAE;IAE5C,OAAO9B,GAAG;EACZ;EAGA,OAAO;IACL+B,GAAG,EAAEnP,IAAI,CAACC,GAAG,CAACmN,GAAG,CAAC+B,GAAG,EAAE6xB,IAAI,CAAC7xB,GAAG,CAAC;IAChCD,EAAE,EAAElP,IAAI,CAACE,GAAG,CAACkN,GAAG,CAAC8B,EAAE,EAAE8xB,IAAI,CAAC9xB,EAAE;EAC9B,CAAC;EAED;AAAc;AAChB,C;;;;;;;;;;;;;;ACpTO,MAAMvO,eAAe,GAAG,eAAe,C;;;;;;UCA9C;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;WC5BA;WACA;WACA;WACA,eAAe,4BAA4B;WAC3C,eAAe;WACf,iCAAiC,WAAW;WAC5C;WACA,E;;;;;WCPA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA,E;;;;;WCPA;WACA;WACA;WACA;WACA,GAAG;WACH;WACA;WACA,CAAC,I;;;;;WCPD,8CAA8C,yD;;;;;WCA9C;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D,E;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACa;AAM6B;AACL;AACG;AACC;AACX;AACG;AACa;AACC;AAChB;AACO;AACF;AAEA;AAOhB;AAIR;AAKH;AAGT,IAAI+C,iBAAiB;AACrB,IAAI,OAAOy9B,SAAS,IAAI,WAAW,EAAE;EACnCz9B,iBAAiB,GAAGy9B,SAAS;AAC/B;AAE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","sources":["webpack://tinode/webpack/universalModuleDefinition","webpack://tinode/./src/access-mode.js","webpack://tinode/./src/cbuffer.js","webpack://tinode/./src/comm-error.js","webpack://tinode/./src/config.js","webpack://tinode/./src/connection.js","webpack://tinode/./src/db.js","webpack://tinode/./src/drafty.js","webpack://tinode/./src/fnd-topic.js","webpack://tinode/./src/large-file.js","webpack://tinode/./src/me-topic.js","webpack://tinode/./src/meta-builder.js","webpack://tinode/./src/the-card.js","webpack://tinode/./src/topic.js","webpack://tinode/./src/utils.js","webpack://tinode/./version.js","webpack://tinode/webpack/bootstrap","webpack://tinode/webpack/runtime/compat get default export","webpack://tinode/webpack/runtime/define property getters","webpack://tinode/webpack/runtime/global","webpack://tinode/webpack/runtime/hasOwnProperty shorthand","webpack://tinode/webpack/runtime/make namespace object","webpack://tinode/./src/tinode.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"tinode\"] = factory();\n\telse\n\t\troot[\"tinode\"] = factory();\n})(this, function() {\nreturn ","/**\n * @file Access control model.\n *\n * @copyright 2015-2026 Tinode LLC.\n */\n'use strict';\n\n// NOTE TO DEVELOPERS:\n// Localizable strings should be double quoted \"   \",\n// non-localizable strings should be single quoted 'non-localized'.\n\n/**\n * Helper class for handling access mode.\n *\n * @class AccessMode\n * @memberof Tinode\n *\n * @param {AccessMode|Object=} acs - AccessMode to copy or access mode object received from the server.\n */\nexport default class AccessMode {\n  constructor(acs) {\n    if (acs) {\n      this.given = typeof acs.given == 'number' ? acs.given : AccessMode.decode(acs.given);\n      this.want = typeof acs.want == 'number' ? acs.want : AccessMode.decode(acs.want);\n      this.mode = acs.mode ? (typeof acs.mode == 'number' ? acs.mode : AccessMode.decode(acs.mode)) :\n        (this.given & this.want);\n    }\n  }\n\n  static #checkFlag(val, side, flag) {\n    side = side || 'mode';\n    if (['given', 'want', 'mode'].includes(side)) {\n      return ((val[side] & flag) != 0);\n    }\n    throw new Error(`Invalid AccessMode component '${side}'`);\n  }\n  /**\n   * Parse string into an access mode value.\n   * @memberof Tinode.AccessMode\n   * @static\n   *\n   * @param {string | number} mode - either a String representation of the access mode to parse or a set of bits to assign.\n   * @returns {number} - Access mode as a numeric value.\n   */\n  static decode(str) {\n    if (!str) {\n      return null;\n    } else if (typeof str == 'number') {\n      return str & AccessMode._BITMASK;\n    } else if (str === 'N' || str === 'n') {\n      return AccessMode._NONE;\n    }\n\n    const bitmask = {\n      'J': AccessMode._JOIN,\n      'R': AccessMode._READ,\n      'W': AccessMode._WRITE,\n      'P': AccessMode._PRES,\n      'A': AccessMode._APPROVE,\n      'S': AccessMode._SHARE,\n      'D': AccessMode._DELETE,\n      'O': AccessMode._OWNER\n    };\n\n    let m0 = AccessMode._NONE;\n\n    for (let i = 0; i < str.length; i++) {\n      const bit = bitmask[str.charAt(i).toUpperCase()];\n      if (!bit) {\n        // Unrecognized bit, skip.\n        continue;\n      }\n      m0 |= bit;\n    }\n    return m0;\n  }\n  /**\n   * Convert numeric representation of the access mode into a string.\n   *\n   * @memberof Tinode.AccessMode\n   * @static\n   *\n   * @param {number} val - access mode value to convert to a string.\n   * @returns {string} - Access mode as a string.\n   */\n  static encode(val) {\n    if (val === null || val === AccessMode._INVALID) {\n      return null;\n    } else if (val === AccessMode._NONE) {\n      return 'N';\n    }\n\n    const bitmask = ['J', 'R', 'W', 'P', 'A', 'S', 'D', 'O'];\n    let res = '';\n    for (let i = 0; i < bitmask.length; i++) {\n      if ((val & (1 << i)) != 0) {\n        res = res + bitmask[i];\n      }\n    }\n    return res;\n  }\n  /**\n   * Update numeric representation of access mode with the new value. The value\n   * is one of the following:\n   *  - a string starting with <code>'+'</code> or <code>'-'</code> then the bits to add or remove, e.g. <code>'+R-W'</code> or <code>'-PS'</code>.\n   *  - a new value of access mode\n   *\n   * @memberof Tinode.AccessMode\n   * @static\n   *\n   * @param {number} val - access mode value to update.\n   * @param {string} upd - update to apply to val.\n   * @returns {number} - updated access mode.\n   */\n  static update(val, upd) {\n    if (!upd || typeof upd != 'string') {\n      return val;\n    }\n\n    let action = upd.charAt(0);\n    if (action == '+' || action == '-') {\n      let val0 = val;\n      // Split delta-string like '+ABC-DEF+Z' into an array of parts including + and -.\n      const parts = upd.split(/([-+])/);\n      // Starting iteration from 1 because String.split() creates an array with the first empty element.\n      // Iterating by 2 because we parse pairs +/- then data.\n      for (let i = 1; i < parts.length - 1; i += 2) {\n        action = parts[i];\n        const m0 = AccessMode.decode(parts[i + 1]);\n        if (m0 == AccessMode._INVALID) {\n          return val;\n        }\n        if (m0 == null) {\n          continue;\n        }\n        if (action === '+') {\n          val0 |= m0;\n        } else if (action === '-') {\n          val0 &= ~m0;\n        }\n      }\n      val = val0;\n    } else {\n      // The string is an explicit new value 'ABC' rather than delta.\n      const val0 = AccessMode.decode(upd);\n      if (val0 != AccessMode._INVALID) {\n        val = val0;\n      }\n    }\n\n    return val;\n  }\n  /**\n   * Bits present in a1 but missing in a2.\n   *\n   * @static\n   * @memberof Tinode\n   *\n   * @param {number | string} a1 - access mode to subtract from.\n   * @param {number | string} a2 - access mode to subtract.\n   * @returns {number} access mode with bits present in <code>a1</code> but missing in <code>a2</code>.\n   */\n  static diff(a1, a2) {\n    a1 = AccessMode.decode(a1);\n    a2 = AccessMode.decode(a2);\n\n    if (a1 == AccessMode._INVALID || a2 == AccessMode._INVALID) {\n      return AccessMode._INVALID;\n    }\n    return a1 & ~a2;\n  }\n  /**\n   * Custom formatter\n   */\n  toString() {\n    return '{\"mode\": \"' + AccessMode.encode(this.mode) +\n      '\", \"given\": \"' + AccessMode.encode(this.given) +\n      '\", \"want\": \"' + AccessMode.encode(this.want) + '\"}';\n  }\n  /**\n   * Converts numeric values to strings.\n   */\n  jsonHelper() {\n    return {\n      mode: AccessMode.encode(this.mode),\n      given: AccessMode.encode(this.given),\n      want: AccessMode.encode(this.want)\n    };\n  }\n  /**\n   * Assign value to 'mode'.\n   * @memberof Tinode.AccessMode\n   *\n   * @param {string | number} m - either a string representation of the access mode or a set of bits.\n   * @returns {AccessMode} - <code>this</code> AccessMode.\n   */\n  setMode(m) {\n    this.mode = AccessMode.decode(m);\n    return this;\n  }\n  /**\n   * Update <code>mode</code> value.\n   * @memberof Tinode.AccessMode\n   *\n   * @param {string} u - string representation of the changes to apply to access mode.\n   * @returns {AccessMode} - <code>this</code> AccessMode.\n   */\n  updateMode(u) {\n    this.mode = AccessMode.update(this.mode, u);\n    return this;\n  }\n  /**\n   * Get <code>mode</code> value as a string.\n   * @memberof Tinode.AccessMode\n   *\n   * @returns {string} - <code>mode</code> value.\n   */\n  getMode() {\n    return AccessMode.encode(this.mode);\n  }\n  /**\n   * Assign <code>given</code>  value.\n   * @memberof Tinode.AccessMode\n   *\n   * @param {string | number} g - either a string representation of the access mode or a set of bits.\n   * @returns {AccessMode} - <code>this</code> AccessMode.\n   */\n  setGiven(g) {\n    this.given = AccessMode.decode(g);\n    return this;\n  }\n  /**\n   * Update 'given' value.\n   * @memberof Tinode.AccessMode\n   *\n   * @param {string} u - string representation of the changes to apply to access mode.\n   * @returns {AccessMode} - <code>this</code> AccessMode.\n   */\n  updateGiven(u) {\n    this.given = AccessMode.update(this.given, u);\n    return this;\n  }\n  /**\n   * Get 'given' value as a string.\n   * @memberof Tinode.AccessMode\n   *\n   * @returns {string} - <b>given</b> value.\n   */\n  getGiven() {\n    return AccessMode.encode(this.given);\n  }\n  /**\n   * Assign 'want' value.\n   * @memberof Tinode.AccessMode\n   *\n   * @param {string | number} w - either a string representation of the access mode or a set of bits.\n   * @returns {AccessMode} - <code>this</code> AccessMode.\n   */\n  setWant(w) {\n    this.want = AccessMode.decode(w);\n    return this;\n  }\n  /**\n   * Update 'want' value.\n   * @memberof Tinode.AccessMode\n   *\n   * @param {string} u - string representation of the changes to apply to access mode.\n   * @returns {AccessMode} - <code>this</code> AccessMode.\n   */\n  updateWant(u) {\n    this.want = AccessMode.update(this.want, u);\n    return this;\n  }\n  /**\n   * Get 'want' value as a string.\n   * @memberof Tinode.AccessMode\n   *\n   * @returns {string} - <b>want</b> value.\n   */\n  getWant() {\n    return AccessMode.encode(this.want);\n  }\n  /**\n   * Get permissions present in 'want' but missing in 'given'.\n   * Inverse of {@link Tinode.AccessMode#getExcessive}\n   *\n   * @memberof Tinode.AccessMode\n   *\n   * @returns {string} permissions present in <b>want</b> but missing in <b>given</b>.\n   */\n  getMissing() {\n    return AccessMode.encode(this.want & ~this.given);\n  }\n  /**\n   * Get permissions present in 'given' but missing in 'want'.\n   * Inverse of {@link Tinode.AccessMode#getMissing}\n   * @memberof Tinode.AccessMode\n   *\n   * @returns {string} permissions present in <b>given</b> but missing in <b>want</b>.\n   */\n  getExcessive() {\n    return AccessMode.encode(this.given & ~this.want);\n  }\n  /**\n   * Update 'want', 'give', and 'mode' values.\n   * @memberof Tinode.AccessMode\n   *\n   * @param {AccessMode} val - new access mode value.\n   * @returns {AccessMode} - <code>this</code> AccessMode.\n   */\n  updateAll(val) {\n    if (val) {\n      this.updateGiven(val.given);\n      this.updateWant(val.want);\n      this.mode = this.given & this.want;\n    }\n    return this;\n  }\n  /**\n   * Check if Owner (O) flag is set.\n   * @memberof Tinode.AccessMode\n   * @param {string=} side - which permission to check: given, want, mode; default: mode.\n   * @returns {boolean} - <code>true</code> if flag is set.\n   */\n  isOwner(side) {\n    return AccessMode.#checkFlag(this, side, AccessMode._OWNER);\n  }\n  /**\n   * Check if Presence (P) flag is set.\n   * @memberof Tinode.AccessMode\n   * @param {string=} side - which permission to check: given, want, mode; default: mode.\n   * @returns {boolean} - <code>true</code> if flag is set.\n   */\n  isPresencer(side) {\n    return AccessMode.#checkFlag(this, side, AccessMode._PRES);\n  }\n  /**\n   * Check if Presence (P) flag is NOT set.\n   * @memberof Tinode.AccessMode\n   * @param {string=} side - which permission to check: given, want, mode; default: mode.\n   * @returns {boolean} - <code>true</code> if flag is set.\n   */\n  isMuted(side) {\n    return !this.isPresencer(side);\n  }\n  /**\n   * Check if Join (J) flag is set.\n   * @memberof Tinode.AccessMode\n   * @param {string=} side - which permission to check: given, want, mode; default: mode.\n   * @returns {boolean} - <code>true</code> if flag is set.\n   */\n  isJoiner(side) {\n    return AccessMode.#checkFlag(this, side, AccessMode._JOIN);\n  }\n  /**\n   * Check if Reader (R) flag is set.\n   * @memberof Tinode.AccessMode\n   * @param {string=} side - which permission to check: given, want, mode; default: mode.\n   * @returns {boolean} - <code>true</code> if flag is set.\n   */\n  isReader(side) {\n    return AccessMode.#checkFlag(this, side, AccessMode._READ);\n  }\n  /**\n   * Check if Writer (W) flag is set.\n   * @memberof Tinode.AccessMode\n   * @param {string=} side - which permission to check: given, want, mode; default: mode.\n   * @returns {boolean} - <code>true</code> if flag is set.\n   */\n  isWriter(side) {\n    return AccessMode.#checkFlag(this, side, AccessMode._WRITE);\n  }\n  /**\n   * Check if Approver (A) flag is set.\n   * @memberof Tinode.AccessMode\n   * @param {string=} side - which permission to check: given, want, mode; default: mode.\n   * @returns {boolean} - <code>true</code> if flag is set.\n   */\n  isApprover(side) {\n    return AccessMode.#checkFlag(this, side, AccessMode._APPROVE);\n  }\n  /**\n   * Check if either one of Owner (O) or Approver (A) flags is set.\n   * @memberof Tinode.AccessMode\n   * @param {string=} side - which permission to check: given, want, mode; default: mode.\n   * @returns {boolean} - <code>true</code> if flag is set.\n   */\n  isAdmin(side) {\n    return this.isOwner(side) || this.isApprover(side);\n  }\n  /**\n   * Check if either one of Owner (O), Approver (A), or Sharer (S) flags is set.\n   * @memberof Tinode.AccessMode\n   * @param {string=} side - which permission to check: given, want, mode; default: mode.\n   * @returns {boolean} - <code>true</code> if flag is set.\n   */\n  isSharer(side) {\n    return this.isAdmin(side) || AccessMode.#checkFlag(this, side, AccessMode._SHARE);\n  }\n  /**\n   * Check if Deleter (D) flag is set.\n   * @memberof Tinode.AccessMode\n   * @param {string=} side - which permission to check: given, want, mode; default: mode.\n   * @returns {boolean} - <code>true</code> if flag is set.\n   */\n  isDeleter(side) {\n    return AccessMode.#checkFlag(this, side, AccessMode._DELETE);\n  }\n}\n\nAccessMode._NONE = 0x00;\nAccessMode._JOIN = 0x01;\nAccessMode._READ = 0x02;\nAccessMode._WRITE = 0x04;\nAccessMode._PRES = 0x08;\nAccessMode._APPROVE = 0x10;\nAccessMode._SHARE = 0x20;\nAccessMode._DELETE = 0x40;\nAccessMode._OWNER = 0x80;\n\nAccessMode._BITMASK = AccessMode._JOIN | AccessMode._READ | AccessMode._WRITE | AccessMode._PRES |\n  AccessMode._APPROVE | AccessMode._SHARE | AccessMode._DELETE | AccessMode._OWNER;\nAccessMode._INVALID = 0x100000;\n","/**\n * @file In-memory sorted cache of objects.\n *\n * @copyright 2015-2025 Tinode LLC.\n */\n'use strict';\n\n/**\n * Callback for iterating contents of buffer. See {@link Tinode.CBuffer#forEach}.\n * @callback Tinode.ForEachCallbackType\n * @param {Object} elem - Current element of the buffer.\n * @param {Object} prev - Previous element of the buffer.\n * @param {Object} next - Next element of the buffer.\n * @param {number} index - Index of the current element.\n */\n\n/**\n * Callback for filtering the buffer. See {@link Tinode.CBuffer#filter}.\n * @callback Tinode.FilterCallbackType\n * @param {Object} elem - Current element of the buffer.\n * @param {number} index - Index of the current element.\n * @returns {boolean} <code>true</code> to keep the element, <code>false</code> to remove.\n */\n\n/**\n * In-memory sorted cache of objects.\n *\n * @class CBuffer\n * @memberof Tinode\n * @protected\n *\n * @param {Function} compare - custom comparator of objects. Takes two parameters <code>a</code> and <code>b</code>;\n *    returns <code>-1</code> if <code>a < b</code>, <code>0</code> if <code>a == b</code>, <code>1</code> otherwise.\n * @param {boolean} unique - enforce element uniqueness: when <code>true</code> replace existing element with a new\n *    one on conflict; when <code>false</code> keep both elements.\n */\nexport default class CBuffer {\n  #comparator = undefined;\n  #unique = false;\n  buffer = [];\n\n  constructor(compare_, unique_) {\n    this.#comparator = compare_ || ((a, b) => {\n      return a === b ? 0 : a < b ? -1 : 1;\n    });\n    this.#unique = unique_;\n  }\n\n  #findNearest(elem, arr, exact) {\n    let start = 0;\n    let end = arr.length - 1;\n    let pivot = 0;\n    let diff = 0;\n    let found = false;\n\n    while (start <= end) {\n      pivot = (start + end) / 2 | 0;\n      diff = this.#comparator(arr[pivot], elem);\n      if (diff < 0) {\n        start = pivot + 1;\n      } else if (diff > 0) {\n        end = pivot - 1;\n      } else {\n        found = true;\n        break;\n      }\n    }\n    if (found) {\n      return {\n        idx: pivot,\n        exact: true\n      };\n    }\n    if (exact) {\n      return {\n        idx: -1\n      };\n    }\n    // Not exact - insertion point\n    return {\n      idx: diff < 0 ? pivot + 1 : pivot\n    };\n  }\n\n  // Insert element into a sorted array.\n  #insertSorted(elem, arr) {\n    const found = this.#findNearest(elem, arr, false);\n    const count = (found.exact && this.#unique) ? 1 : 0;\n    arr.splice(found.idx, count, elem);\n    return arr;\n  }\n\n  /**\n   * Get an element at the given position.\n   * @memberof Tinode.CBuffer#\n   * @param {number} at - Position to fetch from.\n   * @returns {Object} Element at the given position or <code>undefined</code>.\n   */\n  getAt(at) {\n    return this.buffer[at];\n  }\n\n  /**\n   * Convenience method for getting the last element from the buffer.\n   * @memberof Tinode.CBuffer#\n   * @param {function} filter - optional filter to apply to elements. If filter is provided, the search\n   *   for the last element starts from the end of the buffer and goes backwards until the filter returns true.\n   * @returns {Object} The last element in the buffer or <code>undefined</code> if buffer is empty.\n   */\n  getLast(filter) {\n    return filter ?\n      this.buffer.findLast(filter) :\n      this.buffer[this.buffer.length - 1];\n  }\n\n  /**\n   * Insert new element(s) to the buffer at the correct position according to the sort method.\n   * Variadic: takes one or more arguments. If an array is passed as a single argument, its\n   * elements are inserted individually.\n   * @memberof Tinode.CBuffer#\n   *\n   * @param {...Object|Array} - One or more objects to insert.\n   */\n  put() {\n    let insert;\n    // inspect arguments: if array, insert its elements, if one or more non-array arguments, insert them one by one\n    if (arguments.length == 1 && Array.isArray(arguments[0])) {\n      insert = arguments[0];\n    } else {\n      insert = arguments;\n    }\n    for (let idx in insert) {\n      this.#insertSorted(insert[idx], this.buffer);\n    }\n  }\n\n  /**\n   * Remove element at the given position.\n   * @memberof Tinode.CBuffer#\n   * @param {number} at - Position to delete at.\n   * @returns {Object} Element at the given position or <code>undefined</code>.\n   */\n  delAt(at) {\n    at |= 0;\n    let r = this.buffer.splice(at, 1);\n    if (r && r.length > 0) {\n      return r[0];\n    }\n    return undefined;\n  }\n\n  /**\n   * Remove elements between two positions.\n   * @memberof Tinode.CBuffer#\n   * @param {number} since - Position to delete from (inclusive).\n   * @param {number} before - Position to delete to (exclusive).\n   *\n   * @returns {Array} array of removed elements (could be zero length).\n   */\n  delRange(since, before) {\n    return this.buffer.splice(since, before - since);\n  }\n\n  /**\n   * Return the number of elements the buffer holds.\n   * @memberof Tinode.CBuffer#\n   * @return {number} Number of elements in the buffer.\n   */\n  length() {\n    return this.buffer.length;\n  }\n\n  /**\n   * Reset the buffer discarding all elements\n   * @memberof Tinode.CBuffer#\n   */\n  reset() {\n    this.buffer = [];\n  }\n\n  /**\n   * Apply given <code>callback</code> to all elements of the buffer.\n   * @memberof Tinode.CBuffer#\n   *\n   * @param {Tinode.ForEachCallbackType} callback - Function to call for each element.\n   * @param {number} startIdx - Optional index to start iterating from (inclusive), default: 0.\n   * @param {number} beforeIdx - Optional index to stop iterating before (exclusive), default: length of the buffer.\n   * @param {Object} context - calling context (i.e. value of <code>this</code> in callback)\n   */\n  forEach(callback, startIdx, beforeIdx, context) {\n    startIdx = Math.max(0, startIdx | 0);\n    beforeIdx = Math.min(beforeIdx || this.buffer.length, this.buffer.length);\n\n    for (let i = startIdx; i < beforeIdx; i++) {\n      callback.call(context, this.buffer[i],\n        (i > startIdx ? this.buffer[i - 1] : undefined),\n        (i < beforeIdx - 1 ? this.buffer[i + 1] : undefined), i);\n    }\n  }\n\n  /**\n   * Find element in buffer using buffer's comparison function.\n   * @memberof Tinode.CBuffer#\n   *\n   * @param {Object} elem - element to find.\n   * @param {boolean=} nearest - when true and exact match is not found, return the nearest element (insertion point).\n   * @returns {number} index of the element in the buffer or -1.\n   */\n  find(elem, nearest) {\n    const {\n      idx\n    } = this.#findNearest(elem, this.buffer, !nearest);\n    return idx;\n  }\n\n  /**\n   * Remove all elements that do not pass the test implemented by the provided callback function.\n   * @memberof Tinode.CBuffer#\n   *\n   * @param {Tinode.FilterCallbackType} callback - Function to call for each element.\n   * @param {Object} context - calling context (i.e. value of <code>this</code> in the callback)\n   */\n  filter(callback, context) {\n    let count = 0;\n    for (let i = 0; i < this.buffer.length; i++) {\n      if (callback.call(context, this.buffer[i], i)) {\n        this.buffer[count] = this.buffer[i];\n        count++;\n      }\n    }\n\n    this.buffer.splice(count);\n  }\n\n  /**\n   * Check if buffer is empty.\n   * @returns {boolean} <code>true</code> if the buffer is empty, <code>false</code> otherwise.\n   */\n  isEmpty() {\n    return this.buffer.length == 0;\n  }\n}\n","/**\n * @file Throwable error with numeric error code.\n *\n * @copyright 2015-2023 Tinode LLC.\n */\n'use strict';\n\nexport default class CommError extends Error {\n  constructor(message, code) {\n    super(`${message} (${code})`);\n    this.name = 'CommError';\n    this.code = code;\n  }\n}\n","/**\n * @file Global constants and configuration parameters.\n *\n * @copyright 2015-2025 Tinode LLC\n */\n'use strict';\n\nimport {\n  PACKAGE_VERSION\n} from '../version.js';\n\n// Global constants\nexport const PROTOCOL_VERSION = '0'; // Major component of the version, e.g. '0' in '0.17.1'.\nexport const VERSION = PACKAGE_VERSION || '0.25';\nexport const LIBRARY = 'tinodejs/' + VERSION;\n\n// Topic name prefixes.\nexport const TOPIC_NEW = 'new';\nexport const TOPIC_NEW_CHAN = 'nch';\nexport const TOPIC_ME = 'me';\nexport const TOPIC_FND = 'fnd';\nexport const TOPIC_SYS = 'sys';\nexport const TOPIC_SLF = 'slf';\nexport const TOPIC_CHAN = 'chn';\nexport const TOPIC_GRP = 'grp';\nexport const TOPIC_P2P = 'p2p';\nexport const USER_NEW = 'new';\n\n// Starting value of a locally-generated seqId used for pending messages.\nexport const LOCAL_SEQID = 0xFFFFFFF;\n\n// Status codes.\nexport const MESSAGE_STATUS_NONE = 0; // Status not assigned.\nexport const MESSAGE_STATUS_QUEUED = 10; // Local ID assigned, in progress to be sent.\nexport const MESSAGE_STATUS_SENDING = 20; // Transmission started.\nexport const MESSAGE_STATUS_FAILED = 30; // At least one attempt was made to send the message.\nexport const MESSAGE_STATUS_FATAL = 40; // Message sending failed and it should not be retried.\nexport const MESSAGE_STATUS_SENT = 50; // Delivered to the server.\nexport const MESSAGE_STATUS_RECEIVED = 60; // Received by the client.\nexport const MESSAGE_STATUS_READ = 70; // Read by the user.\nexport const MESSAGE_STATUS_TO_ME = 80; // The message is received from another user.\n\n// Reject unresolved futures after this many milliseconds.\nexport const EXPIRE_PROMISES_TIMEOUT = 5_000;\n// Periodicity of garbage collection of unresolved futures.\nexport const EXPIRE_PROMISES_PERIOD = 1_000;\n\n// Delay before acknowledging that a message was recived.\nexport const RECV_TIMEOUT = 100;\n\n// Default number of messages to pull into memory from persistent cache.\nexport const DEFAULT_MESSAGES_PAGE = 24;\n\n// Unicode DEL character indicating data was deleted.\nexport const DEL_CHAR = '\\u2421';\n\n// Maximum number of pinnned messages;\nexport const MAX_PINNED_COUNT = 5;\n\n// Tag prefixes for alias, email, phone.\nexport const TAG_ALIAS = 'alias:';\nexport const TAG_EMAIL = 'email:';\nexport const TAG_PHONE = 'tel:';\n\n// Parameters of exponential backoff for reconnect attempts.\n// 2000 milliseconds, minimum delay between reconnects.\nexport const BACKOFF_BASE = 2_000;\n// Maximum delay between reconnects 2^10 * 2000 ~ 34 minutes.\nexport const BACKOFF_MAX_ITER = 10;\n// Random jitter between reconnection attempts, 0.3 -> 30% jitter.\nexport const BACKOFF_JITTER = 0.3;\n\n// Names of keys to server-provided configuration limits.\nexport const MAX_MESSAGE_SIZE = 'maxMessageSize';\nexport const MAX_SUBSCRIBER_COUNT = 'maxSubscriberCount';\nexport const MIN_TAG_LENGTH = 'minTagLength';\nexport const MAX_TAG_LENGTH = 'maxTagLength';\nexport const MAX_TAG_COUNT = 'maxTagCount';\nexport const MAX_FILE_UPLOAD_SIZE = 'maxFileUploadSize';\nexport const REQ_CRED_VALIDATORS = 'reqCred';\nexport const MSG_DELETE_AGE = 'msgDelAge';\nexport const REACTION_LIST = 'reactions';\nexport const MAX_REACTIONS = 'maxReactions';\n","/**\n * @file Abstraction layer for websocket and long polling connections.\n *\n * @copyright 2015-2026 Tinode LLC.\n */\n'use strict';\n\nimport CommError from './comm-error.js';\nimport {\n  BACKOFF_BASE,\n  BACKOFF_MAX_ITER,\n  BACKOFF_JITTER\n} from './config.js';\nimport {\n  jsonParseHelper\n} from './utils.js';\n\n\nlet WebSocketProvider;\nlet XHRProvider;\n\n// Error code to return in case of a network problem.\nconst NETWORK_ERROR = 503;\nconst NETWORK_ERROR_TEXT = \"Connection failed\";\n\n// Error code to return when user disconnected from server.\nconst NETWORK_USER = 418;\nconst NETWORK_USER_TEXT = \"Disconnected by client\";\n\n// Helper function for creating an endpoint URL.\nfunction makeBaseUrl(host, protocol, version, apiKey) {\n  let url = null;\n\n  if (['http', 'https', 'ws', 'wss'].includes(protocol)) {\n    url = `${protocol}://${host}`;\n    if (url.charAt(url.length - 1) !== '/') {\n      url += '/';\n    }\n    url += 'v' + version + '/channels';\n    if (['http', 'https'].includes(protocol)) {\n      // Long polling endpoint ends with \"lp\", i.e.\n      // '/v0/channels/lp' vs just '/v0/channels' for ws\n      url += '/lp';\n    }\n    url += '?apikey=' + apiKey;\n  }\n  return url;\n}\n\n/**\n * An abstraction for a websocket or a long polling connection.\n *\n * @class Connection\n * @memberof Tinode\n\n * @param {Object} config - configuration parameters.\n * @param {string} config.host - Host name and optional port number to connect to.\n * @param {string} config.apiKey - API key generated by <code>keygen</code>.\n * @param {string} config.transport - Network transport to use, either <code>\"ws\"<code>/<code>\"wss\"</code> for websocket or\n *      <code>lp</code> for long polling.\n * @param {boolean} config.secure - Use Secure WebSocket if <code>true</code>.\n * @param {string} version_ - Major value of the protocol version, e.g. '0' in '0.17.1'.\n * @param {boolean} autoreconnect_ - If connection is lost, try to reconnect automatically.\n */\nexport default class Connection {\n  // Logger, does nothing by default.\n  static #log = _ => {};\n\n  #boffTimer = null;\n  #boffIteration = 0;\n  #boffClosed = false; // Indicator if the socket was manually closed - don't autoreconnect if true.\n\n  // Websocket.\n  #socket = null;\n\n  host;\n  secure;\n  apiKey;\n\n  version;\n  autoreconnect;\n\n  initialized;\n\n  // (config.host, config.apiKey, config.transport, config.secure), PROTOCOL_VERSION, true\n  constructor(config, version_, autoreconnect_) {\n    this.host = config.host;\n    this.secure = config.secure;\n    this.apiKey = config.apiKey;\n\n    this.version = version_;\n    this.autoreconnect = autoreconnect_;\n\n    if (config.transport === 'lp') {\n      // explicit request to use long polling\n      this.#init_lp();\n      this.initialized = 'lp';\n    } else if (config.transport === 'ws') {\n      // explicit request to use web socket\n      // if websockets are not available, horrible things will happen\n      this.#init_ws();\n      this.initialized = 'ws';\n    }\n\n    if (!this.initialized) {\n      // Invalid or undefined network transport.\n      Connection.#log(\"Unknown or invalid network transport. Running under Node? Call 'Tinode.setNetworkProviders()'.\");\n      throw new Error(\"Unknown or invalid network transport. Running under Node? Call 'Tinode.setNetworkProviders()'.\");\n    }\n  }\n\n  /**\n   * To use Connection in a non browser context, supply WebSocket and XMLHttpRequest providers.\n   * @static\n   * @memberof Connection\n   * @param {Object} wsProvider - WebSocket provider, e.g. for nodeJS, <code>require('ws')</code>.\n   * @param {Object} xhrProvider - XMLHttpRequest provider, e.g. for node <code>require('xhr')</code>.\n   */\n  static setNetworkProviders(wsProvider, xhrProvider) {\n    WebSocketProvider = wsProvider;\n    XHRProvider = xhrProvider;\n  }\n\n  /**\n   * Assign a non-default logger.\n   * @static\n   * @memberof Connection\n   * @param {Function} l - variadic logging function.\n   */\n  static set logger(l) {\n    Connection.#log = l;\n  }\n\n  /**\n   * Initiate a new connection\n   * @memberof Tinode.Connection#\n   * @param {string} host_ - Host name to connect to; if <code>null</code> the old host name will be used.\n   * @param {boolean} force - Force new connection even if one already exists.\n   * @returns {Promise} Promise resolved/rejected when the connection call completes, resolution is called without\n   *  parameters, rejection passes the {Error} as parameter.\n   */\n  connect(host_, force) {\n    return Promise.reject(null);\n  }\n\n  /**\n   * Try to restore a network connection, also reset backoff.\n   * @memberof Tinode.Connection#\n   *\n   * @param {boolean} force - reconnect even if there is a live connection already.\n   */\n  reconnect(force) {}\n\n  /**\n   * Terminate the network connection\n   * @memberof Tinode.Connection#\n   */\n  disconnect() {}\n\n  /**\n   * Send a string to the server.\n   * @memberof Tinode.Connection#\n   *\n   * @param {string} msg - String to send.\n   * @throws Throws an exception if the underlying connection is not live.\n   */\n  sendText(msg) {}\n\n  /**\n   * Check if connection is alive.\n   * @memberof Tinode.Connection#\n   * @returns {boolean} <code>true</code> if connection is live, <code>false</code> otherwise.\n   */\n  isConnected() {\n    return false;\n  }\n\n  /**\n   * Get the name of the current network transport.\n   * @memberof Tinode.Connection#\n   * @returns {string} name of the transport such as <code>\"ws\"</code> or <code>\"lp\"</code>.\n   */\n  transport() {\n    return this.initialized;\n  }\n\n  /**\n   * Send network probe to check if connection is indeed live.\n   * @memberof Tinode.Connection#\n   */\n  probe() {\n    this.sendText('1');\n  }\n\n  /**\n   * Reset autoreconnect counter to zero.\n   * @memberof Tinode.Connection#\n   */\n  backoffReset() {\n    this.#boffReset();\n  }\n\n  // Backoff implementation - reconnect after a timeout.\n  #boffReconnect() {\n    // Clear timer\n    clearTimeout(this.#boffTimer);\n    // Calculate when to fire the reconnect attempt\n    const timeout = BACKOFF_BASE * (Math.pow(2, this.#boffIteration) * (1.0 + BACKOFF_JITTER * Math.random()));\n    // Update iteration counter for future use\n    this.#boffIteration = (this.#boffIteration >= BACKOFF_MAX_ITER ? this.#boffIteration : this.#boffIteration + 1);\n    if (this.onAutoreconnectIteration) {\n      this.onAutoreconnectIteration(timeout);\n    }\n\n    this.#boffTimer = setTimeout(_ => {\n      Connection.#log(`Reconnecting, iter=${this.#boffIteration}, timeout=${timeout}`);\n      // Maybe the socket was closed while we waited for the timer?\n      if (!this.#boffClosed) {\n        const prom = this.connect();\n        if (this.onAutoreconnectIteration) {\n          this.onAutoreconnectIteration(0, prom);\n        } else {\n          // Suppress error if it's not used.\n          prom.catch(_ => {\n            /* do nothing */\n          });\n        }\n      } else if (this.onAutoreconnectIteration) {\n        this.onAutoreconnectIteration(-1);\n      }\n    }, timeout);\n  }\n\n  // Terminate auto-reconnect process.\n  #boffStop() {\n    clearTimeout(this.#boffTimer);\n    this.#boffTimer = null;\n  }\n\n  // Reset auto-reconnect iteration counter.\n  #boffReset() {\n    this.#boffIteration = 0;\n  }\n\n  // Initialization for long polling.\n  #init_lp() {\n    const XDR_UNSENT = 0; // Client has been created. open() not called yet.\n    const XDR_OPENED = 1; // open() has been called.\n    const XDR_HEADERS_RECEIVED = 2; // send() has been called, and headers and status are available.\n    const XDR_LOADING = 3; // Downloading; responseText holds partial data.\n    const XDR_DONE = 4; // The operation is complete.\n\n    // Fully composed endpoint URL, with API key & SID\n    let _lpURL = null;\n\n    let _poller = null;\n    let _sender = null;\n\n    let lp_sender = (url_) => {\n      const sender = new XHRProvider();\n      sender.onreadystatechange = (evt) => {\n        if (sender.readyState == XDR_DONE && sender.status >= 400) {\n          // Some sort of error response\n          throw new CommError(\"LP sender failed\", sender.status);\n        }\n      };\n\n      sender.open('POST', url_, true);\n      return sender;\n    }\n\n    let lp_poller = (url_, resolve, reject) => {\n      let poller = new XHRProvider();\n      let promiseCompleted = false;\n\n      poller.onreadystatechange = evt => {\n        if (poller.readyState == XDR_DONE) {\n          if (poller.status == 201) { // 201 == HTTP.Created, get SID\n            let pkt = JSON.parse(poller.responseText, jsonParseHelper);\n            _lpURL = url_ + '&sid=' + pkt.ctrl.params.sid;\n            poller = lp_poller(_lpURL);\n            poller.send(null);\n            if (this.onOpen) {\n              this.onOpen();\n            }\n\n            if (resolve) {\n              promiseCompleted = true;\n              resolve();\n            }\n\n            if (this.autoreconnect) {\n              this.#boffStop();\n            }\n          } else if (poller.status > 0 && poller.status < 400) { // 0 = network error; 400 = HTTP.BadRequest\n            if (this.onMessage) {\n              this.onMessage(poller.responseText);\n            }\n            poller = lp_poller(_lpURL);\n            poller.send(null);\n          } else {\n            // Don't throw an error here, gracefully handle server errors\n            if (reject && !promiseCompleted) {\n              promiseCompleted = true;\n              reject(poller.responseText);\n            }\n            if (this.onMessage && poller.responseText) {\n              this.onMessage(poller.responseText);\n            }\n            if (this.onDisconnect) {\n              const code = poller.status || (this.#boffClosed ? NETWORK_USER : NETWORK_ERROR);\n              const text = poller.responseText || (this.#boffClosed ? NETWORK_USER_TEXT : NETWORK_ERROR_TEXT);\n              this.onDisconnect(new CommError(text, code), code);\n            }\n\n            // Polling has stopped. Indicate it by setting poller to null.\n            poller = null;\n            if (!this.#boffClosed && this.autoreconnect) {\n              this.#boffReconnect();\n            }\n          }\n        }\n      };\n      // Using POST to avoid caching response by service worker.\n      poller.open('POST', url_, true);\n      return poller;\n    }\n\n    this.connect = (host_, force) => {\n      this.#boffClosed = false;\n\n      if (_poller) {\n        if (!force) {\n          return Promise.resolve();\n        }\n        _poller.onreadystatechange = undefined;\n        _poller.abort();\n        _poller = null;\n      }\n\n      if (host_) {\n        this.host = host_;\n      }\n\n      return new Promise((resolve, reject) => {\n        const url = makeBaseUrl(this.host, this.secure ? 'https' : 'http', this.version, this.apiKey);\n        Connection.#log(\"LP connecting to:\", url);\n        _poller = lp_poller(url, resolve, reject);\n        _poller.send(null);\n      }).catch(err => {\n        Connection.#log(\"LP connection failed:\", err);\n      });\n    };\n\n    this.reconnect = force => {\n      this.#boffStop();\n      this.connect(null, force);\n    };\n\n    this.disconnect = _ => {\n      this.#boffClosed = true;\n      this.#boffStop();\n\n      if (_sender) {\n        _sender.onreadystatechange = undefined;\n        _sender.abort();\n        _sender = null;\n      }\n      if (_poller) {\n        _poller.onreadystatechange = undefined;\n        _poller.abort();\n        _poller = null;\n      }\n\n      if (this.onDisconnect) {\n        this.onDisconnect(new CommError(NETWORK_USER_TEXT, NETWORK_USER), NETWORK_USER);\n      }\n      // Ensure it's reconstructed\n      _lpURL = null;\n    };\n\n    this.sendText = (msg) => {\n      _sender = lp_sender(_lpURL);\n      if (_sender && (_sender.readyState == XDR_OPENED)) {\n        _sender.send(msg);\n      } else {\n        throw new Error(\"Long poller failed to connect\");\n      }\n    };\n\n    this.isConnected = _ => {\n      return (_poller && true);\n    };\n  }\n\n  // Initialization for Websocket\n  #init_ws() {\n    this.connect = (host_, force) => {\n      this.#boffClosed = false;\n\n      if (this.#socket) {\n        if (!force && this.#socket.readyState == this.#socket.OPEN) {\n          // Issue a probe request to be sure the connection is live.\n          // This is a non-blocking call.\n          this.probe();\n          return Promise.resolve();\n        }\n        this.#socket.close();\n        this.#socket = null;\n      }\n\n      if (host_) {\n        this.host = host_;\n      }\n\n      return new Promise((resolve, reject) => {\n        const url = makeBaseUrl(this.host, this.secure ? 'wss' : 'ws', this.version, this.apiKey);\n\n        Connection.#log(\"WS connecting to: \", url);\n\n        // It throws when the server is not accessible but the exception cannot be caught:\n        // https://stackoverflow.com/questions/31002592/javascript-doesnt-catch-error-in-websocket-instantiation/31003057\n        const conn = new WebSocketProvider(url);\n\n        conn.onerror = err => {\n          reject(err);\n        };\n\n        conn.onopen = _ => {\n          if (this.autoreconnect) {\n            this.#boffStop();\n          }\n\n          if (this.onOpen) {\n            this.onOpen();\n          }\n\n          resolve();\n        };\n\n        conn.onclose = _ => {\n          this.#socket = null;\n\n          if (this.onDisconnect) {\n            const code = this.#boffClosed ? NETWORK_USER : NETWORK_ERROR;\n            this.onDisconnect(new CommError(this.#boffClosed ? NETWORK_USER_TEXT : NETWORK_ERROR_TEXT, code), code);\n          }\n\n          if (!this.#boffClosed && this.autoreconnect) {\n            this.#boffReconnect();\n          }\n        };\n\n        conn.onmessage = evt => {\n          if (this.onMessage) {\n            this.onMessage(evt.data);\n          }\n        };\n\n        this.#socket = conn;\n      });\n    }\n\n    this.reconnect = force => {\n      this.#boffStop();\n      this.connect(null, force);\n    };\n\n    this.disconnect = _ => {\n      this.#boffClosed = true;\n      this.#boffStop();\n\n      if (!this.#socket) {\n        return;\n      }\n      this.#socket.close();\n      this.#socket = null;\n    };\n\n    this.sendText = msg => {\n      if (this.#socket && (this.#socket.readyState == this.#socket.OPEN)) {\n        this.#socket.send(msg);\n      } else {\n        throw new Error(\"Websocket is not connected\");\n      }\n    };\n\n    this.isConnected = _ => {\n      return (this.#socket && (this.#socket.readyState == this.#socket.OPEN));\n    };\n  }\n\n  // Callbacks:\n\n  /**\n   * A callback to pass incoming messages to. See {@link Tinode.Connection#onMessage}.\n   * @callback Tinode.Connection.OnMessage\n   * @memberof Tinode.Connection\n   * @param {string} message - Message to process.\n   */\n  onMessage = undefined;\n\n  /**\n   * A callback for reporting a dropped connection.\n   * @type {function}\n   * @memberof Tinode.Connection#\n   */\n  onDisconnect = undefined;\n\n  /**\n   * A callback called when the connection is ready to be used for sending. For websockets it's socket open,\n   * for long polling it's <code>readyState=1</code> (OPENED)\n   * @type {function}\n   * @memberof Tinode.Connection#\n   */\n  onOpen = undefined;\n\n  /**\n   * A callback to notify of reconnection attempts. See {@link Tinode.Connection#onAutoreconnectIteration}.\n   * @memberof Tinode.Connection\n   * @callback AutoreconnectIterationType\n   * @param {string} timeout - time till the next reconnect attempt in milliseconds. <code>-1</code> means reconnect was skipped.\n   * @param {Promise} promise - promise resolved or rejected when the reconnect attempt completes.\n   *\n   */\n  /**\n   * A callback to inform when the next attempt to reconnect will happen and to receive connection promise.\n   * @memberof Tinode.Connection#\n   * @type {Tinode.Connection.AutoreconnectIterationType}\n   */\n  onAutoreconnectIteration = undefined;\n}\n\nConnection.NETWORK_ERROR = NETWORK_ERROR;\nConnection.NETWORK_ERROR_TEXT = NETWORK_ERROR_TEXT;\nConnection.NETWORK_USER = NETWORK_USER;\nConnection.NETWORK_USER_TEXT = NETWORK_USER_TEXT;\n","/**\n * @file Helper methods for dealing with IndexedDB cache of messages, users, and topics.\n *\n * @copyright 2015-2026 Tinode LLC.\n */\n'use strict';\n\n// NOTE TO DEVELOPERS:\n// Localizable strings should be double quoted \"   \",\n// non-localizable strings should be single quoted 'non-localized'.\n\nconst DB_VERSION = 3;\nconst DB_NAME = 'tinode-web';\n\nlet IDBProvider;\n\nexport default class DB {\n  #onError = _ => {};\n  #logger = _ => {};\n\n  // Instance of IndexDB.\n  db = null;\n  // Indicator that the cache is disabled.\n  disabled = true;\n\n  constructor(onError, logger) {\n    this.#onError = onError || this.#onError;\n    this.#logger = logger || this.#logger;\n  }\n\n  #mapObjects(source, callback, context) {\n    if (!this.db) {\n      return disabled ?\n        Promise.resolve([]) :\n        Promise.reject(new Error(\"not initialized\"));\n    }\n\n    return new Promise((resolve, reject) => {\n      const trx = this.db.transaction([source]);\n      trx.onerror = event => {\n        this.#logger('PCache', 'mapObjects', source, event.target.error);\n        reject(event.target.error);\n      };\n      trx.objectStore(source).getAll().onsuccess = event => {\n        if (callback) {\n          event.target.result.forEach(topic => {\n            callback.call(context, topic);\n          });\n        }\n        resolve(event.target.result);\n      };\n    });\n  }\n\n  /**\n   * Initialize persistent cache: open or create/upgrade if needed.\n   * @returns {Promise} promise to be resolved/rejected when the DB is initialized.\n   */\n  initDatabase() {\n    return new Promise((resolve, reject) => {\n      // Open the database and initialize callbacks.\n      const req = IDBProvider.open(DB_NAME, DB_VERSION);\n      req.onsuccess = event => {\n        this.db = event.target.result;\n        this.disabled = false;\n\n        // This handler is called when a different tab tries to upgrade the database.\n        this.db.onversionchange = _ => {\n          this.#logger('PCache', \"another tab tries to upgrade DB, shutting down\");\n          this.db.close();\n          this.db = null;\n          this.disabled = true;\n        };\n\n        resolve(this.db);\n      };\n      req.onerror = event => {\n        this.#logger('PCache', \"failed to initialize\", event);\n        reject(event.target.error);\n        this.#onError(event.target.error);\n      };\n      req.onupgradeneeded = event => {\n        this.db = event.target.result;\n\n        this.db.onerror = event => {\n          this.#logger('PCache', \"failed to create storage\", event);\n          this.#onError(event.target.error);\n        };\n\n        // Individual object stores.\n\n        // Alternatively could use event.oldVersion and event.newVersion\n        // to determine which object stores to create or upgrade.\n\n        if (!this.db.objectStoreNames.contains('topic')) {\n          // Object store (table) for topics. The primary key is the topic name.\n          this.db.createObjectStore('topic', {\n            keyPath: 'name'\n          });\n        }\n\n        if (!this.db.objectStoreNames.contains('user')) {\n          // Users object store. UID is the primary key.\n          this.db.createObjectStore('user', {\n            keyPath: 'uid'\n          });\n        }\n\n        if (!this.db.objectStoreNames.contains('subscription')) {\n          // Subscriptions object store topic <-> user. Topic name + UID is the primary key.\n          this.db.createObjectStore('subscription', {\n            keyPath: ['topic', 'uid']\n          });\n        }\n\n        if (!this.db.objectStoreNames.contains('message')) {\n          // Messages object store. The primary key is topic name + seq.\n          this.db.createObjectStore('message', {\n            keyPath: ['topic', 'seq']\n          });\n        }\n\n        if (!this.db.objectStoreNames.contains('dellog')) {\n          // Records of deleted message ranges. The primary key is topic name + low seq.\n          const dellog = this.db.createObjectStore('dellog', {\n            keyPath: ['topic', 'low', 'hi']\n          });\n          if (!dellog.indexNames.contains('topic_clear')) {\n            dellog.createIndex('topic_clear', ['topic', 'clear'], {\n              unique: false\n            });\n          }\n        }\n      }\n    });\n  }\n\n  /**\n   * Delete persistent cache.\n   */\n  deleteDatabase() {\n    // Close connection, otherwise operations will fail with 'onblocked'.\n    if (this.db) {\n      this.db.close();\n      this.db = null;\n    }\n    return new Promise((resolve, reject) => {\n      const req = IDBProvider.deleteDatabase(DB_NAME);\n      req.onblocked = _ => {\n        if (this.db) {\n          this.db.close();\n        }\n        const err = new Error(\"blocked\");\n        this.#logger('PCache', 'deleteDatabase', err);\n        reject(err);\n      };\n      req.onsuccess = _ => {\n        this.db = null;\n        this.disabled = true;\n        resolve(true);\n      };\n      req.onerror = event => {\n        this.#logger('PCache', 'deleteDatabase', event.target.error);\n        reject(event.target.error);\n      };\n    });\n  }\n\n  /**\n   * Check if persistent cache is ready for use.\n   * @memberOf DB\n   * @returns {boolean} <code>true</code> if cache is ready, <code>false</code> otherwise.\n   */\n  isReady() {\n    return !!this.db;\n  }\n\n  // Topics.\n\n  /**\n   * Save to cache or update topic in persistent cache.\n   * @memberOf DB\n   * @param {Topic} topic - topic to be added or updated.\n   * @returns {Promise} promise resolved/rejected on operation completion.\n   */\n  updTopic(topic) {\n    if (!this.isReady()) {\n      return this.disabled ?\n        Promise.resolve() :\n        Promise.reject(new Error(\"not initialized\"));\n    }\n    return new Promise((resolve, reject) => {\n      const trx = this.db.transaction(['topic'], 'readwrite');\n      trx.oncomplete = event => {\n        resolve(event.target.result);\n      };\n      trx.onerror = event => {\n        this.#logger('PCache', 'updTopic', event.target.error);\n        reject(event.target.error);\n      };\n      const req = trx.objectStore('topic').get(topic.name);\n      req.onsuccess = _ => {\n        trx.objectStore('topic').put(DB.#serializeTopic(req.result, topic));\n        trx.commit();\n      };\n    });\n  }\n\n  /**\n   * Mark or unmark topic as deleted.\n   * @memberOf DB\n   * @param {string} name - name of the topic to mark or unmark.\n   * @param {boolean} deleted - status\n   * @return {Promise} promise resolved/rejected on operation completion.\n   */\n  markTopicAsDeleted(name, deleted) {\n    if (!this.isReady()) {\n      return this.disabled ?\n        Promise.resolve() :\n        Promise.reject(new Error(\"not initialized\"));\n    }\n    return new Promise((resolve, reject) => {\n      const trx = this.db.transaction(['topic'], 'readwrite');\n      trx.oncomplete = event => {\n        resolve(event.target.result);\n      };\n      trx.onerror = event => {\n        this.#logger('PCache', 'markTopicAsDeleted', event.target.error);\n        reject(event.target.error);\n      };\n      const req = trx.objectStore('topic').get(name);\n      req.onsuccess = event => {\n        const topic = event.target.result;\n        if (topic && topic._deleted != deleted) {\n          topic._deleted = deleted;\n          trx.objectStore('topic').put(topic);\n        }\n        trx.commit();\n      };\n    });\n  }\n\n  /**\n   * Remove topic from persistent cache.\n   * @memberOf DB\n   * @param {string} name - name of the topic to remove from database.\n   * @return {Promise} promise resolved/rejected on operation completion.\n   */\n  remTopic(name) {\n    if (!this.isReady()) {\n      return this.disabled ?\n        Promise.resolve() :\n        Promise.reject(new Error(\"not initialized\"));\n    }\n    return new Promise((resolve, reject) => {\n      const trx = this.db.transaction(['topic', 'subscription', 'message'], 'readwrite');\n      trx.oncomplete = event => {\n        resolve(event.target.result);\n      };\n      trx.onerror = event => {\n        this.#logger('PCache', 'remTopic', event.target.error);\n        reject(event.target.error);\n      };\n      trx.objectStore('topic').delete(IDBKeyRange.only(name));\n      trx.objectStore('subscription').delete(IDBKeyRange.bound([name, '-'], [name, '~']));\n      trx.objectStore('message').delete(IDBKeyRange.bound([name, 0], [name, Number.MAX_SAFE_INTEGER]));\n      trx.commit();\n    });\n  }\n\n  /**\n   * Execute a callback for each stored topic.\n   * @memberOf DB\n   * @param {function} callback - function to call for each topic.\n   * @param {Object} context - the value or <code>this</code> inside the callback.\n   * @return {Promise} promise resolved/rejected on operation completion.\n   */\n  mapTopics(callback, context) {\n    return this.#mapObjects('topic', callback, context);\n  }\n\n  /**\n   * Copy data from serialized object to topic.\n   * @memberOf DB\n   * @param {Topic} topic - target to deserialize to.\n   * @param {Object} src - serialized data to copy from.\n   */\n  deserializeTopic(topic, src) {\n    DB.#deserializeTopic(topic, src);\n  }\n\n  // Users.\n  /**\n   * Add or update user object in the persistent cache.\n   * @memberOf DB\n   * @param {string} uid - ID of the user to save or update.\n   * @param {Object} pub - user's <code>public</code> information.\n   * @returns {Promise} promise resolved/rejected on operation completion.\n   */\n  updUser(uid, pub) {\n    if (arguments.length < 2 || pub === undefined) {\n      // No point in updating user with invalid data.\n      return;\n    }\n    if (!this.isReady()) {\n      return this.disabled ?\n        Promise.resolve() :\n        Promise.reject(new Error(\"not initialized\"));\n    }\n    return new Promise((resolve, reject) => {\n      const trx = this.db.transaction(['user'], 'readwrite');\n      trx.oncomplete = event => {\n        resolve(event.target.result);\n      };\n      trx.onerror = event => {\n        this.#logger('PCache', 'updUser', event.target.error);\n        reject(event.target.error);\n      };\n      trx.objectStore('user').put({\n        uid: uid,\n        public: pub\n      });\n      trx.commit();\n    });\n  }\n\n  /**\n   * Remove user from persistent cache.\n   * @memberOf DB\n   * @param {string} uid - ID of the user to remove from the cache.\n   * @return {Promise} promise resolved/rejected on operation completion.\n   */\n  remUser(uid) {\n    if (!this.isReady()) {\n      return this.disabled ?\n        Promise.resolve() :\n        Promise.reject(new Error(\"not initialized\"));\n    }\n    return new Promise((resolve, reject) => {\n      const trx = this.db.transaction(['user'], 'readwrite');\n      trx.oncomplete = event => {\n        resolve(event.target.result);\n      };\n      trx.onerror = event => {\n        this.#logger('PCache', 'remUser', event.target.error);\n        reject(event.target.error);\n      };\n      trx.objectStore('user').delete(IDBKeyRange.only(uid));\n      trx.commit();\n    });\n  }\n\n  /**\n   * Execute a callback for each stored user.\n   * @memberOf DB\n   * @param {function} callback - function to call for each topic.\n   * @param {Object} context - the value or <code>this</code> inside the callback.\n   * @return {Promise} promise resolved/rejected on operation completion.\n   */\n  mapUsers(callback, context) {\n    return this.#mapObjects('user', callback, context);\n  }\n\n  /**\n   * Read a single user from persistent cache.\n   * @memberOf DB\n   * @param {string} uid - ID of the user to fetch from cache.\n   * @return {Promise} promise resolved/rejected on operation completion.\n   */\n  getUser(uid) {\n    if (!this.isReady()) {\n      return this.disabled ?\n        Promise.resolve() :\n        Promise.reject(new Error(\"not initialized\"));\n    }\n    return new Promise((resolve, reject) => {\n      const trx = this.db.transaction(['user']);\n      trx.oncomplete = event => {\n        const user = event.target.result;\n        resolve({\n          user: user.uid,\n          public: user.public\n        });\n      };\n      trx.onerror = event => {\n        this.#logger('PCache', 'getUser', event.target.error);\n        reject(event.target.error);\n      };\n      trx.objectStore('user').get(uid);\n    });\n  }\n\n  // Subscriptions.\n  /**\n   * Add or update subscription in persistent cache.\n   * @memberOf DB\n   * @param {string} topicName - name of the topic which owns the message.\n   * @param {string} uid - ID of the subscribed user.\n   * @param {Object} sub - subscription to save.\n   * @return {Promise} promise resolved/rejected on operation completion.\n   */\n  updSubscription(topicName, uid, sub) {\n    if (!this.isReady()) {\n      return this.disabled ?\n        Promise.resolve() :\n        Promise.reject(new Error(\"not initialized\"));\n    }\n    return new Promise((resolve, reject) => {\n      const trx = this.db.transaction(['subscription'], 'readwrite');\n      trx.oncomplete = event => {\n        resolve(event.target.result);\n      };\n      trx.onerror = event => {\n        this.#logger('PCache', 'updSubscription', event.target.error);\n        reject(event.target.error);\n      };\n      trx.objectStore('subscription').get([topicName, uid]).onsuccess = (event) => {\n        trx.objectStore('subscription').put(DB.#serializeSubscription(event.target.result, topicName, uid, sub));\n        trx.commit();\n      };\n    });\n  }\n\n  /**\n   * Execute a callback for each cached subscription in a given topic.\n   * @memberOf DB\n   * @param {string} topicName - name of the topic which owns the subscriptions.\n   * @param {function} callback - function to call for each subscription.\n   * @param {Object} context - the value or <code>this</code> inside the callback.\n   * @return {Promise} promise resolved/rejected on operation completion.\n   */\n  mapSubscriptions(topicName, callback, context) {\n    if (!this.isReady()) {\n      return this.disabled ?\n        Promise.resolve([]) :\n        Promise.reject(new Error(\"not initialized\"));\n    }\n    return new Promise((resolve, reject) => {\n      const trx = this.db.transaction(['subscription']);\n      trx.onerror = (event) => {\n        this.#logger('PCache', 'mapSubscriptions', event.target.error);\n        reject(event.target.error);\n      };\n      trx.objectStore('subscription').getAll(IDBKeyRange.bound([topicName, '-'], [topicName, '~'])).onsuccess = (event) => {\n        if (callback) {\n          event.target.result.forEach((topic) => {\n            callback.call(context, topic);\n          });\n        }\n        resolve(event.target.result);\n      };\n    });\n  }\n\n  // Messages.\n\n  /**\n   * Save message to persistent cache.\n   * @memberOf DB\n   * @param {Object} msg - message to save.\n   * @return {Promise} promise resolved/rejected on operation completion.\n   */\n  addMessage(msg) {\n    if (!this.isReady()) {\n      return this.disabled ?\n        Promise.resolve() :\n        Promise.reject(new Error(\"not initialized\"));\n    }\n    return new Promise((resolve, reject) => {\n      const trx = this.db.transaction(['message'], 'readwrite');\n      trx.onsuccess = event => {\n        resolve(event.target.result);\n      };\n      trx.onerror = event => {\n        this.#logger('PCache', 'addMessage', event.target.error);\n        reject(event.target.error);\n      };\n      trx.objectStore('message').add(DB.#serializeMessage(null, msg));\n      trx.commit();\n    });\n  }\n\n  /**\n   * Update delivery status of a message stored in persistent cache.\n   * @memberOf DB\n   * @param {string} topicName - name of the topic which owns the message.\n   * @param {number} seq - ID of the message to update\n   * @param {number} status - new delivery status of the message.\n   * @return {Promise} promise resolved/rejected on operation completion.\n   */\n  updMessageStatus(topicName, seq, status) {\n    if (!this.isReady()) {\n      return this.disabled ?\n        Promise.resolve() :\n        Promise.reject(new Error(\"not initialized\"));\n    }\n    return new Promise((resolve, reject) => {\n      const trx = this.db.transaction(['message'], 'readwrite');\n      trx.onsuccess = event => {\n        resolve(event.target.result);\n      };\n      trx.onerror = event => {\n        this.#logger('PCache', 'updMessageStatus', event.target.error);\n        reject(event.target.error);\n      };\n      const req = trx.objectStore('message').get(IDBKeyRange.only([topicName, seq]));\n      req.onsuccess = event => {\n        const src = req.result || event.target.result;\n        if (src && src._status != status) {\n          trx.objectStore('message').put(DB.#serializeMessage(src, {\n            topic: topicName,\n            seq: seq,\n            _status: status\n          }));\n        }\n        trx.commit();\n      };\n    });\n  }\n\n  /**\n   * Update reactions to a message.\n   * @memberOf DB\n   * @param {string} topicName - name of the topic which owns the message.\n   * @param {number} seq - ID of the message to update.\n   * @param {Array} react - updated reactions.\n   * @return {Promise} promise resolved/rejected on operation completion.\n   */\n  updMessageReact(topicName, seq, react) {\n    if (!this.isReady()) {\n      return this.disabled ?\n        Promise.resolve() :\n        Promise.reject(new Error(\"not initialized\"));\n    }\n    return new Promise((resolve, reject) => {\n      const trx = this.db.transaction(['message'], 'readwrite');\n      trx.onsuccess = event => {\n        resolve(event.target.result);\n      };\n      trx.onerror = event => {\n        this.#logger('PCache', 'updMessageReact', event.target.error);\n        reject(event.target.error);\n      };\n      const req = trx.objectStore('message').get(IDBKeyRange.only([topicName, seq]));\n      req.onsuccess = event => {\n        const src = req.result || event.target.result;\n        if (src && src.react !== react) {\n          trx.objectStore('message').put(DB.#serializeMessage(src, {\n            topic: topicName,\n            seq: seq,\n            react: react\n          }));\n        }\n        trx.commit();\n      };\n    });\n  }\n\n  /**\n   * Remove one or more messages from persistent cache.\n   * @memberOf DB\n   * @param {string} topicName - name of the topic which owns the message.\n   * @param {number} from - id of the message to remove or lower boundary when removing range (inclusive).\n   * @param {number=} to - upper boundary (exclusive) when removing a range of messages.\n   * @return {Promise} promise resolved/rejected on operation completion.\n   */\n  remMessages(topicName, from, to) {\n    if (!this.isReady()) {\n      return this.disabled ?\n        Promise.resolve() :\n        Promise.reject(new Error(\"not initialized\"));\n    }\n    return new Promise((resolve, reject) => {\n      if (!from && !to) {\n        from = 0;\n        to = Number.MAX_SAFE_INTEGER;\n      }\n      const range = to > 0 ? IDBKeyRange.bound([topicName, from], [topicName, to], false, true) :\n        IDBKeyRange.only([topicName, from]);\n      const trx = this.db.transaction(['message'], 'readwrite');\n      trx.onsuccess = event => {\n        resolve(event.target.result);\n      };\n      trx.onerror = event => {\n        this.#logger('PCache', 'remMessages', event.target.error);\n        reject(event.target.error);\n      };\n      trx.objectStore('message').delete(range);\n      trx.commit();\n    });\n  }\n\n  /**\n   * Retrieve messages from persistent store.\n   * @memberOf DB\n   * @param {string} topicName - name of the topic to retrieve messages from.\n   * @param {function} callback to call for each retrieved message.\n   * @param {GetDataType} query - parameters of the message range to retrieve.\n   *\n   * @return {Promise} promise resolved/rejected on operation completion.\n   */\n  readMessages(topicName, query, callback, context) {\n    query = query || {};\n\n    if (!this.isReady()) {\n      return this.disabled ?\n        Promise.resolve([]) :\n        Promise.reject(new Error(\"not initialized\"));\n    }\n\n    const trx = this.db.transaction(['message']);\n    let result = [];\n\n    // Handle individual message ranges.\n    if (Array.isArray(query.ranges)) {\n      return new Promise((resolve, reject) => {\n        trx.onerror = event => {\n          this.#logger('PCache', 'readMessages', event.target.error);\n          reject(event.target.error);\n        };\n\n        let count = 0;\n        query.ranges.forEach(range => {\n          const key = range.hi ? IDBKeyRange.bound([topicName, range.low], [topicName, range.hi], false, true) :\n            IDBKeyRange.only([topicName, range.low]);\n          trx.objectStore('message').getAll(key).onsuccess = event => {\n            const msgs = event.target.result;\n            if (msgs) {\n              if (callback) {\n                callback.call(context, msgs);\n              }\n              if (Array.isArray(msgs)) {\n                result = result.concat(msgs);\n              } else {\n                result.push(msgs);\n              }\n            }\n            count++;\n            if (count == query.ranges.length) {\n              resolve(result);\n            }\n          };\n        });\n      });\n    }\n\n    // Handle single range.\n    return new Promise((resolve, reject) => {\n      const since = query.since > 0 ? query.since : 0;\n      const before = query.before > 0 ? query.before : Number.MAX_SAFE_INTEGER;\n      const limit = query.limit | 0;\n\n      trx.onerror = event => {\n        this.#logger('PCache', 'readMessages', event.target.error);\n        reject(event.target.error);\n      };\n\n      const range = IDBKeyRange.bound([topicName, since], [topicName, before], false, true);\n      // Iterate in descending order.\n      trx.objectStore('message').openCursor(range, 'prev')\n        .onsuccess = event => {\n          const cursor = event.target.result;\n          if (cursor) {\n            if (callback) {\n              callback.call(context, cursor.value);\n            }\n            result.push(cursor.value);\n            if (limit <= 0 || result.length < limit) {\n              cursor.continue();\n            } else {\n              resolve(result);\n            }\n          } else {\n            resolve(result);\n          }\n        };\n    });\n  }\n\n  // Delete log\n\n  /**\n   * Add records of deleted messages.\n   * @memberOf DB\n   * @param {string} topicName - name of the topic which owns the message.\n   * @param {number} delId - id of the deletion transaction.\n   * @param {Array.<IdRange>} ranges - message to save.\n   * @return {Promise} promise resolved/rejected on operation completion.\n   */\n  addDelLog(topicName, delId, ranges) {\n    if (!this.isReady()) {\n      return this.disabled ?\n        Promise.resolve() :\n        Promise.reject(new Error(\"not initialized\"));\n    }\n    return new Promise((resolve, reject) => {\n      const trx = this.db.transaction(['dellog'], 'readwrite');\n      trx.onsuccess = event => {\n        resolve(event.target.result);\n      };\n      trx.onerror = event => {\n        this.#logger('PCache', 'addDelLog', event.target.error);\n        reject(event.target.error);\n      };\n      ranges.forEach(r => trx.objectStore('dellog').add({\n        topic: topicName,\n        clear: delId,\n        low: r.low,\n        hi: r.hi || (r.low + 1)\n      }));\n      trx.commit();\n    });\n  }\n\n  /**\n   * Retrieve deleted message records from persistent store.\n   * @memberOf DB\n   * @param {string} topicName - name of the topic to retrieve records for.\n   * @param {GetDataType} query - parameters of the message range to retrieve.\n   * @return {Promise} promise resolved/rejected on operation completion.\n   */\n  readDelLog(topicName, query) {\n    query = query || {};\n\n    if (!this.isReady()) {\n      return this.disabled ?\n        Promise.resolve([]) :\n        Promise.reject(new Error(\"not initialized\"));\n    }\n\n    const trx = this.db.transaction(['dellog']);\n    let result = [];\n\n    // Handle individual message ranges.\n    if (Array.isArray(query.ranges)) {\n      return new Promise((resolve, reject) => {\n        trx.onerror = event => {\n          this.#logger('PCache', 'readDelLog', event.target.error);\n          reject(event.target.error);\n        };\n\n        let count = 0;\n        query.ranges.forEach(range => {\n          const hi = range.hi || (range.low + 1);\n          const key = IDBKeyRange.bound([topicName, 0, range.low], [topicName, hi, Number.MAX_SAFE_INTEGER], false, true);\n          trx.objectStore('dellog').getAll(key).onsuccess = event => {\n            const entries = event.target.result;\n            if (entries) {\n              if (Array.isArray(entries)) {\n                result = result.concat(entries.map(entry => {\n                  return {\n                    low: entry.low,\n                    hi: entry.hi\n                  };\n                }));\n              } else {\n                result.push({\n                  low: entries.low,\n                  hi: entries.hi\n                });\n              }\n            }\n            count++;\n            if (count == query.ranges.length) {\n              resolve(result);\n            }\n          };\n        });\n      });\n    }\n\n    return new Promise((resolve, reject) => {\n      const since = query.since > 0 ? query.since : 0;\n      const before = query.before > 0 ? query.before : Number.MAX_SAFE_INTEGER;\n      const limit = query.limit | 0;\n\n      trx.onerror = event => {\n        this.#logger('PCache', 'readDelLog', event.target.error);\n        reject(event.target.error);\n      };\n\n      let count = 0;\n      const result = [];\n      const range = IDBKeyRange.bound([topicName, 0, since], [topicName, before, Number.MAX_SAFE_INTEGER], false, true);\n      trx.objectStore('dellog').openCursor(range, 'prev')\n        .onsuccess = event => {\n          const cursor = event.target.result;\n          if (cursor) {\n            result.push({\n              low: cursor.value.low,\n              hi: cursor.value.hi\n            });\n            count += cursor.value.hi - cursor.value.low;\n            if (limit <= 0 || count < limit) {\n              cursor.continue();\n            } else {\n              resolve(result);\n            }\n          } else {\n            resolve(result);\n          }\n        };\n    });\n  }\n\n  /**\n   * Retrieve the latest 'clear' ID for the given topic.\n   * @param {string} topicName\n   * @return {Promise} promise resolved/rejected on operation completion.\n   */\n  maxDelId(topicName) {\n    if (!this.isReady()) {\n      return this.disabled ?\n        Promise.resolve(0) :\n        Promise.reject(new Error(\"not initialized\"));\n    }\n\n    return new Promise((resolve, reject) => {\n      const trx = this.db.transaction(['dellog']);\n      trx.onerror = event => {\n        this.#logger('PCache', 'maxDelId', event.target.error);\n        reject(event.target.error);\n      };\n\n      const index = trx.objectStore('dellog').index('topic_clear');\n      index.openCursor(IDBKeyRange.bound([topicName, 0], [topicName, Number.MAX_SAFE_INTEGER]), 'prev')\n        .onsuccess = event => {\n          if (event.target.result) {\n            resolve(event.target.result.value);\n          }\n        };\n    });\n  }\n\n  // Private methods.\n\n  // Serializable topic fields.\n  static #topic_fields = ['created', 'updated', 'deleted', 'touched', 'read', 'recv', 'seq',\n    'clear', 'mrrid', 'defacs', 'creds', 'public', 'trusted', 'private', '_aux', '_deleted',\n    '_mrrSeen'\n  ];\n\n  // Copy data from src to Topic object.\n  static #deserializeTopic(topic, src) {\n    DB.#topic_fields.forEach((f) => {\n      if (src.hasOwnProperty(f)) {\n        topic[f] = src[f];\n      }\n    });\n    if (Array.isArray(src.tags)) {\n      topic._tags = src.tags;\n    }\n    if (src.acs) {\n      topic.setAccessMode(src.acs);\n    }\n    topic.seq |= 0;\n    topic.read |= 0;\n    topic.unread = Math.max(0, topic.seq - topic.read);\n  }\n\n  // Copy values from 'src' to 'dst'. Allocate dst if it's null or undefined.\n  static #serializeTopic(dst, src) {\n    const res = dst || {\n      name: src.name\n    };\n    DB.#topic_fields.forEach(f => {\n      if (src.hasOwnProperty(f)) {\n        res[f] = src[f];\n      }\n    });\n    if (Array.isArray(src._tags)) {\n      res.tags = src._tags;\n    }\n    if (src.acs) {\n      res.acs = src.getAccessMode().jsonHelper();\n    }\n    return res;\n  }\n\n  static #serializeSubscription(dst, topicName, uid, sub) {\n    const fields = ['updated', 'mode', 'read', 'recv', 'clear', 'lastSeen', 'userAgent'];\n    const res = dst || {\n      topic: topicName,\n      uid: uid\n    };\n\n    fields.forEach((f) => {\n      if (sub.hasOwnProperty(f)) {\n        res[f] = sub[f];\n      }\n    });\n\n    return res;\n  }\n\n  static #serializeMessage(dst, msg) {\n    // Serializable fields.\n    const fields = ['topic', 'seq', 'ts', '_status', 'from', 'head', 'content', 'react'];\n    const res = dst || {};\n    fields.forEach((f) => {\n      if (msg.hasOwnProperty(f)) {\n        res[f] = msg[f];\n      }\n    });\n    return res;\n  }\n\n  /**\n   * To use DB in a non browser context, supply indexedDB provider.\n   * @static\n   * @memberof DB\n   * @param idbProvider indexedDB provider, e.g. for node <code>require('fake-indexeddb')</code>.\n   */\n  static setDatabaseProvider(idbProvider) {\n    IDBProvider = idbProvider;\n  }\n}\n","/**\n * @copyright 2015-2026 Tinode LLC.\n * @summary Minimally rich text representation and formatting for Tinode.\n * @license Apache 2.0\n *\n * @file Basic parser and formatter for very simple text markup. Mostly targeted at\n * mobile use cases similar to Telegram, WhatsApp, and FB Messenger.\n *\n * <p>Supports conversion of user keyboard input to formatted text:</p>\n * <ul>\n *   <li>*abc* &rarr; <b>abc</b></li>\n *   <li>_abc_ &rarr; <i>abc</i></li>\n *   <li>~abc~ &rarr; <del>abc</del></li>\n *   <li>`abc` &rarr; <tt>abc</tt></li>\n * </ul>\n * Also supports forms and buttons.\n *\n * Nested formatting is supported, e.g. *abc _def_* -> <b>abc <i>def</i></b>\n * URLs, @mentions, and #hashtags are extracted and converted into links.\n * Forms and buttons can be added procedurally.\n * JSON data representation is inspired by Draft.js raw formatting.\n *\n *\n * @example\n * Text:\n * <pre>\n *     this is *bold*, `code` and _italic_, ~strike~\n *     combined *bold and _italic_*\n *     an url: https://www.example.com/abc#fragment and another _www.tinode.co_\n *     this is a @mention and a #hashtag in a string\n *     second #hashtag\n * </pre>\n *\n *  Sample JSON representation of the text above:\n *  {\n *     \"txt\": \"this is bold, code and italic, strike combined bold and italic an url: https://www.example.com/abc#fragment \" +\n *             \"and another www.tinode.co this is a @mention and a #hashtag in a string second #hashtag\",\n *     \"fmt\": [\n *         { \"at\":8, \"len\":4,\"tp\":\"ST\" },{ \"at\":14, \"len\":4, \"tp\":\"CO\" },{ \"at\":23, \"len\":6, \"tp\":\"EM\"},\n *         { \"at\":31, \"len\":6, \"tp\":\"DL\" },{ \"tp\":\"BR\", \"len\":1, \"at\":37 },{ \"at\":56, \"len\":6, \"tp\":\"EM\" },\n *         { \"at\":47, \"len\":15, \"tp\":\"ST\" },{ \"tp\":\"BR\", \"len\":1, \"at\":62 },{ \"at\":120, \"len\":13, \"tp\":\"EM\" },\n *         { \"at\":71, \"len\":36, \"key\":0 },{ \"at\":120, \"len\":13, \"key\":1 },{ \"tp\":\"BR\", \"len\":1, \"at\":133 },\n *         { \"at\":144, \"len\":8, \"key\":2 },{ \"at\":159, \"len\":8, \"key\":3 },{ \"tp\":\"BR\", \"len\":1, \"at\":179 },\n *         { \"at\":187, \"len\":8, \"key\":3 },{ \"tp\":\"BR\", \"len\":1, \"at\":195 }\n *     ],\n *     \"ent\": [\n *         { \"tp\":\"LN\", \"data\":{ \"url\":\"https://www.example.com/abc#fragment\" } },\n *         { \"tp\":\"LN\", \"data\":{ \"url\":\"http://www.tinode.co\" } },\n *         { \"tp\":\"MN\", \"data\":{ \"val\":\"mention\" } },\n *         { \"tp\":\"HT\", \"data\":{ \"val\":\"hashtag\" } }\n *     ]\n *  }\n */\n\n'use strict';\n\n// NOTE TO DEVELOPERS:\n// Localizable strings should be double quoted \"   \",\n// non-localizable strings should be single quoted 'non-localized'.\n\nconst MAX_FORM_ELEMENTS = 8;\nconst MAX_PREVIEW_ATTACHMENTS = 3;\nconst MAX_PREVIEW_DATA_SIZE = 64;\nconst DRAFTY_MIME_TYPE = 'text/x-drafty';\n// Drafty form-response MIME type.\nconst DRAFTY_FR_MIME_TYPE = 'text/x-drafty-fr';\n// Legacy Drafty form-response MIME type.\nconst DRAFTY_FR_MIME_TYPE_LEGACY = 'application/json'; // Remove in 2026.\nconst ALLOWED_ENT_FIELDS = ['act', 'height', 'duration', 'fn', 'incoming', 'mime', 'name',\n  'premime', 'preref', 'preview', 'ref', 'size', 'state', 'url', 'val', 'width'\n];\n\n// Intl.Segmenter is not available in Firefox 124 and earlier. FF 125 with support for Intl.Segmenter\n// was released on April 15, 2024. Polyfill is included in the top package (webapp).\nconst segmenter = new Intl.Segmenter();\n\n// Regular expressions for parsing inline formats. Javascript does not support lookbehind,\n// so it's a bit messy.\nconst INLINE_STYLES = [\n  // Strong = bold, *bold text*\n  {\n    name: 'ST',\n    start: /(?:^|[\\W_])(\\*)[^\\s*]/,\n    end: /[^\\s*](\\*)(?=$|[\\W_])/\n  },\n  // Emphesized = italic, _italic text_\n  {\n    name: 'EM',\n    start: /(?:^|\\W)(_)[^\\s_]/,\n    end: /[^\\s_](_)(?=$|\\W)/\n  },\n  // Deleted, ~strike this though~\n  {\n    name: 'DL',\n    start: /(?:^|[\\W_])(~)[^\\s~]/,\n    end: /[^\\s~](~)(?=$|[\\W_])/\n  },\n  // Code block `this is monospace`\n  {\n    name: 'CO',\n    start: /(?:^|\\W)(`)[^`]/,\n    end: /[^`](`)(?=$|\\W)/\n  }\n];\n\n// Relative weights of formatting spans. Greater index in array means greater weight.\nconst FMT_WEIGHT = ['QQ'];\n\n// RegExps for entity extraction (RF = reference)\nconst ENTITY_TYPES = [\n  // URLs\n  {\n    name: 'LN',\n    dataName: 'url',\n    pack: function(val) {\n      // Check if the protocol is specified, if not use http\n      if (!/^[a-z]+:\\/\\//i.test(val)) {\n        val = 'http://' + val;\n      }\n      return {\n        url: val\n      };\n    },\n    re: /(?:(?:https?|ftp):\\/\\/|www\\.|ftp\\.)[-A-Z0-9+&@#\\/%=~_|$?!:,.]*[A-Z0-9+&@#\\/%=~_|$]/ig\n  },\n  // Mentions @user (must be 2 or more characters)\n  {\n    name: 'MN',\n    dataName: 'val',\n    pack: function(val) {\n      return {\n        val: val.slice(1)\n      };\n    },\n    re: /\\B@([\\p{L}\\p{N}][._\\p{L}\\p{N}]*[\\p{L}\\p{N}])/ug\n  },\n  // Hashtags #hashtag, like metion 2 or more characters.\n  {\n    name: 'HT',\n    dataName: 'val',\n    pack: function(val) {\n      return {\n        val: val.slice(1)\n      };\n    },\n    re: /\\B#([\\p{L}\\p{N}][._\\p{L}\\p{N}]*[\\p{L}\\p{N}])/ug\n  }\n];\n\n// HTML tag name suggestions\nconst FORMAT_TAGS = {\n  AU: {\n    html_tag: 'audio',\n    md_tag: undefined,\n    isVoid: false\n  },\n  BN: {\n    html_tag: 'button',\n    md_tag: undefined,\n    isVoid: false\n  },\n  BR: {\n    html_tag: 'br',\n    md_tag: '\\n',\n    isVoid: true\n  },\n  CO: {\n    html_tag: 'tt',\n    md_tag: '`',\n    isVoid: false\n  },\n  DL: {\n    html_tag: 'del',\n    md_tag: '~',\n    isVoid: false\n  },\n  EM: {\n    html_tag: 'i',\n    md_tag: '_',\n    isVoid: false\n  },\n  EX: {\n    html_tag: '',\n    md_tag: undefined,\n    isVoid: true\n  },\n  FM: {\n    html_tag: 'div',\n    md_tag: undefined,\n    isVoid: false\n  },\n  HD: {\n    html_tag: '',\n    md_tag: undefined,\n    isVoid: false\n  },\n  HL: {\n    html_tag: 'span',\n    md_tag: undefined,\n    isVoid: false\n  },\n  HT: {\n    html_tag: 'a',\n    md_tag: undefined,\n    isVoid: false\n  },\n  IM: {\n    html_tag: 'img',\n    md_tag: undefined,\n    isVoid: false\n  },\n  LN: {\n    html_tag: 'a',\n    md_tag: undefined,\n    isVoid: false\n  },\n  MN: {\n    html_tag: 'a',\n    md_tag: undefined,\n    isVoid: false\n  },\n  RW: {\n    html_tag: 'div',\n    md_tag: undefined,\n    isVoid: false,\n  },\n  QQ: {\n    html_tag: 'div',\n    md_tag: undefined,\n    isVoid: false\n  },\n  ST: {\n    html_tag: 'b',\n    md_tag: '*',\n    isVoid: false\n  },\n  TC: { // TheCard\n    html_tag: 'div',\n    md_tag: undefined,\n    isVoid: false\n  },\n  VC: {\n    html_tag: 'div',\n    md_tag: undefined,\n    isVoid: false\n  },\n  VD: {\n    html_tag: 'video',\n    md_tag: undefined,\n    isVoid: false\n  }\n};\n\n// Convert base64-encoded string into Blob.\nfunction base64toObjectUrl(b64, contentType, logger) {\n  if (!b64) {\n    return null;\n  }\n\n  try {\n    const bin = atob(b64);\n    const length = bin.length;\n    const buf = new ArrayBuffer(length);\n    const arr = new Uint8Array(buf);\n    for (let i = 0; i < length; i++) {\n      arr[i] = bin.charCodeAt(i);\n    }\n\n    return URL.createObjectURL(new Blob([buf], {\n      type: contentType\n    }));\n  } catch (err) {\n    if (logger) {\n      logger(\"Drafty: failed to convert object.\", err.message);\n    }\n  }\n\n  return null;\n}\n\nfunction base64toDataUrl(b64, contentType) {\n  if (!b64) {\n    return null;\n  }\n  contentType = contentType || 'image/jpeg';\n  return 'data:' + contentType + ';base64,' + b64;\n}\n\n// Helpers for converting Drafty to HTML.\nconst DECORATORS = {\n  // Visial styles\n  ST: {\n    open: _ => '<b>',\n    close: _ => '</b>'\n  },\n  EM: {\n    open: _ => '<i>',\n    close: _ => '</i>'\n  },\n  DL: {\n    open: _ => '<del>',\n    close: _ => '</del>'\n  },\n  CO: {\n    open: _ => '<tt>',\n    close: _ => '</tt>'\n  },\n  // Line break\n  BR: {\n    open: _ => '<br/>',\n    close: _ => ''\n  },\n  // Hidden element\n  HD: {\n    open: _ => '',\n    close: _ => ''\n  },\n  // Highlighted element.\n  HL: {\n    open: _ => '<span style=\"color:teal\">',\n    close: _ => '</span>'\n  },\n  // Link (URL)\n  LN: {\n    open: (data) => {\n      return '<a href=\"' + data.url + '\">';\n    },\n    close: _ => '</a>',\n    props: (data) => {\n      return data ? {\n        href: data.url,\n        target: '_blank'\n      } : null;\n    },\n  },\n  // Mention\n  MN: {\n    open: (data) => {\n      return '<a href=\"#' + data.val + '\">';\n    },\n    close: _ => '</a>',\n    props: (data) => {\n      return data ? {\n        id: data.val\n      } : null;\n    },\n  },\n  // Hashtag\n  HT: {\n    open: (data) => {\n      return '<a href=\"#' + data.val + '\">';\n    },\n    close: _ => '</a>',\n    props: (data) => {\n      return data ? {\n        id: data.val\n      } : null;\n    },\n  },\n  // Button\n  BN: {\n    open: _ => '<button>',\n    close: _ => '</button>',\n    props: (data) => {\n      return data ? {\n        'data-act': data.act,\n        'data-val': data.val,\n        'data-name': data.name,\n        'data-ref': data.ref\n      } : null;\n    },\n  },\n  // Audio recording\n  AU: {\n    open: (data) => {\n      const url = data.ref || base64toObjectUrl(data.val, data.mime, Drafty.logger);\n      return '<audio controls src=\"' + url + '\">';\n    },\n    close: _ => '</audio>',\n    props: (data) => {\n      if (!data) return null;\n      return {\n        // Embedded data or external link.\n        src: data.ref || base64toObjectUrl(data.val, data.mime, Drafty.logger),\n        'data-preload': data.ref ? 'metadata' : 'auto',\n        'data-duration': data.duration,\n        'data-name': data.name,\n        'data-size': data.val ? ((data.val.length * 0.75) | 0) : (data.size | 0),\n        'data-mime': data.mime,\n      };\n    }\n  },\n  // Image\n  IM: {\n    open: data => {\n      // Don't use data.ref for preview: it's a security risk.\n      const tmpPreviewUrl = base64toDataUrl(data._tempPreview, data.mime);\n      const previewUrl = base64toObjectUrl(data.val, data.mime, Drafty.logger);\n      const downloadUrl = data.ref || previewUrl;\n      return (data.name ? '<a href=\"' + downloadUrl + '\" download=\"' + data.name + '\">' : '') +\n        '<img src=\"' + (tmpPreviewUrl || previewUrl) + '\"' +\n        (data.width ? ' width=\"' + data.width + '\"' : '') +\n        (data.height ? ' height=\"' + data.height + '\"' : '') + ' border=\"0\" />';\n    },\n    close: data => {\n      return (data.name ? '</a>' : '');\n    },\n    props: data => {\n      if (!data) return null;\n      return {\n        // Temporary preview, or permanent preview, or external link.\n        src: base64toDataUrl(data._tempPreview, data.mime) ||\n          data.ref || base64toObjectUrl(data.val, data.mime, Drafty.logger),\n        title: data.name,\n        alt: data.name,\n        'data-width': data.width,\n        'data-height': data.height,\n        'data-name': data.name,\n        'data-size': data.ref ? (data.size | 0) : (data.val ? ((data.val.length * 0.75) | 0) : (data.size | 0)),\n        'data-mime': data.mime,\n      };\n    },\n  },\n  // Form - structured layout of elements.\n  FM: {\n    open: _ => '<div>',\n    close: _ => '</div>'\n  },\n  // Row: logic grouping of elements\n  RW: {\n    open: _ => '<div>',\n    close: _ => '</div>'\n  },\n  // Quoted block.\n  QQ: {\n    open: _ => '<div>',\n    close: _ => '</div>',\n    props: (data) => {\n      return data ? {} : null;\n    },\n  },\n  TC: { // TheCard\n    open: _ => '<div>',\n    close: _ => '</div>',\n    props: data => {\n      if (!data) return {};\n      return {\n        'data-fn': data.fn,\n        'data-title': data.title,\n      };\n    }\n  },\n  // Video call\n  VC: {\n    open: _ => '<div>',\n    close: _ => '</div>',\n    props: data => {\n      if (!data) return {};\n      return {\n        'data-duration': data.duration,\n        'data-state': data.state,\n      };\n    }\n  },\n  // Video.\n  VD: {\n    open: data => {\n      const tmpPreviewUrl = base64toDataUrl(data._tempPreview, data.mime);\n      const previewUrl = data.ref || base64toObjectUrl(data.preview, data.premime || 'image/jpeg', Drafty.logger);\n      return '<img src=\"' + (tmpPreviewUrl || previewUrl) + '\"' +\n        (data.width ? ' width=\"' + data.width + '\"' : '') +\n        (data.height ? ' height=\"' + data.height + '\"' : '') + ' border=\"0\" />';\n    },\n    close: _ => '',\n    props: data => {\n      if (!data) return null;\n      const poster = data.preref || base64toObjectUrl(data.preview, data.premime || 'image/jpeg', Drafty.logger);\n      return {\n        // Embedded data or external link.\n        src: poster,\n        'data-src': data.ref || base64toObjectUrl(data.val, data.mime, Drafty.logger),\n        'data-width': data.width,\n        'data-height': data.height,\n        'data-preload': data.ref ? 'metadata' : 'auto',\n        'data-preview': poster,\n        'data-duration': data.duration | 0,\n        'data-name': data.name,\n        'data-size': data.ref ? (data.size | 0) : (data.val ? ((data.val.length * 0.75) | 0) : (data.size | 0)),\n        'data-mime': data.mime,\n      };\n    }\n  },\n};\n\n/**\n * The main object which performs all the formatting actions.\n * @class Drafty\n * @constructor\n */\nconst Drafty = function() {\n  this.txt = '';\n  this.fmt = [];\n  this.ent = [];\n}\n\n/**\n * Initialize Drafty document to a plain text string.\n *\n * @param {string} plainText - string to use as Drafty content.\n *\n * @returns new Drafty document or null is plainText is not a string or undefined.\n */\nDrafty.init = function(plainText) {\n  if (typeof plainText == 'undefined') {\n    plainText = '';\n  } else if (typeof plainText != 'string') {\n    return null;\n  }\n\n  return {\n    txt: plainText\n  };\n}\n\n/**\n * Parse plain text into Drafty document.\n * @memberof Drafty\n * @static\n *\n * @param {string} content - plain-text content to parse.\n * @return {Drafty} parsed document or null if the source is not plain text.\n */\nDrafty.parse = function(content) {\n  // Make sure we are parsing strings only.\n  if (typeof content != 'string') {\n    return null;\n  }\n\n  // Split text into lines. It makes further processing easier.\n  const lines = content.split(/\\r?\\n/);\n\n  // Holds entities referenced from text\n  const entityMap = [];\n  const entityIndex = {};\n\n  // Processing lines one by one, hold intermediate result in blx.\n  const blx = [];\n  lines.forEach((line) => {\n    let spans = [];\n    let entities;\n\n    // Find formatted spans in the string.\n    // Try to match each style.\n    INLINE_STYLES.forEach((tag) => {\n      // Each style could be matched multiple times.\n      spans = spans.concat(spannify(line, tag.start, tag.end, tag.name));\n    });\n\n    let block;\n    if (spans.length == 0) {\n      block = {\n        txt: line\n      };\n    } else {\n      // Sort spans by style occurence early -> late, then by length: first long then short.\n      spans.sort((a, b) => {\n        const diff = a.at - b.at;\n        return diff != 0 ? diff : b.end - a.end;\n      });\n\n      // Convert an array of possibly overlapping spans into a tree.\n      spans = toSpanTree(spans);\n\n      // Build a tree representation of the entire string, not\n      // just the formatted parts.\n      const chunks = chunkify(line, 0, line.length, spans);\n\n      const drafty = draftify(chunks, 0);\n\n      block = {\n        txt: drafty.txt,\n        fmt: drafty.fmt\n      };\n    }\n\n    // Extract entities from the cleaned up string.\n    entities = extractEntities(block.txt);\n    if (entities.length > 0) {\n      const ranges = [];\n      for (let i in entities) {\n        // {offset: match['index'], unique: match[0], len: match[0].length, data: ent.packer(), type: ent.name}\n        const entity = entities[i];\n        let index = entityIndex[entity.unique];\n        if (!index) {\n          index = entityMap.length;\n          entityIndex[entity.unique] = index;\n          entityMap.push({\n            tp: entity.type,\n            data: entity.data\n          });\n        }\n        ranges.push({\n          at: entity.offset,\n          len: entity.len,\n          key: index\n        });\n      }\n      block.ent = ranges;\n    }\n\n    blx.push(block);\n  });\n\n  const result = {\n    txt: ''\n  };\n\n  // Merge lines and save line breaks as BR inline formatting.\n  if (blx.length > 0) {\n    result.txt = blx[0].txt;\n    result.fmt = (blx[0].fmt || []).concat(blx[0].ent || []);\n\n    if (result.fmt.length) {\n      const segments = segmenter.segment(result.txt);\n      for (const ele of result.fmt) {\n        ({\n            at: ele.at,\n            len: ele.len\n          } =\n          toGraphemeValues(ele, segments, result.txt));\n      }\n    }\n\n    for (let i = 1; i < blx.length; i++) {\n      const block = blx[i];\n      const offset = stringToGraphemes(result.txt).length + 1;\n\n      result.fmt.push({\n        tp: 'BR',\n        len: 1,\n        at: offset - 1\n      });\n\n      let segments = {};\n\n      result.txt += ' ' + block.txt;\n      if (block.fmt) {\n        segments = segmenter.segment(block.txt);\n        result.fmt = result.fmt.concat(\n          block.fmt.map((s) => {\n            const {\n              at: correctAt,\n              len: correctLen\n            } =\n            toGraphemeValues(s, segments, block.txt);\n            s.at = correctAt + offset;\n            s.len = correctLen;\n            return s;\n          })\n        );\n      }\n      if (block.ent) {\n        if (isEmptyObject(segments)) {\n          segments = segmenter.segment(block.txt);\n        }\n        result.fmt = result.fmt.concat(\n          block.ent.map((s) => {\n            const {\n              at: correctAt,\n              len: correctLen\n            } =\n            toGraphemeValues(s, segments, block.txt);\n            s.at = correctAt + offset;\n            s.len = correctLen;\n            return s;\n          })\n        );\n      }\n    }\n\n    if (result.fmt.length == 0) {\n      delete result.fmt;\n    }\n\n    if (entityMap.length > 0) {\n      result.ent = entityMap;\n    }\n  }\n  return result;\n}\n\n/**\n * Append one Drafty document to another.\n *\n * @param {Drafty} first - Drafty document to append to.\n * @param {Drafty|string} second - Drafty document or string being appended.\n *\n * @return {Drafty} first document with the second appended to it.\n */\nDrafty.append = function(first, second) {\n  if (!first) {\n    return second;\n  }\n  if (!second) {\n    return first;\n  }\n\n  first.txt = first.txt || '';\n  const len = stringToGraphemes(first.txt).length;\n\n  if (typeof second == 'string') {\n    first.txt += second;\n  } else if (second.txt) {\n    first.txt += second.txt;\n  }\n\n  if (Array.isArray(second.fmt)) {\n    first.fmt = first.fmt || [];\n    if (Array.isArray(second.ent)) {\n      first.ent = first.ent || [];\n    }\n    second.fmt.forEach(src => {\n      const fmt = {\n        at: (src.at | 0) + len,\n        len: src.len | 0\n      };\n      // Special case for the outside of the normal rendering flow styles.\n      if (src.at == -1) {\n        fmt.at = -1;\n        fmt.len = 0;\n      }\n      if (src.tp) {\n        fmt.tp = src.tp;\n      } else {\n        fmt.key = first.ent.length;\n        first.ent.push(second.ent[src.key || 0]);\n      }\n      first.fmt.push(fmt);\n    });\n  }\n\n  return first;\n}\n\n/**\n * Description of an image to attach.\n * @typedef {Object} ImageDesc\n * @memberof Drafty\n *\n * @property {string} mime - mime-type of the image, e.g. \"image/png\".\n * @property {string} refurl - reference to the content. Could be null/undefined.\n * @property {string} bits - base64-encoded image content. Could be null/undefined.\n * @property {string} preview - base64-encoded thumbnail of the image.\n * @property {integer} width - width of the image.\n * @property {integer} height - height of the image.\n * @property {string} filename - file name suggestion for downloading the image.\n * @property {integer} size - size of the image in bytes. Treat is as an untrusted hint.\n * @property {string} _tempPreview - base64-encoded image preview used during upload process; not serializable.\n * @property {Promise} urlPromise - Promise which returns content URL when resolved.\n */\n\n/**\n * Insert inline image into Drafty document.\n * @memberof Drafty\n * @static\n *\n * @param {Drafty} content - document to add image to.\n * @param {integer} at - index where the object is inserted. The length of the image is always 1.\n * @param {ImageDesc} imageDesc - object with image paramenets and data.\n *\n * @return {Drafty} updated document.\n */\nDrafty.insertImage = function(content, at, imageDesc) {\n  content = content || {\n    txt: ' '\n  };\n  content.ent = content.ent || [];\n  content.fmt = content.fmt || [];\n\n  content.fmt.push({\n    at: at | 0,\n    len: 1,\n    key: content.ent.length\n  });\n\n  const ex = {\n    tp: 'IM',\n    data: {\n      mime: imageDesc.mime,\n      ref: imageDesc.refurl,\n      val: imageDesc.bits || imageDesc.preview,\n      width: imageDesc.width,\n      height: imageDesc.height,\n      name: imageDesc.filename,\n      size: imageDesc.size | 0,\n    }\n  };\n\n  if (imageDesc.urlPromise) {\n    ex.data._tempPreview = imageDesc._tempPreview;\n    ex.data._processing = true;\n    imageDesc.urlPromise.then(\n      url => {\n        ex.data.ref = url;\n        ex.data._tempPreview = undefined;\n        ex.data._processing = undefined;\n      },\n      _ => {\n        // Catch the error, otherwise it will appear in the console.\n        ex.data._processing = undefined;\n      }\n    );\n  }\n\n  content.ent.push(ex);\n\n  return content;\n}\n\n/**\n * Description of a video to attach.\n * @typedef {Object} VideoDesc\n * @memberof Drafty\n *\n * @property {string} mime - mime-type of the video, e.g. \"video/mpeg\".\n * @property {string} refurl - reference to the content. Could be null/undefined.\n * @property {string} bits - in-band base64-encoded image data. Could be null/undefined.\n * @property {string} preview - base64-encoded screencapture from the video. Could be null/undefined.\n * @property {string} preref - reference to screencapture from the video. Could be null/undefined.\n * @property {integer} width - width of the video.\n * @property {integer} height - height of the video.\n * @property {integer} duration - duration of the video.\n * @property {string} filename - file name suggestion for downloading the video.\n * @property {integer} size - size of the video in bytes. Treat is as an untrusted hint.\n * @property {string} _tempPreview - base64-encoded screencapture used during upload process; not serializable.\n * @property {Promise} urlPromise - array of two promises, which return URLs of video and preview uploads correspondingly\n *        (either could be null).\n */\n\n/**\n * Insert inline image into Drafty document.\n * @memberof Drafty\n * @static\n *\n * @param {Drafty} content - document to add video to.\n * @param {integer} at - index where the object is inserted. The length of the video is always 1.\n * @param {VideoDesc} videoDesc - object with video paramenets and data.\n *\n * @return {Drafty} updated document.\n */\nDrafty.insertVideo = function(content, at, videoDesc) {\n  content = content || {\n    txt: ' '\n  };\n  content.ent = content.ent || [];\n  content.fmt = content.fmt || [];\n\n  content.fmt.push({\n    at: at | 0,\n    len: 1,\n    key: content.ent.length\n  });\n\n  const ex = {\n    tp: 'VD',\n    data: {\n      mime: videoDesc.mime,\n      ref: videoDesc.refurl,\n      val: videoDesc.bits,\n      preref: videoDesc.preref,\n      preview: videoDesc.preview,\n      width: videoDesc.width,\n      height: videoDesc.height,\n      duration: videoDesc.duration | 0,\n      name: videoDesc.filename,\n      size: videoDesc.size | 0,\n    }\n  };\n\n  if (videoDesc.urlPromise) {\n    ex.data._tempPreview = videoDesc._tempPreview;\n    ex.data._processing = true;\n    videoDesc.urlPromise.then(\n      urls => {\n        ex.data.ref = urls[0];\n        ex.data.preref = urls[1];\n        ex.data._tempPreview = undefined;\n        ex.data._processing = undefined;\n      },\n      _ => {\n        // Catch the error, otherwise it will appear in the console.\n        ex.data._processing = undefined;\n      }\n    );\n  }\n\n  content.ent.push(ex);\n\n  return content;\n}\n\n/**\n * Description of an audio recording to attach.\n * @typedef {Object} AudioDesc\n * @memberof Drafty\n *\n * @property {string} mime - mime-type of the audio, e.g. \"audio/ogg\".\n * @property {string} refurl - reference to the content. Could be null/undefined.\n * @property {string} bits - base64-encoded audio content. Could be null/undefined.\n * @property {integer} duration - duration of the record in milliseconds.\n * @property {string} preview - base64 encoded short array of amplitude values 0..100.\n * @property {string} filename - file name suggestion for downloading the audio.\n * @property {integer} size - size of the recording in bytes. Treat is as an untrusted hint.\n * @property {Promise} urlPromise - Promise which returns content URL when resolved.\n */\n\n/**\n * Insert audio recording into Drafty document.\n * @memberof Drafty\n * @static\n *\n * @param {Drafty} content - document to add audio record to.\n * @param {integer} at - index where the object is inserted. The length of the record is always 1.\n * @param {AudioDesc} audioDesc - object with the audio paramenets and data.\n *\n * @return {Drafty} updated document.\n */\nDrafty.insertAudio = function(content, at, audioDesc) {\n  content = content || {\n    txt: ' '\n  };\n  content.ent = content.ent || [];\n  content.fmt = content.fmt || [];\n\n  content.fmt.push({\n    at: at | 0,\n    len: 1,\n    key: content.ent.length\n  });\n\n  const ex = {\n    tp: 'AU',\n    data: {\n      mime: audioDesc.mime,\n      val: audioDesc.bits,\n      duration: audioDesc.duration | 0,\n      preview: audioDesc.preview,\n      name: audioDesc.filename,\n      size: audioDesc.size | 0,\n      ref: audioDesc.refurl\n    }\n  };\n\n  if (audioDesc.urlPromise) {\n    ex.data._processing = true;\n    audioDesc.urlPromise.then(\n      url => {\n        ex.data.ref = url;\n        ex.data._processing = undefined;\n      },\n      _ => {\n        // Catch the error, otherwise it will appear in the console.\n        ex.data._processing = undefined;\n      }\n    );\n  }\n\n  content.ent.push(ex);\n\n  return content;\n}\n\n/**\n * Create a (self-contained) video call Drafty document.\n * @memberof Drafty\n * @static\n * @param {boolean} audioOnly <code>true</code> if the call is initially audio-only.\n * @returns Video Call drafty document.\n */\nDrafty.videoCall = function(audioOnly) {\n  const content = {\n    txt: ' ',\n    fmt: [{\n      at: 0,\n      len: 1,\n      key: 0\n    }],\n    ent: [{\n      tp: 'VC',\n      data: {\n        aonly: audioOnly\n      },\n    }]\n  };\n  return content;\n}\n\n/**\n * Update video call (VC) entity with the new status and duration.\n * @memberof Drafty\n * @static\n *\n * @param {Drafty} content - VC document to update.\n * @param {object} params - new video call parameters.\n * @param {string} params.state - state of video call.\n * @param {number} params.duration - duration of the video call in milliseconds.\n *\n * @returns the same document with update applied.\n */\nDrafty.updateVideoCall = function(content, params) {\n  // The video element could be just a format or a format + entity.\n  // Must ensure it's the latter first.\n  const fmt = ((content || {}).fmt || [])[0];\n  if (!fmt) {\n    // Unrecognized content.\n    return content;\n  }\n\n  let ent;\n  if (fmt.tp == 'VC') {\n    // Just a format, convert to format + entity.\n    delete fmt.tp;\n    fmt.key = 0;\n    ent = {\n      tp: 'VC'\n    };\n    content.ent = [ent];\n  } else {\n    ent = (content.ent || [])[fmt.key | 0];\n    if (!ent || ent.tp != 'VC') {\n      // Not a VC entity.\n      return content;\n    }\n  }\n  ent.data = ent.data || {};\n  Object.assign(ent.data, params);\n  return content;\n}\n\n/**\n * Create a quote to Drafty document.\n * @memberof Drafty\n * @static\n *\n * @param {string} header - Quote header (title, etc.).\n * @param {string} uid - UID of the author to mention.\n * @param {Drafty} body - Body of the quoted message.\n *\n * @returns Reply quote Drafty doc with the quote formatting.\n */\nDrafty.quote = function(header, uid, body) {\n  const quote = Drafty.append(Drafty.appendLineBreak(Drafty.mention(header, uid)), body);\n\n  // Wrap into a quote.\n  quote.fmt.push({\n    at: 0,\n    len: stringToGraphemes(quote.txt).length,\n    tp: 'QQ'\n  });\n\n  return quote;\n}\n\n/**\n * Create a Drafty document with a mention.\n *\n * @param {string} name - mentioned name.\n * @param {string} uid - mentioned user ID.\n *\n * @returns {Drafty} document with the mention.\n */\nDrafty.mention = function(name, uid) {\n  return {\n    txt: name || '',\n    fmt: [{\n      at: 0,\n      len: stringToGraphemes(name || '').length,\n      key: 0\n    }],\n    ent: [{\n      tp: 'MN',\n      data: {\n        val: uid\n      }\n    }]\n  };\n}\n\n/**\n * Append a link to a Drafty document.\n *\n * @param {Drafty} content - Drafty document to append link to.\n * @param {Object} linkData - Link info in format <code>{txt: 'ankor text', url: 'http://...'}</code>.\n *\n * @returns {Drafty} the same document as <code>content</code>.\n */\nDrafty.appendLink = function(content, linkData) {\n  content = content || {\n    txt: ''\n  };\n\n  content.ent = content.ent || [];\n  content.fmt = content.fmt || [];\n\n  content.fmt.push({\n    at: content.txt.length,\n    len: linkData.txt.length,\n    key: content.ent.length\n  });\n  content.txt += linkData.txt;\n\n  const ex = {\n    tp: 'LN',\n    data: {\n      url: linkData.url\n    }\n  }\n  content.ent.push(ex);\n\n  return content;\n}\n\n/**\n * Append image to Drafty document.\n * @memberof Drafty\n * @static\n *\n * @param {Drafty} content - document to add image to.\n * @param {ImageDesc} imageDesc - object with image paramenets.\n *\n * @return {Drafty} updated document.\n */\nDrafty.appendImage = function(content, imageDesc) {\n  content = content || {\n    txt: ''\n  };\n  content.txt += ' ';\n  return Drafty.insertImage(content, content.txt.length - 1, imageDesc);\n}\n\n/**\n * Append audio recodring to Drafty document.\n * @memberof Drafty\n * @static\n *\n * @param {Drafty} content - document to add recording to.\n * @param {AudioDesc} audioDesc - object with audio data.\n *\n * @return {Drafty} updated document.\n */\nDrafty.appendAudio = function(content, audioDesc) {\n  content = content || {\n    txt: ''\n  };\n  content.txt += ' ';\n  return Drafty.insertAudio(content, content.txt.length - 1, audioDesc);\n}\n\n/**\n * Description of a file to attach.\n * @typedef {Object} AttachmentDesc\n * @memberof Drafty\n *\n * @property {string} mime - mime-type of the attachment, e.g. \"application/octet-stream\"\n * @property {string} data - base64-encoded in-band content of small attachments. Could be null/undefined.\n * @property {string} filename - file name suggestion for downloading the attachment.\n * @property {integer} size - size of the file in bytes. Treat is as an untrusted hint.\n * @property {string} refurl - reference to the out-of-band content. Could be null/undefined.\n * @property {Promise} urlPromise - Promise which returns content URL when resolved.\n */\n\n/**\n * Attach file to Drafty content. Either as a blob or as a reference.\n * @memberof Drafty\n * @static\n *\n * @param {Drafty} content - document to attach file to.\n * @param {AttachmentDesc} object - containing attachment description and data.\n *\n * @return {Drafty} updated document.\n */\nDrafty.attachFile = function(content, attachmentDesc) {\n  content = content || {\n    txt: ''\n  };\n\n  content.ent = content.ent || [];\n  content.fmt = content.fmt || [];\n\n  content.fmt.push({\n    at: -1,\n    len: 0,\n    key: content.ent.length\n  });\n\n  const ex = {\n    tp: 'EX',\n    data: {\n      mime: attachmentDesc.mime,\n      val: attachmentDesc.data,\n      name: attachmentDesc.filename,\n      ref: attachmentDesc.refurl,\n      size: attachmentDesc.size | 0\n    }\n  }\n  if (attachmentDesc.urlPromise) {\n    ex.data._processing = true;\n    attachmentDesc.urlPromise.then(\n      url => {\n        ex.data.ref = url;\n        ex.data._processing = undefined;\n      },\n      _ => {\n        /* catch the error, otherwise it will appear in the console. */\n        ex.data._processing = undefined;\n      }\n    );\n  }\n  content.ent.push(ex);\n\n  return content;\n}\n\n/**\n * Wraps drafty document into a simple formatting style.\n * @memberof Drafty\n * @static\n *\n * @param {Drafty|string} content - document or string to wrap into a style.\n * @param {string} style - two-letter style to wrap into.\n * @param {number} at - index where the style starts, default 0.\n * @param {number} len - length of the form content, default all of it.\n *\n * @return {Drafty} updated document.\n */\nDrafty.wrapInto = function(content, style, at, len) {\n  if (typeof content == 'string') {\n    content = {\n      txt: content\n    };\n  }\n  content.fmt = content.fmt || [];\n\n  content.fmt.push({\n    at: at || 0,\n    len: len || content.txt.length,\n    tp: style,\n  });\n\n  return content;\n}\n\n/**\n * Wraps content into an interactive form.\n * @memberof Drafty\n * @static\n *\n * @param {Drafty|string} content - to wrap into a form.\n * @param {number} at - index where the forms starts.\n * @param {number} len - length of the form content.\n *\n * @return {Drafty} updated document.\n */\nDrafty.wrapAsForm = function(content, at, len) {\n  return Drafty.wrapInto(content, 'FM', at, len);\n}\n\n/**\n * Insert clickable button into Drafty document.\n * @memberof Drafty\n * @static\n *\n * @param {Drafty|string} content - Drafty document to insert button to or a string to be used as button text.\n * @param {number} at - location where the button is inserted.\n * @param {number} len - the length of the text to be used as button title.\n * @param {string} name - the button. Client should return it to the server when the button is clicked.\n * @param {string} actionType - the type of the button, one of 'url' or 'pub'.\n * @param {string} actionValue - the value to return on click:\n * @param {string} refUrl - the URL to go to when the 'url' button is clicked.\n *\n * @return {Drafty} updated document.\n */\nDrafty.insertButton = function(content, at, len, name, actionType, actionValue, refUrl) {\n  if (typeof content == 'string') {\n    content = {\n      txt: content\n    };\n  }\n\n  if (!content || !content.txt || content.txt.length < at + len) {\n    return null;\n  }\n\n  if (len <= 0 || ['url', 'pub'].indexOf(actionType) == -1) {\n    return null;\n  }\n  // Ensure refUrl is a string.\n  if (actionType == 'url' && !refUrl) {\n    return null;\n  }\n  refUrl = '' + refUrl;\n\n  content.ent = content.ent || [];\n  content.fmt = content.fmt || [];\n\n  content.fmt.push({\n    at: at | 0,\n    len: len,\n    key: content.ent.length\n  });\n  content.ent.push({\n    tp: 'BN',\n    data: {\n      act: actionType,\n      val: actionValue,\n      ref: refUrl,\n      name: name\n    }\n  });\n\n  return content;\n}\n\n/**\n * Append clickable button to Drafty document.\n * @memberof Drafty\n * @static\n *\n * @param {Drafty|string} content - Drafty document to insert button to or a string to be used as button text.\n * @param {string} title - the text to be used as button title.\n * @param {string} name - the button. Client should return it to the server when the button is clicked.\n * @param {string} actionType - the type of the button, one of 'url' or 'pub'.\n * @param {string} actionValue - the value to return on click:\n * @param {string} refUrl - the URL to go to when the 'url' button is clicked.\n *\n * @return {Drafty} updated document.\n */\nDrafty.appendButton = function(content, title, name, actionType, actionValue, refUrl) {\n  content = content || {\n    txt: ''\n  };\n  const at = content.txt.length;\n  content.txt += title;\n  return Drafty.insertButton(content, at, title.length, name, actionType, actionValue, refUrl);\n}\n\n/**\n * Attach a generic JS object. The object is attached as a json string.\n * Intended for representing a form response.\n *\n * @memberof Drafty\n * @static\n *\n * @param {Drafty} content - Drafty document to attach file to.\n * @param {Object} data - data to convert to json string and attach.\n * @returns {Drafty} the same document as <code>content</code>.\n */\nDrafty.attachJSON = function(content, data) {\n  content = content || {\n    txt: ''\n  };\n  content.ent = content.ent || [];\n  content.fmt = content.fmt || [];\n\n  content.fmt.push({\n    at: -1,\n    len: 0,\n    key: content.ent.length\n  });\n\n  content.ent.push({\n    tp: 'EX',\n    data: {\n      mime: DRAFTY_FR_MIME_TYPE,\n      val: data\n    }\n  });\n\n  return content;\n}\n/**\n * Append line break to a Drafty document.\n * @memberof Drafty\n * @static\n *\n * @param {Drafty} content - Drafty document to append linebreak to.\n * @returns {Drafty} the same document as <code>content</code>.\n */\nDrafty.appendLineBreak = function(content) {\n  content = content || {\n    txt: ''\n  };\n  content.fmt = content.fmt || [];\n  content.fmt.push({\n    at: stringToGraphemes(content.txt).length,\n    len: 1,\n    tp: 'BR'\n  });\n  content.txt += ' ';\n\n  return content;\n}\n/**\n * Append TheCard to a Drafty document.\n * @memberof Drafty\n * @static\n *\n * @param {Drafty} content - Drafty document to append TheCard to.\n * @param {Object} theCardData - TheCard data object.\n * @returns {Drafty} the same document as <code>content</code>.\n */\nDrafty.appendTheCard = function(content, theCardData) {\n  content = content || {\n    txt: ''\n  };\n  content.ent = content.ent || [];\n  content.fmt = content.fmt || [];\n\n  content.fmt.push({\n    at: stringToGraphemes(content.txt).length,\n    len: 1,\n    key: content.ent.length\n  });\n  content.txt += ' ';\n\n  // const {...object} = classInstance;\n  content.ent.push({\n    tp: 'TC',\n    data: theCardData\n  });\n\n  return content;\n}\n/**\n * Given Drafty document, convert it to HTML.\n * No attempt is made to strip pre-existing html markup.\n * This is potentially unsafe because <code>content.txt</code> may contain malicious HTML\n * markup. DO NOT use in production code.\n *\n * @memberof Tinode.Drafty\n * @static\n *\n * @param {Drafty} doc - document to convert.\n *\n * @returns {string} HTML-representation of content.\n */\nDrafty.UNSAFE_toHTML = function(doc) {\n  const tree = draftyToTree(doc);\n  const htmlFormatter = function(type, data, values) {\n    const tag = DECORATORS[type];\n    let result = values ? values.join('') : '';\n    if (tag) {\n      result = tag.open(data) + result + tag.close(data);\n    }\n    return result;\n  };\n  return treeBottomUp(tree, htmlFormatter, 0);\n}\n\n/**\n * Callback for applying custom formatting to a Drafty document.\n * Called once for each style span.\n * @memberof Drafty\n * @static\n *\n * @callback Formatter\n * @param {string} style - style code such as \"ST\" or \"IM\".\n * @param {Object} data - entity's data.\n * @param {Object} values - possibly styled subspans contained in this style span.\n * @param {number} index - index of the element guaranteed to be unique.\n */\n\n/**\n * Convert Drafty document to a representation suitable for display.\n * The <code>context</code> may expose a function <code>getFormatter(style)</code>. If it's available\n * it will call it to obtain a <code>formatter</code> for a subtree of styles under the <code>style</code>.\n * @memberof Drafty\n * @static\n *\n * @param {Drafty|Object} content - Drafty document to transform.\n * @param {Formatter} formatter - callback which formats individual elements.\n * @param {Object} context - context provided to formatter as <code>this</code>.\n *\n * @return {Object} transformed object\n */\nDrafty.format = function(original, formatter, context) {\n  return treeBottomUp(draftyToTree(original), formatter, 0, [], context);\n}\n\n/**\n * Shorten Drafty document making the drafty text no longer than the limit.\n * @memberof Drafty\n * @static\n *\n * @param {Drafty|string} original - Drafty object to shorten.\n * @param {number} limit - length in characrets to shorten to.\n * @param {boolean} light - remove heavy data from entities.\n * @returns new shortened Drafty object leaving the original intact.\n */\nDrafty.shorten = function(original, limit, light) {\n  let tree = draftyToTree(original);\n  tree = shortenTree(tree, limit, '');\n  if (tree && light) {\n    tree = lightEntity(tree);\n  }\n  return treeToDrafty({}, tree, []);\n}\n\n/**\n * Transform Drafty doc for forwarding: strip leading @mention and any leading line breaks or whitespace.\n * @memberof Drafty\n * @static\n *\n * @param {Drafty|string} original - Drafty object to shorten.\n * @returns converted Drafty object leaving the original intact.\n */\nDrafty.forwardedContent = function(original) {\n  let tree = draftyToTree(original);\n  const rmMention = function(node) {\n    if (node.type == 'MN') {\n      if (!node.parent || !node.parent.type) {\n        return null;\n      }\n    }\n    return node;\n  }\n  // Strip leading mention.\n  tree = treeTopDown(tree, rmMention);\n  // Remove leading whitespace.\n  tree = lTrim(tree);\n  // Convert back to Drafty.\n  return treeToDrafty({}, tree, []);\n}\n\n/**\n * Prepare Drafty doc for wrapping into QQ as a reply:\n *  - Replace forwarding mention with symbol '' and remove data (UID).\n *  - Remove quoted text completely.\n *  - Replace line breaks with spaces.\n *  - Strip entities of heavy content.\n *  - Move attachments to the end of the document.\n * @memberof Drafty\n * @static\n *\n * @param {Drafty|string} original - Drafty object to shorten.\n * @param {number} limit - length in characters to shorten to.\n * @returns converted Drafty object leaving the original intact.\n */\nDrafty.replyContent = function(original, limit) {\n  const convMNnQQnBR = function(node) {\n    if (node.type == 'QQ') {\n      return null;\n    } else if (node.type == 'MN') {\n      if ((!node.parent || !node.parent.type) && (node.text || '').startsWith('')) {\n        node.text = '';\n        delete node.children;\n        delete node.data;\n      }\n    } else if (node.type == 'BR') {\n      node.text = ' ';\n      delete node.type;\n      delete node.children;\n    }\n    return node;\n  }\n\n  let tree = draftyToTree(original);\n  if (!tree) {\n    return original;\n  }\n\n  // Strip leading mention.\n  tree = treeTopDown(tree, convMNnQQnBR);\n  // Move attachments to the end of the doc.\n  tree = attachmentsToEnd(tree, MAX_PREVIEW_ATTACHMENTS);\n  // Shorten the doc.\n  tree = shortenTree(tree, limit, '');\n  // Strip heavy elements except IM.data['val'] and VD.data['preview'] (have to keep them to generate previews later).\n  const filter = node => {\n    switch (node.type) {\n      case 'IM':\n        return ['val'];\n      case 'VD':\n        return ['preview'];\n    }\n    return null;\n  };\n  tree = lightEntity(tree, filter);\n  // Convert back to Drafty.\n  return treeToDrafty({}, tree, []);\n}\n\n/**\n * Generate drafty preview:\n *  - Shorten the document.\n *  - Strip all heavy entity data leaving just inline styles and entity references.\n *  - Replace line breaks with spaces.\n *  - Replace content of QQ with a space.\n *  - Replace forwarding mention with symbol ''.\n * move all attachments to the end of the document and make them visible.\n * The <code>context</code> may expose a function <code>getFormatter(style)</code>. If it's available\n * it will call it to obtain a <code>formatter</code> for a subtree of styles under the <code>style</code>.\n * @memberof Drafty\n * @static\n *\n * @param {Drafty|string} original - Drafty object to shorten.\n * @param {number} limit - length in characters to shorten to.\n * @param {boolean} forwarding - this a forwarding message preview.\n * @returns new shortened Drafty object leaving the original intact.\n */\nDrafty.preview = function(original, limit, forwarding) {\n  let tree = draftyToTree(original);\n\n  // Move attachments to the end.\n  tree = attachmentsToEnd(tree, MAX_PREVIEW_ATTACHMENTS);\n\n  // Convert leading mention to '' and replace QQ and BR with a space ' '.\n  const convMNnQQnBR = function(node) {\n    if (node.type == 'MN') {\n      if ((!node.parent || !node.parent.type) && (node.text || '').startsWith('')) {\n        node.text = '';\n        delete node.children;\n      }\n    } else if (node.type == 'QQ') {\n      node.text = ' ';\n      delete node.children;\n    } else if (node.type == 'BR') {\n      node.text = ' ';\n      delete node.children;\n      delete node.type;\n    }\n    return node;\n  }\n  tree = treeTopDown(tree, convMNnQQnBR);\n\n  tree = shortenTree(tree, limit, '');\n  if (forwarding) {\n    // Keep some IM and VD data for preview.\n    const filter = {\n      IM: ['val'],\n      VD: ['preview']\n    };\n    tree = lightEntity(tree, node => {\n      return filter[node.type];\n    });\n  } else {\n    tree = lightEntity(tree);\n  }\n\n  // Convert back to Drafty.\n  return treeToDrafty({}, tree, []);\n}\n\n/**\n * Given Drafty document, convert it to plain text.\n * @memberof Drafty\n * @static\n *\n * @param {Drafty} content - document to convert to plain text.\n * @returns {string} plain-text representation of the drafty document.\n */\nDrafty.toPlainText = function(content) {\n  return typeof content == 'string' ? content : content.txt;\n}\n\n/**\n * Check if the document has no markup and no entities.\n * @memberof Drafty\n * @static\n *\n * @param {Drafty} content - content to check for presence of markup.\n * @returns <code>true</code> is content is plain text, <code>false</code> otherwise.\n */\nDrafty.isPlainText = function(content) {\n  return typeof content == 'string' || !(content.fmt || content.ent);\n}\n\n/**\n * Convert document to plain text with markdown. All elements which cannot\n * be represented in markdown are stripped.\n * @memberof Drafty\n * @static\n *\n * @param {Drafty} content - document to convert to plain text with markdown.\n */\nDrafty.toMarkdown = function(content) {\n  let tree = draftyToTree(content);\n  const mdFormatter = function(type, _, values) {\n    const def = FORMAT_TAGS[type];\n    let result = (values ? values.join('') : '');\n    if (def) {\n      if (def.isVoid) {\n        result = def.md_tag || '';\n      } else if (def.md_tag) {\n        result = def.md_tag + result + def.md_tag;\n      }\n    }\n    return result;\n  };\n  return treeBottomUp(tree, mdFormatter, 0);\n}\n\n/**\n * Checks if the object represets is a valid Drafty document.\n * @memberof Drafty\n * @static\n *\n * @param {Drafty} content - content to check for validity.\n * @returns <code>true</code> is content is valid, <code>false</code> otherwise.\n */\nDrafty.isValid = function(content) {\n  if (!content) {\n    return false;\n  }\n\n  const {\n    txt,\n    fmt,\n    ent\n  } = content;\n\n  if (!txt && txt !== '' && !fmt && !ent) {\n    return false;\n  }\n\n  const txt_type = typeof txt;\n  if (txt_type != 'string' && txt_type != 'undefined' && txt !== null) {\n    return false;\n  }\n\n  if (typeof fmt != 'undefined' && !Array.isArray(fmt) && fmt !== null) {\n    return false;\n  }\n\n  if (typeof ent != 'undefined' && !Array.isArray(ent) && ent !== null) {\n    return false;\n  }\n  return true;\n}\n\n/**\n * Check if the drafty document has attachments: style EX and outside of normal rendering flow,\n * i.e. <code>at = -1</code>.\n * @memberof Drafty\n * @static\n *\n * @param {Drafty} content - document to check for attachments.\n * @returns <code>true</code> if there are attachments.\n */\nDrafty.hasAttachments = function(content) {\n  if (!Array.isArray(content.fmt)) {\n    return false;\n  }\n  for (let i in content.fmt) {\n    const fmt = content.fmt[i];\n    if (fmt && fmt.at < 0) {\n      const ent = content.ent[fmt.key | 0];\n      return ent && ent.tp == 'EX' && ent.data;\n    }\n  }\n  return false;\n}\n\n/**\n * Callback for enumerating entities in a Drafty document.\n * Called once for each entity.\n * @memberof Drafty\n * @static\n *\n * @callback EntityCallback\n * @param {Object} data - entity data.\n * @param {string} tp - entity type.\n * @param {number} index - entity's index in `content.ent`.\n *\n * @returns {boolean} 'true-ish' to stop processing, 'false-ish' otherwise.\n */\n\n/**\n * Enumerate attachments: style EX and outside of normal rendering flow, i.e. <code>at = -1</code>.\n * @memberof Drafty\n * @static\n *\n * @param {Drafty} content - document to process for attachments.\n * @param {EntityCallback} callback - callback to call for each attachment.\n * @param {Object} context - value of \"this\" for callback.\n */\nDrafty.attachments = function(content, callback, context) {\n  if (!Array.isArray(content.fmt)) {\n    return;\n  }\n  let count = 0;\n  for (let i in content.fmt) {\n    let fmt = content.fmt[i];\n    if (fmt && fmt.at < 0) {\n      const ent = content.ent[fmt.key | 0];\n      if (ent && ent.tp == 'EX' && ent.data) {\n        if (callback.call(context, ent.data, count++, 'EX')) {\n          break;\n        }\n      }\n    }\n  };\n}\n\n/**\n * Check if the drafty document has entities.\n * @memberof Drafty\n * @static\n *\n * @param {Drafty} content - document to check for entities.\n * @returns <code>true</code> if there are entities.\n */\nDrafty.hasEntities = function(content) {\n  return content.ent && content.ent.length > 0;\n}\n\n/**\n * Enumerate entities. Enumeration stops if callback returns 'true'.\n * @memberof Drafty\n * @static\n *\n * @param {Drafty} content - document with entities to enumerate.\n * @param {EntityCallback} callback - callback to call for each entity.\n * @param {Object} context - value of \"this\" for callback.\n *\n */\nDrafty.entities = function(content, callback, context) {\n  if (content.ent && content.ent.length > 0) {\n    for (let i in content.ent) {\n      if (content.ent[i]) {\n        if (callback.call(context, content.ent[i].data, i, content.ent[i].tp)) {\n          break;\n        }\n      }\n    }\n  }\n}\n\n/**\n * Callback for enumerating styles (inline formats) in a Drafty document.\n * Called once for each style.\n * @memberof Drafty\n * @static\n *\n * @callback StyleCallback\n * @param {string} tp - format type.\n * @param {number} at - starting position of the format in text.\n * @param {number} len - extent of the format in characters.\n * @param {number} key - index of the entity if format is a reference.\n * @param {number} index - style's index in `content.fmt`.\n *\n * @return 'true-ish' to stop processing, 'false-ish' otherwise.\n */\n\n/**\n * Enumerate styles (inline formats). Enumeration stops if callback returns 'true'.\n * @memberof Drafty\n * @static\n *\n * @param {Drafty} content - document with styles (formats) to enumerate.\n * @param {StyleCallback} callback - callback to call for each format.\n * @param {Object} context - value of \"this\" for callback.\n */\nDrafty.styles = function(content, callback, context) {\n  if (content.fmt && content.fmt.length > 0) {\n    for (let i in content.fmt) {\n      const fmt = content.fmt[i];\n      if (fmt) {\n        if (callback.call(context, fmt.tp, fmt.at, fmt.len, fmt.key, i)) {\n          break;\n        }\n      }\n    }\n  }\n}\n\n/**\n * Remove unrecognized fields from entity data\n * @memberof Drafty\n * @static\n *\n * @param {Drafty} content - document with entities to enumerate.\n * @returns content.\n */\nDrafty.sanitizeEntities = function(content) {\n  if (content && content.ent && content.ent.length > 0) {\n    for (let i in content.ent) {\n      const ent = content.ent[i];\n      if (ent && ent.data) {\n        const data = copyEntData(ent.data);\n        if (data) {\n          content.ent[i].data = data;\n        } else {\n          delete content.ent[i].data;\n        }\n      }\n    }\n  }\n  return content;\n}\n\n/**\n * Given the entity, get URL which can be used for downloading\n * entity data.\n * @memberof Drafty\n * @static\n *\n * @param {Object} entData - entity.data to get the URl from.\n * @returns {string} URL to download entity data or <code>null</code>.\n */\nDrafty.getDownloadUrl = function(entData) {\n  let url = null;\n  if (!Drafty.isFormResponseType(entData.mime) && entData.val) {\n    url = base64toObjectUrl(entData.val, entData.mime, Drafty.logger);\n  } else if (typeof entData.ref == 'string') {\n    url = entData.ref;\n  }\n  return url;\n}\n\n/**\n * Check if the entity data is not ready for sending, such as being uploaded to the server.\n * @memberof Drafty\n * @static\n *\n * @param {Object} entity.data to get the URl from.\n * @returns {boolean} true if upload is in progress, false otherwise.\n */\nDrafty.isProcessing = function(entData) {\n  return !!entData._processing;\n}\n\n/**\n * Given the entity, get URL which can be used for previewing\n * the entity.\n * @memberof Drafty\n * @static\n *\n * @param {Object} entity.data to get the URl from.\n *\n * @returns {string} url for previewing or null if no such url is available.\n */\nDrafty.getPreviewUrl = function(entData) {\n  return entData.val ? base64toObjectUrl(entData.val, entData.mime, Drafty.logger) : null;\n}\n\n/**\n * Get approximate size of the entity.\n * @memberof Drafty\n * @static\n *\n * @param {Object} entData - entity.data to get the size for.\n * @returns {number} size of entity data in bytes.\n */\nDrafty.getEntitySize = function(entData) {\n  // Either size hint or length of value. The value is base64 encoded,\n  // the actual object size is smaller than the encoded length.\n  return entData.size ? entData.size : entData.val ? (entData.val.length * 0.75) | 0 : 0;\n}\n\n/**\n * Get entity mime type.\n * @memberof Drafty\n * @static\n *\n * @param {Object} entData - entity.data to get the type for.\n * @returns {string} mime type of entity.\n */\nDrafty.getEntityMimeType = function(entData) {\n  return entData.mime || 'text/plain';\n}\n\n/**\n * Get HTML tag for a given two-letter style name.\n * @memberof Drafty\n * @static\n *\n * @param {string} style - two-letter style, like ST or LN.\n *\n * @returns {string} HTML tag name if style is found, {code: undefined} if style is falsish or not found.\n */\nDrafty.tagName = function(style) {\n  return FORMAT_TAGS[style] && FORMAT_TAGS[style].html_tag;\n}\n\n/**\n * For a given data bundle generate an object with HTML attributes,\n * for instance, given {url: \"http://www.example.com/\"} return\n * {href: \"http://www.example.com/\"}\n * @memberof Drafty\n * @static\n *\n * @param {string} style - two-letter style to generate attributes for.\n * @param {Object} data - data bundle to convert to attributes\n *\n * @returns {Object} object with HTML attributes.\n */\nDrafty.attrValue = function(style, data) {\n  if (data && DECORATORS[style] && DECORATORS[style].props) {\n    return DECORATORS[style].props(data);\n  }\n\n  return undefined;\n}\n\n/**\n * Drafty MIME type.\n * @memberof Drafty\n * @static\n *\n * @returns {string} content-Type \"text/x-drafty\".\n */\nDrafty.getContentType = function() {\n  return DRAFTY_MIME_TYPE;\n}\n\nDrafty.contentType = DRAFTY_MIME_TYPE;\n\n/**\n * Check if the given mime-type is a MIME type of drafty form response.\n * @memberof Drafty\n * @static\n *\n * @returns {boolean} <code>true</code> if given mime type is drafty form response, <code>false</code> otherwise.\n */\nDrafty.isFormResponseType = function(mimeType) {\n  return mimeType === DRAFTY_FR_MIME_TYPE ||\n    mimeType === DRAFTY_FR_MIME_TYPE_LEGACY;\n}\n\n// =================\n// Utility methods.\n// =================\n\n// Take a string and defined earlier style spans, re-compose them into a tree where each leaf is\n// a same-style (including unstyled) string. I.e. 'hello *bold _italic_* and ~more~ world' ->\n// ('hello ', (b: 'bold ', (i: 'italic')), ' and ', (s: 'more'), ' world');\n//\n// This is needed in order to clear markup, i.e. 'hello *world*' -> 'hello world' and convert\n// ranges from markup-ed offsets to plain text offsets.\nfunction chunkify(line, start, end, spans) {\n  const chunks = [];\n\n  if (spans.length == 0) {\n    return [];\n  }\n\n  for (let i in spans) {\n    // Get the next chunk from the queue\n    const span = spans[i];\n\n    // Grab the initial unstyled chunk\n    if (span.at > start) {\n      chunks.push({\n        txt: line.slice(start, span.at)\n      });\n    }\n\n    // Grab the styled chunk. It may include subchunks.\n    const chunk = {\n      tp: span.tp\n    };\n    const chld = chunkify(line, span.at + 1, span.end, span.children);\n    if (chld.length > 0) {\n      chunk.children = chld;\n    } else {\n      chunk.txt = span.txt;\n    }\n    chunks.push(chunk);\n    start = span.end + 1; // '+1' is to skip the formatting character\n  }\n\n  // Grab the remaining unstyled chunk, after the last span\n  if (start < end) {\n    chunks.push({\n      txt: line.slice(start, end)\n    });\n  }\n\n  return chunks;\n}\n\n// Detect starts and ends of formatting spans. Unformatted spans are\n// ignored at this stage.\nfunction spannify(original, re_start, re_end, type) {\n  const result = [];\n  let index = 0;\n  let line = original.slice(0); // make a copy;\n\n  while (line.length > 0) {\n    // match[0]; // match, like '*abc*'\n    // match[1]; // match captured in parenthesis, like 'abc'\n    // match['index']; // offset where the match started.\n\n    // Find the opening token.\n    const start = re_start.exec(line);\n    if (start == null) {\n      break;\n    }\n\n    // Because javascript RegExp does not support lookbehind, the actual offset may not point\n    // at the markup character. Find it in the matched string.\n    let start_offset = start['index'] + start[0].lastIndexOf(start[1]);\n    // Clip the processed part of the string.\n    line = line.slice(start_offset + 1);\n    // start_offset is an offset within the clipped string. Convert to original index.\n    start_offset += index;\n    // Index now point to the beginning of 'line' within the 'original' string.\n    index = start_offset + 1;\n\n    // Find the matching closing token.\n    const end = re_end ? re_end.exec(line) : null;\n    if (end == null) {\n      break;\n    }\n    let end_offset = end['index'] + end[0].indexOf(end[1]);\n    // Clip the processed part of the string.\n    line = line.slice(end_offset + 1);\n    // Update offsets\n    end_offset += index;\n    // Index now points to the beginning of 'line' within the 'original' string.\n    index = end_offset + 1;\n\n    result.push({\n      txt: original.slice(start_offset + 1, end_offset),\n      children: [],\n      at: start_offset,\n      end: end_offset,\n      tp: type\n    });\n  }\n\n  return result;\n}\n\n// Convert linear array or spans into a tree representation.\n// Keep standalone and nested spans, throw away partially overlapping spans.\nfunction toSpanTree(spans) {\n  if (spans.length == 0) {\n    return [];\n  }\n\n  const tree = [spans[0]];\n  let last = spans[0];\n  for (let i = 1; i < spans.length; i++) {\n    // Keep spans which start after the end of the previous span or those which\n    // are complete within the previous span.\n    if (spans[i].at > last.end) {\n      // Span is completely outside of the previous span.\n      tree.push(spans[i]);\n      last = spans[i];\n    } else if (spans[i].end <= last.end) {\n      // Span is fully inside of the previous span. Push to subnode.\n      last.children.push(spans[i]);\n    }\n    // Span could partially overlap, ignoring it as invalid.\n  }\n\n  // Recursively rearrange the subnodes.\n  for (let i in tree) {\n    tree[i].children = toSpanTree(tree[i].children);\n  }\n\n  return tree;\n}\n\n// Convert drafty document to a tree.\nfunction draftyToTree(doc) {\n  if (!doc) {\n    return null;\n  }\n\n  doc = (typeof doc == 'string') ? {\n    txt: doc\n  } : doc;\n  let {\n    txt,\n    fmt,\n    ent\n  } = doc;\n\n  txt = txt || '';\n  if (!Array.isArray(ent)) {\n    ent = [];\n  }\n\n  if (!Array.isArray(fmt) || fmt.length == 0) {\n    if (ent.length == 0) {\n      return {\n        text: txt\n      };\n    }\n\n    // Handle special case when all values in fmt are 0 and fmt therefore is skipped.\n    fmt = [{\n      at: 0,\n      len: 0,\n      key: 0\n    }];\n  }\n\n  // Sanitize spans.\n  const spans = [];\n  const attachments = [];\n  fmt.forEach((span) => {\n    if (!span || typeof span != 'object') {\n      return;\n    }\n\n    if (!['undefined', 'number'].includes(typeof span.at)) {\n      // Present, but non-numeric 'at'.\n      return;\n    }\n    if (!['undefined', 'number'].includes(typeof span.len)) {\n      // Present, but non-numeric 'len'.\n      return;\n    }\n    let at = span.at | 0;\n    let len = span.len | 0;\n    if (len < 0) {\n      // Invalid span length.\n      return;\n    }\n\n    let key = span.key || 0;\n    if (ent.length > 0 && (typeof key != 'number' || key < 0 || key >= ent.length)) {\n      // Invalid key value.\n      return;\n    }\n\n    if (at <= -1) {\n      // Attachment. Store attachments separately.\n      attachments.push({\n        start: -1,\n        end: 0,\n        key: key\n      });\n      return;\n    } else if (at + len > stringToGraphemes(txt).length) {\n      // Span is out of bounds.\n      return;\n    }\n\n    if (!span.tp) {\n      if (ent.length > 0 && (typeof ent[key] == 'object')) {\n        spans.push({\n          start: at,\n          end: at + len,\n          key: key\n        });\n      }\n    } else {\n      spans.push({\n        type: span.tp,\n        start: at,\n        end: at + len\n      });\n    }\n  });\n\n  // Sort spans first by start index (asc) then by length (desc), then by weight.\n  spans.sort((a, b) => {\n    let diff = a.start - b.start;\n    if (diff != 0) {\n      return diff;\n    }\n    diff = b.end - a.end;\n    if (diff != 0) {\n      return diff;\n    }\n    return FMT_WEIGHT.indexOf(b.type) - FMT_WEIGHT.indexOf(a.type);\n  });\n\n  // Move attachments to the end of the list.\n  if (attachments.length > 0) {\n    spans.push(...attachments);\n  }\n\n  spans.forEach((span) => {\n    if (ent.length > 0 && !span.type && ent[span.key] && typeof ent[span.key] == 'object') {\n      span.type = ent[span.key].tp;\n      span.data = ent[span.key].data;\n    }\n\n    // Is type still undefined? Hide the invalid element!\n    if (!span.type) {\n      span.type = 'HD';\n    }\n  });\n\n  const graphemes = stringToGraphemes(txt);\n  let tree = spansToTree({}, graphemes, 0, graphemes.length, spans);\n\n  // Flatten tree nodes.\n  const flatten = function(node) {\n    if (Array.isArray(node.children) && node.children.length == 1) {\n      // Unwrap.\n      const child = node.children[0];\n      if (!node.type) {\n        const parent = node.parent;\n        node = child;\n        node.parent = parent;\n      } else if (!child.type && !child.children) {\n        node.text = child.text;\n        delete node.children;\n      }\n    }\n    return node;\n  }\n  tree = treeTopDown(tree, flatten);\n\n  return tree;\n}\n\n// Add tree node to a parent tree.\nfunction addNode(parent, n) {\n  if (!n) {\n    return parent;\n  }\n\n  if (!parent.children) {\n    parent.children = [];\n  }\n\n  // If text is present, move it to a subnode.\n  if (parent.text) {\n    parent.children.push({\n      text: parent.text,\n      parent: parent\n    });\n    delete parent.text;\n  }\n\n  n.parent = parent;\n  parent.children.push(n);\n\n  return parent;\n}\n\n// Returns a tree of nodes.\nfunction spansToTree(parent, graphemes, start, end, spans) {\n  if (!spans || spans.length == 0) {\n    if (start < end) {\n      addNode(parent, {\n        text: graphemes.slice(start, end)\n          .map(segment => segment.segment)\n          .join('')\n      });\n    }\n    return parent;\n  }\n\n  // Process subspans.\n  for (let i = 0; i < spans.length; i++) {\n    const span = spans[i];\n    if (span.start < 0 && span.type == 'EX') {\n      addNode(parent, {\n        type: span.type,\n        data: span.data,\n        key: span.key,\n        att: true\n      });\n      continue;\n    }\n\n    // Add un-styled range before the styled span starts.\n    if (start < span.start) {\n      addNode(parent, {\n        text: graphemes.slice(start, span.start)\n          .map(segment => segment.segment)\n          .join('')\n      });\n      start = span.start;\n    }\n\n    // Get all spans which are within the current span.\n    const subspans = [];\n    while (i < spans.length - 1) {\n      const inner = spans[i + 1];\n      if (inner.start < 0) {\n        // Attachments are in the end. Stop.\n        break;\n      } else if (inner.start < span.end) {\n        if (inner.end <= span.end) {\n          const tag = FORMAT_TAGS[inner.tp] || {};\n          if (inner.start < inner.end || tag.isVoid) {\n            // Valid subspan: completely within the current span and\n            // either non-zero length or zero length is acceptable.\n            subspans.push(inner);\n          }\n        }\n        i++;\n        // Overlapping subspans are ignored.\n      } else {\n        // Past the end of the current span. Stop.\n        break;\n      }\n    }\n\n    addNode(parent, spansToTree({\n      type: span.type,\n      data: span.data,\n      key: span.key\n    }, graphemes, start, span.end, subspans));\n    start = span.end;\n  }\n\n  // Add the last unformatted range.\n  if (start < end) {\n    addNode(parent, {\n      text: graphemes\n        .slice(start, end)\n        .map((segment) => segment.segment)\n        .join('')\n    });\n  }\n\n  return parent;\n}\n\n// Append a tree to a Drafty doc.\nfunction treeToDrafty(doc, tree, keymap) {\n  if (!tree) {\n    return doc;\n  }\n\n  doc.txt = doc.txt || '';\n\n  // Checkpoint to measure length of the current tree node.\n  const start = stringToGraphemes(doc.txt).length;\n\n  if (tree.text) {\n    doc.txt += tree.text;\n  } else if (Array.isArray(tree.children)) {\n    tree.children.forEach((c) => {\n      treeToDrafty(doc, c, keymap);\n    });\n  }\n\n  if (tree.type) {\n    const len = stringToGraphemes(doc.txt).length - start;\n    doc.fmt = doc.fmt || [];\n    if (Object.keys(tree.data || {}).length > 0) {\n      doc.ent = doc.ent || [];\n      const newKey = (typeof keymap[tree.key] == 'undefined') ? doc.ent.length : keymap[tree.key];\n      keymap[tree.key] = newKey;\n      doc.ent[newKey] = {\n        tp: tree.type,\n        data: tree.data\n      };\n      if (tree.att) {\n        // Attachment.\n        doc.fmt.push({\n          at: -1,\n          len: 0,\n          key: newKey\n        });\n      } else {\n        doc.fmt.push({\n          at: start,\n          len: len,\n          key: newKey\n        });\n      }\n    } else {\n      doc.fmt.push({\n        tp: tree.type,\n        at: start,\n        len: len\n      });\n    }\n  }\n  return doc;\n}\n\n// Traverse the tree top down transforming the nodes: apply transformer to every tree node.\nfunction treeTopDown(src, transformer, context) {\n  if (!src) {\n    return null;\n  }\n\n  let dst = transformer.call(context, src);\n  if (!dst || !dst.children) {\n    return dst;\n  }\n\n  const children = [];\n  for (let i in dst.children) {\n    let n = dst.children[i];\n    if (n) {\n      n = treeTopDown(n, transformer, context);\n      if (n) {\n        children.push(n);\n      }\n    }\n  }\n\n  if (children.length == 0) {\n    dst.children = null;\n  } else {\n    dst.children = children;\n  }\n\n  return dst;\n}\n\n// Traverse the tree bottom-up: apply formatter to every node.\n// The formatter must maintain its state through context.\nfunction treeBottomUp(src, formatter, index, stack, context) {\n  if (!src) {\n    return null;\n  }\n\n  if (stack && src.type) {\n    stack.push(src.type);\n  }\n\n  let values = [];\n  for (let i in src.children) {\n    const n = treeBottomUp(src.children[i], formatter, i, stack, context);\n    if (n) {\n      values.push(n);\n    }\n  }\n  if (values.length == 0) {\n    if (src.text) {\n      values = [src.text];\n    } else {\n      values = null;\n    }\n  }\n\n  if (stack && src.type) {\n    stack.pop();\n  }\n\n  return formatter.call(context, src.type, src.data, values, index, stack);\n}\n\n// Clip tree to the provided limit.\nfunction shortenTree(tree, limit, tail) {\n  if (!tree) {\n    return null;\n  }\n\n  if (tail) {\n    limit -= tail.length;\n  }\n\n  const shortener = function(node) {\n    if (limit <= -1) {\n      // Limit -1 means the doc was already clipped.\n      return null;\n    }\n\n    if (node.att) {\n      // Attachments are unchanged.\n      return node;\n    }\n    if (limit == 0) {\n      node.text = tail;\n      limit = -1;\n    } else if (node.text) {\n      const graphemes = stringToGraphemes(node.text);\n      if (graphemes.length > limit) {\n        node.text = graphemes\n          .slice(0, limit)\n          .map((segment) => segment.segment)\n          .join('') + tail;\n        limit = -1;\n      } else {\n        limit -= graphemes.length;\n      }\n    }\n    return node;\n  }\n\n  return treeTopDown(tree, shortener);\n}\n\n// Strip heavy entities from a tree.\nfunction lightEntity(tree, allow) {\n  const lightCopy = node => {\n    const data = copyEntData(node.data, true, allow ? allow(node) : null);\n    if (data) {\n      node.data = data;\n    } else {\n      delete node.data;\n    }\n    return node;\n  }\n  return treeTopDown(tree, lightCopy);\n}\n\n// Remove spaces and breaks on the left.\nfunction lTrim(tree) {\n  if (tree.type == 'BR') {\n    tree = null;\n  } else if (tree.text) {\n    if (!tree.type) {\n      tree.text = tree.text.trimStart();\n      if (!tree.text) {\n        tree = null;\n      }\n    }\n  } else if (!tree.type && tree.children && tree.children.length > 0) {\n    const c = lTrim(tree.children[0]);\n    if (c) {\n      tree.children[0] = c;\n    } else {\n      tree.children.shift();\n      if (!tree.type && tree.children.length == 0) {\n        tree = null;\n      }\n    }\n  }\n  return tree;\n}\n\n// Move attachments to the end. Attachments must be at the top level, no need to traverse the tree.\nfunction attachmentsToEnd(tree, limit) {\n  if (!tree) {\n    return null;\n  }\n\n  if (tree.att) {\n    tree.text = ' ';\n    delete tree.att;\n    delete tree.children;\n  } else if (tree.children) {\n    const attachments = [];\n    const children = [];\n    for (let i in tree.children) {\n      const c = tree.children[i];\n      if (c.att) {\n        if (attachments.length == limit) {\n          // Too many attachments to preview;\n          continue;\n        }\n        if (Drafty.isFormResponseType(c.data['mime'])) {\n          // Form response attachments are not shown in preview.\n          continue;\n        }\n\n        delete c.att;\n        delete c.children;\n        c.text = ' ';\n        attachments.push(c);\n      } else {\n        children.push(c);\n      }\n    }\n    tree.children = children.concat(attachments);\n  }\n  return tree;\n}\n\n// Get a list of entities from a text.\nfunction extractEntities(line) {\n  let match;\n  let extracted = [];\n  ENTITY_TYPES.forEach((entity) => {\n    while ((match = entity.re.exec(line)) !== null) {\n      extracted.push({\n        offset: match['index'],\n        len: match[0].length,\n        unique: match[0],\n        data: entity.pack(match[0]),\n        type: entity.name\n      });\n    }\n  });\n\n  if (extracted.length == 0) {\n    return extracted;\n  }\n\n  // Remove entities detected inside other entities, like #hashtag in a URL.\n  extracted.sort((a, b) => {\n    return a.offset - b.offset;\n  });\n\n  let idx = -1;\n  extracted = extracted.filter((el) => {\n    const result = (el.offset > idx);\n    idx = el.offset + el.len;\n    return result;\n  });\n\n  return extracted;\n}\n\n// Convert the chunks into format suitable for serialization.\nfunction draftify(chunks, startAt) {\n  let plain = '';\n  let ranges = [];\n  for (let i in chunks) {\n    const chunk = chunks[i];\n    if (!chunk.txt) {\n      const drafty = draftify(chunk.children, plain.length + startAt);\n      chunk.txt = drafty.txt;\n      ranges = ranges.concat(drafty.fmt);\n    }\n\n    if (chunk.tp) {\n      ranges.push({\n        at: plain.length + startAt,\n        len: chunk.txt.length,\n        tp: chunk.tp\n      });\n    }\n\n    plain += chunk.txt;\n  }\n  return {\n    txt: plain,\n    fmt: ranges\n  };\n}\n\n// Create a copy of entity data with (light=false) or without (light=true) the large payload.\n// The array 'allow' contains a list of fields exempt from stripping.\nfunction copyEntData(data, light, allow) {\n  if (data && Object.entries(data).length > 0) {\n    allow = allow || [];\n    const dc = {};\n    ALLOWED_ENT_FIELDS.forEach(key => {\n      if (data[key]) {\n        if (light && !allow.includes(key) &&\n          (typeof data[key] == 'string' || Array.isArray(data[key])) &&\n          data[key].length > MAX_PREVIEW_DATA_SIZE) {\n          return;\n        }\n        if (typeof data[key] == 'object') {\n          return;\n        }\n        dc[key] = data[key];\n      }\n    });\n\n    if (Object.entries(dc).length != 0) {\n      return dc;\n    }\n  }\n  return null;\n}\n\n// Returns true if object is empty, if undefined returns true\nfunction isEmptyObject(obj) {\n  return Object.keys(obj ?? {}).length == 0;\n};\n\n\n// Returns an array (of length equal to the length of the original string) such that each index\n// denotes the position of char in string in a grapheme array (created from that string)\n// Eg: string: \"HiHi\" -> [0,1,2,2,2,2,3,4]\nfunction graphemeIndices(graphemes) {\n  const result = [];\n  let graphemeIndex = 0;\n  let charIndex = 0;\n\n  // Iterate over the grapheme clusters.\n  for (const {\n      segment\n    }\n    of graphemes) {\n    // Map the character indices to the grapheme index.\n    for (let i = 0; i < segment.length; i++) {\n      result[charIndex + i] = graphemeIndex;\n    }\n\n    // Increment the character index by the length of the grapheme cluster.\n    charIndex += segment.length;\n\n    // Increment the grapheme index.\n    graphemeIndex++;\n  }\n\n  return result;\n}\n\n// Convert fmt.at and fmt.len from character-expressed index and length to grapheme-expressed\n// index and length.\nfunction toGraphemeValues(fmt, segments, txt) {\n  segments = segments ?? segmenter.segment(txt);\n\n  const indices = graphemeIndices(segments);\n\n  const correctAt = indices[fmt.at];\n  const correctLen = fmt.at + fmt.len <= txt.length ?\n    indices[fmt.at + fmt.len - 1] - correctAt : fmt.len;\n\n  return {\n    at: correctAt,\n    len: correctLen + 1\n  };\n}\n\n// Convert string to graphme cluster array.\nfunction stringToGraphemes(str) {\n  return Array.from(segmenter.segment(str));\n}\n\nif (typeof module != 'undefined') {\n  module.exports = Drafty;\n}\n","/**\n * @file Definition of 'fnd' topic.\n *\n * @copyright 2015-2026 Tinode LLC.\n */\n'use strict';\n\nimport * as Const from './config.js';\nimport Topic from './topic.js';\nimport {\n  mergeToCache\n} from './utils.js';\n\n\n/**\n * Special case of {@link Tinode.Topic} for searching for contacts and group topics\n * @extends Tinode.Topic\n *\n */\nexport default class TopicFnd extends Topic {\n  // List of users and topics uid or topic_name -> Contact object)\n  _contacts = {};\n\n  /**\n   * Create TopicFnd.\n   *\n   * @param {TopicFnd.Callbacks} callbacks - Callbacks to receive various events.\n   */\n  constructor(callbacks) {\n    super(Const.TOPIC_FND, callbacks);\n  }\n\n  // Override the original Topic._processMetaSubs\n  _processMetaSubs(subs) {\n    let updateCount = Object.getOwnPropertyNames(this._contacts).length;\n    // Reset contact list.\n    this._contacts = {};\n    for (let idx in subs) {\n      let sub = subs[idx];\n      const indexBy = sub.topic ? sub.topic : sub.user;\n\n      sub = mergeToCache(this._contacts, indexBy, sub);\n      updateCount++;\n\n      if (this.onMetaSub) {\n        this.onMetaSub(sub);\n      }\n    }\n\n    if (updateCount > 0 && this.onSubsUpdated) {\n      this.onSubsUpdated(Object.keys(this._contacts));\n    }\n  }\n\n  /**\n   * Publishing to TopicFnd is not supported. {@link Topic#publish} is overriden and thows an {Error} if called.\n   * @memberof Tinode.TopicFnd#\n   * @throws {Error} Always throws an error.\n   */\n  publish() {\n    return Promise.reject(new Error(\"Publishing to 'fnd' is not supported\"));\n  }\n\n  /**\n   * setMeta to TopicFnd resets contact list in addition to sending the message.\n   * @memberof Tinode.TopicFnd#\n   * @param {Tinode.SetParams} params - parameters to update.\n   * @returns {Promise} Promise to be resolved/rejected when the server responds to request.\n   */\n  setMeta(params) {\n    return Object.getPrototypeOf(TopicFnd.prototype).setMeta.call(this, params).then(_ => {\n      if (Object.keys(this._contacts).length > 0) {\n        this._contacts = {};\n        if (this.onSubsUpdated) {\n          this.onSubsUpdated([]);\n        }\n      }\n    });\n  }\n\n  /**\n   * Check if the given tag is unique by asking the server.\n   * @param {string} tag - tag to check.\n   * @param {string} caller - identifier of the caller.\n   * @returns {Promise} promise to be resolved with true if the tag is unique, false otherwise.\n   */\n  checkTagUniqueness(tag, caller) {\n    return new Promise((resolve, reject) => {\n      this.subscribe()\n        .then(_ => this.setMeta({\n          desc: {\n            public: tag\n          }\n        }))\n        .then(_ => this.getMeta(this.startMetaQuery().withTags().build()))\n        .then(meta => {\n          if (!meta || !Array.isArray(meta.tags) || meta.tags.length == 0) {\n            resolve(true);\n          }\n          const tags = meta.tags.filter(t => t !== caller);\n          resolve(tags.length == 0);\n        })\n        .catch(err => {\n          reject(err);\n        });\n    });\n  }\n\n  /**\n   * Iterate over found contacts. If callback is undefined, use {@link this.onMetaSub}.\n   * @function\n   * @memberof Tinode.TopicFnd#\n   * @param {TopicFnd.ContactCallback} callback - Callback to call for each contact.\n   * @param {Object} context - Context to use for calling the `callback`, i.e. the value of `this` inside the callback.\n   */\n  contacts(callback, context) {\n    const cb = (callback || this.onMetaSub);\n    if (cb) {\n      for (let idx in this._contacts) {\n        cb.call(context, this._contacts[idx], idx, this._contacts);\n      }\n    }\n  }\n}\n","/**\n * @file Utilities for uploading and downloading files.\n *\n * @copyright 2015-2026 Tinode LLC.\n */\n'use strict';\n\nimport CommError from './comm-error.js';\nimport {\n  isUrlRelative,\n  jsonParseHelper\n} from './utils.js';\n\nlet XHRProvider;\n\nfunction addURLParam(relUrl, key, value) {\n  const url = new URL(relUrl, window.location.origin);\n  url.searchParams.append(key, value);\n  return url.toString().substring(window.location.origin.length);\n}\n\n/**\n * @class LargeFileHelper - utilities for uploading and downloading files out of band.\n * Don't instantiate this class directly. Use {Tinode.getLargeFileHelper} instead.\n * @memberof Tinode\n *\n * @param {Tinode} tinode - the main Tinode object.\n * @param {string} version - protocol version, i.e. '0'.\n */\nexport default class LargeFileHelper {\n  constructor(tinode, version) {\n    this._tinode = tinode;\n    this._version = version;\n\n    this._apiKey = tinode._apiKey;\n    this._authToken = tinode.getAuthToken();\n\n    // Ongoing requests.\n    this.xhr = [];\n  }\n\n  /**\n   * Start uploading the file to an endpoint at baseUrl.\n   *\n   * @memberof Tinode.LargeFileHelper#\n   *\n   * @param {string} baseUrl - base URL of upload server.\n   * @param {File|Blob} data - data to upload.\n   * @param {string} avatarFor - topic name if the upload represents an avatar.\n   * @param {Function} onProgress - callback. Takes one {number} parameter 0..1\n   * @param {Function} onSuccess - callback. Called when the file is successfully uploaded.\n   * @param {Function} onFailure - callback. Called in case of a failure.\n   *\n   * @returns {Promise} resolved/rejected when the upload is completed/failed.\n   */\n  uploadWithBaseUrl(baseUrl, data, avatarFor, onProgress, onSuccess, onFailure) {\n    let url = `/v${this._version}/file/u/`;\n    if (baseUrl) {\n      let base = baseUrl;\n      if (base.endsWith('/')) {\n        // Removing trailing slash.\n        base = base.slice(0, -1);\n      }\n      if (base.startsWith('http://') || base.startsWith('https://')) {\n        url = base + url;\n      } else {\n        throw new Error(`Invalid base URL '${baseUrl}'`);\n      }\n    }\n\n    const instance = this;\n    const xhr = new XHRProvider();\n    this.xhr.push(xhr);\n\n    xhr.open('POST', url, true);\n    xhr.setRequestHeader('X-Tinode-APIKey', this._apiKey);\n    if (this._authToken) {\n      xhr.setRequestHeader('X-Tinode-Auth', `Token ${this._authToken.token}`);\n    }\n\n    let toResolve = null;\n    let toReject = null;\n\n    const result = new Promise((resolve, reject) => {\n      toResolve = resolve;\n      toReject = reject;\n    });\n\n    xhr.upload.onprogress = e => {\n      if (e.lengthComputable) {\n        if (onProgress) {\n          onProgress(e.loaded / e.total);\n        }\n        if (this.onProgress) {\n          this.onProgress(e.loaded / e.total);\n        }\n      }\n    };\n\n    xhr.onload = function() {\n      let pkt;\n      try {\n        pkt = JSON.parse(this.response, jsonParseHelper);\n      } catch (err) {\n        instance._tinode.logger(\"ERROR: Invalid server response in LargeFileHelper\", this.response);\n        pkt = {\n          ctrl: {\n            code: this.status,\n            text: this.statusText\n          }\n        };\n      }\n\n      if (this.status >= 200 && this.status < 300) {\n        if (toResolve) {\n          toResolve(pkt.ctrl.params.url);\n        }\n        if (onSuccess) {\n          onSuccess(pkt.ctrl);\n        }\n      } else if (this.status >= 400) {\n        if (toReject) {\n          toReject(new CommError(pkt.ctrl.text, pkt.ctrl.code));\n        }\n        if (onFailure) {\n          onFailure(pkt.ctrl);\n        }\n      } else {\n        instance._tinode.logger(\"ERROR: Unexpected server response status\", this.status, this.response);\n      }\n    };\n\n    xhr.onerror = function(e) {\n      if (toReject) {\n        toReject(e || new Error(\"failed\"));\n      }\n      if (onFailure) {\n        onFailure(null);\n      }\n    };\n\n    xhr.onabort = function(e) {\n      if (toReject) {\n        toReject(new Error(\"upload cancelled by user\"));\n      }\n      if (onFailure) {\n        onFailure(null);\n      }\n    };\n\n    try {\n      const form = new FormData();\n      form.append('file', data);\n      form.set('id', this._tinode.getNextUniqueId());\n      if (avatarFor) {\n        form.set('topic', avatarFor);\n      }\n      xhr.send(form);\n    } catch (err) {\n      if (toReject) {\n        toReject(err);\n      }\n      if (onFailure) {\n        onFailure(null);\n      }\n    }\n\n    return result;\n  }\n  /**\n   * Start uploading the file to default endpoint.\n   *\n   * @memberof Tinode.LargeFileHelper#\n   *\n   * @param {File|Blob} data - data to upload.\n   * @param {string} avatarFor - topic name if the upload represents an avatar.\n   * @param {Function} onProgress - callback. Takes one {number} parameter 0..1\n   * @param {Function} onSuccess - callback. Called when the file is successfully uploaded.\n   * @param {Function} onFailure - callback. Called in case of a failure.\n   *\n   * @returns {Promise} resolved/rejected when the upload is completed/failed.\n   */\n  upload(data, avatarFor, onProgress, onSuccess, onFailure) {\n    const baseUrl = (this._tinode._secure ? 'https://' : 'http://') + this._tinode._host;\n    return this.uploadWithBaseUrl(baseUrl, data, avatarFor, onProgress, onSuccess, onFailure);\n  }\n  /**\n   * Download the file from a given URL using GET request. This method works with the Tinode server only.\n   *\n   * @memberof Tinode.LargeFileHelper#\n   *\n   * @param {string} relativeUrl - URL to download the file from. Must be relative url, i.e. must not contain the host.\n   * @param {string=} filename - file name to use for the downloaded file.\n   *\n   * @returns {Promise} resolved/rejected when the download is completed/failed.\n   */\n  download(relativeUrl, filename, mimetype, onProgress, onError) {\n    if (!isUrlRelative(relativeUrl)) {\n      // As a security measure refuse to download from an absolute URL.\n      if (onError) {\n        onError(`The URL '${relativeUrl}' must be relative, not absolute`);\n      }\n      return;\n    }\n    if (!this._authToken) {\n      if (onError) {\n        onError(\"Must authenticate first\");\n      }\n      return;\n    }\n    const instance = this;\n\n    const xhr = new XHRProvider();\n    this.xhr.push(xhr);\n\n    // Add '&asatt=1' to URL to request 'Content-Disposition: attachment' response header.\n    relativeUrl = addURLParam(relativeUrl, 'asatt', '1');\n\n    // Get data as blob (stored by the browser as a temporary file).\n    xhr.open('GET', relativeUrl, true);\n    xhr.setRequestHeader('X-Tinode-APIKey', this._apiKey);\n    xhr.setRequestHeader('X-Tinode-Auth', 'Token ' + this._authToken.token);\n    xhr.responseType = 'blob';\n\n    xhr.onprogress = function(e) {\n      if (onProgress) {\n        // Passing e.loaded instead of e.loaded/e.total because e.total\n        // is always 0 with gzip compression enabled by the server.\n        onProgress(e.loaded);\n      }\n    };\n\n    let toResolve = null;\n    let toReject = null;\n\n    const result = new Promise((resolve, reject) => {\n      toResolve = resolve;\n      toReject = reject;\n    });\n\n    // The blob needs to be saved as file. There is no known way to\n    // save the blob as file other than to fake a click on an <a href... download=...>.\n    xhr.onload = function() {\n      if (this.status == 200) {\n        const link = document.createElement('a');\n        // URL.createObjectURL is not available in non-browser environment. This call will fail.\n        link.href = window.URL.createObjectURL(new Blob([this.response], {\n          type: mimetype\n        }));\n        link.style.display = 'none';\n        link.setAttribute('download', filename);\n        document.body.appendChild(link);\n        link.click();\n        document.body.removeChild(link);\n        window.URL.revokeObjectURL(link.href);\n        if (toResolve) {\n          toResolve();\n        }\n      } else if (this.status >= 400 && toReject) {\n        // The this.responseText is undefined, must use this.response which is a blob.\n        // Need to convert this.response to JSON. The blob can only be accessed by the\n        // FileReader.\n        const reader = new FileReader();\n        reader.onload = function() {\n          try {\n            const pkt = JSON.parse(this.result, jsonParseHelper);\n            toReject(new CommError(pkt.ctrl.text, pkt.ctrl.code));\n          } catch (err) {\n            instance._tinode.logger(\"ERROR: Invalid server response in LargeFileHelper\", this.result);\n            toReject(err);\n          }\n        };\n        reader.readAsText(this.response);\n      }\n    };\n\n    xhr.onerror = function(e) {\n      if (toReject) {\n        toReject(new Error(\"failed\"));\n      }\n      if (onError) {\n        onError(e);\n      }\n    };\n\n    xhr.onabort = function() {\n      if (toReject) {\n        toReject(null);\n      }\n    };\n\n    try {\n      xhr.send();\n    } catch (err) {\n      if (toReject) {\n        toReject(err);\n      }\n      if (onError) {\n        onError(err);\n      }\n    }\n\n    return result;\n  }\n  /**\n   * Try to cancel all ongoing uploads or downloads.\n   * @memberof Tinode.LargeFileHelper#\n   */\n  cancel() {\n    this.xhr.forEach(req => {\n      if (req.readyState < 4) {\n        req.abort();\n      }\n    });\n  }\n  /**\n   * To use LargeFileHelper in a non browser context, supply XMLHttpRequest provider.\n   * @static\n   * @memberof LargeFileHelper\n   * @param {Object} xhrProvider - XMLHttpRequest provider, e.g. for node <code>require('xhr')</code>.\n   */\n  static setNetworkProvider(xhrProvider) {\n    XHRProvider = xhrProvider;\n  }\n}\n","/**\n * @file Definition of 'me' topic.\n *\n * @copyright 2015-2026 Tinode LLC.\n */\n'use strict';\n\nimport AccessMode from './access-mode.js';\nimport * as Const from './config.js';\nimport Topic from './topic.js';\nimport {\n  mergeObj\n} from './utils.js';\n\n/**\n * @class TopicMe - special case of {@link Tinode.Topic} for\n * managing data of the current user, including contact list.\n * @extends Tinode.Topic\n * @memberof Tinode\n *\n * @param {TopicMe.Callbacks} callbacks - Callbacks to receive various events.\n */\nexport default class TopicMe extends Topic {\n  onContactUpdate;\n\n  constructor(callbacks) {\n    super(Const.TOPIC_ME, callbacks);\n\n    // me-specific callbacks\n    if (callbacks) {\n      this.onContactUpdate = callbacks.onContactUpdate;\n    }\n  }\n\n  // Override the original Topic._processMetaDesc.\n  _processMetaDesc(desc) {\n    // Check if online contacts need to be turned off because P permission was removed.\n    const turnOff = (desc.acs && !desc.acs.isPresencer()) && (this.acs && this.acs.isPresencer());\n\n    // Copy parameters from desc object to this topic.\n    mergeObj(this, desc);\n    this._tinode._db.updTopic(this);\n    // Update current user's record in the global cache.\n    this._updateCachedUser(this._tinode._myUID, desc);\n\n    // 'P' permission was removed. All topics are offline now.\n    if (turnOff) {\n      this._tinode.mapTopics((cont) => {\n        if (cont.online) {\n          cont.online = false;\n          cont.seen = Object.assign(cont.seen || {}, {\n            when: new Date()\n          });\n          this._refreshContact('off', cont);\n        }\n      });\n    }\n\n    if (this.onMetaDesc) {\n      this.onMetaDesc(this);\n    }\n  }\n\n  // Override the original Topic._processMetaSubs\n  _processMetaSubs(subs) {\n    let updateCount = 0;\n    subs.forEach((sub) => {\n      const topicName = sub.topic;\n      // Don't show 'me' and 'fnd' topics in the list of contacts.\n      if (topicName == Const.TOPIC_FND || topicName == Const.TOPIC_ME) {\n        return;\n      }\n      sub.online = !!sub.online;\n\n      let cont = null;\n      if (sub.deleted) {\n        cont = sub;\n        this._tinode.cacheRemTopic(topicName);\n        this._tinode._db.remTopic(topicName);\n      } else {\n        // Ensure the values are defined and are integers.\n        if (typeof sub.seq != 'undefined') {\n          sub.seq = sub.seq | 0;\n          sub.recv = sub.recv | 0;\n          sub.read = sub.read | 0;\n          sub.unread = sub.seq - sub.read;\n        }\n\n        const topic = this._tinode.getTopic(topicName);\n        if (topic._new) {\n          delete topic._new;\n        }\n\n        cont = mergeObj(topic, sub);\n        this._tinode._db.updTopic(cont);\n\n        if (Topic.isP2PTopicName(topicName)) {\n          this._cachePutUser(topicName, cont);\n          this._tinode._db.updUser(topicName, cont.public);\n        }\n        // Notify topic of the update if it's an external update.\n        if (!sub._noForwarding && topic) {\n          sub._noForwarding = true;\n          topic._processMetaDesc(sub);\n        }\n      }\n\n      updateCount++;\n\n      if (this.onMetaSub) {\n        this.onMetaSub(cont);\n      }\n    });\n\n    if (this.onSubsUpdated && updateCount > 0) {\n      const keys = [];\n      subs.forEach((s) => {\n        keys.push(s.topic);\n      });\n      this.onSubsUpdated(keys, updateCount);\n    }\n  }\n\n  // Called by Tinode when meta.sub is received.\n  _processMetaCreds(creds, upd) {\n    if (creds.length == 1 && creds[0] == Const.DEL_CHAR) {\n      creds = [];\n    }\n    if (upd) {\n      creds.forEach((cr) => {\n        if (cr.val) {\n          // Adding a credential.\n          let idx = this._credentials.findIndex((el) => {\n            return el.meth == cr.meth && el.val == cr.val;\n          });\n          if (idx < 0) {\n            // Not found.\n            if (!cr.done) {\n              // Unconfirmed credential replaces previous unconfirmed credential of the same method.\n              idx = this._credentials.findIndex((el) => {\n                return el.meth == cr.meth && !el.done;\n              });\n              if (idx >= 0) {\n                // Remove previous unconfirmed credential.\n                this._credentials.splice(idx, 1);\n              }\n            }\n            this._credentials.push(cr);\n          } else {\n            // Found. Maybe change 'done' status.\n            this._credentials[idx].done = cr.done;\n          }\n        } else if (cr.resp) {\n          // Handle credential confirmation.\n          const idx = this._credentials.findIndex((el) => {\n            return el.meth == cr.meth && !el.done;\n          });\n          if (idx >= 0) {\n            this._credentials[idx].done = true;\n          }\n        }\n      });\n    } else {\n      this._credentials = creds;\n    }\n    if (this.onCredsUpdated) {\n      this.onCredsUpdated(this._credentials);\n    }\n  }\n\n  // Process presence change message\n  _routePres(pres) {\n    if (pres.what == 'term') {\n      // The 'me' topic itself is detached. Mark as unsubscribed.\n      this._resetSub();\n      return;\n    }\n\n    if (pres.what == 'upd' && pres.src == Const.TOPIC_ME) {\n      // Update to me's description. Request updated value.\n      this.getMeta(this.startMetaQuery().withDesc().build());\n      return;\n    }\n\n    const cont = this._tinode.cacheGetTopic(pres.src);\n    if (cont) {\n      switch (pres.what) {\n        case 'on': // topic came online\n          cont.online = true;\n          break;\n        case 'off': // topic went offline\n          if (cont.online) {\n            cont.online = false;\n            cont.seen = Object.assign(cont.seen || {}, {\n              when: new Date()\n            });\n          }\n          break;\n        case 'msg': // new message received\n          cont._updateReceived(pres.seq, pres.act);\n          break;\n        case 'upd': // desc updated\n          // Request updated subscription.\n          this.getMeta(this.startMetaQuery().withLaterOneSub(pres.src).build());\n          break;\n        case 'acs': // access mode changed\n          // If 'tgt' is not set then this is an update to the permissions of the current user.\n          // Otherwise it's an update to group topic subscriber permissions while the topic is offline.\n          // Just ignore it then.\n          if (!pres.tgt) {\n            if (cont.acs) {\n              cont.acs.updateAll(pres.dacs);\n            } else {\n              cont.acs = new AccessMode().updateAll(pres.dacs);\n            }\n            cont.touched = new Date();\n          }\n          break;\n        case 'ua':\n          // user agent changed.\n          cont.seen = {\n            when: new Date(),\n            ua: pres.val\n          };\n          break;\n        case 'recv':\n          // user's other session marked some messges as received.\n          pres.seq = pres.seq | 0;\n          cont.recv = cont.recv ? Math.max(cont.recv, pres.seq) : pres.seq;\n          break;\n        case 'read':\n          // user's other session marked some messages as read.\n          pres.seq = pres.seq | 0;\n          cont.read = cont.read ? Math.max(cont.read, pres.seq) : pres.seq;\n          cont.recv = cont.recv ? Math.max(cont.read, cont.recv) : cont.recv;\n          cont.unread = cont.seq - cont.read;\n          break;\n        case 'gone':\n          // topic deleted or unsubscribed from.\n          this._tinode.cacheRemTopic(pres.src);\n          if (!cont._deleted) {\n            cont._deleted = true;\n            cont._attached = false;\n            this._tinode._db.markTopicAsDeleted(pres.src, true);\n          } else {\n            this._tinode._db.remTopic(pres.src);\n          }\n          break;\n        case 'del':\n          // Update topic.del value.\n          break;\n        case 'react':\n          // Reaction to message.\n          cont._processMetaReact(undefined, {\n            mrrid: pres.id2 | 0,\n            seq: pres.seq,\n            user: pres.actor,\n            val: pres.val\n          });\n          break;\n        default:\n          this._tinode.logger(\"INFO: Unsupported presence update in 'me'\", pres.what);\n      }\n\n      this._refreshContact(pres.what, cont);\n    } else {\n      if (pres.what == 'acs') {\n        // New subscriptions and deleted/banned subscriptions have full\n        // access mode (no + or - in the dacs string). Changes to known subscriptions are sent as\n        // deltas, but they should not happen here.\n        const acs = new AccessMode(pres.dacs);\n        if (!acs || acs.mode == AccessMode._INVALID) {\n          this._tinode.logger(\"ERROR: Invalid access mode update\", pres.src, pres.dacs);\n          return;\n        } else if (acs.mode == AccessMode._NONE) {\n          this._tinode.logger(\"WARNING: Removing non-existent subscription\", pres.src, pres.dacs);\n          return;\n        } else {\n          // New subscription. Send request for the full description.\n          // Using .withOneSub (not .withLaterOneSub) to make sure IfModifiedSince is not set.\n          this.getMeta(this.startMetaQuery().withOneSub(undefined, pres.src).build());\n          // Create a dummy entry to catch online status update.\n          const dummy = this._tinode.getTopic(pres.src);\n          dummy.topic = pres.src;\n          dummy.online = false;\n          dummy.acs = acs;\n          this._tinode._db.updTopic(dummy);\n        }\n      } else if (pres.what == 'tags') {\n        this.getMeta(this.startMetaQuery().withTags().build());\n      } else if (pres.what == 'msg') {\n        // Message received for un unknown (previously deleted) topic.\n        this.getMeta(this.startMetaQuery().withOneSub(undefined, pres.src).build());\n        // Create an entry to catch updates and messages.\n        const dummy = this._tinode.getTopic(pres.src);\n        dummy._deleted = false;\n        this._tinode._db.updTopic(dummy);\n      }\n\n      this._refreshContact(pres.what, cont);\n    }\n\n    if (this.onPres) {\n      this.onPres(pres);\n    }\n  }\n\n  // Contact is updated, execute callbacks.\n  _refreshContact(what, cont) {\n    if (this.onContactUpdate) {\n      this.onContactUpdate(what, cont);\n    }\n  }\n\n  /**\n   * Publishing to TopicMe is not supported. {@link Topic#publish} is overridden and throws an {Error} if called.\n   * @memberof Tinode.TopicMe#\n   * @throws {Error} Always throws an error.\n   */\n  publish() {\n    return Promise.reject(new Error(\"Publishing to 'me' is not supported\"));\n  }\n\n  /**\n   * Delete validation credential.\n   * @memberof Tinode.TopicMe#\n   *\n   * @param {string} method - Validation method such as 'email' or 'tel'.\n   * @param {string} value - Credential value to delete.\n   * @returns {Promise} Promise which will be resolved/rejected on receiving server reply.\n   */\n  delCredential(method, value) {\n    if (!this._attached) {\n      return Promise.reject(new Error(\"Cannot delete credential in inactive 'me' topic\"));\n    }\n    // Send {del} message, return promise\n    return this._tinode.delCredential(method, value).then(ctrl => {\n      // Remove deleted credential from the cache.\n      const index = this._credentials.findIndex((el) => {\n        return el.meth == method && el.val == value;\n      });\n      if (index > -1) {\n        this._credentials.splice(index, 1);\n      }\n      // Notify listeners\n      if (this.onCredsUpdated) {\n        this.onCredsUpdated(this._credentials);\n      }\n      return ctrl;\n    });\n  }\n\n  /**\n   * @callback contactFilter\n   * @param {Object} contact - contact to check for inclusion.\n   * @returns {boolean} <code>true</code> if contact should be processed, <code>false</code> to exclude it.\n   */\n  /**\n   * Iterate over cached contacts.\n   *\n   * @function\n   * @memberof Tinode.TopicMe#\n   * @param {TopicMe.ContactCallback} callback - Callback to call for each contact.\n   * @param {contactFilter=} filter - Optionally filter contacts; include all if filter is false-ish, otherwise\n   *      include those for which filter returns true-ish.\n   * @param {Object=} context - Context to use for calling the `callback`, i.e. the value of `this` inside the callback.\n   */\n  contacts(callback, filter, context) {\n    this._tinode.mapTopics((c, idx) => {\n      if (c.isCommType() && (!filter || filter(c))) {\n        callback.call(context, c, idx);\n      }\n    });\n  }\n\n  /**\n   * Get a contact from cache.\n   * @memberof Tinode.TopicMe#\n   *\n   * @param {string} name - Name of the contact to get, either a UID (for p2p topics) or a topic name.\n   * @returns {Tinode.Contact} - Contact or `undefined`.\n   */\n  getContact(name) {\n    return this._tinode.cacheGetTopic(name);\n  }\n\n  /**\n   * Get access mode of a given contact from cache.\n   * @memberof Tinode.TopicMe#\n   *\n   * @param {string} name - Name of the contact to get access mode for, either a UID (for p2p topics)\n   *        or a topic name; if missing, access mode for the 'me' topic itself.\n   * @returns {string} - access mode, such as `RWP`.\n   */\n  getAccessMode(name) {\n    if (name) {\n      const cont = this._tinode.cacheGetTopic(name);\n      return cont ? cont.acs : null;\n    }\n    return this.acs;\n  }\n\n  /**\n   * Check if contact is archived, i.e. contact.private.arch == true.\n   * @memberof Tinode.TopicMe#\n   *\n   * @param {string} name - Name of the contact to check archived status, either a UID (for p2p topics) or a topic name.\n   * @returns {boolean} - true if contact is archived, false otherwise.\n   */\n  isArchived(name) {\n    const cont = this._tinode.cacheGetTopic(name);\n    return cont && cont.private && !!cont.private.arch;\n  }\n\n  /**\n   * @typedef Tinode.Credential\n   * @memberof Tinode\n   * @type Object\n   * @property {string} meth - validation method such as 'email' or 'tel'.\n   * @property {string} val - credential value, i.e. 'jdoe@example.com' or '+17025551234'\n   * @property {boolean} done - true if credential is validated.\n   */\n  /**\n   * Get the user's credentials: email, phone, etc.\n   * @memberof Tinode.TopicMe#\n   *\n   * @returns {Tinode.Credential[]} - array of credentials.\n   */\n  getCredentials() {\n    return this._credentials;\n  }\n\n  /**\n   * Pin topic to the top of the contact list.\n   * @memberof Tinode.TopicMe#\n   *\n   * @param {string} topic - Name of the topic to pin.\n   * @param {boolean} [pin=false] - If true, pin the topic, otherwise unpin.\n   *\n   * @returns {Promise} Promise to be resolved/rejected when the server responds to request.\n   */\n  pinTopic(topic, pin) {\n    if (!this._attached) {\n      return Promise.reject(new Error(\"Cannot pin topic in inactive 'me' topic\"));\n    }\n    if (!Topic.isCommTopicName(topic)) {\n      return Promise.reject(new Error(\"Invalid topic to pin\"));\n    }\n\n    const tpin = Array.isArray(this.private && this.private.tpin) ? this.private.tpin : [];\n    const found = tpin.includes(topic);\n    if ((pin && found) || (!pin && !found)) {\n      // Nothing to do.\n      return Promise.resolve(tpin);\n    }\n\n    if (pin) {\n      // Add topic to the top of the pinned list.\n      tpin.unshift(topic);\n    } else {\n      // Remove topic from the pinned list.\n      tpin.splice(tpin.indexOf(topic), 1);\n    }\n\n    return this.setMeta({\n      desc: {\n        private: {\n          tpin: tpin.length > 0 ? tpin : Const.DEL_CHAR\n        }\n      }\n    });\n  }\n\n  /**\n   * Get the rank of the pinned topic.\n   * @memberof Tinode.TopicMe#\n   * @param {string} topic - Name of the topic to check.\n   *\n   * @returns {number} numeric rank of the pinned topic in the range 1..N (N being the top,\n   *      N - the number of pinned topics) or 0 if not pinned.\n   */\n  pinnedTopicRank(topic) {\n    if (!this.private || !this.private.tpin) {\n      return 0;\n    }\n    const idx = this.private.tpin.indexOf(topic);\n    return idx < 0 ? 0 : this.private.tpin.length - idx;\n  }\n}\n","/**\n * @file Helper class for constructing {@link Tinode.GetQuery}.\n *\n * @copyright 2015-2023 Tinode LLC.\n */\n'use strict';\n\nimport {\n  listToRanges,\n  normalizeRanges\n} from './utils';\n\n/**\n * Helper class for constructing {@link Tinode.GetQuery}.\n *\n * @class MetaGetBuilder\n * @memberof Tinode\n *\n * @param {Tinode.Topic} parent topic which instantiated this builder.\n */\nexport default class MetaGetBuilder {\n  constructor(parent) {\n    this.topic = parent;\n    this.what = {};\n  }\n\n  // Get timestamp of the most recent desc update.\n  #get_desc_ims() {\n    return this.topic._deleted ? undefined : this.topic.updated;\n  }\n\n  // Get timestamp of the most recent subs update.\n  #get_subs_ims() {\n    if (this.topic.isP2PType()) {\n      return this.#get_desc_ims();\n    }\n    return this.topic._deleted ? undefined : this.topic._lastSubsUpdate;\n  }\n  /**\n   * Add query parameters to fetch messages within explicit limits.\n   * @memberof Tinode.MetaGetBuilder#\n   *\n   * @param {number=} since - messages newer than this (inclusive);\n   * @param {number=} before - older than this (exclusive)\n   * @param {number=} limit - number of messages to fetch\n   * @returns {Tinode.MetaGetBuilder} <code>this</code> object.\n   */\n  withData(since, before, limit) {\n    this.what['data'] = {\n      since: since,\n      before: before,\n      limit: limit\n    };\n    return this;\n  }\n  /**\n   * Add query parameters to fetch messages newer than the latest saved message.\n   * @memberof Tinode.MetaGetBuilder#\n   *\n   * @param {number=} limit - number of messages to fetch\n   *\n   * @returns {Tinode.MetaGetBuilder} <code>this</code> object.\n   */\n  withLaterData(limit) {\n    return this.withData(this.topic._maxSeq > 0 ? this.topic._maxSeq + 1 : undefined, undefined, limit);\n  }\n  /**\n   * Add query parameters to fetch messages within ID ranges.\n   * @memberof Tinode.MetaGetBuilder#\n   *\n   * @param {Array.<SeqRange>} ranges - ranges of seq IDs to fetch.\n   * @param {number=} limit - maximum number of messages to fetch.\n   * @returns {Tinode.MetaGetBuilder} <code>this</code> object.\n   */\n  withDataRanges(ranges, limit) {\n    this.what['data'] = {\n      ranges: normalizeRanges(ranges, this.topic._maxSeq),\n      limit: limit\n    };\n    return this;\n  }\n  /**\n   * Add query parameters to fetch messages by an array of IDs.\n   * @memberof Tinode.MetaGetBuilder#\n   *\n   * @param {number[]} list - array of seq IDs to fetch.\n   * @returns {Tinode.MetaGetBuilder} <code>this</code> object.\n   */\n  withDataList(list) {\n    return this.withDataRanges(listToRanges(list));\n  }\n  /**\n   * Add query parameters to fetch messages older than the earliest saved message.\n   * @memberof Tinode.MetaGetBuilder#\n   *\n   * @param {number=} limit - maximum number of messages to fetch.\n   *\n   * @returns {Tinode.MetaGetBuilder} <code>this</code> object.\n   */\n  withEarlierData(limit) {\n    return this.withData(undefined, this.topic._minSeq > 0 ? this.topic._minSeq : undefined, limit);\n  }\n  /**\n   * Add query parameters to fetch topic description if it's newer than the given timestamp.\n   * @memberof Tinode.MetaGetBuilder#\n   *\n   * @param {Date=} ims - fetch messages newer than this timestamp.\n   *\n   * @returns {Tinode.MetaGetBuilder} <code>this</code> object.\n   */\n  withDesc(ims) {\n    this.what['desc'] = {\n      ims: ims\n    };\n    return this;\n  }\n  /**\n   * Add query parameters to fetch topic description if it's newer than the last update.\n   * @memberof Tinode.MetaGetBuilder#\n   *\n   * @returns {Tinode.MetaGetBuilder} <code>this</code> object.\n   */\n  withLaterDesc() {\n    return this.withDesc(this.#get_desc_ims());\n  }\n  /**\n   * Add query parameters to fetch subscriptions.\n   * @memberof Tinode.MetaGetBuilder#\n   *\n   * @param {Date=} ims - fetch subscriptions modified more recently than this timestamp\n   * @param {number=} limit - maximum number of subscriptions to fetch.\n   * @param {string=} userOrTopic - user ID or topic name to fetch for fetching one subscription.\n   *\n   * @returns {Tinode.MetaGetBuilder} <code>this</code> object.\n   */\n  withSub(ims, limit, userOrTopic) {\n    const opts = {\n      ims: ims,\n      limit: limit\n    };\n    if (this.topic.getType() == 'me') {\n      opts.topic = userOrTopic;\n    } else {\n      opts.user = userOrTopic;\n    }\n    this.what['sub'] = opts;\n    return this;\n  }\n  /**\n   * Add query parameters to fetch a single subscription.\n   * @memberof Tinode.MetaGetBuilder#\n   *\n   * @param {Date=} ims - fetch subscriptions modified more recently than this timestamp\n   * @param {string=} userOrTopic - user ID or topic name to fetch for fetching one subscription.\n   *\n   * @returns {Tinode.MetaGetBuilder} <code>this</code> object.\n   */\n  withOneSub(ims, userOrTopic) {\n    return this.withSub(ims, undefined, userOrTopic);\n  }\n  /**\n   * Add query parameters to fetch a single subscription if it's been updated since the last update.\n   * @memberof Tinode.MetaGetBuilder#\n   *\n   * @param {string=} userOrTopic - user ID or topic name to fetch for fetching one subscription.\n   *\n   * @returns {Tinode.MetaGetBuilder} <code>this</code> object.\n   */\n  withLaterOneSub(userOrTopic) {\n    return this.withOneSub(this.topic._lastSubsUpdate, userOrTopic);\n  }\n  /**\n   * Add query parameters to fetch subscriptions updated since the last update.\n   * @memberof Tinode.MetaGetBuilder#\n   *\n   * @param {number=} limit - maximum number of subscriptions to fetch.\n   *\n   * @returns {Tinode.MetaGetBuilder} <code>this</code> object.\n   */\n  withLaterSub(limit) {\n    return this.withSub(this.#get_subs_ims(), limit);\n  }\n  /**\n   * Add query parameters to fetch topic tags.\n   * @memberof Tinode.MetaGetBuilder#\n   *\n   * @returns {Tinode.MetaGetBuilder} <code>this</code> object.\n   */\n  withTags() {\n    this.what['tags'] = true;\n    return this;\n  }\n  /**\n   * Add query parameters to fetch user's credentials. <code>'me'</code> topic only.\n   * @memberof Tinode.MetaGetBuilder#\n   *\n   * @returns {Tinode.MetaGetBuilder} <code>this</code> object.\n   */\n  withCred() {\n    if (this.topic.getType() == 'me') {\n      this.what['cred'] = true;\n    } else {\n      this.topic._tinode.logger(\"ERROR: Invalid topic type for MetaGetBuilder:withCreds\", this.topic.getType());\n    }\n    return this;\n  }\n  /**\n   * Add query parameters to fetch topic tags.\n   * @memberof Tinode.MetaGetBuilder#\n   *\n   * @returns {Tinode.MetaGetBuilder} <code>this</code> object.\n   */\n  withAux() {\n    this.what['aux'] = true;\n    return this;\n  }\n  /**\n   * Add query parameters to fetch deleted messages within explicit limits. Any/all parameters can be null.\n   * @memberof Tinode.MetaGetBuilder#\n   *\n   * @param {number=} since - ids of messages deleted since this 'del' id (inclusive)\n   * @param {number=} limit - number of deleted message ids to fetch\n   *\n   * @returns {Tinode.MetaGetBuilder} <code>this</code> object.\n   */\n  withDel(since, limit) {\n    if (since || limit) {\n      this.what['del'] = {\n        since: since,\n        limit: limit\n      };\n    }\n    return this;\n  }\n  /**\n   * Add query parameters to fetch messages deleted after the saved <code>'del'</code> id.\n   * @memberof Tinode.MetaGetBuilder#\n   *\n   * @param {number=} limit - number of deleted message ids to fetch\n   *\n   * @returns {Tinode.MetaGetBuilder} <code>this</code> object.\n   */\n  withLaterDel(limit) {\n    // Specify 'since' only if we have already received some messages. If\n    // we have no locally cached messages then we don't care if any messages were deleted.\n    return this.withDel(this.topic._maxSeq > 0 ? this.topic._maxDel + 1 : undefined, limit);\n  }\n\n  /**\n   * Extract subquery: get an object that contains specified subquery.\n   * @memberof Tinode.MetaGetBuilder#\n   * @param {string} what - subquery to return: one of 'data', 'sub', 'desc', 'tags', 'cred', 'del'.\n   * @returns {Object} requested subquery or <code>undefined</code>.\n   */\n  extract(what) {\n    return this.what[what];\n  }\n\n  /**\n   * Construct parameters.\n   * @memberof Tinode.MetaGetBuilder#\n   *\n   * @returns {Tinode.GetQuery} Get query\n   */\n  build() {\n    const what = [];\n    let params = {};\n    ['data', 'sub', 'desc', 'tags', 'cred', 'aux', 'del'].forEach((key) => {\n      if (this.what.hasOwnProperty(key)) {\n        what.push(key);\n        if (Object.getOwnPropertyNames(this.what[key]).length > 0) {\n          params[key] = this.what[key];\n        }\n      }\n    });\n    if (what.length > 0) {\n      params.what = what.join(' ');\n    } else {\n      params = undefined;\n    }\n    return params;\n  }\n}\n","/**\n * @file Definition of a contact card, similar to vCard.\n *\n * @copyright 2025-2026 Tinode LLC.\n *\n * TheCard class represents a contact card with various fields such as full name,\n * photo, organization, communication methods, and birthday.\n */\n\n'use strict';\n\nimport {\n  DEL_CHAR\n} from './config.js';\n\nconst THE_CARD_MIME_TYPE = 'text/x-the-card';\n\nexport default class TheCard {\n  /**\n   * Create a new contact card.\n   * @param {string} fn - Full name.\n   * @param {string} imageUrl - Avatar URL or data URL.\n   * @param {string} imageMimeType - MIME type of the avatar image.\n   * @param {string} note - Notes or comments about the contact.\n   */\n  constructor(fn, imageUrl, imageMimeType, note) {\n    Object.assign(this, theCard(fn, imageUrl, imageMimeType, note) || {});\n  }\n\n  /**\n   * Merge another card into this one.\n   * @param {Object} that - Card object to merge.\n   */\n  merge(that) {\n    Object.assign(this, that);\n  }\n\n  /**\n   * Get the MIME type of the card.\n   * @returns {string} The MIME type.\n   */\n  get contentType() {\n    return THE_CARD_MIME_TYPE;\n  }\n\n  /**\n   * Get the size of the card in bytes when serialized as JSON.\n   * @returns {number} Size in bytes.\n   */\n  get size() {\n    return JSON.stringify(this).length;\n  }\n}\n\nTheCard.contentType = THE_CARD_MIME_TYPE;\n\n/**\n * Set the full name on a card.\n * @param {Object} card - The card object.\n * @param {string} fn - Full name to set.\n * @returns {Object} The updated card.\n */\nTheCard.setFn = function(card, fn) {\n  fn = fn && fn.trim();\n  card = card || {};\n  card.fn = fn || undefined;\n  return card;\n}\n\n/**\n * Get the full name from a card.\n * @param {Object} card - The card object.\n * @returns {string|null} The full name or null if not set.\n */\nTheCard.getFn = function(card) {\n  if (card && card.fn) {\n    return card.fn;\n  }\n  return null;\n}\n\n/**\n * Set notes on a card.\n * @param {Object} card - The card object.\n * @param {string} note - Notes to set.\n * @returns {Object} The updated card.\n */\nTheCard.setNote = function(card, note) {\n  note = note && note.trim();\n  card = card || {};\n  card.note = note ? note : DEL_CHAR;\n  return card;\n}\n\n/**\n * Set photo/avatar on a card.\n * @param {Object} card - The card object.\n * @param {string} imageUrl - Image URL or data URL.\n * @param {string} imageMimeType - MIME type of the image.\n * @returns {Object} The updated card.\n */\nTheCard.setPhoto = function(card, imageUrl, imageMimeType) {\n  if (imageUrl) {\n    card = card || {};\n    let mimeType = imageMimeType;\n    // Is this a data URL \"data:[<mediatype>][;base64],<data>\"?\n    const matches = /^data:(image\\/[-a-z0-9+.]+)?(;base64)?,/i.exec(imageUrl);\n    if (matches) {\n      mimeType = matches[1];\n      card.photo = {\n        data: imageUrl.substring(imageUrl.indexOf(',') + 1),\n        ref: DEL_CHAR\n      };\n    } else {\n      card.photo = {\n        data: DEL_CHAR,\n        ref: imageUrl\n      };\n      // Get mime type from URL, if not provided.\n      if (!mimeType) {\n        const ext = /\\.([a-z0-9]+)$/i.exec(imageUrl);\n        if (ext) {\n          const extLower = ext[1].toLowerCase();\n          const mimeMap = {\n            'jpg': 'image/jpeg',\n            'jpeg': 'image/jpeg',\n            'png': 'image/png',\n            'gif': 'image/gif',\n            'bmp': 'image/bmp',\n            'webp': 'image/webp',\n            'svg': 'image/svg+xml'\n          };\n          mimeType = mimeMap[extLower] || null;\n        }\n      }\n    }\n    card.photo.type = (mimeType || 'image/jpeg').substring('image/'.length);\n  } else {\n    card = card || {};\n    card.photo = DEL_CHAR;\n  }\n  return card;\n}\n\n/**\n * Get photo URL from a card.\n * @param {Object} card - The card object.\n * @returns {string|null} Photo URL or data URL, or null if not set.\n */\nTheCard.getPhotoUrl = function(card) {\n  if (card && card.photo) {\n    if (card.photo.ref && card.photo.ref != DEL_CHAR) {\n      return card.photo.ref;\n    } else if (card.photo.data && card.photo.data != DEL_CHAR) {\n      return 'data:image/' + (card.photo.type || 'jpeg') + ';base64,' + card.photo.data;\n    }\n  }\n  return null;\n}\n\n/**\n * Get organization name from a card.\n * @param {Object} card - The card object.\n * @returns {string|null} Organization name or null if not set.\n */\nTheCard.getOrg = function(card) {\n  if (card && card.org) {\n    return card.org.fn || null;\n  }\n  return null;\n}\n\n/**\n * Set a phone number on a card, replacing any existing phone with the same type.\n * @param {Object} card - The card object.\n * @param {string} phone - Phone number.\n * @param {string} [type='voice'] - Type of phone number (e.g., 'voice', 'mobile', 'work').\n * @returns {Object} The updated card.\n */\nTheCard.setPhone = function(card, phone, type = 'voice') {\n  return addOrSetComm(card, 'tel', phone, type, true);\n}\n\n/**\n * Set an email address on a card, replacing any existing email with the same type.\n * @param {Object} card - The card object.\n * @param {string} email - Email address.\n * @param {string} [type='home'] - Type of email (e.g., 'home', 'work').\n * @returns {Object} The updated card.\n */\nTheCard.setEmail = function(card, email, type = 'home') {\n  return addOrSetComm(card, 'email', email, type, true);\n}\n\n/**\n * Set a Tinode ID on a card, replacing any existing ID with the same type.\n * @param {Object} card - The card object.\n * @param {string} tinodeID - Tinode user ID.\n * @param {string} [type='home'] - Type of ID.\n * @returns {Object} The updated card.\n */\nTheCard.setTinodeID = function(card, tinodeID, type = 'home') {\n  return addOrSetComm(card, 'tinode', tinodeID, type, true);\n}\n\n/**\n * Add a phone number to a card without replacing existing ones.\n * @param {Object} card - The card object.\n * @param {string} phone - Phone number.\n * @param {string} [type='voice'] - Type of phone number.\n * @returns {Object} The updated card.\n */\nTheCard.addPhone = function(card, phone, type = 'voice') {\n  return addOrSetComm(card, 'tel', phone, type, false);\n}\n\n/**\n * Add an email address to a card without replacing existing ones.\n * @param {Object} card - The card object.\n * @param {string} email - Email address.\n * @param {string} [type='home'] - Type of email.\n * @returns {Object} The updated card.\n */\nTheCard.addEmail = function(card, email, type = 'home') {\n  return addOrSetComm(card, 'email', email, type, false);\n}\n\n/**\n * Add a Tinode ID to a card without replacing existing ones.\n * @param {Object} card - The card object.\n * @param {string} tinodeID - Tinode user ID.\n * @param {string} [type='home'] - Type of ID.\n * @returns {Object} The updated card.\n */\nTheCard.addTinodeID = function(card, tinodeID, type = 'home') {\n  return addOrSetComm(card, 'tinode', tinodeID, type, false);\n}\n\n/**\n * Remove phone number(s) from a card.\n * @param {Object} card - The card object.\n * @param {string} phone - Phone number to remove (optional).\n * @param {string} type - Type of phone to remove (optional).\n * @returns {Object} The updated card.\n */\nTheCard.clearPhone = function(card, phone, type) {\n  return clearComm(card, 'tel', phone, type);\n}\n\n/**\n * Remove email address(es) from a card.\n * @param {Object} card - The card object.\n * @param {string} email - Email to remove (optional).\n * @param {string} type - Type of email to remove (optional).\n * @returns {Object} The updated card.\n */\nTheCard.clearEmail = function(card, email, type) {\n  return clearComm(card, 'email', email, type);\n}\n\n/**\n * Remove Tinode ID(s) from a card.\n * @param {Object} card - The card object.\n * @param {string} tinodeID - Tinode ID to remove (optional).\n * @param {string} type - Type of ID to remove (optional).\n * @returns {Object} The updated card.\n */\nTheCard.clearTinodeID = function(card, tinodeID, type) {\n  return clearComm(card, 'tinode', tinodeID, type);\n}\n\n/**\n * Get all communication methods of a specific protocol from a card.\n * @param {Object} card - The card object.\n * @param {string} proto - Protocol ('tel', 'email', 'tinode', 'http').\n * @returns {Array} Array of communication entries matching the protocol.\n */\nTheCard.getComm = function(card, proto) {\n  if (card && Array.isArray(card.comm)) {\n    return card.comm.filter(c => c.proto == proto);\n  }\n  return [];\n}\n\n/**\n * Get all email addresses from a card.\n * @param {Object} card - The card object.\n * @returns {Array<string>} Array of email addresses.\n */\nTheCard.getEmails = function(card) {\n  return TheCard.getComm(card, 'email').map(c => c.value);\n}\n\n/**\n * Get all phone numbers from a card.\n * @param {Object} card - The card object.\n * @returns {Array<string>} Array of phone numbers.\n */\nTheCard.getPhones = function(card) {\n  return TheCard.getComm(card, 'tel').map(c => c.value);\n}\n\n/**\n * Get the first Tinode ID from a card.\n * @param {Object} card - The card object.\n * @returns {string|null} The first Tinode ID or null if none.\n */\nTheCard.getFirstTinodeID = function(card) {\n  const comms = TheCard.getComm(card, 'tinode');\n  if (comms.length > 0) {\n    return comms[0].value;\n  }\n  return null;\n}\n\n/**\n * Export a card as vCard 3.0 format string.\n * @param {Object} card - The card object to export.\n * @returns {string|null} vCard formatted string or null if card is empty.\n */\nTheCard.exportVCard = function(card) {\n  if (!card) {\n    return null;\n  }\n\n  let vcard = 'BEGIN:VCARD\\r\\nVERSION:3.0\\r\\n';\n\n  if (card.fn) {\n    vcard += `FN:${card.fn}\\r\\n`;\n  }\n\n  if (card.n) {\n    vcard += `N:${card.n.surname || ''};${card.n.given || ''};${card.n.additional || ''};${card.n.prefix || ''};${card.n.suffix || ''}\\r\\n`;\n  }\n\n  if (card.org) {\n    if (card.org.fn) {\n      vcard += `ORG:${card.org.fn}\\r\\n`;\n    }\n    if (card.org.title) {\n      vcard += `TITLE:${card.org.title}\\r\\n`;\n    }\n  }\n\n  if (card.note && card.note != DEL_CHAR) {\n    vcard += `NOTE:${card.note}\\r\\n`;\n  }\n\n  if (card.bday && card.bday.m && card.bday.d) {\n    // Format as YYYY-MM-DD or --MM-DD if no year\n    const year = card.bday.y ? String(card.bday.y).padStart(4, '0') : '--';\n    const month = String(card.bday.m).padStart(2, '0');\n    const day = String(card.bday.d).padStart(2, '0');\n    vcard += `BDAY:${year}-${month}-${day}\\r\\n`;\n  }\n\n  if (card.photo) {\n    if (card.photo.ref && card.photo.ref != DEL_CHAR) {\n      vcard += `PHOTO;VALUE=URI:${card.photo.ref}\\r\\n`;\n    } else if (card.photo.data && card.photo.data != DEL_CHAR) {\n      vcard += `PHOTO;TYPE=${card.photo.type.toUpperCase()};ENCODING=b:${card.photo.data}\\r\\n`;\n    }\n  }\n\n  if (Array.isArray(card.comm)) {\n    card.comm.forEach(comm => {\n      const types = comm.des.join(',').toUpperCase();\n      if (comm.proto === 'tel') {\n        vcard += `TEL;TYPE=${types}:${comm.value}\\r\\n`;\n      } else if (comm.proto === 'email') {\n        vcard += `EMAIL;TYPE=${types}:${comm.value}\\r\\n`;\n      } else if (comm.proto === 'tinode') {\n        vcard += `IMPP;TYPE=${types};tinode:${comm.value}\\r\\n`;\n      } else if (comm.proto === 'http') {\n        vcard += `URL;TYPE=${types}:${comm.value}\\r\\n`;\n      }\n    });\n  }\n\n  vcard += 'END:VCARD\\r\\n';\n  return vcard;\n}\n\n/**\n * Import a vCard formatted string and convert it to a card object.\n * Supports vCard 2.1 and 3.0 formats with various field encodings.\n * @param {string} vcardStr - vCard formatted string.\n * @returns {Object|null} Parsed card object or null if invalid.\n */\nTheCard.importVCard = function(vcardStr) {\n  if (!vcardStr || typeof vcardStr !== 'string') {\n    return null;\n  }\n\n  // Handle line folding: lines starting with space or tab are continuations\n  // Also handle Quoted-Printable soft line breaks (line ending with =)\n  const rawLines = vcardStr.split(/\\r\\n|\\n/);\n  const lines = [];\n  let currentLine = '';\n\n  for (let i = 0; i < rawLines.length; i++) {\n    const line = rawLines[i];\n    if (line.startsWith(' ') || line.startsWith('\\t')) {\n      // This is a vCard continuation of the previous line\n      currentLine += line.substring(1);\n    } else if (currentLine.endsWith('=')) {\n      // This is a Quoted-Printable soft line break\n      // Remove the trailing = and append the next line directly\n      currentLine = currentLine.substring(0, currentLine.length - 1) + line;\n    } else {\n      if (currentLine) {\n        lines.push(currentLine);\n      }\n      currentLine = line;\n    }\n  }\n  if (currentLine) {\n    lines.push(currentLine);\n  }\n\n  let card = {};\n  // Temporary map to collect and dedupe comm entries\n  const commMap = new Map(); // key: \"proto:value\", value: Set of types\n\n  // Helper to unescape vCard text values (unescape \\, \\; \\\\ \\n)\n  const unescapeValue = (val) => {\n    return val.replace(/\\\\([,;\\\\n])/g, (match, char) => {\n      if (char === 'n') return '\\n';\n      return char;\n    });\n  };\n\n  // Helper to decode Quoted-Printable encoding\n  const decodeQuotedPrintable = (val) => {\n    // Decode =XX sequences to bytes, then decode as UTF-8\n    // First collect all bytes\n    const bytes = [];\n    let i = 0;\n    while (i < val.length) {\n      if (val[i] === '=' && i + 2 < val.length) {\n        const hex = val.substring(i + 1, i + 3);\n        if (/^[0-9A-F]{2}$/i.test(hex)) {\n          bytes.push(parseInt(hex, 16));\n          i += 3;\n        } else {\n          // Not a valid hex sequence, keep the character as-is\n          bytes.push(val.charCodeAt(i));\n          i++;\n        }\n      } else {\n        bytes.push(val.charCodeAt(i));\n        i++;\n      }\n    }\n\n    // Decode UTF-8 bytes to string\n    try {\n      const uint8Array = new Uint8Array(bytes);\n      return new TextDecoder('utf-8').decode(uint8Array);\n    } catch (e) {\n      // Fallback if TextDecoder is not available\n      return val.replace(/=([0-9A-F]{2})/gi, (match, hex) => {\n        return String.fromCharCode(parseInt(hex, 16));\n      });\n    }\n  };\n\n  lines.forEach(line => {\n    const [keyPart, ...valueParts] = line.split(':');\n    if (!keyPart || valueParts.length === 0) {\n      return;\n    }\n    const value = valueParts.join(':');\n\n    const keyParams = keyPart.split(';');\n    const key = keyParams[0].trim().toUpperCase();\n\n    // Check if QUOTED-PRINTABLE encoding is specified\n    const isQuotedPrintable = keyParams.some(param =>\n      param.trim().toUpperCase() === 'QUOTED-PRINTABLE' ||\n      param.trim().toUpperCase() === 'ENCODING=QUOTED-PRINTABLE'\n    );\n\n    if (key === 'FN') {\n      let processedValue = value;\n      if (isQuotedPrintable) {\n        processedValue = decodeQuotedPrintable(processedValue);\n      }\n      card.fn = unescapeValue(processedValue);\n    } else if (key === 'N') {\n      let processedValue = value;\n      if (isQuotedPrintable) {\n        processedValue = decodeQuotedPrintable(processedValue);\n      }\n      const parts = processedValue.split(';');\n      card.n = {\n        surname: parts[0] ? unescapeValue(parts[0]) : undefined,\n        given: parts[1] ? unescapeValue(parts[1]) : undefined,\n        additional: parts[2] ? unescapeValue(parts[2]) : undefined,\n        prefix: parts[3] ? unescapeValue(parts[3]) : undefined,\n        suffix: parts[4] ? unescapeValue(parts[4]) : undefined,\n      };\n      // Clean up undefined properties.\n      Object.keys(card.n).forEach(key => card.n[key] === undefined && delete card.n[key]);\n      if (Object.keys(card.n).length === 0) {\n        delete card.n;\n      }\n    } else if (key === 'ORG') {\n      // Multiple values are separated by semicolon. We only use the first one as distinct name.\n      // The second one is usually the department, which we skip.\n      let processedValue = value;\n      if (isQuotedPrintable) {\n        processedValue = decodeQuotedPrintable(processedValue);\n      }\n      const parts = processedValue.split(';');\n      card.org = card.org || {};\n      card.org.fn = parts[0] ? unescapeValue(parts[0]) : undefined;\n      if (!card.org.fn) delete card.org.fn;\n    } else if (key === 'TITLE') {\n      let processedValue = value;\n      if (isQuotedPrintable) {\n        processedValue = decodeQuotedPrintable(processedValue);\n      }\n      card.org = card.org || {};\n      card.org.title = processedValue ? unescapeValue(processedValue) : undefined;\n      if (!card.org.title) delete card.org.title;\n    } else if (key === 'NOTE') {\n      let processedValue = value;\n      if (isQuotedPrintable) {\n        processedValue = decodeQuotedPrintable(processedValue);\n      }\n      card.note = unescapeValue(processedValue);\n    } else if (key === 'BDAY') {\n      // Parse birthday in various formats\n      // Strip time if present (anything after T or space)\n      let dateStr = value.split(/[T ]/)[0].trim();\n\n      let year = null;\n      let month = null;\n      let day = null;\n\n      // Remove hyphens for easier parsing\n      const noHyphens = dateStr.replace(/-/g, '');\n\n      if (noHyphens.length === 6 && /^\\d{6}$/.test(noHyphens)) {\n        // YYMMDD format\n        const yy = parseInt(noHyphens.substring(0, 2), 10);\n        month = parseInt(noHyphens.substring(2, 4), 10);\n        day = parseInt(noHyphens.substring(4, 6), 10);\n        // If YY >= 35, it's 19XX, otherwise 20XX\n        year = yy >= 35 ? 1900 + yy : 2000 + yy;\n      } else if (dateStr.startsWith('--') || dateStr.startsWith('----')) {\n        // --MMDD or ----MMDD format (no year)\n        const cleaned = dateStr.replace(/^-+/, '');\n        if (cleaned.length === 4 && /^\\d{4}$/.test(cleaned)) {\n          month = parseInt(cleaned.substring(0, 2), 10);\n          day = parseInt(cleaned.substring(2, 4), 10);\n        } else if (cleaned.includes('-')) {\n          const parts = cleaned.split('-');\n          if (parts.length >= 2) {\n            month = parseInt(parts[0], 10);\n            day = parseInt(parts[1], 10);\n          }\n        }\n      } else if (noHyphens.length === 8 && /^\\d{8}$/.test(noHyphens)) {\n        // YYYYMMDD format\n        year = parseInt(noHyphens.substring(0, 4), 10);\n        month = parseInt(noHyphens.substring(4, 6), 10);\n        day = parseInt(noHyphens.substring(6, 8), 10);\n      } else if (dateStr.includes('-')) {\n        // YYYY-MM-DD format\n        const parts = dateStr.split('-');\n        if (parts[0] && parts[0] !== '' && !/^-+$/.test(parts[0])) {\n          year = parseInt(parts[0], 10);\n        }\n        if (parts.length >= 2) {\n          month = parseInt(parts[1], 10);\n        }\n        if (parts.length >= 3) {\n          day = parseInt(parts[2], 10);\n        }\n      }\n\n      // Basic validation\n      const isValidMonth = month && month >= 1 && month <= 12;\n      const isValidDay = day && day >= 1 && day <= 31;\n      const isValidYear = !year || (year >= 1800 && year <= 2200);\n\n      if (isValidMonth && isValidDay && isValidYear) {\n        card.bday = {\n          m: month,\n          d: day\n        };\n        if (year) {\n          card.bday.y = year;\n        }\n      }\n    } else if (key === 'PHOTO') {\n      const params = keyPart.split(';').slice(1);\n      let type = 'jpeg';\n      let encoding = null;\n      params.forEach(param => {\n        const [pKey, pValue] = param.split('=');\n        if (pKey && pKey.trim().toUpperCase() === 'TYPE') {\n          type = pValue ? pValue.trim().toLowerCase() : 'jpeg';\n        } else if (pKey && pKey.trim().toUpperCase() === 'ENCODING') {\n          encoding = pValue ? pValue.trim().toLowerCase() : null;\n        }\n      });\n      if (encoding === 'b') {\n        card.photo = {\n          type: type,\n          data: value,\n          ref: DEL_CHAR\n        };\n      } else {\n        card.photo = {\n          type: type,\n          data: DEL_CHAR,\n          ref: value\n        };\n      }\n    } else if (key === 'TEL') {\n      // Extract all TYPE values (can be comma-separated or multiple TYPE= params)\n      const typeParams = keyPart.split(';').filter(param => param.trim().toUpperCase().startsWith('TYPE='));\n      const types = typeParams.flatMap(param => {\n        // Split by first '=' only to get the value part\n        const equalIndex = param.indexOf('=');\n        const valuesPart = param.substring(equalIndex + 1);\n        // Split by comma and clean up any 'TYPE=' prefix\n        return valuesPart.split(',').map(t => {\n          const cleaned = t.trim().toLowerCase();\n          return cleaned.startsWith('type=') ? cleaned.substring(5) : cleaned;\n        });\n      }).filter(t => t !== 'internet'); // Skip 'internet' type\n\n      const mapKey = `tel|${value}`;\n      if (!commMap.has(mapKey)) {\n        commMap.set(mapKey, new Set());\n      }\n      types.forEach(t => commMap.get(mapKey).add(t));\n    } else if (key === 'EMAIL') {\n      // Extract all TYPE values (can be comma-separated or multiple TYPE= params)\n      const typeParams = keyPart.split(';').filter(param => param.trim().toUpperCase().startsWith('TYPE='));\n      const types = typeParams.flatMap(param => {\n        // Split by first '=' only to get the value part\n        const equalIndex = param.indexOf('=');\n        const valuesPart = param.substring(equalIndex + 1);\n        // Split by comma and clean up any 'TYPE=' prefix\n        return valuesPart.split(',').map(t => {\n          const cleaned = t.trim().toLowerCase();\n          return cleaned.startsWith('type=') ? cleaned.substring(5) : cleaned;\n        });\n      }).filter(t => t !== 'internet'); // Skip 'internet' type\n\n      const mapKey = `email|${value}`;\n      if (!commMap.has(mapKey)) {\n        commMap.set(mapKey, new Set());\n      }\n      types.forEach(t => commMap.get(mapKey).add(t));\n    } else if (key === 'IMPP') {\n      // Extract all TYPE values (can be comma-separated or multiple TYPE= params)\n      const typeParams = keyPart.split(';').filter(param => param.trim().toUpperCase().startsWith('TYPE='));\n      const types = typeParams.flatMap(param => {\n        // Split by first '=' only to get the value part\n        const equalIndex = param.indexOf('=');\n        const valuesPart = param.substring(equalIndex + 1);\n        // Split by comma and clean up any 'TYPE=' prefix\n        return valuesPart.split(',').map(t => {\n          const cleaned = t.trim().toLowerCase();\n          return cleaned.startsWith('type=') ? cleaned.substring(5) : cleaned;\n        });\n      }).filter(t => t !== 'internet'); // Skip 'internet' type\n\n      const tinodeID = value.replace(/^tinode:/, '');\n      const mapKey = `tinode|${tinodeID}`;\n      if (!commMap.has(mapKey)) {\n        commMap.set(mapKey, new Set());\n      }\n      types.forEach(t => commMap.get(mapKey).add(t));\n    } else if (key === 'URL') {\n      // Extract all TYPE values (can be comma-separated or multiple TYPE= params)\n      const typeParams = keyPart.split(';').filter(param => param.trim().toUpperCase().startsWith('TYPE='));\n      const types = typeParams.flatMap(param => {\n        // Split by first '=' only to get the value part\n        const equalIndex = param.indexOf('=');\n        const valuesPart = param.substring(equalIndex + 1);\n        // Split by comma and clean up any 'TYPE=' prefix\n        return valuesPart.split(',').map(t => {\n          const cleaned = t.trim().toLowerCase();\n          return cleaned.startsWith('type=') ? cleaned.substring(5) : cleaned;\n        });\n      }).filter(t => t !== 'internet'); // Skip 'internet' type\n\n      const mapKey = `http|${value}`;\n      if (!commMap.has(mapKey)) {\n        commMap.set(mapKey, new Set());\n      }\n      types.forEach(t => commMap.get(mapKey).add(t));\n    }\n  });\n\n  // Convert commMap to comm array\n  if (commMap.size > 0) {\n    card.comm = [];\n    commMap.forEach((types, key) => {\n      const [proto, value] = key.split('|', 2);\n      card.comm.push({\n        proto: proto,\n        des: Array.from(types),\n        value: value\n      });\n    });\n  }\n\n  return card;\n}\n\n/**\n * Check if a file type or name is a supported vCard format.\n * @param {string} type - MIME type of the file.\n * @param {string} name - File name.\n * @returns {boolean} True if the file is a vCard format.\n */\nTheCard.isFileSupported = function(type, name) {\n  return type == 'text/vcard' ||\n    (name || '').endsWith('.vcf') ||\n    (name || '').endsWith('.vcard');\n}\n\nfunction theCard(fn, imageUrl, imageMimeType, note) {\n  let card = null;\n  fn = fn && fn.trim();\n  note = note && note.trim();\n\n  if (fn) {\n    card = {\n      fn: fn\n    };\n  }\n\n  if (typeof note == 'string') {\n    card = card || {};\n    card.note = note ? note : DEL_CHAR;\n  }\n\n  if (imageUrl) {\n    card = card || {};\n    let mimeType = imageMimeType;\n    // Is this a data URL \"data:[<mediatype>][;base64],<data>\"?\n    const matches = /^data:(image\\/[-a-z0-9+.]+)?(;base64)?,/i.exec(imageUrl);\n    if (matches) {\n      mimeType = matches[1];\n      card.photo = {\n        data: imageUrl.substring(imageUrl.indexOf(',') + 1),\n        ref: DEL_CHAR\n      };\n    } else {\n      card.photo = {\n        data: DEL_CHAR,\n        ref: imageUrl\n      };\n    }\n    card.photo.type = (mimeType || 'image/jpeg').substring('image/'.length);\n  }\n\n  return card;\n}\n\nfunction addOrSetComm(card, proto, value, type, setOnly) {\n  proto = proto && proto.trim();\n  value = value && value.trim();\n  if (proto && value) {\n    card = card || {};\n    card.comm = card.comm || [];\n    if (setOnly) {\n      // Remove existing entries with the same proto and type.\n      card.comm = card.comm.filter(c => {\n        if (c.proto != proto) return true;\n        return !c.des.includes(type);\n      });\n    }\n    card.comm.push({\n      proto: proto,\n      des: [type], // Always use array\n      value: value\n    });\n  }\n  return card;\n}\n\nfunction clearComm(card, proto, value, type) {\n  if (card && Array.isArray(card.comm)) {\n    card.comm = card.comm.filter(c => {\n      if (c.proto != proto) return true;\n      if (value && c.value != value) return true;\n      if (type) {\n        return !c.des.includes(type);\n      }\n      return false;\n    });\n  }\n  return card;\n}\n","/**\n * @file Topic management.\n *\n * @copyright 2015-2026 Tinode LLC.\n */\n'use strict';\n\nimport AccessMode from './access-mode.js';\nimport CBuffer from './cbuffer.js';\nimport CommError from './comm-error.js';\nimport * as Const from './config.js';\nimport Drafty from './drafty.js';\nimport MetaGetBuilder from './meta-builder.js';\nimport {\n  listToRanges,\n  mergeObj,\n  mergeToCache,\n  normalizeArray,\n  normalizeRanges\n} from './utils.js';\n\n/**\n * Topic is a class representing a logical communication channel.\n */\nexport default class Topic {\n  /**\n   * Create topic.\n   * @param {string} name - Name of the topic to create.\n   * @param {Object=} callbacks - Object with various event callbacks.\n   * @param {Function} callbacks.onData - Callback which receives a <code>{data}</code> message.\n   * @param {Function} callbacks.onMeta - Callback which receives a <code>{meta}</code> message.\n   * @param {Function} callbacks.onPres - Callback which receives a <code>{pres}</code> message.\n   * @param {Function} callbacks.onInfo - Callback which receives an <code>{info}</code> message.\n   * @param {Function} callbacks.onMetaDesc - Callback which receives changes to topic desctioption {@link desc}.\n   * @param {Function} callbacks.onMetaSub - Called for a single subscription record change.\n   * @param {Function} callbacks.onSubsUpdated - Called after a batch of subscription changes have been recieved and cached.\n   * @param {Function} callbacks.onDeleteTopic - Called after the topic is deleted.\n   * @param {Function} callbacks.onTagsUpdated - Called after user discovery tags are updated.\n   * @param {Function} callbacks.onCredsUpdated - Called after credentials are updated.\n   * @param {Function} callbacks.onAuxUpdated - Called after auxiliary data is updated.\n   * @param {Function} callbacks.onReact - Called after message reactions are updated.\n   * @param {Function} callbacks.onAllMessagesReceived - Called when all requested <code>{data}</code> messages have been recived.\n   */\n  constructor(name, callbacks) {\n    // Parent Tinode object.\n    this._tinode = null;\n\n    // Server-provided data, locally immutable.\n    // topic name\n    this.name = name;\n    // Timestamp when the topic was created.\n    this.created = null;\n    // Timestamp when the topic was last updated.\n    this.updated = null;\n    // Timestamp of the last messages\n    this.touched = new Date(0);\n    // Access mode, see AccessMode\n    this.acs = new AccessMode(null);\n    // Per-topic private data (accessible by current user only).\n    this.private = null;\n    // Per-topic public data (accessible by all users).\n    this.public = null;\n    // Per-topic system-provided data (accessible by all users).\n    this.trusted = null;\n    // Last known messge sequence number.\n    this.seq = 0;\n    // Last known read message ID.\n    this.read = 0;\n    // Last known received message ID.\n    this.recv = 0;\n    // Last known deleted message ID.\n    this.clear = 0;\n    // Last known reaction ID.\n    this.mrrid = 0;\n\n    // Locally cached data\n    // Subscribed users, for tracking read/recv/msg notifications.\n    this._users = {};\n\n    // Current value of locally issued seqId, used for pending messages.\n    this._queuedSeqId = Const.LOCAL_SEQID;\n\n    // The maximum known {data.seq} value.\n    this._maxSeq = 0;\n    // The minimum known {data.seq} value.\n    this._minSeq = 0;\n    // Indicator that the last request for earlier messages returned 0.\n    this._noEarlierMsgs = false;\n    // The maximum known deletion ID.\n    this._maxDel = 0;\n    // The maximum seen reaction ID, same logic as read.\n    this._mrrSeen = 0;\n    // Timer object used to send 'recv' notifications.\n    this._recvNotificationTimer = null;\n\n    // User discovery tags\n    this._tags = [];\n    // Credentials such as email or phone number.\n    this._credentials = [];\n    // Auxiliary data\n    this._aux = {};\n\n    // Message versions cache (e.g. for edited messages).\n    // Keys: original message seq ID.\n    // Values: CBuffers containing newer versions of the original message\n    // ordered by seq id.\n    this._messageVersions = {};\n    // Message cache, sorted by message seq values, from old to new.\n    this._messages = new CBuffer((a, b) => {\n      return a.seq - b.seq;\n    }, true);\n    // Boolean, true if the topic is currently live\n    this._attached = false;\n    // Timestap of the most recently updated subscription.\n    this._lastSubsUpdate = new Date(0);\n    // Topic created but not yet synced with the server. Used only during initialization.\n    this._new = true;\n    // The topic is deleted at the server, this is a local copy.\n    this._deleted = false;\n\n    // Timer used to trigger {leave} request after a delay.\n    this._delayedLeaveTimer = null;\n\n    // Callbacks\n    if (callbacks) {\n      this.onData = callbacks.onData;\n      this.onMeta = callbacks.onMeta;\n      this.onPres = callbacks.onPres;\n      this.onInfo = callbacks.onInfo;\n      // A single desc update;\n      this.onMetaDesc = callbacks.onMetaDesc;\n      // A single subscription record;\n      this.onMetaSub = callbacks.onMetaSub;\n      // All subscription records received;\n      this.onSubsUpdated = callbacks.onSubsUpdated;\n      this.onTagsUpdated = callbacks.onTagsUpdated;\n      this.onCredsUpdated = callbacks.onCredsUpdated;\n      this.onAuxUpdated = callbacks.onAuxUpdated;\n      this.onReact = callbacks.onReact;\n      this.onDeleteTopic = callbacks.onDeleteTopic;\n      this.onAllMessagesReceived = callbacks.onAllMessagesReceived;\n    }\n  }\n\n  // Static methods.\n\n  /**\n   * Determine topic type from topic's name: grp, p2p, me, fnd, sys.\n   *\n   * @param {string} name - Name of the topic to test.\n   * @returns {string} One of <code>\"me\"</code>, <code>\"fnd\"</code>, <code>\"sys\"</code>, <code>\"grp\"</code>,\n   *    <code>\"p2p\"</code> or <code>undefined</code>.\n   */\n  static topicType(name) {\n    const types = {\n      'me': Const.TOPIC_ME,\n      'fnd': Const.TOPIC_FND,\n      'grp': Const.TOPIC_GRP,\n      'new': Const.TOPIC_GRP,\n      'nch': Const.TOPIC_GRP,\n      'chn': Const.TOPIC_GRP,\n      'usr': Const.TOPIC_P2P,\n      'sys': Const.TOPIC_SYS,\n      'slf': Const.TOPIC_SLF\n    };\n    return types[(typeof name == 'string') ? name.substring(0, 3) : 'xxx'];\n  }\n\n  /**\n   * Check if the given topic name is a name of a 'me' topic.\n   *\n   * @param {string} name - Name of the topic to test.\n   * @returns {boolean} <code>true</code> if the name is a name of a 'me' topic, <code>false</code> otherwise.\n   */\n  static isMeTopicName(name) {\n    return Topic.topicType(name) == Const.TOPIC_ME;\n  }\n\n  /**\n   * Check if the given topic name is a name of a 'slf' topic.\n   *\n   * @param {string} name - Name of the topic to test.\n   * @returns {boolean} <code>true</code> if the name is a name of a 'slf' topic, <code>false</code> otherwise.\n   */\n  static isSelfTopicName(name) {\n    return Topic.topicType(name) == Const.TOPIC_SLF;\n  }\n\n  /**\n   * Check if the given topic name is a name of a group topic.\n   * @static\n   *\n   * @param {string} name - Name of the topic to test.\n   * @returns {boolean} <code>true</code> if the name is a name of a group topic, <code>false</code> otherwise.\n   */\n  static isGroupTopicName(name) {\n    return Topic.topicType(name) == Const.TOPIC_GRP;\n  }\n\n  /**\n   * Check if the given topic name is a name of a p2p topic.\n   * @static\n   *\n   * @param {string} name - Name of the topic to test.\n   * @returns {boolean} <code>true</code> if the name is a name of a p2p topic, <code>false</code> otherwise.\n   */\n  static isP2PTopicName(name) {\n    return Topic.topicType(name) == Const.TOPIC_P2P;\n  }\n\n  /**\n   * Check if the given topic name is a name of a communication topic, i.e. P2P or group.\n   * @static\n   *\n   * @param {string} name - Name of the topic to test.\n   * @returns {boolean} <code>true</code> if the name is a name of a p2p or group topic, <code>false</code> otherwise.\n   */\n  static isCommTopicName(name) {\n    return Topic.isP2PTopicName(name) || Topic.isGroupTopicName(name) || Topic.isSelfTopicName(name);\n  }\n\n  /**\n   * Check if the topic name is a name of a new topic.\n   * @static\n   *\n   * @param {string} name - topic name to check.\n   * @returns {boolean} <code>true</code> if the name is a name of a new topic, <code>false</code> otherwise.\n   */\n  static isNewGroupTopicName(name) {\n    return (typeof name == 'string') &&\n      (name.substring(0, 3) == Const.TOPIC_NEW || name.substring(0, 3) == Const.TOPIC_NEW_CHAN);\n  }\n\n  /**\n   * Check if the topic name is a name of a channel.\n   * @static\n   *\n   * @param {string} name - topic name to check.\n   * @returns {boolean} <code>true</code> if the name is a name of a channel, <code>false</code> otherwise.\n   */\n  static isChannelTopicName(name) {\n    return (typeof name == 'string') &&\n      (name.substring(0, 3) == Const.TOPIC_CHAN || name.substring(0, 3) == Const.TOPIC_NEW_CHAN);\n  }\n\n  // Returns true if pub is meant to replace another message (e.g. original message was edited).\n  static #isReplacementMsg(pub) {\n    return pub.head && pub.head.replace;\n  }\n\n  /**\n   * Check if the topic is subscribed.\n   * @returns {boolean} True is topic is attached/subscribed, false otherwise.\n   */\n  isSubscribed() {\n    return this._attached;\n  }\n\n  /**\n   * Request topic to subscribe. Wrapper for {@link Tinode#subscribe}.\n   *\n   * @param {Tinode.GetQuery=} getParams - get query parameters.\n   * @param {Tinode.SetParams=} setParams - set parameters.\n   * @returns {Promise} Promise to be resolved/rejected when the server responds to the request.\n   */\n  subscribe(getParams, setParams) {\n    // Clear request to leave topic.\n    clearTimeout(this._delayedLeaveTimer);\n    this._delayedLeaveTimer = null;\n\n    // If the topic is already subscribed, return resolved promise\n    if (this._attached) {\n      return Promise.resolve(this);\n    }\n\n    // Send subscribe message, handle async response.\n    // If topic name is explicitly provided, use it. If no name, then it's a new group topic,\n    // use \"new\".\n    return this._tinode.subscribe(this.name || Const.TOPIC_NEW, getParams, setParams).then(ctrl => {\n      if (ctrl.code >= 300) {\n        // Do nothing if subscription status has not changed.\n        return ctrl;\n      }\n\n      this._attached = true;\n      this._deleted = false;\n      this.acs = (ctrl.params && ctrl.params.acs) ? ctrl.params.acs : this.acs;\n\n      // Set topic name for new topics and add it to cache.\n      if (this._new) {\n        delete this._new;\n\n        if (this.name != ctrl.topic) {\n          // Name may change new123456 -> grpAbCdEf. Remove from cache under the old name.\n          this._cacheDelSelf();\n          this.name = ctrl.topic;\n        }\n        this._cachePutSelf();\n\n        this.created = ctrl.ts;\n        this.updated = ctrl.ts;\n\n        if (this.name != Const.TOPIC_ME && this.name != Const.TOPIC_FND) {\n          // Add the new topic to the list of contacts maintained by the 'me' topic.\n          const me = this._tinode.getMeTopic();\n          if (me.onMetaSub) {\n            me.onMetaSub(this);\n          }\n          if (me.onSubsUpdated) {\n            me.onSubsUpdated([this.name], 1);\n          }\n        }\n\n        if (setParams && setParams.desc) {\n          setParams.desc._noForwarding = true;\n          this._processMetaDesc(setParams.desc);\n        }\n      }\n      return ctrl;\n    });\n  }\n\n  /**\n   * Create a draft of a message without sending it to the server.\n   * @memberof Tinode.Topic#\n   *\n   * @param {string | Object} data - Content to wrap in a draft.\n   * @param {boolean=} noEcho - If <code>true</code> server will not echo message back to originating\n   * session. Otherwise the server will send a copy of the message to sender.\n   *\n   * @returns {Object} message draft.\n   */\n  createMessage(data, noEcho) {\n    return this._tinode.createMessage(this.name, data, noEcho);\n  }\n\n  /**\n   * Immediately publish data to topic. Wrapper for {@link Tinode#publish}.\n   * @memberof Tinode.Topic#\n   *\n   * @param {string | Object} data - Message to publish, either plain string or a Drafty object.\n   * @param {boolean=} noEcho - If <code>true</code> server will not echo message back to originating\n   * @returns {Promise} Promise to be resolved/rejected when the server responds to the request.\n   */\n  publish(data, noEcho) {\n    return this.publishMessage(this.createMessage(data, noEcho));\n  }\n\n  /**\n   * Publish message created by {@link Tinode.Topic#createMessage}.\n   * @memberof Tinode.Topic#\n   *\n   * @param {Object} pub - {data} object to publish. Must be created by {@link Tinode.Topic#createMessage}\n   *\n   * @returns {Promise} Promise to be resolved/rejected when the server responds to the request.\n   */\n  publishMessage(pub) {\n    if (!this._attached) {\n      return Promise.reject(new Error(\"Cannot publish on inactive topic\"));\n    }\n    if (this._sending) {\n      return Promise.reject(new Error(\"The message is already being sent\"));\n    }\n\n    // Send data.\n    pub._sending = true;\n    pub._failed = false;\n\n    // Extract refereces to attachments and out of band image records.\n    let attachments = null;\n    if (Drafty.hasEntities(pub.content)) {\n      attachments = [];\n      Drafty.entities(pub.content, data => {\n        if (data) {\n          if (data.ref) {\n            attachments.push(data.ref);\n          }\n          if (data.preref) {\n            attachments.push(data.preref);\n          }\n        }\n      });\n      if (attachments.length == 0) {\n        attachments = null;\n      }\n    }\n\n    return this._tinode.publishMessage(pub, attachments).then(ctrl => {\n      pub._sending = false;\n      pub.ts = ctrl.ts;\n      this.swapMessageId(pub, ctrl.params.seq);\n      this._maybeUpdateMessageVersionsCache(pub);\n      this._routeData(pub);\n      return ctrl;\n    }).catch(err => {\n      this._tinode.logger(\"WARNING: Message rejected by the server\", err);\n      pub._sending = false;\n      pub._failed = true;\n      if (this.onData) {\n        this.onData();\n      }\n    });\n  }\n\n  /**\n   * Add message to local message cache, send to the server when the promise is resolved.\n   * If promise is null or undefined, the message will be sent immediately.\n   * The message is sent when the\n   * The message should be created by {@link Tinode.Topic#createMessage}.\n   * This is probably not the final API.\n   * @memberof Tinode.Topic#\n   *\n   * @param {Object} pub - Message to use as a draft.\n   * @param {Promise} prom - Message will be sent when this promise is resolved, discarded if rejected.\n   *\n   * @returns {Promise} derived promise.\n   */\n  publishDraft(pub, prom) {\n    const seq = pub.seq || this._getQueuedSeqId();\n    if (!pub._noForwarding) {\n      // The 'seq', 'ts', and 'from' are added to mimic {data}. They are removed later\n      // before the message is sent.\n      pub._noForwarding = true;\n      pub.seq = seq;\n      pub.ts = new Date();\n      pub.from = this._tinode.getCurrentUserID();\n\n      // Don't need an echo message because the message is added to local cache right away.\n      pub.noecho = true;\n      // Add to cache.\n      this._messages.put(pub);\n      this._tinode._db.addMessage(pub);\n\n      if (this.onData) {\n        this.onData(pub);\n      }\n    }\n    // If promise is provided, send the queued message when it's resolved.\n    // If no promise is provided, create a resolved one and send immediately.\n    return (prom || Promise.resolve())\n      .then(_ => {\n        if (pub._cancelled) {\n          return {\n            code: 300,\n            text: \"cancelled\"\n          };\n        }\n        return this.publishMessage(pub);\n      }).catch(err => {\n        this._tinode.logger(\"WARNING: Message draft rejected\", err);\n        pub._sending = false;\n        pub._failed = true;\n        pub._fatal = err instanceof CommError ? (err.code >= 400 && err.code < 500) : false;\n        if (this.onData) {\n          this.onData();\n        }\n        // Rethrow to let caller know that the operation failed.\n        throw err;\n      });\n  }\n\n  /**\n   * Leave the topic, optionally unsibscribe. Leaving the topic means the topic will stop\n   * receiving updates from the server. Unsubscribing will terminate user's relationship with the topic.\n   * Wrapper for {@link Tinode#leave}.\n   * @memberof Tinode.Topic#\n   *\n   * @param {boolean=} unsub - If true, unsubscribe, otherwise just leave.\n   * @returns {Promise} Promise to be resolved/rejected when the server responds to the request.\n   */\n  leave(unsub) {\n    // It's possible to unsubscribe (unsub==true) from inactive topic.\n    if (!this._attached && !unsub) {\n      return Promise.reject(new Error(\"Cannot leave inactive topic\"));\n    }\n\n    // Send a 'leave' message, handle async response\n    return this._tinode.leave(this.name, unsub).then(ctrl => {\n      this._resetSub();\n      if (unsub) {\n        this._gone();\n      }\n      return ctrl;\n    });\n  }\n\n  /**\n   * Leave the topic, optionally unsibscribe after a delay. Leaving the topic means the topic will stop\n   * receiving updates from the server. Unsubscribing will terminate user's relationship with the topic.\n   * Wrapper for {@link Tinode#leave}.\n   * @memberof Tinode.Topic#\n   *\n   * @param {boolean} unsub - If true, unsubscribe, otherwise just leave.\n   * @param {number} delay - time in milliseconds to delay leave request.\n   */\n  leaveDelayed(unsub, delay) {\n    clearTimeout(this._delayedLeaveTimer);\n    this._delayedLeaveTimer = setTimeout(_ => {\n      this._delayedLeaveTimer = null;\n      this.leave(unsub)\n    }, delay);\n  }\n\n  /**\n   * Request topic metadata from the local cache or from the server.\n   * @memberof Tinode.Topic#\n   *\n   * @param {Tinode.GetQuery} params - request parameters\n   *\n   * @returns {Promise} Promise to be resolved/rejected when the server responds to request.\n   */\n  getMeta(params) {\n    // Send {get} message, return promise.\n    return this._tinode.getMeta(this.name, params);\n  }\n\n  /**\n   * Request more messages from the server. The goal is to load continous range of messages\n   * covering at least between 'min' and 'max' + one full page forward (newer = true) or backwards\n   * (newer=false).\n   * @memberof Tinode.Topic#\n   *\n   * @param {number} limit - number of messages to get.\n   * @param {Array.<Range>} gaps - ranges of messages to load.\n   * @param {number} min - if non-negative, request newer messages with seq >= min.\n   * @param {number} max - if positive, request older messages with seq < max.\n   * @param {boolean} newer - if true, fetch newer messages; if false, fetch older messages.\n   * @returns {Promise} Promise to be resolved/rejected when the server responds to request.\n   */\n  getMessagesPage(limit, gaps, min, max, newer) {\n    let query = gaps ?\n      this.startMetaQuery().withDataRanges(gaps, limit) :\n      newer ?\n      this.startMetaQuery().withData(min, undefined, limit) :\n      this.startMetaQuery().withData(undefined, max, limit);\n    // First try fetching from DB, then from the server.\n    return this._loadMessages(this._tinode._db, query.extract('data'))\n      .then(count => {\n        // Recalculate missing ranges.\n        gaps = this.msgHasMoreMessages(min, max, newer);\n        if (gaps.length == 0) {\n          // All messages loaded.\n          return Promise.resolve({\n            topic: this.name,\n            code: 200,\n            params: {\n              count: count\n            }\n          });\n        }\n\n        // Reduce the count of requested messages.\n        limit -= count;\n        // Update query with new values loaded from DB.\n        query = this.startMetaQuery().withDataRanges(gaps, limit);\n        return this.getMeta(query.build());\n      });\n  }\n\n  /**\n   * Request to get pinned messages from the local cache or from the server.\n   * @memberof Tinode.Topic#\n   * @returns {Promise} Promise to be resolved/rejected when the server responds to request.\n   */\n  getPinnedMessages() {\n    const pins = this.aux('pins');\n    if (!Array.isArray(pins)) {\n      return Promise.resolve(0);\n    }\n\n    const loaded = [];\n    let remains = pins;\n    // First try fetching from DB, then check deleted log, then ask the server.\n    return this._tinode._db.readMessages(this.name, {\n        ranges: listToRanges(remains)\n      })\n      .then(msgs => {\n        msgs.forEach(data => {\n          // The 'data' could be undefined.\n          if (data) {\n            loaded.push(data.seq);\n            this._messages.put(data);\n            this._maybeUpdateMessageVersionsCache(data);\n          }\n        });\n        if (loaded.length < pins.length) {\n          // Some messages are missing, try dellog.\n          remains = pins.filter(seq => !loaded.includes(seq));\n          return this._tinode._db.readMessages(this.name, {\n            ranges: listToRanges(remains)\n          });\n        }\n        return null;\n      })\n      .then(ranges => {\n        if (ranges) {\n          // Found some deleted ranges in dellog.\n          remains.forEach(seq => {\n            if (ranges.find(r => r.low <= seq && r.hi > seq)) {\n              loaded.push(seq);\n            }\n          });\n        }\n        if (loaded.length == pins.length) {\n          // Got all pinned messages from the local cache.\n          return Promise.resolve({\n            topic: this.name,\n            code: 200,\n            params: {\n              count: loaded.length\n            }\n          });\n        }\n\n        remains = pins.filter(seq => !loaded.includes(seq));\n        return this.getMeta(this.startMetaQuery().withDataList(remains).build());\n      });\n  }\n\n  /**\n   * Update topic metadata.\n   * @memberof Tinode.Topic#\n   *\n   * @param {Tinode.SetParams} params - parameters to update.\n   * @returns {Promise} Promise to be resolved/rejected when the server responds to request.\n   */\n  setMeta(params) {\n    if (params.tags) {\n      params.tags = normalizeArray(params.tags);\n    }\n    // Send Set message, handle async response.\n    return this._tinode.setMeta(this.name, params)\n      .then(ctrl => {\n        if (ctrl && ctrl.code >= 300) {\n          // Not modified\n          return ctrl;\n        }\n\n        if (params.sub) {\n          params.sub.topic = this.name;\n          if (ctrl.params && ctrl.params.acs) {\n            params.sub.acs = ctrl.params.acs;\n            params.sub.updated = ctrl.ts;\n          }\n          if (!params.sub.user) {\n            // This is a subscription update of the current user.\n            // Assign user ID otherwise the update will be ignored by _processMetaSubs.\n            params.sub.user = this._tinode.getCurrentUserID();\n            if (!params.desc) {\n              // Force update to topic's asc.\n              params.desc = {};\n            }\n          }\n          params.sub._noForwarding = true;\n          this._processMetaSubs([params.sub]);\n        }\n\n        if (params.desc) {\n          if (ctrl.params && ctrl.params.acs) {\n            params.desc.acs = ctrl.params.acs;\n            params.desc.updated = ctrl.ts;\n          }\n          this._processMetaDesc(params.desc);\n        }\n\n        if (params.tags) {\n          this._processMetaTags(params.tags);\n        }\n        if (params.cred) {\n          this._processMetaCreds([params.cred], true);\n        }\n        if (params.aux) {\n          this._processMetaAux(params.aux);\n        }\n        if (params.react) {\n          params.react.mrrid = ctrl.params?.mrrid | 0;\n          this._processMetaReact(undefined, params.react);\n        }\n\n        return ctrl;\n      });\n  }\n  /**\n   * Update access mode of the current user or of another topic subscriber.\n   * @memberof Tinode.Topic#\n   *\n   * @param {string} uid - UID of the user to update or null to update current user.\n   * @param {string} update - the update value, full or delta.\n   * @returns {Promise} Promise to be resolved/rejected when the server responds to request.\n   */\n  updateMode(uid, update) {\n    const user = uid ? this.subscriber(uid) : null;\n    const am = user ?\n      user.acs.updateGiven(update).getGiven() :\n      this.getAccessMode().updateWant(update).getWant();\n\n    return this.setMeta({\n      sub: {\n        user: uid,\n        mode: am\n      }\n    });\n  }\n  /**\n   * Create new topic subscription. Wrapper for {@link Tinode#setMeta}.\n   * @memberof Tinode.Topic#\n   *\n   * @param {string} uid - ID of the user to invite\n   * @param {string=} mode - Access mode. <code>null</code> means to use default.\n   *\n   * @returns {Promise} Promise to be resolved/rejected when the server responds to request.\n   */\n  invite(uid, mode) {\n    return this.setMeta({\n      sub: {\n        user: uid,\n        mode: mode\n      }\n    });\n  }\n  /**\n   * Archive or un-archive the topic. Wrapper for {@link Tinode#setMeta}.\n   * @memberof Tinode.Topic#\n   *\n   * @param {boolean} arch - true to archive the topic, false otherwise.\n   *\n   * @returns {Promise} Promise to be resolved/rejected when the server responds to request.\n   */\n  archive(arch) {\n    if (this.private && (!this.private.arch == !arch)) {\n      return Promise.resolve(arch);\n    }\n    return this.setMeta({\n      desc: {\n        private: {\n          arch: arch ? true : Const.DEL_CHAR\n        }\n      }\n    });\n  }\n  /**\n   * Set message as pinned or unpinned by adding it to aux.pins array. Wrapper for {@link Tinode#setMeta}.\n   * @memberof Tinode.Topic#\n   *\n   * @param {number} seq - seq ID of the message to pin or un-pin.\n   * @param {boolean} pin - true to pin the message, false to un-pin.\n   *\n   * @returns {Promise} Promise to be resolved/rejected when the server responds to request.\n   */\n  pinMessage(seq, pin) {\n    let pinned = this.aux('pins');\n    if (!Array.isArray(pinned)) {\n      pinned = [];\n    }\n    let changed = false;\n    if (pin) {\n      if (!pinned.includes(seq)) {\n        changed = true;\n        if (pinned.length == Const.MAX_PINNED_COUNT) {\n          pinned.shift();\n        }\n        pinned.push(seq);\n      }\n    } else {\n      if (pinned.includes(seq)) {\n        changed = true;\n        pinned = pinned.filter(id => id != seq);\n        if (pinned.length == 0) {\n          pinned = Const.DEL_CHAR;\n        }\n      }\n    }\n    if (changed) {\n      return this.setMeta({\n        aux: {\n          pins: pinned\n        }\n      });\n    }\n    return Promise.resolve();\n  }\n\n  /**\n   * Pin topic to the top of the contact list.\n   * @memberof Tinode.Topic#\n   *\n   * @param {string} topic - Name of the topic to pin.\n   * @param {boolean} [pin=false] - If true, pin the topic, otherwise unpin.\n   *\n   * @returns {Promise} Promise to be resolved/rejected when the server responds to request.\n   */\n  pinTopic(topic, pin) {\n    // Unsupported operation for non-me topics.\n    return Promise.reject(new Error(\"Pinning topics is not supported here\"));\n  }\n\n  /**\n   * Get the rank of the pinned topic.\n   * @memberof Tinode.Topic#\n   * @param {string} topic - Name of the topic to check.\n   *\n   * @returns {number} numeric rank of the pinned topic in the range 1..N (N being the top,\n   *      N - the number of pinned topics) or 0 if not pinned.\n   */\n  pinnedTopicRank(topic) {\n    // Unsupported for non-me topics.\n    return 0;\n  }\n\n  /**\n   * Send or remove a reaction for a message in this topic.\n   * If the same reaction from the current user is already present, remove it.\n   *\n   * @param {int} seq - ID of the message to react to.\n   * @param {string} emo - Emoji string to add as reaction, or Tinode.DEL_CHAR to remove reaction.\n   */\n  react(seq, emo) {\n    if (!seq || !emo) {\n      return Promise.reject(new Error(\"Invalid parameters\"));\n    }\n    const curr = this.msgMyReaction(seq);\n    if (curr == emo) {\n      // Treat the same value as toggle.\n      emo = Const.DEL_CHAR;\n    }\n    this.setMeta({\n      react: {\n        seq: seq,\n        val: emo\n      }\n    });\n  }\n\n  /**\n   * Get a list of allowed reactions for this topic.\n   * @memberof Tinode.Topic#\n   *\n   * @returns {Array.<string>} Array of allowed reaction strings.\n   */\n  reactions() {\n    const react = this.aux('react');\n    if (react) {\n      return react.vals;\n    }\n    return this._tinode.getServerParam(Const.REACTION_LIST);\n  }\n\n  /**\n   * Get maximum number of allowed reaction types per message for this topic.\n   * @memberof Tinode.Topic#\n   *\n   * @returns {number} maxumum number of allowed reaction types per message.\n   */\n  maxReactions() {\n    const react = this.aux('react');\n    if (react) {\n      return react.max;\n    }\n    return this._tinode.getServerParam(Const.MAX_REACTIONS, 0);\n  }\n\n  /**\n   * Mark all known reactions as seen.\n   * @memberof Tinode.Topic#\n   */\n  markReactionsSeen() {\n    if (this._mrrSeen != this.mrrid) {\n      this._mrrSeen = this.mrrid;\n      // Sent a notification to 'me' listeners.\n      this._tinode.getMeTopic()._refreshContact('react', this);\n    }\n  }\n\n  /**\n   * Delete messages. Hard-deleting messages requires Deleter (D) permission.\n   * Wrapper for {@link Tinode#delMessages}.\n   * @memberof Tinode.Topic#\n   *\n   * @param {Array.<Tinode.SeqRange>} ranges - Ranges of message IDs to delete.\n   * @param {boolean=} hard - Hard or soft delete\n   * @returns {Promise} Promise to be resolved/rejected when the server responds to request.\n   */\n  delMessages(ranges, hard) {\n    if (!this._attached) {\n      return Promise.reject(new Error(\"Cannot delete messages in inactive topic\"));\n    }\n\n    const tosend = normalizeRanges(ranges, this._maxSeq)\n\n    // Send {del} message, return promise\n    let result;\n    if (tosend.length > 0) {\n      result = this._tinode.delMessages(this.name, tosend, hard);\n    } else {\n      result = Promise.resolve({\n        params: {\n          del: 0\n        }\n      });\n    }\n    // Update local cache.\n    return result.then(ctrl => {\n      if (ctrl.params.del > this._maxDel) {\n        this._maxDel = Math.max(ctrl.params.del, this._maxDel);\n        this.clear = Math.max(ctrl.params.del, this.clear);\n      }\n\n      ranges.forEach(rec => {\n        if (rec.hi) {\n          this.flushMessageRange(rec.low, rec.hi);\n        } else {\n          this.flushMessage(rec.low);\n        }\n        this._messages.put({\n          seq: rec.low,\n          low: rec.low,\n          hi: rec.hi,\n          _deleted: true\n        });\n      });\n\n      // Make a record.\n      this._tinode._db.addDelLog(this.name, ctrl.params.del, ranges);\n\n      if (this.onData) {\n        // Calling with no parameters to indicate the messages were deleted.\n        this.onData();\n      }\n      return ctrl;\n    });\n  }\n  /**\n   * Delete all messages. Hard-deleting messages requires Deleter permission.\n   * @memberof Tinode.Topic#\n   *\n   * @param {boolean} hardDel - true if messages should be hard-deleted.\n   *\n   * @returns {Promise} Promise to be resolved/rejected when the server responds to request.\n   */\n  delMessagesAll(hardDel) {\n    if (!this._maxSeq || this._maxSeq <= 0) {\n      // There are no messages to delete.\n      return Promise.resolve();\n    }\n    return this.delMessages([{\n      low: 1,\n      hi: this._maxSeq + 1,\n      _all: true\n    }], hardDel);\n  }\n\n  /**\n   * Delete multiple messages defined by their IDs. Hard-deleting messages requires Deleter permission.\n   * @memberof Tinode.Topic#\n   *\n   * @param {Array.<number>} list - list of seq IDs to delete.\n   * @param {boolean=} hardDel - true if messages should be hard-deleted.\n   *\n   * @returns {Promise} Promise to be resolved/rejected when the server responds to request.\n   */\n  delMessagesList(list, hardDel) {\n    // Send {del} message, return promise\n    return this.delMessages(listToRanges(list), hardDel);\n  }\n\n  /**\n   * Delete original message and edited variants. Hard-deleting messages requires Deleter permission.\n   * @memberof Tinode.Topic#\n   *\n   * @param {number} seq - original seq ID of the message to delete.\n   * @param {boolean=} hardDel - true if messages should be hard-deleted.\n   *\n   * @returns {Promise} Promise to be resolved/rejected when the server responds to the request.\n   */\n  delMessagesEdits(seq, hardDel) {\n    const list = [seq];\n    this.messageVersions(seq, msg => list.push(msg.seq));\n    // Send {del} message, return promise\n    return this.delMessagesList(list, hardDel);\n  }\n\n  /**\n   * Delete topic. Requires Owner permission. Wrapper for {@link Tinode#delTopic}.\n   * @memberof Tinode.Topic#\n   *\n   * @param {boolean} hard - hard-delete topic.\n   * @returns {Promise} Promise to be resolved/rejected when the server responds to the request.\n   */\n  delTopic(hard) {\n    if (this._deleted) {\n      // The topic is already deleted at the server, just remove from DB.\n      this._gone();\n      return Promise.resolve(null);\n    }\n\n    return this._tinode.delTopic(this.name, hard).then(ctrl => {\n      this._deleted = true;\n      this._resetSub();\n      this._gone();\n      return ctrl;\n    });\n  }\n  /**\n   * Delete subscription. Requires Share permission. Wrapper for {@link Tinode#delSubscription}.\n   * @memberof Tinode.Topic#\n   *\n   * @param {string} user - ID of the user to remove subscription for.\n   * @returns {Promise} Promise to be resolved/rejected when the server responds to request.\n   */\n  delSubscription(user) {\n    if (!this._attached) {\n      return Promise.reject(new Error(\"Cannot delete subscription in inactive topic\"));\n    }\n    // Send {del} message, return promise\n    return this._tinode.delSubscription(this.name, user).then(ctrl => {\n      // Remove the object from the subscription cache;\n      delete this._users[user];\n      // Notify listeners\n      if (this.onSubsUpdated) {\n        this.onSubsUpdated(Object.keys(this._users));\n      }\n      return ctrl;\n    });\n  }\n  /**\n   * Send a read/recv notification.\n   * @memberof Tinode.Topic#\n   *\n   * @param {string} what - what notification to send: <code>recv</code>, <code>read</code>.\n   * @param {number} seq - ID or the message read or received.\n   */\n  note(what, seq) {\n    if (!this._attached) {\n      // Cannot sending {note} on an inactive topic\".\n      return;\n    }\n\n    // Update local cache with the new count.\n    const user = this._users[this._tinode.getCurrentUserID()];\n    let update = false;\n    if (user) {\n      // Self-subscription is found.\n      if (!user[what] || user[what] < seq) {\n        user[what] = seq;\n        update = true;\n      }\n    } else {\n      // Self-subscription is not found.\n      update = (this[what] | 0) < seq;\n    }\n\n    if (update) {\n      // Send notification to the server.\n      this._tinode.note(this.name, what, seq);\n      // Update locally cached contact with the new count.\n      this._updateMyReadRecv(what, seq);\n\n      if (this.acs != null && !this.acs.isMuted()) {\n        const me = this._tinode.getMeTopic();\n        // Sent a notification to 'me' listeners.\n        me._refreshContact(what, this);\n      }\n    }\n  }\n\n  /**\n   * Send a 'recv' receipt. Wrapper for {@link Tinode#noteRecv}.\n   * @memberof Tinode.Topic#\n   *\n   * @param {number} seq - ID of the message to acknowledge.\n   */\n  noteRecv(seq) {\n    this.note('recv', seq);\n  }\n  /**\n   * Send a 'read' receipt. Wrapper for {@link Tinode#noteRead}.\n   * @memberof Tinode.Topic#\n   *\n   * @param {number} seq - ID of the message to acknowledge or 0/undefined to acknowledge the latest messages.\n   */\n  noteRead(seq) {\n    seq = seq || this._maxSeq;\n    if (seq > 0) {\n      this.note('read', seq);\n    }\n  }\n  /**\n   * Send a key-press notification. Wrapper for {@link Tinode#noteKeyPress}.\n   * @memberof Tinode.Topic#\n   */\n  noteKeyPress() {\n    if (this._attached) {\n      this._tinode.noteKeyPress(this.name);\n    } else {\n      this._tinode.logger(\"INFO: Cannot send notification in inactive topic\");\n    }\n  }\n  /**\n   * Send a notification that a video or audio message is being recorded. Wrapper for {@link Tinode#noteKeyPress}.\n   * @memberof Tinode.Topic#\n   * @param {boolean} audioOnly - true if the recording is audio-only, false if it's a video recording.\n   */\n  noteRecording(audioOnly) {\n    if (this._attached) {\n      this._tinode.noteKeyPress(this.name, audioOnly ? 'kpa' : 'kpv');\n    } else {\n      this._tinode.logger(\"INFO: Cannot send notification in inactive topic\");\n    }\n  }\n\n  /**\n   * Send a {note what='call'}. Wrapper for {@link Tinode#videoCall}.\n   * @memberof Tinode#\n   *\n   * @param {string} evt - Call event.\n   * @param {number} seq - ID of the call message the event pertains to.\n   * @param {string} payload - Payload associated with this event (e.g. SDP string).\n   */\n  videoCall(evt, seq, payload) {\n    if (!this._attached && !['ringing', 'hang-up'].includes(evt)) {\n      // Cannot {call} on an inactive topic\".\n      return;\n    }\n    this._tinode.videoCall(this.name, seq, evt, payload);\n  }\n\n  // Update cached read/recv/unread counts for the current user.\n  _updateMyReadRecv(what, seq, ts) {\n    let oldVal, doUpdate = false;\n\n    seq = seq | 0;\n    this.seq = this.seq | 0;\n    this.read = this.read | 0;\n    this.recv = this.recv | 0;\n    switch (what) {\n      case 'recv':\n        oldVal = this.recv;\n        this.recv = Math.max(this.recv, seq);\n        doUpdate = (oldVal != this.recv);\n        break;\n      case 'read':\n        oldVal = this.read;\n        this.read = Math.max(this.read, seq);\n        doUpdate = (oldVal != this.read);\n        break;\n      case 'msg':\n        oldVal = this.seq;\n        this.seq = Math.max(this.seq, seq);\n        if (!this.touched || this.touched < ts) {\n          this.touched = ts;\n        }\n        doUpdate = (oldVal != this.seq);\n        break;\n    }\n\n    // Sanity checks.\n    if (this.recv < this.read) {\n      this.recv = this.read;\n      doUpdate = true;\n    }\n    if (this.seq < this.recv) {\n      this.seq = this.recv;\n      if (!this.touched || this.touched < ts) {\n        this.touched = ts;\n      }\n      doUpdate = true;\n    }\n    this.unread = this.seq - this.read;\n    return doUpdate;\n  }\n  /**\n   * Get user description from global cache. The user does not need to be a\n   * subscriber of this topic.\n   * @memberof Tinode.Topic#\n   *\n   * @param {string} uid - ID of the user to fetch.\n   * @return {Object} user description or undefined.\n   */\n  userDesc(uid) {\n    // TODO: handle asynchronous requests\n    const user = this._cacheGetUser(uid);\n    if (user) {\n      return user; // Promise.resolve(user)\n    }\n  }\n  /**\n   * Get description of the p2p peer from subscription cache.\n   * @memberof Tinode.Topic#\n   *\n   * @return {Object} peer's description or undefined.\n   */\n  p2pPeerDesc() {\n    if (!this.isP2PType()) {\n      return undefined;\n    }\n    return this._users[this.name];\n  }\n  /**\n   * Iterate over cached subscribers. If callback is undefined, use this.onMetaSub.\n   * @memberof Tinode.Topic#\n   *\n   * @param {function} callback - Callback which will receive subscribers one by one.\n   * @param {Object=} context - Value of `this` inside the `callback`.\n   */\n  subscribers(callback, context) {\n    const cb = (callback || this.onMetaSub);\n    if (cb) {\n      for (let idx in this._users) {\n        cb.call(context, this._users[idx], idx, this._users);\n      }\n    }\n  }\n  /**\n   * Get a copy of cached tags.\n   * @memberof Tinode.Topic#\n   *\n   * @return {Array.<string>} a copy of tags\n   */\n  tags() {\n    // Return a copy.\n    return this._tags.slice(0);\n  }\n  /**\n   * Get auxiliary entry by key.\n   * @memberof Tinode.Topic#\n   * @param {string} key - auxiliary data key to retrieve.\n   * @return {Object} value for the <code>key</code> or <code>undefined</code>.\n   */\n  aux(key) {\n    return this._aux[key];\n  }\n  /**\n   * Get alias value (unique tag with alias: prefix), if present.\n   * The prefix is stripped off.\n   * @memberof Tinode.Topic#\n   * @return {string} alias or <code>undefined</code>.\n   */\n  alias() {\n    const alias = this._tags && this._tags.find(t => t.startsWith(Const.TAG_ALIAS));\n    if (!alias) {\n      return undefined;\n    }\n    // Remove 'alias:' prefix.\n    return alias.substring(Const.TAG_ALIAS.length);\n  }\n\n  /**\n   * Get cached subscription for the given user ID.\n   * @memberof Tinode.Topic#\n   *\n   * @param {string} uid - id of the user to query for\n   * @return user description or undefined.\n   */\n  subscriber(uid) {\n    return this._users[uid];\n  }\n  /**\n   * Iterate over versions of a message: call <code>callback</code> for each version (excluding original).\n   * If <code>callback</code> is undefined, does nothing.\n   * @memberof Tinode.Topic#\n   *\n   * @param {number} origSeq - seq ID of the original message.\n   * @param {Tinode.ForEachCallbackType} callback - Callback which will receive messages one by one. See {@link Tinode.CBuffer#forEach}\n   * @param {Object} context - Value of `this` inside the `callback`.\n   */\n  messageVersions(origSeq, callback, context) {\n    if (!callback) {\n      // No callback? We are done then.\n      return;\n    }\n    const versions = this._messageVersions[origSeq];\n    if (!versions) {\n      return;\n    }\n    versions.forEach(callback, undefined, undefined, context);\n  }\n  /**\n   * Iterate over cached messages: call <code>callback</code> for each message in the range [sinceIdx, beforeIdx).\n   * If <code>callback</code> is undefined, use <code>this.onData</code>.\n   * @memberof Tinode.Topic#\n   *\n   * @param {Tinode.ForEachCallbackType} callback - Callback which will receive messages one by one. See {@link Tinode.CBuffer#forEach}\n   * @param {number} sinceId - Optional seqId to start iterating from (inclusive).\n   * @param {number} beforeId - Optional seqId to stop iterating before it is reached (exclusive).\n   * @param {Object} context - Value of `this` inside the `callback`.\n   */\n  messages(callback, sinceId, beforeId, context) {\n    const cb = (callback || this.onData);\n    if (cb) {\n      const startIdx = typeof sinceId == 'number' ? this._messages.find({\n        seq: sinceId\n      }, true) : undefined;\n      const beforeIdx = typeof beforeId == 'number' ? this._messages.find({\n        seq: beforeId\n      }, true) : undefined;\n      if (startIdx != -1 && beforeIdx != -1) {\n        // Step 1. Filter out all replacement messages and\n        // save displayable messages in a temporary buffer.\n        let msgs = [];\n        this._messages.forEach((msg, unused1, unused2, i) => {\n          if (Topic.#isReplacementMsg(msg)) {\n            // Skip replacements.\n            return;\n          }\n          if (msg._deleted) {\n            // Skip deleted ranges.\n            return;\n          }\n          // In case the massage was edited, replace timestamp of the version with the original's timestamp.\n          const latest = this.latestMsgVersion(msg.seq) || msg;\n          if (!latest._origTs) {\n            latest._origTs = latest.ts;\n            latest._origSeq = latest.seq;\n            latest.ts = msg.ts;\n            latest.seq = msg.seq;\n          }\n          msgs.push({\n            data: latest,\n            idx: i\n          });\n        }, startIdx, beforeIdx, {});\n        // Step 2. Loop over displayble messages invoking cb on each of them.\n        msgs.forEach((val, i) => {\n          cb.call(context, val.data,\n            (i > 0 ? msgs[i - 1].data : undefined),\n            (i < msgs.length - 1 ? msgs[i + 1].data : undefined), val.idx);\n        });\n      }\n    }\n  }\n  /**\n   * Get the message from cache by literal <code>seq</code> (does not resolve message edits).\n   * @memberof Tinode.Topic#\n   *\n   * @param {number} seq - message seqId to search for.\n   * @returns {Object} the message with the given <code>seq</code> or <code>undefined</code>, if no such message is found.\n   */\n  findMessage(seq) {\n    const idx = this._messages.find({\n      seq: seq\n    });\n    if (idx >= 0) {\n      return this._messages.getAt(idx);\n    }\n    return undefined;\n  }\n  /**\n   * Get the most recent non-deleted message from cache.\n   * @memberof Tinode.Topic#\n   *\n   * @returns {Object} the most recent cached message or <code>undefined</code>, if no messages are cached.\n   */\n  latestMessage() {\n    return this._messages.getLast(msg => !msg._deleted);\n  }\n  /**\n   * Get the latest version for message.\n   * @memberof Tinode.Topic#\n   *\n   * @param {number} seq - original seq ID of the message.\n   * @returns {Object} the latest version of the message or null if message not found.\n   */\n  latestMsgVersion(seq) {\n    const versions = this._messageVersions[seq];\n    return versions ? versions.getLast() : null;\n  }\n  /**\n   * Get the maximum cached seq ID.\n   * @memberof Tinode.Topic#\n   *\n   * @returns {number} the greatest seq ID in cache.\n   */\n  maxMsgSeq() {\n    return this._maxSeq;\n  }\n  /**\n   * Get the minimum cached seq ID.\n   * @memberof Tinode.Topic#\n   *\n   * @returns {number} the smallest seq ID in cache or 0.\n   */\n  minMsgSeq() {\n    return this._minSeq;\n  }\n  /**\n   * Get the maximum deletion ID.\n   * @memberof Tinode.Topic#\n   *\n   * @returns {number} the greatest deletion ID.\n   */\n  maxClearId() {\n    return this._maxDel;\n  }\n  /**\n   * Get the number of messages in the cache.\n   * @memberof Tinode.Topic#\n   *\n   * @returns {number} count of cached messages.\n   */\n  messageCount() {\n    return this._messages.length();\n  }\n  /**\n   * Iterate over cached unsent messages. Wraps {@link Tinode.Topic#messages}.\n   * @memberof Tinode.Topic#\n   *\n   * @param {function} callback - Callback which will receive messages one by one. See {@link Tinode.CBuffer#forEach}\n   * @param {Object} context - Value of <code>this</code> inside the <code>callback</code>.\n   */\n  queuedMessages(callback, context) {\n    if (!callback) {\n      throw new Error(\"Callback must be provided\");\n    }\n    this.messages(callback, Const.LOCAL_SEQID, undefined, context);\n  }\n  /**\n   * Get the number of topic subscribers who marked this message as either recv or read\n   * Current user is excluded from the count.\n   * @memberof Tinode.Topic#\n   *\n   * @param {string} what - what action to consider: received <code>\"recv\"</code> or read <code>\"read\"</code>.\n   * @param {number} seq - ID or the message read or received.\n   *\n   * @returns {number} the number of subscribers who marked the message with the given ID as read or received.\n   */\n  msgReceiptCount(what, seq) {\n    let count = 0;\n    if (seq > 0) {\n      const me = this._tinode.getCurrentUserID();\n      for (let idx in this._users) {\n        const user = this._users[idx];\n        if (user.user !== me && user[what] >= seq) {\n          count++;\n        }\n      }\n    }\n    return count;\n  }\n  /**\n   * Get the number of topic subscribers who marked this message (and all older messages) as read.\n   * The current user is excluded from the count.\n   * @memberof Tinode.Topic#\n   *\n   * @param {number} seq - message id to check.\n   * @returns {number} number of subscribers who claim to have received the message.\n   */\n  msgReadCount(seq) {\n    return this.msgReceiptCount('read', seq);\n  }\n  /**\n   * Get the number of topic subscribers who marked this message (and all older messages) as received.\n   * The current user is excluded from the count.\n   * @memberof Tinode.Topic#\n   *\n   * @param {number} seq - Message id to check.\n   * @returns {number} Number of subscribers who claim to have received the message.\n   */\n  msgRecvCount(seq) {\n    return this.msgReceiptCount('recv', seq);\n  }\n\n  /**\n   * Return reactions for the message with the given seq id if present.\n   * @memberof Tinode.Topic#\n   * @param {number} seq - message seq id.\n   * @returns {Array} array of reaction objects or empty array.\n   */\n  msgReactions(seq) {\n    const msg = this.findMessage(seq);\n    if (!msg) {\n      return [];\n    }\n    return msg.react || [];\n  }\n\n  /**\n   * Return current user's reaction value for the given message.\n   * @memberof Tinode.Topic#\n   * @param {number} seq - message seq id.\n   * @returns {string|null} current user's reaction value or null.\n   */\n  msgMyReaction(seq) {\n    const reactions = this.msgReactions(seq);\n    const me = this._tinode.getCurrentUserID();\n    for (let i = 0; i < reactions.length; i++) {\n      if ((reactions[i].users || []).includes(me)) {\n        return reactions[i].val;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Check if topic has unseen reactions.\n   * @memberof Tinode.Topic#\n   *\n   * @returns {boolean} true if there are unseen reactions, false otherwise.\n   */\n  hasUnseenReactions() {\n    return this.mrrid > this._mrrSeen;\n  }\n\n  /**\n   * Check if cached message IDs indicate that the server may have more messages.\n   * @memberof Tinode.Topic#\n   *\n   * @param {number} min - smallest seq ID loaded range.\n   * @param {number} max - greatest seq ID in loaded range.\n   * @param {boolean} newer - if <code>true</code>, check for newer messages only.\n   * @returns {Array.<Range>} - missing ranges in the selected direction.\n   */\n  msgHasMoreMessages(min, max, newer) {\n    // Find gaps in cached messages.\n    const gaps = [];\n    if (min >= max) {\n      return gaps;\n    }\n    let maxSeq = 0;\n    let gap;\n    this._messages.forEach((msg, prev) => {\n      const p = prev || {\n        seq: 0\n      };\n      const expected = p._deleted ? p.hi : p.seq + 1;\n      if (msg.seq > expected) {\n        gap = {\n          low: expected,\n          hi: msg.seq\n        };\n      } else {\n        gap = null;\n      }\n      // If newer: collect all gaps from min to infinity.\n      // If older: collect all gaps from max to zero.\n      if (gap && (newer ? gap.hi >= min : gap.low < max)) {\n        gaps.push(gap);\n      }\n      maxSeq = expected;\n    });\n\n    if (maxSeq < this.seq) {\n      gap = {\n        low: maxSeq + 1,\n        hi: this.seq + 1\n      };\n      if (newer ? gap.hi >= min : gap.low < max) {\n        gaps.push(gap);\n      }\n    }\n    return gaps;\n  }\n  /**\n   * Check if the given seq Id is id of the most recent message.\n   * @memberof Tinode.Topic#\n   *\n   * @param {number} seqId id of the message to check\n   */\n  isNewMessage(seqId) {\n    return this._maxSeq <= seqId;\n  }\n  /**\n   * Remove one message from local cache.\n   * @memberof Tinode.Topic#\n   *\n   * @param {number} seqId id of the message to remove from cache.\n   * @returns {Message} removed message or undefined if such message was not found.\n   */\n  flushMessage(seqId) {\n    const idx = this._messages.find({\n      seq: seqId\n    });\n    delete this._messageVersions[seqId];\n    if (idx >= 0) {\n      this._tinode._db.remMessages(this.name, seqId);\n      return this._messages.delAt(idx);\n    }\n    return undefined;\n  }\n  /**\n   * Remove a range of messages from the local cache.\n   * @memberof Tinode.Topic#\n   *\n   * @param {number} fromId seq ID of the first message to remove (inclusive).\n   * @param {number} untilId seqID of the last message to remove (exclusive).\n   *\n   * @returns {Message[]} array of removed messages (could be empty).\n   */\n  flushMessageRange(fromId, untilId) {\n    // Remove range from persistent cache.\n    this._tinode._db.remMessages(this.name, fromId, untilId);\n\n    // Remove all versions keyed by IDs in the range.\n    for (let i = fromId; i < untilId; i++) {\n      delete this._messageVersions[i];\n    }\n\n    // start, end: find insertion points (nearest == true).\n    const since = this._messages.find({\n      seq: fromId\n    }, true);\n    return since >= 0 ? this._messages.delRange(since, this._messages.find({\n      seq: untilId\n    }, true)) : [];\n  }\n  /**\n   * Update message's seqId.\n   * @memberof Tinode.Topic#\n   *\n   * @param {Object} pub message object.\n   * @param {number} newSeqId new seq id for pub.\n   */\n  swapMessageId(pub, newSeqId) {\n    const idx = this._messages.find(pub);\n    const numMessages = this._messages.length();\n    if (0 <= idx && idx < numMessages) {\n      // Remove message with the old seq ID.\n      this._messages.delAt(idx);\n      this._tinode._db.remMessages(this.name, pub.seq);\n      // Add message with the new seq ID.\n      pub.seq = newSeqId;\n      this._messages.put(pub);\n      this._tinode._db.addMessage(pub);\n    }\n  }\n  /**\n   * Attempt to stop message from being sent.\n   * @memberof Tinode.Topic#\n   *\n   * @param {number} seqId id of the message to stop sending and remove from cache.\n   *\n   * @returns {boolean} <code>true</code> if message was cancelled, <code>false</code> otherwise.\n   */\n  cancelSend(seqId) {\n    const idx = this._messages.find({\n      seq: seqId\n    });\n    if (idx >= 0) {\n      const msg = this._messages.getAt(idx);\n      const status = this.msgStatus(msg);\n      if (status == Const.MESSAGE_STATUS_QUEUED ||\n        status == Const.MESSAGE_STATUS_FAILED ||\n        status == Const.MESSAGE_STATUS_FATAL) {\n        this._tinode._db.remMessages(this.name, seqId);\n        msg._cancelled = true;\n        this._messages.delAt(idx);\n        if (this.onData) {\n          // Calling with no parameters to indicate the message was deleted.\n          this.onData();\n        }\n        return true;\n      }\n    }\n    return false;\n  }\n  /**\n   * Get type of the topic: me, p2p, grp, fnd...\n   * @memberof Tinode.Topic#\n   *\n   * @returns {string} One of 'me', 'p2p', 'grp', 'fnd', 'sys' or <code>undefined</code>.\n   */\n  getType() {\n    return Topic.topicType(this.name);\n  }\n  /**\n   * Get current user's access mode of the topic.\n   * @memberof Tinode.Topic#\n   *\n   * @returns {Tinode.AccessMode} - user's access mode\n   */\n  getAccessMode() {\n    return this.acs;\n  }\n  /**\n   * Set current user's access mode of the topic.\n   * @memberof Tinode.Topic#\n   *\n   * @param {AccessMode | Object} acs - access mode to set.\n   */\n  setAccessMode(acs) {\n    return this.acs = new AccessMode(acs);\n  }\n  /**\n   * Get topic's default access mode.\n   * @memberof Tinode.Topic#\n   *\n   * @returns {Tinode.DefAcs} - access mode, such as {auth: `RWP`, anon: `N`}.\n   */\n  getDefaultAccess() {\n    return this.defacs;\n  }\n  /**\n   * Initialize new meta {@link Tinode.GetQuery} builder. The query is attched to the current topic.\n   * It will not work correctly if used with a different topic.\n   * @memberof Tinode.Topic#\n   *\n   * @returns {Tinode.MetaGetBuilder} query attached to the current topic.\n   */\n  startMetaQuery() {\n    return new MetaGetBuilder(this);\n  }\n  /**\n   * Check if topic is archived, i.e. private.arch == true.\n   * @memberof Tinode.Topic#\n   *\n   * @returns {boolean} - <code>true</code> if topic is archived, <code>false</code> otherwise.\n   */\n  isArchived() {\n    return this.private && !!this.private.arch;\n  }\n  /**\n   * Check if topic is a 'me' topic.\n   * @memberof Tinode.Topic#\n   *\n   * @returns {boolean} - <code>true</code> if topic is a 'me' topic, <code>false</code> otherwise.\n   */\n  isMeType() {\n    return Topic.isMeTopicName(this.name);\n  }\n  /**\n   * Check if topic is a 'slf' topic.\n   * @memberof Tinode.Topic#\n   *\n   * @returns {boolean} - <code>true</code> if topic is a 'slf' topic, <code>false</code> otherwise.\n   */\n  isSelfType() {\n    return Topic.isSelfTopicName(this.name);\n  }\n  /**\n   * Check if topic is a channel.\n   * @memberof Tinode.Topic#\n   *\n   * @returns {boolean} - <code>true</code> if topic is a channel, <code>false</code> otherwise.\n   */\n  isChannelType() {\n    return Topic.isChannelTopicName(this.name);\n  }\n  /**\n   * Check if topic is a group topic.\n   * @memberof Tinode.Topic#\n   *\n   * @returns {boolean} - <code>true</code> if topic is a group, <code>false</code> otherwise.\n   */\n  isGroupType() {\n    return Topic.isGroupTopicName(this.name);\n  }\n  /**\n   * Check if topic is a p2p topic.\n   * @memberof Tinode.Topic#\n   *\n   * @returns {boolean} - <code>true</code> if topic is a p2p topic, <code>false</code> otherwise.\n   */\n  isP2PType() {\n    return Topic.isP2PTopicName(this.name);\n  }\n  /**\n   * Check if topic is a communication topic, i.e. a group or p2p topic.\n   * @memberof Tinode.Topic#\n   *\n   * @returns {boolean} - <code>true</code> if topic is a p2p or group topic, <code>false</code> otherwise.\n   */\n  isCommType() {\n    return Topic.isCommTopicName(this.name);\n  }\n  /**\n   * Get status (queued, sent, received etc) of a given message in the context\n   * of this topic.\n   * @memberof Tinode.Topic#\n   *\n   * @param {Message} msg - message to check for status.\n   * @param {boolean} upd - update chached message status.\n   *\n   * @returns message status constant.\n   */\n  msgStatus(msg, upd) {\n    let status = Const.MESSAGE_STATUS_NONE;\n    if (this._tinode.isMe(msg.from)) {\n      if (msg._sending) {\n        status = Const.MESSAGE_STATUS_SENDING;\n      } else if (msg._fatal || msg._cancelled) {\n        status = Const.MESSAGE_STATUS_FATAL;\n      } else if (msg._failed) {\n        status = Const.MESSAGE_STATUS_FAILED;\n      } else if (msg.seq >= Const.LOCAL_SEQID) {\n        status = Const.MESSAGE_STATUS_QUEUED;\n      } else if (this.msgReadCount(msg.seq) > 0) {\n        status = Const.MESSAGE_STATUS_READ;\n      } else if (this.msgRecvCount(msg.seq) > 0) {\n        status = Const.MESSAGE_STATUS_RECEIVED;\n      } else if (msg.seq > 0) {\n        status = Const.MESSAGE_STATUS_SENT;\n      }\n    } else {\n      status = Const.MESSAGE_STATUS_TO_ME;\n    }\n\n    if (upd && msg._status != status) {\n      msg._status = status;\n      this._tinode._db.updMessageStatus(this.name, msg.seq, status);\n    }\n\n    return status;\n  }\n\n  // If msg is a replacement for another message, save the msg in the message versions cache\n  // as a newer version for the message it's supposed to replace.\n  _maybeUpdateMessageVersionsCache(msg) {\n    if (!Topic.#isReplacementMsg(msg)) {\n      // Check if this message is the original in the chain of edits and if so\n      // ensure all version have the same sender.\n      if (this._messageVersions[msg.seq]) {\n        // Remove versions with different 'from'.\n        this._messageVersions[msg.seq].filter(version => version.from == msg.from);\n        if (this._messageVersions[msg.seq].isEmpty()) {\n          delete this._messageVersions[msg.seq];\n        }\n      }\n      return;\n    }\n\n    const targetSeq = parseInt(msg.head.replace.split(':')[1]);\n    if (targetSeq > msg.seq) {\n      // Substitutes are supposed to have higher seq ids.\n      return;\n    }\n    const targetMsg = this.findMessage(targetSeq);\n    if (targetMsg && targetMsg.from != msg.from) {\n      // Substitute cannot change the sender.\n      return;\n    }\n    const versions = this._messageVersions[targetSeq] || new CBuffer((a, b) => {\n      return a.seq - b.seq;\n    }, true);\n    versions.put(msg);\n    this._messageVersions[targetSeq] = versions;\n  }\n\n  // Process data message\n  _routeData(data) {\n    if (data.content) {\n      if (!this.touched || this.touched < data.ts) {\n        this.touched = data.ts;\n        this._tinode._db.updTopic(this);\n      }\n    }\n\n    if (data.seq > this._maxSeq) {\n      this._maxSeq = data.seq;\n      this.msgStatus(data, true);\n      // Ackn receiving the message.\n      clearTimeout(this._recvNotificationTimer);\n      this._recvNotificationTimer = setTimeout(_ => {\n        this._recvNotificationTimer = null;\n        this.noteRecv(this._maxSeq);\n      }, Const.RECV_TIMEOUT);\n    }\n\n    if (data.seq < this._minSeq || this._minSeq == 0) {\n      this._minSeq = data.seq;\n    }\n\n    const outgoing = ((!this.isChannelType() && !data.from) || this._tinode.isMe(data.from));\n\n    if (data.head && data.head.webrtc && data.head.mime == Drafty.getContentType() && data.content) {\n      // Rewrite VC body with info from the headers.\n      const upd = {\n        state: data.head.webrtc,\n        duration: data.head['webrtc-duration'],\n        incoming: !outgoing,\n      };\n      if (data.head.vc) {\n        upd.vc = true;\n      }\n      data.content = Drafty.updateVideoCall(data.content, upd);\n    }\n\n    // Normalize reactions payload if present: server uses 'react' field with array of\n    // {value, count, users}.\n    if (data.react) {\n      let maxReact = 0;\n      data.react = (data.react || []).map(r => {\n        maxReact = Math.max(maxReact, r.mrrid);\n        return {\n          mrrid: r.mrrid,\n          val: r.val,\n          count: r.count | 0,\n          users: Array.isArray(r.users) ? r.users.slice() : []\n        };\n      });\n      if (this.mrrid < maxReact) {\n        this.mrrid = maxReact;\n      }\n    }\n\n    if (!data._noForwarding) {\n      this._messages.put(data);\n      this._tinode._db.addMessage(data);\n      this._maybeUpdateMessageVersionsCache(data);\n    }\n\n    if (this.onData) {\n      this.onData(data);\n    }\n\n    // Update locally cached contact with the new message count.\n    const what = outgoing ? 'read' : 'msg';\n    this._updateMyReadRecv(what, data.seq, data.ts);\n\n    if (!outgoing && data.from) {\n      // Mark messages as read by the sender.\n      this._routeInfo({\n        what: 'read',\n        from: data.from,\n        seq: data.seq,\n        _noForwarding: true\n      });\n    }\n\n    // Notify 'me' listeners of the change.\n    this._tinode.getMeTopic()._refreshContact(what, this);\n  }\n\n  // Process metadata message\n  _routeMeta(meta) {\n    if (meta.desc) {\n      this._processMetaDesc(meta.desc);\n    }\n    if (meta.sub && meta.sub.length > 0) {\n      this._processMetaSubs(meta.sub);\n    }\n    if (meta.del) {\n      this._processDelMessages(meta.del.clear, meta.del.delseq);\n    }\n    if (meta.tags) {\n      this._processMetaTags(meta.tags);\n    }\n    if (meta.cred) {\n      this._processMetaCreds(meta.cred);\n    }\n    if (meta.aux) {\n      this._processMetaAux(meta.aux);\n    }\n    if (meta.react) {\n      this._processMetaReact(meta.react);\n    }\n\n    if (this.onMeta) {\n      this.onMeta(meta);\n    }\n  }\n  // Process presence change message\n  _routePres(pres) {\n    let user, uid;\n    switch (pres.what) {\n      case 'del':\n        // Delete cached messages.\n        this._processDelMessages(pres.clear, pres.delseq);\n        break;\n      case 'on':\n      case 'off':\n        // Update online status of a subscription.\n        user = this._users[pres.src];\n        if (user) {\n          user.online = pres.what == 'on';\n        } else {\n          this._tinode.logger(\"WARNING: Presence update for an unknown user\", this.name, pres.src);\n        }\n        break;\n      case 'term':\n        // Attachment to topic is terminated probably due to cluster rehashing.\n        this._resetSub();\n        break;\n      case 'upd':\n        // A topic subscriber has updated his description.\n        // Issue {get sub} only if the current user has no p2p topics with the updated user (p2p name is not in cache).\n        // Otherwise 'me' will issue a {get desc} request.\n        if (pres.src && !this._tinode.isTopicCached(pres.src)) {\n          this.getMeta(this.startMetaQuery().withOneSub(undefined, pres.src).build());\n        }\n        break;\n      case 'aux':\n        // Auxiliary data updated.\n        this.getMeta(this.startMetaQuery().withAux().build());\n        break;\n      case 'react':\n        // Reaction to message.\n        this._processMetaReact(undefined, {\n          mrrid: pres.id2 | 0,\n          seq: pres.seq | 0,\n          user: pres.act,\n          val: pres.val,\n        });\n        break;\n      case 'acs':\n        uid = pres.src || this._tinode.getCurrentUserID();\n        user = this._users[uid];\n        if (!user) {\n          // Update for an unknown user: notification of a new subscription.\n          const acs = new AccessMode().updateAll(pres.dacs);\n          if (acs && acs.mode != AccessMode._NONE) {\n            user = this._cacheGetUser(uid);\n            if (!user) {\n              user = {\n                user: uid,\n                acs: acs\n              };\n              this.getMeta(this.startMetaQuery().withOneSub(undefined, uid).build());\n            } else {\n              user.acs = acs;\n            }\n            user.updated = new Date();\n            this._processMetaSubs([user]);\n          }\n        } else {\n          // Known user\n          user.acs.updateAll(pres.dacs);\n          // Update user's access mode.\n          this._processMetaSubs([{\n            user: uid,\n            updated: new Date(),\n            acs: user.acs\n          }]);\n        }\n        break;\n      default:\n        this._tinode.logger(\"INFO: Ignored presence update\", pres.what);\n    }\n\n    if (this.onPres) {\n      this.onPres(pres);\n    }\n  }\n\n  // Process {info} message\n  _routeInfo(info) {\n    switch (info.what) {\n      case 'recv':\n      case 'read':\n        const user = this._users[info.from];\n        if (user) {\n          user[info.what] = info.seq;\n          if (user.recv < user.read) {\n            user.recv = user.read;\n          }\n        }\n        const msg = this.latestMessage();\n        if (msg) {\n          this.msgStatus(msg, true);\n        }\n\n        // If this is an update from the current user, update the cache with the new count.\n        if (this._tinode.isMe(info.from) && !info._noForwarding) {\n          this._updateMyReadRecv(info.what, info.seq);\n        }\n\n        // Notify 'me' listener of the status change.\n        this._tinode.getMeTopic()._refreshContact(info.what, this);\n        break;\n      case 'kp':\n      case 'kpa':\n      case 'kpv':\n        // Typing or audio/video recording notification. Do nothing.\n        break;\n      case 'call':\n        // Do nothing here.\n        break;\n      default:\n        this._tinode.logger(\"INFO: Ignored info update\", info.what);\n    }\n\n    if (this.onInfo) {\n      this.onInfo(info);\n    }\n  }\n  // Called by Tinode when meta.desc packet is received.\n  // Called by 'me' topic on contact update (desc._noForwarding is true).\n  _processMetaDesc(desc) {\n    if (this.isP2PType()) {\n      // Synthetic desc may include defacs for p2p topics which is useless.\n      // Remove it.\n      delete desc.defacs;\n\n      // Update to p2p desc is the same as user update. Update cached user.\n      this._tinode._db.updUser(this.name, desc.public);\n    }\n\n    // Copy parameters from desc object to this topic.\n    mergeObj(this, desc);\n    // Update persistent cache.\n    this._tinode._db.updTopic(this);\n\n    // Notify 'me' listener, if available:\n    if (this.name !== Const.TOPIC_ME && !desc._noForwarding) {\n      const me = this._tinode.getMeTopic();\n      if (me.onMetaSub) {\n        me.onMetaSub(this);\n      }\n      if (me.onSubsUpdated) {\n        me.onSubsUpdated([this.name], 1);\n      }\n    }\n\n    if (this.onMetaDesc) {\n      this.onMetaDesc(this);\n    }\n  }\n  // Called by Tinode when meta.sub is received, in response to received\n  // {ctrl} after setMeta-sub, or as a handler for {pres what=sub}.\n  _processMetaSubs(subs) {\n    for (let idx in subs) {\n      const sub = subs[idx];\n\n      // Fill defaults.\n      sub.online = !!sub.online;\n      // Update timestamp of the most recent subscription update.\n      this._lastSubsUpdate = new Date(Math.max(this._lastSubsUpdate, sub.updated));\n\n      let user = null;\n      if (!sub.deleted) {\n        // If this is a change to user's own permissions, update them in topic too.\n        // Desc will update 'me' topic.\n        if (this._tinode.isMe(sub.user) && sub.acs) {\n          this._processMetaDesc({\n            updated: sub.updated,\n            touched: sub.touched,\n            acs: sub.acs\n          });\n        }\n        if (!this._users[sub.user]) {\n          // New subscription.\n          this.subcnt++;\n        }\n        user = this._updateCachedUser(sub.user, sub);\n      } else {\n        // Subscription is deleted, remove it from topic (but leave in Users cache)\n        delete this._users[sub.user];\n        user = sub;\n        this.subcnt--;\n      }\n\n      if (this.onMetaSub) {\n        this.onMetaSub(user);\n      }\n    }\n\n    if (this.onSubsUpdated) {\n      this.onSubsUpdated(Object.keys(this._users));\n    }\n  }\n  // Called by Tinode when meta.tags is received.\n  _processMetaTags(tags) {\n    if (tags == Const.DEL_CHAR || (tags.length == 1 && tags[0] == Const.DEL_CHAR)) {\n      tags = [];\n    }\n    this._tags = tags;\n    this._tinode._db.updTopic(this);\n    if (this.onTagsUpdated) {\n      this.onTagsUpdated(tags);\n    }\n  }\n  // Do nothing for topics other than 'me'\n  _processMetaCreds(creds) {}\n\n  // Called by Tinode when meta.aux is received.\n  _processMetaAux(aux) {\n    aux = (!aux || aux == Const.DEL_CHAR) ? {} : aux;\n    this._aux = mergeObj(this._aux, aux);\n    this._tinode._db.updTopic(this);\n    if (this.onAuxUpdated) {\n      this.onAuxUpdated(this._aux);\n    }\n  }\n\n  // Handle an incremental reaction update for a message.\n  // delta: {val, users: [user]}\n  // The users could be empty or contain exactly one user.\n  // 1. If user has already reacted with the same emoji, remove the reaction.\n  // 2. If user has already reacted with a different emoji, change the reaction.\n  // 3. If user has not reacted yet, add the reaction to the same emoji, if present.\n  // 4. If user has not reacted yet, and no one reacted that way, create a new reaction.\n  _handleReactionDiff(msg, delta) {\n    const reacts = [...(msg.react || [])];\n    // Find if the given user has already reacted.\n    const user = delta.users[0];\n    const found = user ? reacts.findIndex(r => r.users.includes(user)) : -1;\n    if (found >= 0) {\n      const existing = reacts[found];\n      if (delta.val == Const.DEL_CHAR || existing.val == delta.val) {\n        // Remove existing reaction.\n        existing.count--;\n        existing.mrrid = Math.max(existing.mrrid, delta.mrrid);\n        if (existing.count <= 0) {\n          reacts.splice(found, 1);\n        } else {\n          const userIdx = existing.users.indexOf(user);\n          existing.users.splice(userIdx, 1);\n        }\n      } else {\n        // User changed reaction.\n        const userIdx = existing.users.indexOf(user);\n        existing.users.splice(userIdx, 1);\n        existing.count--;\n        if (existing.count <= 0) {\n          reacts.splice(found, 1);\n        }\n        // Add user reaction as a different emoji.\n        const emoIndex = reacts.findIndex(r => r.val == delta.val);\n        if (emoIndex >= 0) {\n          // Add to existing reaction.\n          reacts[emoIndex].users.push(user);\n          reacts[emoIndex].count++;\n          reacts[emoIndex].mrrid = Math.max(reacts[emoIndex].mrrid, delta.mrrid);\n        } else {\n          // Create new reaction.\n          reacts.push({\n            mrrid: delta.mrrid,\n            users: [user],\n            count: 1,\n            val: delta.val\n          });\n        }\n      }\n    } else if (delta.val != Const.DEL_CHAR) {\n      // Existing user has not reacted yet.\n      // Find reaction of the same type.\n      const emoIndex = reacts.findIndex(r => r.val == delta.val);\n      if (emoIndex >= 0) {\n        // Add to existing reaction.\n        if (user) {\n          reacts[emoIndex].users.push(user);\n        }\n        reacts[emoIndex].count++;\n        reacts[emoIndex].mrrid = Math.max(reacts[emoIndex].mrrid, delta.mrrid);\n      } else {\n        // Create new reaction.\n        reacts.push({\n          mrrid: delta.mrrid,\n          users: user ? [user] : [],\n          count: 1,\n          val: delta.val\n        });\n      }\n    }\n    return reacts;\n  }\n\n  // Called by Tinode when meta.aux is recived.\n  _processMetaReact(reacts, oneReaction) {\n    if (!Array.isArray(reacts)) {\n      if (!oneReaction.seq || !oneReaction.val) {\n        this._tinode.logger(\"WARNING: invalid reaction\");\n        return;\n      }\n      reacts = [{\n        _diff: true, // Indicate that this is a delta update.\n        seq: oneReaction.seq,\n        data: [{\n          mrrid: oneReaction.mrrid,\n          val: oneReaction.val,\n          count: 1,\n          users: [oneReaction.user || this._tinode.getCurrentUserID()]\n        }]\n      }];\n    }\n    // Process reactions metadata. meta.react is an array of {seq, data: [{val, count, users}]}\n    const seqIds = [];\n    reacts.forEach(mr => {\n      const msg = this.findMessage(mr.seq);\n      seqIds.push(mr.seq);\n      if (msg) {\n        let upd;\n        if (mr._diff) {\n          // Single incremental update.\n          upd = this._handleReactionDiff(msg, mr.data[0]);\n        } else {\n          upd = (mr.data || []).map(r => ({\n            mrrid: r.mrrid,\n            val: r.val,\n            count: r.count | 0,\n            users: Array.isArray(r.users) ? r.users.slice() : []\n          }));\n        }\n        msg.react = upd;\n        const maxReact = upd.reduce((max, r) => Math.max(max, r.mrrid), 0);\n        if (this.mrrid < maxReact) {\n          this.mrrid = maxReact;\n        }\n        this._tinode._db.updMessageReact(this.name, mr.seq, msg.react);\n      }\n    });\n    // Notify UI listeners of changes.\n    if (this.onReact) {\n      this.onReact(seqIds);\n    }\n  }\n\n  // Delete cached messages and update cached transaction IDs\n  _processDelMessages(clear, delseq) {\n    this._maxDel = Math.max(clear, this._maxDel);\n    this.clear = Math.max(clear, this.clear);\n    let count = 0;\n    if (Array.isArray(delseq)) {\n      delseq.forEach(rec => {\n        if (!rec.hi) {\n          count++;\n          this.flushMessage(rec.low);\n        } else {\n          count += rec.hi - rec.low;\n          this.flushMessageRange(rec.low, rec.hi);\n        }\n        this._messages.put({\n          seq: rec.low,\n          low: rec.low,\n          hi: rec.hi,\n          _deleted: true\n        });\n      });\n\n      this._tinode._db.addDelLog(this.name, clear, delseq);\n    }\n\n    if (count > 0) {\n      if (this.onData) {\n        this.onData();\n      }\n    }\n  }\n  // Topic is informed that the entire response to {get what=data} has been received.\n  _allMessagesReceived(count) {\n\n    if (this.onAllMessagesReceived) {\n      this.onAllMessagesReceived(count);\n    }\n  }\n  // Reset subscribed state\n  _resetSub() {\n    this._attached = false;\n  }\n  // This topic is either deleted or unsubscribed from.\n  _gone() {\n    this._messages.reset();\n    this._tinode._db.remMessages(this.name);\n    this._users = {};\n    this.acs = new AccessMode(null);\n    this.private = null;\n    this.public = null;\n    this.trusted = null;\n    this._maxSeq = 0;\n    this._minSeq = 0;\n    this._maxDel = 0;\n    this._maxReact = 0;\n    this._attached = false;\n\n    const me = this._tinode.getMeTopic();\n    if (me) {\n      me._routePres({\n        _noForwarding: true,\n        what: 'gone',\n        topic: Const.TOPIC_ME,\n        src: this.name\n      });\n    }\n    if (this.onDeleteTopic) {\n      this.onDeleteTopic();\n    }\n  }\n  // Update global user cache and local subscribers cache.\n  // Don't call this method for non-subscribers.\n  _updateCachedUser(uid, obj) {\n    // Fetch user object from the global cache.\n    // This is a clone of the stored object\n    let cached = this._cacheGetUser(uid);\n    cached = mergeObj(cached || {}, obj);\n    // Save to global cache\n    this._cachePutUser(uid, cached);\n    // Save to the list of topic subscribers.\n    return mergeToCache(this._users, uid, cached);\n  }\n  // Get local seqId for a queued message.\n  _getQueuedSeqId() {\n    return this._queuedSeqId++;\n  }\n\n  // Load most recent messages from persistent cache.\n  _loadMessages(db, query) {\n    query = query || {};\n    query.limit = query.limit || Const.DEFAULT_MESSAGES_PAGE;\n\n    // Count of message loaded from DB.\n    let count = 0;\n    return db.readMessages(this.name, query)\n      .then(msgs => {\n        msgs.forEach(data => {\n          if (data.seq > this._maxSeq) {\n            this._maxSeq = data.seq;\n          }\n          if (data.seq < this._minSeq || this._minSeq == 0) {\n            this._minSeq = data.seq;\n          }\n          this._messages.put(data);\n          this._maybeUpdateMessageVersionsCache(data);\n        });\n        count = msgs.length;\n      })\n      .then(_ => db.readDelLog(this.name, query))\n      .then(dellog => {\n        return dellog.forEach(rec => {\n          this._messages.put({\n            seq: rec.low,\n            low: rec.low,\n            hi: rec.hi,\n            _deleted: true\n          });\n        });\n      })\n      .then(_ => {\n        // DEBUG\n        return count;\n      });\n  }\n\n  // Push or {pres}: message received.\n  _updateReceived(seq, act) {\n    this.touched = new Date();\n    this.seq = seq | 0;\n    // Check if message is sent by the current user. If so it's been read already.\n    if (!act || this._tinode.isMe(act)) {\n      this.read = this.read ? Math.max(this.read, this.seq) : this.seq;\n      this.recv = this.recv ? Math.max(this.read, this.recv) : this.read;\n    }\n    this.unread = this.seq - (this.read | 0);\n    this._tinode._db.updTopic(this);\n  }\n}\n","/**\n * @file Utilities used in multiple places.\n *\n * @copyright 2015-2025 Tinode LLC.\n */\n'use strict';\n\nimport AccessMode from './access-mode.js';\nimport {\n  DEL_CHAR,\n  LOCAL_SEQID\n} from './config.js';\n\n// Attempt to convert date and AccessMode strings to objects.\nexport function jsonParseHelper(key, val) {\n  // Try to convert string timestamps with optional milliseconds to Date,\n  // e.g. 2015-09-02T01:45:43[.123]Z\n  if (typeof val == 'string' && val.length >= 20 && val.length <= 24 && ['ts', 'touched', 'updated', 'created', 'when', 'deleted', 'expires'].includes(key)) {\n    const date = new Date(val);\n    if (!isNaN(date)) {\n      return date;\n    }\n  } else if (key === 'acs' && typeof val === 'object') {\n    return new AccessMode(val);\n  }\n  return val;\n}\n\n// Checks if URL is a relative url, i.e. has no 'scheme://', including the case of missing scheme '//'.\n// The scheme is expected to be RFC-compliant, e.g. [a-z][a-z0-9+.-]*\n// example.html - ok\n// https:example.com - not ok.\n// http:/example.com - not ok.\n// '  https://example.com' - not ok. ( means carriage return)\nexport function isUrlRelative(url) {\n  return url && !/^\\s*([a-z][a-z0-9+.-]*:|\\/\\/)/im.test(url);\n}\n\nfunction isValidDate(d) {\n  return (d instanceof Date) && !isNaN(d) && (d.getTime() != 0);\n}\n\n// RFC3339 formater of Date\nexport function rfc3339DateString(d) {\n  if (!isValidDate(d)) {\n    return undefined;\n  }\n\n  const pad = function(val, sp) {\n    sp = sp || 2;\n    return '0'.repeat(sp - ('' + val).length) + val;\n  };\n\n  const millis = d.getUTCMilliseconds();\n  return d.getUTCFullYear() + '-' + pad(d.getUTCMonth() + 1) + '-' + pad(d.getUTCDate()) +\n    'T' + pad(d.getUTCHours()) + ':' + pad(d.getUTCMinutes()) + ':' + pad(d.getUTCSeconds()) +\n    (millis ? '.' + pad(millis, 3) : '') + 'Z';\n}\n\n// Recursively merge src's own properties to dst.\n// Array and Date objects are shallow-copied.\nexport function mergeObj(dst, src) {\n  if (typeof src != 'object') {\n    if (src === undefined) {\n      return dst;\n    }\n    if (src === DEL_CHAR) {\n      return undefined;\n    }\n    return src;\n  }\n  // JS is crazy: typeof null is 'object'.\n  if (src === null) {\n    return dst;\n  }\n\n  // Handle Date\n  if (src instanceof Date && !isNaN(src)) {\n    return (!dst || !(dst instanceof Date) || isNaN(dst) || dst < src) ? src : dst;\n  }\n\n  // Access mode\n  if (src instanceof AccessMode) {\n    return new AccessMode(src);\n  }\n\n  // Handle Array\n  if (src instanceof Array) {\n    return src;\n  }\n\n  if (!dst || dst === DEL_CHAR) {\n    dst = src.constructor();\n  }\n\n  for (let prop in src) {\n    if (src.hasOwnProperty(prop) && (prop != '_noForwarding')) {\n      try {\n        dst[prop] = mergeObj(dst[prop], src[prop]);\n      } catch (err) {\n        console.warn(\"Error merging property:\", prop, err);\n      }\n    }\n  }\n  return dst;\n}\n\n// Update object stored in a cache. Returns updated value.\nexport function mergeToCache(cache, key, newval) {\n  cache[key] = mergeObj(cache[key], newval);\n  return cache[key];\n}\n\n// Strips all values from an object of they evaluate to false or if their name starts with '_'.\n// Used on all outgoing object before serialization to string.\nexport function simplify(obj) {\n  Object.keys(obj).forEach((key) => {\n    if (key[0] == '_') {\n      // Strip fields like \"obj._key\".\n      delete obj[key];\n    } else if (!obj[key]) {\n      // Strip fields which evaluate to false.\n      delete obj[key];\n    } else if (Array.isArray(obj[key]) && obj[key].length == 0) {\n      // Strip empty arrays.\n      delete obj[key];\n    } else if (!obj[key]) {\n      // Strip fields which evaluate to false.\n      delete obj[key];\n    } else if (obj[key] instanceof Date) {\n      // Strip invalid or zero date.\n      if (!isValidDate(obj[key])) {\n        delete obj[key];\n      }\n    } else if (typeof obj[key] == 'object') {\n      simplify(obj[key]);\n      // Strip empty objects.\n      if (Object.getOwnPropertyNames(obj[key]).length == 0) {\n        delete obj[key];\n      }\n    }\n  });\n  return obj;\n};\n\n\n// Trim whitespace, convert to lowercase, strip empty, short, and duplicate elements elements.\n// If the result is an empty array, add a single element \"\\u2421\" (Unicode Del character).\nexport function normalizeArray(arr) {\n  let out = [];\n  if (Array.isArray(arr)) {\n    // Trim, throw away very short and empty tags.\n    for (let i = 0, l = arr.length; i < l; i++) {\n      let t = arr[i];\n      if (t) {\n        t = t.trim().toLowerCase();\n        if (t.length > 1) {\n          out.push(t);\n        }\n      }\n    }\n    out = out.sort().filter((item, pos, ary) => {\n      return !pos || item != ary[pos - 1];\n    });\n  }\n  if (out.length == 0) {\n    // Add single tag with a Unicode Del character, otherwise an ampty array\n    // is ambiguos. The Del tag will be stripped by the server.\n    out.push(DEL_CHAR);\n  }\n  return out;\n}\n\n// Convert input to valid ranges of IDs.\nexport function normalizeRanges(ranges, maxSeq) {\n  if (!Array.isArray(ranges)) {\n    return [];\n  }\n\n  // Sort ranges in accending order by low, then descending by hi.\n  ranges.sort((r1, r2) => {\n    if (r1.low < r2.low) {\n      return -1;\n    }\n    if (r1.low == r2.low) {\n      return (r2.hi | 0) - r1.hi;\n    }\n    return 1;\n  });\n\n  // Remove pending messages from ranges possibly clipping some ranges.\n  ranges = ranges.reduce((out, r) => {\n    if (r.low < LOCAL_SEQID && r.low > 0) {\n      if (!r.hi || r.hi < LOCAL_SEQID) {\n        out.push(r);\n      } else {\n        // Clip hi to max allowed value.\n        out.push({\n          low: r.low,\n          hi: maxSeq + 1\n        });\n      }\n    }\n    return out;\n  }, []);\n\n  // Merge overlapping ranges.\n  ranges = ranges.reduce((out, r) => {\n    if (out.length == 0) {\n      out.push(r);\n    } else {\n      let prev = out[out.length - 1];\n      if (r.low <= prev.hi) {\n        prev.hi = Math.max(prev.hi, r.hi);\n      } else {\n        out.push(r);\n      }\n    }\n    return out;\n  }, []);\n\n  return ranges;\n}\n\n// Convert array of IDs to array of ranges.\nexport function listToRanges(list) {\n  // Sort the list in ascending order\n  list.sort((a, b) => a - b);\n  // Convert the array of IDs to ranges.\n  return list.reduce((out, id) => {\n    if (out.length == 0) {\n      // First element.\n      out.push({\n        low: id\n      });\n    } else {\n      let prev = out[out.length - 1];\n      if ((!prev.hi && (id != prev.low + 1)) || (id > prev.hi)) {\n        // New range.\n        out.push({\n          low: id\n        });\n      } else {\n        // Expand existing range.\n        prev.hi = prev.hi ? Math.max(prev.hi, id + 1) : id + 1;\n      }\n    }\n    return out;\n  }, []);\n}\n\n// Cuts 'clip' range out of the 'src' range.\n// Returns an array with 0, 1 or 2 elements.\nexport function clipOutRange(src, clip) {\n  if (clip.hi <= src.low || clip.low >= src.hi) {\n    // Clip is completely outside of src, no intersection.\n    return [src];\n  }\n\n\n  if (clip.low <= src.low) {\n    if (clip.hi >= src.hi) {\n      // The source range is completely inside the clipping range.\n      return [];\n    }\n    // Partial clipping at the top.\n    return [{\n      low: clip.hi,\n      hi: src.hi\n    }];\n  }\n\n  // Range on the lower end.\n  const result = [{\n    low: src.low,\n    hi: clip.low\n  }];\n  if (clip.hi < src.hi) {\n    // Maybe a range on the higher end, if clip is completely inside the source.\n    result.push({\n      low: clip.hi,\n      hi: src.hi\n    });\n  }\n\n  return result;\n}\n\n// Cuts 'src' range to be completely within 'clip' range.\n// Returns clipped range or null if 'src' is outside of 'clip'.\nexport function clipInRange(src, clip) {\n  if (clip.hi <= src.low || clip.low >= src.hi) {\n    // The src is completely outside of the clip, no intersection.\n    return null;\n  }\n\n  if (src.low >= clip.low && src.hi <= clip.hi) {\n    // Src is completely within the clip, return the entire src.\n    return src;\n  }\n\n  // Partial overlap.\n  return {\n    low: Math.max(src.low, clip.low),\n    hi: Math.min(src.hi, clip.hi)\n  };\n\n  return result;\n}\n","export const PACKAGE_VERSION = \"0.26.0-alpha2\";\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Check if module exists (development only)\n\tif (__webpack_modules__[moduleId] === undefined) {\n\t\tvar e = new Error(\"Cannot find module '\" + moduleId + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = function(module) {\n\tvar getter = module && module.__esModule ?\n\t\tfunction() { return module['default']; } :\n\t\tfunction() { return module; };\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\n * @module tinode-sdk\n *\n * @copyright 2015-2026 Tinode LLC.\n * @summary Javascript bindings for Tinode.\n * @license Apache 2.0\n * @version 0.25\n *\n * See <a href=\"https://github.com/tinode/webapp\">https://github.com/tinode/webapp</a> for real-life usage.\n *\n * @example\n * <head>\n * <script src=\".../tinode.js\"></script>\n * </head>\n *\n * <body>\n *  ...\n * <script>\n *  // Instantiate tinode.\n *  const tinode = new Tinode(config, _ => {\n *    // Called on init completion.\n *  });\n *  tinode.enableLogging(true);\n *  tinode.onDisconnect = err => {\n *    // Handle disconnect.\n *  };\n *  // Connect to the server.\n *  tinode.connect('https://example.com/').then(_ => {\n *    // Connected. Login now.\n *    return tinode.loginBasic(login, password);\n *  }).then(ctrl => {\n *    // Logged in fine, attach callbacks, subscribe to 'me'.\n *    const me = tinode.getMeTopic();\n *    me.onMetaDesc = function(meta) { ... };\n *    // Subscribe, fetch topic description and the list of contacts.\n *    me.subscribe({get: {desc: {}, sub: {}}});\n *  }).catch(err => {\n *    // Login or subscription failed, do something.\n *    ...\n *  });\n *  ...\n * </script>\n * </body>\n */\n'use strict';\n\n// NOTE TO DEVELOPERS:\n// Localizable strings should be double quoted \"   \",\n// non-localizable strings should be single quoted 'non-localized'.\n\nimport AccessMode from './access-mode.js';\nimport * as Const from './config.js';\nimport CommError from './comm-error.js';\nimport Connection from './connection.js';\nimport DBCache from './db.js';\nimport Drafty from './drafty.js';\nimport LargeFileHelper from './large-file.js';\nimport MetaGetBuilder from './meta-builder.js';\nimport Topic from './topic.js';\nimport TopicFnd from './fnd-topic.js';\nimport TopicMe from './me-topic.js';\n\nimport TheCard from './the-card.js';\nimport {\n  isUrlRelative,\n  jsonParseHelper,\n  mergeObj,\n  rfc3339DateString,\n  simplify\n} from './utils.js';\n\n// Re-export AccessMode\nexport {\n  AccessMode\n};\n\n// Re-export TheCard\nexport {\n  TheCard\n};\n\nlet WebSocketProvider;\nif (typeof WebSocket != 'undefined') {\n  WebSocketProvider = WebSocket;\n}\n\nlet XHRProvider;\nif (typeof XMLHttpRequest != 'undefined') {\n  XHRProvider = XMLHttpRequest;\n}\n\nlet IndexedDBProvider;\nif (typeof indexedDB != 'undefined') {\n  IndexedDBProvider = indexedDB;\n}\n\n// Re-export Drafty.\nexport {\n  Drafty\n}\n\ninitForNonBrowserApp();\n\n// Utility functions\n\n// Polyfill for non-browser context, e.g. NodeJs.\nfunction initForNonBrowserApp() {\n  // Tinode requirement in native mode because react native doesn't provide Base64 method\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n\n  if (typeof btoa == 'undefined') {\n    global.btoa = function(input = '') {\n      let str = input;\n      let output = '';\n\n      for (let block = 0, charCode, i = 0, map = chars; str.charAt(i | 0) || (map = '=', i % 1); output += map.charAt(63 & block >> 8 - i % 1 * 8)) {\n\n        charCode = str.charCodeAt(i += 3 / 4);\n\n        if (charCode > 0xFF) {\n          throw new Error(\"'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.\");\n        }\n        block = block << 8 | charCode;\n      }\n\n      return output;\n    };\n  }\n\n  if (typeof atob == 'undefined') {\n    global.atob = function(input = '') {\n      let str = input.replace(/=+$/, '');\n      let output = '';\n\n      if (str.length % 4 == 1) {\n        throw new Error(\"'atob' failed: The string to be decoded is not correctly encoded.\");\n      }\n      for (let bc = 0, bs = 0, buffer, i = 0; buffer = str.charAt(i++);\n\n        ~buffer && (bs = bc % 4 ? bs * 64 + buffer : buffer,\n          bc++ % 4) ? output += String.fromCharCode(255 & bs >> (-2 * bc & 6)) : 0\n      ) {\n        buffer = chars.indexOf(buffer);\n      }\n\n      return output;\n    };\n  }\n\n  if (typeof window == 'undefined') {\n    global.window = {\n      WebSocket: WebSocketProvider,\n      XMLHttpRequest: XHRProvider,\n      indexedDB: IndexedDBProvider,\n      URL: {\n        createObjectURL: function() {\n          throw new Error(\"Unable to use URL.createObjectURL in a non-browser application\");\n        }\n      }\n    }\n  }\n\n  Connection.setNetworkProviders(WebSocketProvider, XHRProvider);\n  LargeFileHelper.setNetworkProvider(XHRProvider);\n  DBCache.setDatabaseProvider(IndexedDBProvider);\n}\n\n// Detect find most useful network transport.\nfunction detectTransport() {\n  if (typeof window == 'object') {\n    if (window['WebSocket']) {\n      return 'ws';\n    } else if (window['XMLHttpRequest']) {\n      // The browser or node has no websockets, using long polling.\n      return 'lp';\n    }\n  }\n  return null;\n}\n\n// btoa replacement. Stock btoa fails on on non-Latin1 strings.\nfunction b64EncodeUnicode(str) {\n  // The encodeURIComponent percent-encodes UTF-8 string,\n  // then the percent encoding is converted into raw bytes which\n  // can be fed into btoa.\n  return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,\n    function toSolidBytes(match, p1) {\n      return String.fromCharCode('0x' + p1);\n    }));\n}\n\n// JSON stringify helper - pre-processor for JSON.stringify\nfunction jsonBuildHelper(key, val) {\n  if (val instanceof Date) {\n    // Convert javascript Date objects to rfc3339 strings\n    val = rfc3339DateString(val);\n  } else if (val instanceof AccessMode) {\n    val = val.jsonHelper();\n  } else if (val === undefined || val === null || val === false ||\n    (Array.isArray(val) && val.length == 0) ||\n    ((typeof val == 'object') && (Object.keys(val).length == 0))) {\n    // strip out empty elements while serializing objects to JSON\n    return undefined;\n  }\n\n  return val;\n};\n\n// Trims very long strings (encoded images) to make logged packets more readable.\nfunction jsonLoggerHelper(key, val) {\n  if (typeof val == 'string' && val.length > 128) {\n    return '<' + val.length + ', bytes: ' + val.substring(0, 12) + '...' + val.substring(val.length - 12) + '>';\n  }\n  return jsonBuildHelper(key, val);\n};\n\n// Parse browser user agent to extract browser name and version.\nfunction getBrowserInfo(ua, product) {\n  ua = ua || '';\n  let reactnative = '';\n  // Check if this is a ReactNative app.\n  if (/reactnative/i.test(product)) {\n    reactnative = 'ReactNative; ';\n  }\n  let result;\n  // Remove useless string.\n  ua = ua.replace(' (KHTML, like Gecko)', '');\n  // Test for WebKit-based browser.\n  let m = ua.match(/(AppleWebKit\\/[.\\d]+)/i);\n  if (m) {\n    // List of common strings, from more useful to less useful.\n    // All unknown strings get the highest (-1) priority.\n    const priority = ['edg', 'chrome', 'safari', 'mobile', 'version'];\n    let tmp = ua.substr(m.index + m[0].length).split(' ');\n    let tokens = [];\n    let version; // 1.0 in Version/1.0 or undefined;\n    // Split string like 'Name/0.0.0' into ['Name', '0.0.0', 3] where the last element is the priority.\n    for (let i = 0; i < tmp.length; i++) {\n      let m2 = /([\\w.]+)[\\/]([\\.\\d]+)/.exec(tmp[i]);\n      if (m2) {\n        // Unknown values are highest priority (-1).\n        tokens.push([m2[1], m2[2], priority.findIndex((e) => {\n          return m2[1].toLowerCase().startsWith(e);\n        })]);\n        if (m2[1] == 'Version') {\n          version = m2[2];\n        }\n      }\n    }\n    // Sort by priority: more interesting is earlier than less interesting.\n    tokens.sort((a, b) => {\n      return a[2] - b[2];\n    });\n    if (tokens.length > 0) {\n      // Return the least common browser string and version.\n      if (tokens[0][0].toLowerCase().startsWith('edg')) {\n        tokens[0][0] = 'Edge';\n      } else if (tokens[0][0] == 'OPR') {\n        tokens[0][0] = 'Opera';\n      } else if (tokens[0][0] == 'Safari' && version) {\n        tokens[0][1] = version;\n      }\n      result = tokens[0][0] + '/' + tokens[0][1];\n    } else {\n      // Failed to ID the browser. Return the webkit version.\n      result = m[1];\n    }\n  } else if (/firefox/i.test(ua)) {\n    m = /Firefox\\/([.\\d]+)/g.exec(ua);\n    if (m) {\n      result = 'Firefox/' + m[1];\n    } else {\n      result = 'Firefox/?';\n    }\n  } else {\n    // Neither AppleWebKit nor Firefox. Try the last resort.\n    m = /([\\w.]+)\\/([.\\d]+)/.exec(ua);\n    if (m) {\n      result = m[1] + '/' + m[2];\n    } else {\n      m = ua.split(' ');\n      result = m[0];\n    }\n  }\n\n  // Shorten the version to one dot 'a.bb.ccc.d -> a.bb' at most.\n  m = result.split('/');\n  if (m.length > 1) {\n    const v = m[1].split('.');\n    const minor = v[1] ? '.' + v[1].substr(0, 2) : '';\n    result = `${m[0]}/${v[0]}${minor}`;\n  }\n  return reactnative + result;\n}\n\n/**\n * The main class for interacting with Tinode server.\n */\nexport class Tinode {\n  _host;\n  _secure;\n\n  _appName;\n\n  // API Key.\n  _apiKey;\n\n  // Name and version of the browser.\n  _browser = '';\n  _platform;\n  // Hardware\n  _hwos = 'undefined';\n  _humanLanguage = 'xx';\n\n  // Logging to console enabled\n  _loggingEnabled = false;\n  // When logging, trip long strings (base64-encoded images) for readability\n  _trimLongStrings = false;\n  // UID of the currently authenticated user.\n  _myUID = null;\n  // Status of connection: authenticated or not.\n  _authenticated = false;\n  // Login used in the last successful basic authentication\n  _login = null;\n  // Token which can be used for login instead of login/password.\n  _authToken = null;\n  // Counter of received packets\n  _inPacketCount = 0;\n  // Counter for generating unique message IDs\n  _messageId = Math.floor((Math.random() * 0xFFFF) + 0xFFFF);\n  // Information about the server, if connected\n  _serverInfo = null;\n  // Push notification token. Called deviceToken for consistency with the Android SDK.\n  _deviceToken = null;\n\n  // Cache of pending promises by message id.\n  _pendingPromises = {};\n  // The Timeout object returned by the reject expired promises setInterval.\n  _expirePromises = null;\n\n  // Websocket or long polling connection.\n  _connection = null;\n\n  // Use indexDB for caching topics and messages.\n  _persist = false;\n  // IndexedDB wrapper object.\n  _db = null;\n\n  // Tinode's cache of objects\n  _cache = {};\n\n  /**\n   * Create Tinode object.\n   *\n   * @param {Object} config - configuration parameters.\n   * @param {string} config.appName - Name of the calling application to be reported in the User Agent.\n   * @param {string} config.host - Host name and optional port number to connect to.\n   * @param {string} config.apiKey - API key generated by <code>keygen</code>.\n   * @param {string} config.transport - See {@link Tinode.Connection#transport}.\n   * @param {boolean} config.secure - Use Secure WebSocket if <code>true</code>.\n   * @param {string} config.platform - Optional platform identifier, one of <code>\"ios\"</code>, <code>\"web\"</code>, <code>\"android\"</code>.\n   * @param {boolean} config.persist - Use IndexedDB persistent storage.\n   * @param {function} onComplete - callback to call when initialization is completed.\n   */\n  constructor(config, onComplete) {\n    this._host = config.host;\n    this._secure = config.secure;\n\n    // Client-provided application name, format <Name>/<version number>\n    this._appName = config.appName || \"Undefined\";\n\n    // API Key.\n    this._apiKey = config.apiKey;\n\n    // Name and version of the browser.\n    this._platform = config.platform || 'web';\n    // Underlying OS.\n    if (typeof navigator != 'undefined') {\n      this._browser = getBrowserInfo(navigator.userAgent, navigator.product);\n      this._hwos = navigator.platform;\n      // This is the default language. It could be changed by client.\n      this._humanLanguage = navigator.language || 'en-US';\n    }\n\n    Connection.logger = this.logger;\n    Drafty.logger = this.logger;\n\n    // WebSocket or long polling network connection.\n    if (config.transport != 'lp' && config.transport != 'ws') {\n      config.transport = detectTransport();\n    }\n    this._connection = new Connection(config, Const.PROTOCOL_VERSION, /* autoreconnect */ true);\n    this._connection.onMessage = (data) => {\n      // Call the main message dispatcher.\n      this.#dispatchMessage(data);\n    }\n\n    // Ready to start sending.\n    this._connection.onOpen = _ => this.#connectionOpen();\n    this._connection.onDisconnect = (err, code) => this.#disconnected(err, code);\n\n    // Wrapper for the reconnect iterator callback.\n    this._connection.onAutoreconnectIteration = (timeout, promise) => {\n      if (this.onAutoreconnectIteration) {\n        this.onAutoreconnectIteration(timeout, promise);\n      }\n    }\n\n    this._persist = config.persist;\n    // Initialize object regardless. It simplifies the code.\n    this._db = new DBCache(this.logger, this.logger);\n\n    if (this._persist) {\n      // Create the persistent cache.\n      // Store promises to be resolved when messages load into memory.\n      const prom = [];\n      this._db.initDatabase().then(_ => {\n        // First load topics into memory.\n        return this._db.mapTopics(data => {\n          let topic = this.#cacheGet('topic', data.name);\n          if (topic) {\n            return;\n          }\n          if (data.name == Const.TOPIC_ME) {\n            topic = new TopicMe();\n          } else if (data.name == Const.TOPIC_FND) {\n            topic = new TopicFnd();\n          } else {\n            topic = new Topic(data.name);\n          }\n          this._db.deserializeTopic(topic, data);\n          this.#attachCacheToTopic(topic);\n          topic._cachePutSelf();\n          this._db.maxDelId(topic.name).then(clear => {\n            topic._maxDel = Math.max(topic._maxDel, clear || 0);\n          });\n          // Topic loaded from DB is not new.\n          delete topic._new;\n          // Request to load messages and save the promise.\n          prom.push(topic._loadMessages(this._db));\n        });\n      }).then(_ => {\n        // Then load users.\n        return this._db.mapUsers((data) => {\n          this.#cachePut('user', data.uid, mergeObj({}, data.public));\n        });\n      }).then(_ => {\n        // Now wait for all messages to finish loading.\n        return Promise.all(prom);\n      }).then(_ => {\n        if (onComplete) {\n          onComplete();\n        }\n        this.logger(\"Persistent cache initialized.\");\n      }).catch(err => {\n        if (onComplete) {\n          onComplete(err);\n        }\n        this.logger(\"Failed to initialize persistent cache:\", err);\n      });\n    } else {\n      this._db.deleteDatabase().then(_ => {\n        if (onComplete) {\n          onComplete();\n        }\n      });\n    }\n  }\n\n  // Private methods.\n\n  // Console logger. Babel somehow fails to parse '...rest' parameter.\n  logger(str, ...args) {\n    if (this._loggingEnabled) {\n      const d = new Date();\n      const dateString = ('0' + d.getUTCHours()).slice(-2) + ':' +\n        ('0' + d.getUTCMinutes()).slice(-2) + ':' +\n        ('0' + d.getUTCSeconds()).slice(-2) + '.' +\n        ('00' + d.getUTCMilliseconds()).slice(-3);\n\n      console.log('[' + dateString + ']', str, args.join(' '));\n    }\n  }\n\n  // Generator of default promises for sent packets.\n  #makePromise(id) {\n    let promise = null;\n    if (id) {\n      promise = new Promise((resolve, reject) => {\n        // Stored callbacks will be called when the response packet with this Id arrives\n        this._pendingPromises[id] = {\n          'resolve': resolve,\n          'reject': reject,\n          'ts': new Date()\n        };\n      });\n    }\n    return promise;\n  };\n\n  // Resolve or reject a pending promise.\n  // Unresolved promises are stored in _pendingPromises.\n  #execPromise(id, code, onOK, errorText) {\n    const callbacks = this._pendingPromises[id];\n    if (callbacks) {\n      delete this._pendingPromises[id];\n      if (code >= 200 && code < 400) {\n        if (callbacks.resolve) {\n          callbacks.resolve(onOK);\n        }\n      } else if (callbacks.reject) {\n        callbacks.reject(new CommError(errorText, code));\n      }\n    }\n  }\n\n  // Send a packet. If packet id is provided return a promise.\n  #send(pkt, id) {\n    let promise;\n    if (id) {\n      promise = this.#makePromise(id);\n    }\n    pkt = simplify(pkt);\n    let msg = JSON.stringify(pkt);\n    this.logger(\"out: \" + (this._trimLongStrings ? JSON.stringify(pkt, jsonLoggerHelper) : msg));\n    try {\n      this._connection.sendText(msg);\n    } catch (err) {\n      // If sendText throws, wrap the error in a promise or rethrow.\n      if (id) {\n        this.#execPromise(id, Connection.NETWORK_ERROR, null, err.message);\n      } else {\n        throw err;\n      }\n    }\n    return promise;\n  }\n\n  // The main message dispatcher.\n  #dispatchMessage(data) {\n    // Skip empty response. This happens when LP times out.\n    if (!data)\n      return;\n\n    this._inPacketCount++;\n\n    // Send raw message to listener\n    if (this.onRawMessage) {\n      this.onRawMessage(data);\n    }\n\n    if (data === '0') {\n      // Server response to a network probe.\n      if (this.onNetworkProbe) {\n        this.onNetworkProbe();\n      }\n      // No processing is necessary.\n      return;\n    }\n\n    let pkt = JSON.parse(data, jsonParseHelper);\n    if (!pkt) {\n      this.logger(\"in: \" + data);\n      this.logger(\"ERROR: failed to parse data\");\n    } else {\n      this.logger(\"in: \" + (this._trimLongStrings ? JSON.stringify(pkt, jsonLoggerHelper) : data));\n\n      // Send complete packet to listener\n      if (this.onMessage) {\n        this.onMessage(pkt);\n      }\n\n      if (pkt.ctrl) {\n        // Handling {ctrl} message\n        if (this.onCtrlMessage) {\n          this.onCtrlMessage(pkt.ctrl);\n        }\n\n        // Resolve or reject a pending promise, if any\n        if (pkt.ctrl.id) {\n          this.#execPromise(pkt.ctrl.id, pkt.ctrl.code, pkt.ctrl, pkt.ctrl.text);\n        }\n        setTimeout(_ => {\n          if (pkt.ctrl.code == 205 && pkt.ctrl.text == 'evicted') {\n            // User evicted from topic.\n            const topic = this.#cacheGet('topic', pkt.ctrl.topic);\n            if (topic) {\n              topic._resetSub();\n              if (pkt.ctrl.params && pkt.ctrl.params.unsub) {\n                topic._gone();\n              }\n            }\n          } else if (pkt.ctrl.code < 300 && pkt.ctrl.params) {\n            if (pkt.ctrl.params.what == 'data') {\n              // code=208, all messages received: \"params\":{\"count\":11,\"what\":\"data\"},\n              const topic = this.#cacheGet('topic', pkt.ctrl.topic);\n              if (topic) {\n                topic._allMessagesReceived(pkt.ctrl.params.count);\n              }\n            } else if (pkt.ctrl.params.what == 'sub') {\n              // code=204, the topic has no (refreshed) subscriptions.\n              const topic = this.#cacheGet('topic', pkt.ctrl.topic);\n              if (topic) {\n                // Trigger topic.onSubsUpdated.\n                topic._processMetaSubs([]);\n              }\n            }\n          }\n        }, 0);\n      } else {\n        setTimeout(_ => {\n          if (pkt.meta) {\n            // Handling a {meta} message.\n            // Preferred API: Route meta to topic, if one is registered\n            const topic = this.#cacheGet('topic', pkt.meta.topic);\n            if (topic) {\n              topic._routeMeta(pkt.meta);\n            }\n\n            if (pkt.meta.id) {\n              this.#execPromise(pkt.meta.id, 200, pkt.meta, 'META');\n            }\n\n            // Secondary API: callback\n            if (this.onMetaMessage) {\n              this.onMetaMessage(pkt.meta);\n            }\n          } else if (pkt.data) {\n            // Handling {data} message\n            // Preferred API: Route data to topic, if one is registered\n            const topic = this.#cacheGet('topic', pkt.data.topic);\n            if (topic) {\n              topic._routeData(pkt.data);\n            }\n\n            // Secondary API: Call callback\n            if (this.onDataMessage) {\n              this.onDataMessage(pkt.data);\n            }\n          } else if (pkt.pres) {\n            // Handling {pres} message\n            // Preferred API: Route presence to topic, if one is registered\n            const topic = this.#cacheGet('topic', pkt.pres.topic);\n            if (topic) {\n              topic._routePres(pkt.pres);\n            }\n\n            // Secondary API - callback\n            if (this.onPresMessage) {\n              this.onPresMessage(pkt.pres);\n            }\n          } else if (pkt.info) {\n            // {info} message - read/received notifications and key presses\n            // Preferred API: Route {info}} to topic, if one is registered\n            const topic = this.#cacheGet('topic', pkt.info.topic);\n            if (topic) {\n              topic._routeInfo(pkt.info);\n            }\n\n            // Secondary API - callback\n            if (this.onInfoMessage) {\n              this.onInfoMessage(pkt.info);\n            }\n          } else {\n            this.logger(\"ERROR: Unknown packet received.\");\n          }\n        }, 0);\n      }\n    }\n  }\n\n  // Connection open, ready to start sending.\n  #connectionOpen() {\n    if (!this._expirePromises) {\n      // Reject promises which have not been resolved for too long.\n      this._expirePromises = setInterval(_ => {\n        const err = new CommError(\"timeout\", 504);\n        const expires = new Date(new Date().getTime() - Const.EXPIRE_PROMISES_TIMEOUT);\n        for (let id in this._pendingPromises) {\n          let callbacks = this._pendingPromises[id];\n          if (callbacks && callbacks.ts < expires) {\n            this.logger(\"Promise expired\", id);\n            delete this._pendingPromises[id];\n            if (callbacks.reject) {\n              callbacks.reject(err);\n            }\n          }\n        }\n      }, Const.EXPIRE_PROMISES_PERIOD);\n    }\n    this.hello();\n  }\n\n  #disconnected(err, code) {\n    this._inPacketCount = 0;\n    this._serverInfo = null;\n    this._authenticated = false;\n\n    if (this._expirePromises) {\n      clearInterval(this._expirePromises);\n      this._expirePromises = null;\n    }\n\n    // Mark all topics as unsubscribed\n    this.#cacheMap('topic', (topic, key) => {\n      topic._resetSub();\n    });\n\n    // Reject all pending promises\n    for (let key in this._pendingPromises) {\n      const callbacks = this._pendingPromises[key];\n      if (callbacks && callbacks.reject) {\n        callbacks.reject(err);\n      }\n    }\n    this._pendingPromises = {};\n\n    if (this.onDisconnect) {\n      this.onDisconnect(err);\n    }\n  }\n\n  // Get User Agent string\n  #getUserAgent() {\n    return this._appName + ' (' + (this._browser ? this._browser + '; ' : '') + this._hwos + '); ' + Const.LIBRARY;\n  }\n\n  // Generator of packets stubs\n  #initPacket(type, topic) {\n    switch (type) {\n      case 'hi':\n        return {\n          'hi': {\n            'id': this.getNextUniqueId(),\n            'ver': Const.VERSION,\n            'ua': this.#getUserAgent(),\n            'dev': this._deviceToken,\n            'lang': this._humanLanguage,\n            'platf': this._platform\n          }\n        };\n\n      case 'acc':\n        return {\n          'acc': {\n            'id': this.getNextUniqueId(),\n            'user': null,\n            'scheme': null,\n            'secret': null,\n            'tmpscheme': null,\n            'tmpsecret': null,\n            'login': false,\n            'tags': null,\n            'desc': {},\n            'cred': {}\n          }\n        };\n\n      case 'login':\n        return {\n          'login': {\n            'id': this.getNextUniqueId(),\n            'scheme': null,\n            'secret': null\n          }\n        };\n\n      case 'sub':\n        return {\n          'sub': {\n            'id': this.getNextUniqueId(),\n            'topic': topic,\n            'set': {},\n            'get': {}\n          }\n        };\n\n      case 'leave':\n        return {\n          'leave': {\n            'id': this.getNextUniqueId(),\n            'topic': topic,\n            'unsub': false\n          }\n        };\n\n      case 'pub':\n        return {\n          'pub': {\n            'id': this.getNextUniqueId(),\n            'topic': topic,\n            'noecho': false,\n            'head': null,\n            'content': {}\n          }\n        };\n\n      case 'get':\n        return {\n          'get': {\n            'id': this.getNextUniqueId(),\n            'topic': topic,\n            'what': null,\n            'desc': {},\n            'sub': {},\n            'data': {}\n          }\n        };\n\n      case 'set':\n        return {\n          'set': {\n            'id': this.getNextUniqueId(),\n            'topic': topic,\n            'desc': {},\n            'sub': {},\n            'tags': [],\n            'aux': {}\n          }\n        };\n\n      case 'del':\n        return {\n          'del': {\n            'id': this.getNextUniqueId(),\n            'topic': topic,\n            'what': null,\n            'delseq': null,\n            'user': null,\n            'hard': false\n          }\n        };\n\n      case 'note':\n        return {\n          'note': {\n            // no id by design (except calls).\n            'topic': topic,\n            'what': null, // one of \"recv\", \"read\", \"kp\", \"call\"\n            'seq': undefined // the server-side message id acknowledged as received or read.\n          }\n        };\n\n      default:\n        throw new Error(`Unknown packet type requested: ${type}`);\n    }\n  }\n\n  // Cache management\n  #cachePut(type, name, obj) {\n    this._cache[type + ':' + name] = obj;\n  }\n  #cacheGet(type, name) {\n    return this._cache[type + ':' + name];\n  }\n  #cacheDel(type, name) {\n    delete this._cache[type + ':' + name];\n  }\n\n  // Enumerate all items in cache, call func for each item.\n  // Enumeration stops if func returns true.\n  #cacheMap(type, func, context) {\n    const key = type ? type + ':' : undefined;\n    for (let idx in this._cache) {\n      if (!key || idx.indexOf(key) == 0) {\n        if (func.call(context, this._cache[idx], idx)) {\n          break;\n        }\n      }\n    }\n  }\n\n  // Make limited cache management available to topic.\n  // Caching user.public only. Everything else is per-topic.\n  #attachCacheToTopic(topic) {\n    topic._tinode = this;\n\n    topic._cacheGetUser = (uid) => {\n      const pub = this.#cacheGet('user', uid);\n      if (pub) {\n        return {\n          user: uid,\n          public: mergeObj({}, pub)\n        };\n      }\n      return undefined;\n    };\n    topic._cachePutUser = (uid, user) => {\n      this.#cachePut('user', uid, mergeObj({}, user.public));\n    };\n    topic._cacheDelUser = (uid) => {\n      this.#cacheDel('user', uid);\n    };\n    topic._cachePutSelf = _ => {\n      this.#cachePut('topic', topic.name, topic);\n    };\n    topic._cacheDelSelf = _ => {\n      this.#cacheDel('topic', topic.name);\n    };\n  }\n\n  // On successful login save server-provided data.\n  #loginSuccessful(ctrl) {\n    if (!ctrl.params || !ctrl.params.user) {\n      return ctrl;\n    }\n    // This is a response to a successful login,\n    // extract UID and security token, save it in Tinode module\n    this._myUID = ctrl.params.user;\n    this._authenticated = (ctrl && ctrl.code >= 200 && ctrl.code < 300);\n    if (ctrl.params && ctrl.params.token && ctrl.params.expires) {\n      this._authToken = {\n        token: ctrl.params.token,\n        expires: ctrl.params.expires\n      };\n    } else {\n      this._authToken = null;\n    }\n\n    if (this.onLogin) {\n      this.onLogin(ctrl.code, ctrl.text);\n    }\n\n    return ctrl;\n  }\n\n  // Static methods.\n  /**\n   * Helper method to package account credential.\n   *\n   * @param {string | Credential} meth - validation method or object with validation data.\n   * @param {string=} val - validation value (e.g. email or phone number).\n   * @param {Object=} params - validation parameters.\n   * @param {string=} resp - validation response.\n   *\n   * @returns {Array.<Credential>} array with a single credential or <code>null</code> if no valid credentials were given.\n   */\n  static credential(meth, val, params, resp) {\n    if (typeof meth == 'object') {\n      ({\n        val,\n        params,\n        resp,\n        meth\n      } = meth);\n    }\n    if (meth && (val || resp)) {\n      return [{\n        'meth': meth,\n        'val': val,\n        'resp': resp,\n        'params': params\n      }];\n    }\n    return null;\n  }\n\n  /**\n   * Determine topic type from topic's name: grp, p2p, me, fnd, sys.\n   * @param {string} name - Name of the topic to test.\n   * @returns {string} One of <code>\"me\"</code>, <code>\"fnd\"</code>, <code>\"sys\"</code>, <code>\"grp\"</code>,\n   *    <code>\"p2p\"</code> or <code>undefined</code>.\n   */\n  static topicType(name) {\n    return Topic.topicType(name);\n  }\n\n  /**\n   * Check if the given topic name is a name of a 'me' topic.\n   * @param {string} name - Name of the topic to test.\n   * @returns {boolean} <code>true</code> if the name is a name of a 'me' topic, <code>false</code> otherwise.\n   */\n  static isMeTopicName(name) {\n    return Topic.isMeTopicName(name);\n  }\n  /**\n   * Check if the given topic name is a name of a 'slf' topic.\n   * @param {string} name - Name of the topic to test.\n   * @returns {boolean} <code>true</code> if the name is a name of a 'slf' topic, <code>false</code> otherwise.\n   */\n  static isSelfTopicName(name) {\n    return Topic.isSelfTopicName(name);\n  }\n  /**\n   * Check if the given topic name is a name of a group topic.\n   * @param {string} name - Name of the topic to test.\n   * @returns {boolean} <code>true</code> if the name is a name of a group topic, <code>false</code> otherwise.\n   */\n  static isGroupTopicName(name) {\n    return Topic.isGroupTopicName(name);\n  }\n  /**\n   * Check if the given topic name is a name of a p2p topic.\n   * @param {string} name - Name of the topic to test.\n   * @returns {boolean} <code>true</code> if the name is a name of a p2p topic, <code>false</code> otherwise.\n   */\n  static isP2PTopicName(name) {\n    return Topic.isP2PTopicName(name);\n  }\n  /**\n   * Check if the given topic name is a name of a communication topic, i.e. P2P or group.\n   * @param {string} name - Name of the topic to test.\n   * @returns {boolean} <code>true</code> if the name is a name of a p2p or group topic, <code>false</code> otherwise.\n   */\n  static isCommTopicName(name) {\n    return Topic.isCommTopicName(name);\n  }\n  /**\n   * Check if the topic name is a name of a new topic.\n   * @param {string} name - topic name to check.\n   * @returns {boolean} <code>true</code> if the name is a name of a new topic, <code>false</code> otherwise.\n   */\n  static isNewGroupTopicName(name) {\n    return Topic.isNewGroupTopicName(name);\n  }\n  /**\n   * Check if the topic name is a name of a channel.\n   * @param {string} name - topic name to check.\n   * @returns {boolean} <code>true</code> if the name is a name of a channel, <code>false</code> otherwise.\n   */\n  static isChannelTopicName(name) {\n    return Topic.isChannelTopicName(name);\n  }\n  /**\n   * Get information about the current version of this Tinode client library.\n   * @returns {string} semantic version of the library, e.g. <code>\"0.15.5-rc1\"</code>.\n   */\n  static getVersion() {\n    return Const.VERSION;\n  }\n  /**\n   * To use Tinode in a non browser context, supply WebSocket and XMLHttpRequest providers.\n   * @static\n   *\n   * @param {Object} wsProvider - <code>WebSocket</code> provider, e.g. for nodeJS, <code>require('ws')</code>.\n   * @param {Object} xhrProvider - <code>XMLHttpRequest</code> provider, e.g. for node <code>require('xhr')</code>.\n   */\n  static setNetworkProviders(wsProvider, xhrProvider) {\n    WebSocketProvider = wsProvider;\n    XHRProvider = xhrProvider;\n\n    Connection.setNetworkProviders(WebSocketProvider, XHRProvider);\n    LargeFileHelper.setNetworkProvider(XHRProvider);\n  }\n  /**\n   * To use Tinode in a non browser context, supply <code>indexedDB</code> provider.\n   * @static\n   *\n   * @param {Object} idbProvider - <code>indexedDB</code> provider, e.g. for nodeJS, <code>require('fake-indexeddb')</code>.\n   */\n  static setDatabaseProvider(idbProvider) {\n    IndexedDBProvider = idbProvider;\n\n    DBCache.setDatabaseProvider(IndexedDBProvider);\n  }\n  /**\n   * Return information about the current name and version of this Tinode library.\n   * @static\n   *\n   * @returns {string} the name of the library and its version.\n   */\n  static getLibrary() {\n    return Const.LIBRARY;\n  }\n  /**\n   * Check if the given string represents <code>NULL</code> value as defined by Tinode (<code>'\\u2421'</code>).\n   * @param {string} str - string to check for <code>NULL</code> value.\n   * @returns {boolean} <code>true</code> if string represents <code>NULL</code> value, <code>false</code> otherwise.\n   */\n  static isNullValue(str) {\n    return str === Const.DEL_CHAR;\n  }\n  /**\n   * Check if the given seq ID is likely to be issued by the server as opposite to being temporary locally assigned ID.\n   * @param {number} seq - seq ID to check.\n   * @returns {boolean} <code>true</code> if seq is likely server-issued, <code>false</code> otherwise.\n   */\n  static isServerAssignedSeq(seq) {\n    return seq > 0 && seq < Const.LOCAL_SEQID;\n  }\n\n  /**\n   * Check if the given string is a valid tag value.\n   * @param {string} tag - string to check.\n   * @returns {boolean} <code>true</code> if the string is a valid tag value, <code>false</code> otherwise.\n   */\n  static isValidTagValue(tag) {\n    // 4-24 characters, starting with letter or digit, then letters, digits, hyphen, underscore.\n    const ALIAS_REGEX = /^[a-z0-9][a-z0-9_\\-]{3,23}$/i;\n    return tag && typeof tag == 'string' && tag.length > 3 && tag.length < 24 && ALIAS_REGEX.test(tag);\n  }\n\n  /**\n   * Split fully-qualified tag into prefix and value.\n   */\n  static tagSplit(tag) {\n    if (!tag) {\n      return null;\n    }\n\n    tag = tag.trim();\n\n    const splitAt = tag.indexOf(':');\n    if (splitAt <= 0) {\n      // Invalid syntax.\n      return null;\n    }\n\n    const value = tag.substring(splitAt + 1);\n    if (!value) {\n      return null;\n    }\n    return {\n      prefix: tag.substring(0, splitAt),\n      value: value\n    };\n  }\n\n  /**\n   * Set a unique namespace tag.\n   * If the tag with this namespace is already present then it's replaced with the new tag.\n   * @param {Array.<string>} tags - array of tags to modify.\n   * @param {string} uniqueTag - tag to add, must be fully-qualified; if null or empty, no action is taken.\n   * @returns {Array.<string>} modified array of tags.\n   */\n  static setUniqueTag(tags, uniqueTag) {\n    if (!tags || tags.length == 0) {\n      // No tags, just add the new one.\n      return [uniqueTag];\n    }\n\n    const parts = Tinode.tagSplit(uniqueTag)\n    if (!parts) {\n      // Invalid tag.\n      return tags;\n    }\n\n    // Remove the old tag with the same prefix.\n    tags = tags.filter(tag => tag && !tag.startsWith(parts.prefix));\n    // Add the new tag.\n    tags.push(uniqueTag);\n    return tags;\n  }\n\n  /**\n   * Remove a unique tag with the given prefix.\n   * @param {Array.<string>} tags - array of tags to modify.\n   * @param {string} prefix - prefix to remove.\n   * @returns {Array.<string>} array of tags without the ones with the given prefix.\n   */\n  static clearTagPrefix(tags, prefix) {\n    if (!tags || tags.length == 0) {\n      return [];\n    }\n    return tags.filter(tag => tag && !tag.startsWith(prefix));\n  }\n\n  /**\n   * Find the first tag with the given prefix.\n   * @param {Array.<string>} tags - array of tags to search.\n   * @param {string} prefix - prefix to search for.\n   * @returns {string} the first tag with the given prefix if found or <code>undefined</code>.\n   */\n  static tagByPrefix(tags, prefix) {\n    if (!tags) {\n      return undefined;\n    }\n\n    return tags.find(tag => tag && tag.startsWith(prefix));\n  }\n\n  // Instance methods.\n\n  /** Generates unique message IDs */\n  getNextUniqueId() {\n    return (this._messageId != 0) ? '' + this._messageId++ : undefined;\n  };\n\n  /**\n   * Connect to the server.\n   *\n   * @param {string} host_ - name of the host to connect to.\n   * @return {Promise} Promise resolved/rejected when the connection call completes:\n   *    <code>resolve()</code> is called without parameters, <code>reject()</code> receives the\n   *    <code>Error</code> as a single parameter.\n   */\n  connect(host_) {\n    return this._connection.connect(host_);\n  }\n\n  /**\n   * Attempt to reconnect to the server immediately.\n   *\n   * @param {string} force - if <code>true</code>, reconnect even if there is a connection already.\n   */\n  reconnect(force) {\n    this._connection.reconnect(force);\n  }\n\n  /**\n   * Disconnect from the server.\n   */\n  disconnect() {\n    this._connection.disconnect();\n  }\n\n  /**\n   * Clear persistent cache: remove IndexedDB.\n   *\n   * @return {Promise} Promise resolved/rejected when the operation is completed.\n   */\n  clearStorage() {\n    if (this._db.isReady()) {\n      return this._db.deleteDatabase();\n    }\n    return Promise.resolve();\n  }\n\n  /**\n   * Initialize persistent cache: create IndexedDB cache.\n   *\n   * @return {Promise} Promise resolved/rejected when the operation is completed.\n   */\n  initStorage() {\n    if (!this._db.isReady()) {\n      return this._db.initDatabase();\n    }\n    return Promise.resolve();\n  }\n\n  /**\n   * Send a network probe message to make sure the connection is alive.\n   */\n  networkProbe() {\n    this._connection.probe();\n  }\n\n  /**\n   * Check for live connection to server.\n   *\n   * @returns {boolean} <code>true</code> if there is a live connection, <code>false</code> otherwise.\n   */\n  isConnected() {\n    return this._connection.isConnected();\n  }\n\n  /**\n   * Check if connection is authenticated (last login was successful).\n   *\n   * @returns {boolean} <code>true</code> if authenticated, <code>false</code> otherwise.\n   */\n  isAuthenticated() {\n    return this._authenticated;\n  }\n\n  /**\n   * Add API key and auth token to the relative URL making it usable for getting data\n   * from the server in a simple <code>HTTP GET</code> request.\n   *\n   * @param {string} URL - URL to wrap.\n   * @returns {string} URL with appended API key and token, if valid token is present.\n   */\n  authorizeURL(url) {\n    if (typeof url != 'string') {\n      return url;\n    }\n\n    if (isUrlRelative(url)) {\n      // Fake base to make the relative URL parseable.\n      const base = 'scheme://host/';\n      const parsed = new URL(url, base);\n      if (this._apiKey) {\n        parsed.searchParams.append('apikey', this._apiKey);\n      }\n      if (this._authToken && this._authToken.token) {\n        parsed.searchParams.append('auth', 'token');\n        parsed.searchParams.append('secret', this._authToken.token);\n      }\n      // Convert back to string and strip fake base URL except for the root slash.\n      url = parsed.toString().substring(base.length - 1);\n    }\n    return url;\n  }\n\n  /**\n   * @typedef AccountParams\n   * @type {Object}\n   * @property {DefAcs=} defacs - Default access parameters for user's <code>me</code> topic.\n   * @property {Object=} public - Public application-defined data exposed on <code>me</code> topic.\n   * @property {Object=} private - Private application-defined data accessible on <code>me</code> topic.\n   * @property {Object=} trusted - Trusted user data which can be set by a root user only.\n   * @property {Array.<string>} tags - array of string tags for user discovery.\n   * @property {string} scheme - Temporary authentication scheme for password reset.\n   * @property {string} secret - Temporary authentication secret for password reset.\n   * @property {Array.<string>=} attachments - Array of references to out of band attachments used in account description.\n   */\n  /**\n   * @typedef DefAcs\n   * @type {Object}\n   * @property {string=} auth - Access mode for <code>me</code> for authenticated users.\n   * @property {string=} anon - Access mode for <code>me</code> for anonymous users.\n   */\n\n  /**\n   * Create or update an account.\n   *\n   * @param {string} uid - User id to update\n   * @param {string} scheme - Authentication scheme; <code>\"basic\"</code> and <code>\"anonymous\"</code> are the currently supported schemes.\n   * @param {string} secret - Authentication secret, assumed to be already base64 encoded.\n   * @param {boolean=} login - Use new account to authenticate current session\n   * @param {AccountParams=} params - User data to pass to the server.\n   *\n   * @returns {Promise} Promise which will be resolved/rejected when server reply is received.\n   */\n  account(uid, scheme, secret, login, params) {\n    const pkt = this.#initPacket('acc');\n    pkt.acc.user = uid;\n    pkt.acc.scheme = scheme;\n    pkt.acc.secret = secret;\n    // Log in to the new account using selected scheme\n    pkt.acc.login = login;\n\n    if (params) {\n      pkt.acc.desc.defacs = params.defacs;\n      pkt.acc.desc.public = params.public;\n      pkt.acc.desc.private = params.private;\n      pkt.acc.desc.trusted = params.trusted;\n\n      pkt.acc.tags = params.tags;\n      pkt.acc.cred = params.cred;\n\n      pkt.acc.tmpscheme = params.scheme;\n      pkt.acc.tmpsecret = params.secret;\n\n      if (Array.isArray(params.attachments) && params.attachments.length > 0) {\n        pkt.extra = {\n          attachments: params.attachments.filter(ref => isUrlRelative(ref))\n        };\n      }\n    }\n\n    return this.#send(pkt, pkt.acc.id);\n  }\n\n  /**\n   * Create a new user. Wrapper for {@link Tinode#account}.\n   *\n   * @param {string} scheme - Authentication scheme; <code>\"basic\"</code> is the only currently supported scheme.\n   * @param {string} secret - Authentication.\n   * @param {boolean=} login - Use new account to authenticate current session\n   * @param {AccountParams=} params - User data to pass to the server.\n   *\n   * @returns {Promise} Promise which will be resolved/rejected when server reply is received.\n   */\n  createAccount(scheme, secret, login, params) {\n    let promise = this.account(Const.USER_NEW, scheme, secret, login, params);\n    if (login) {\n      promise = promise.then(ctrl => this.#loginSuccessful(ctrl));\n    }\n    return promise;\n  }\n\n  /**\n   * Create user with <code>'basic'</code> authentication scheme and immediately\n   * use it for authentication. Wrapper for {@link Tinode#account}.\n   *\n   * @param {string} username - Login to use for the new account.\n   * @param {string} password - User's password.\n   * @param {AccountParams=} params - User data to pass to the server.\n   *\n   * @returns {Promise} Promise which will be resolved/rejected when server reply is received.\n   */\n  createAccountBasic(username, password, params) {\n    // Make sure we are not using 'null' or 'undefined';\n    username = username || '';\n    password = password || '';\n    return this.createAccount('basic',\n      b64EncodeUnicode(username + ':' + password), true, params);\n  }\n\n  /**\n   * Update user's credentials for <code>'basic'</code> authentication scheme. Wrapper for {@link Tinode#account}.\n   *\n   * @param {string} uid - User ID to update.\n   * @param {string} username - Login to use for the new account.\n   * @param {string} password - User's password.\n   * @param {AccountParams=} params - data to pass to the server.\n   *\n   * @returns {Promise} Promise which will be resolved/rejected when server reply is received.\n   */\n  updateAccountBasic(uid, username, password, params) {\n    // Make sure we are not using 'null' or 'undefined';\n    username = username || '';\n    password = password || '';\n    return this.account(uid, 'basic',\n      b64EncodeUnicode(username + ':' + password), false, params);\n  }\n\n  /**\n   * Send handshake to the server.\n   *\n   * @returns {Promise} Promise which will be resolved/rejected when server reply is received.\n   */\n  hello() {\n    const pkt = this.#initPacket('hi');\n\n    return this.#send(pkt, pkt.hi.id)\n      .then(ctrl => {\n        // Reset backoff counter on successful connection.\n        this._connection.backoffReset();\n\n        // Server response contains server protocol version, build, constraints,\n        // session ID for long polling. Save them.\n        if (ctrl.params) {\n          this._serverInfo = ctrl.params;\n        }\n\n        if (this.onConnect) {\n          this.onConnect();\n        }\n\n        return ctrl;\n      }).catch(err => {\n        this._connection.reconnect(true);\n\n        if (this.onDisconnect) {\n          this.onDisconnect(err);\n        }\n      });\n  }\n\n  /**\n   * Set or refresh the push notifications/device token. If the client is connected,\n   * the deviceToken can be sent to the server.\n   *\n   * @param {string} dt - token obtained from the provider or <code>false</code>,\n   *    <code>null</code> or <code>undefined</code> to clear the token.\n   *\n   * @returns <code>true</code> if attempt was made to send the update to the server.\n   */\n  setDeviceToken(dt) {\n    let sent = false;\n    // Convert any falsish value to null.\n    dt = dt || null;\n    if (dt != this._deviceToken) {\n      this._deviceToken = dt;\n      if (this.isConnected() && this.isAuthenticated()) {\n        this.#send({\n          'hi': {\n            'dev': dt || Tinode.DEL_CHAR\n          }\n        });\n        sent = true;\n      }\n    }\n    return sent;\n  }\n\n  /**\n   * @typedef Credential\n   * @type {Object}\n   * @property {string} meth - validation method.\n   * @property {string} val - value to validate (e.g. email or phone number).\n   * @property {string} resp - validation response.\n   * @property {Object} params - validation parameters.\n   */\n  /**\n   * Authenticate current session.\n   *\n   * @param {string} scheme - Authentication scheme; <code>\"basic\"</code> is the only currently supported scheme.\n   * @param {string} secret - Authentication secret, assumed to be already base64 encoded.\n   * @param {Credential=} cred - credential confirmation, if required.\n   *\n   * @returns {Promise} Promise which will be resolved/rejected when server reply is received.\n   */\n  login(scheme, secret, cred) {\n    const pkt = this.#initPacket('login');\n    pkt.login.scheme = scheme;\n    pkt.login.secret = secret;\n    pkt.login.cred = cred;\n\n    return this.#send(pkt, pkt.login.id)\n      .then(ctrl => this.#loginSuccessful(ctrl));\n  }\n\n  /**\n   * Wrapper for {@link Tinode#login} with basic authentication\n   *\n   * @param {string} uname - User name.\n   * @param {string} password  - Password.\n   * @param {Credential=} cred - credential confirmation, if required.\n   *\n   * @returns {Promise} Promise which will be resolved/rejected on receiving server reply.\n   */\n  loginBasic(uname, password, cred) {\n    return this.login('basic', b64EncodeUnicode(uname + ':' + password), cred)\n      .then(ctrl => {\n        this._login = uname;\n        return ctrl;\n      });\n  }\n\n  /**\n   * Wrapper for {@link Tinode#login} with token authentication\n   *\n   * @param {string} token - Token received in response to earlier login.\n   * @param {Credential=} cred - credential confirmation, if required.\n   *\n   * @returns {Promise} Promise which will be resolved/rejected on receiving server reply.\n   */\n  loginToken(token, cred) {\n    return this.login('token', token, cred);\n  }\n\n  /**\n   * Send a request for resetting an authentication secret.\n   *\n   * @param {string} scheme - authentication scheme to reset.\n   * @param {string} method - method to use for resetting the secret, such as \"email\" or \"tel\".\n   * @param {string} value - value of the credential to use, a specific email address or a phone number.\n   *\n   * @returns {Promise} Promise which will be resolved/rejected on receiving the server reply.\n   */\n  requestResetAuthSecret(scheme, method, value) {\n    return this.login('reset', b64EncodeUnicode(scheme + ':' + method + ':' + value));\n  }\n\n  /**\n   * @typedef AuthToken\n   * @type {Object}\n   * @property {string} token - Token value.\n   * @property {Date} expires - Token expiration time.\n   */\n  /**\n   * Get stored authentication token.\n   *\n   * @returns {AuthToken} authentication token.\n   */\n  getAuthToken() {\n    if (this._authToken && (this._authToken.expires.getTime() > Date.now())) {\n      return this._authToken;\n    } else {\n      this._authToken = null;\n    }\n    return null;\n  }\n\n  /**\n   * Application may provide a saved authentication token.\n   *\n   * @param {AuthToken} token - authentication token.\n   */\n  setAuthToken(token) {\n    this._authToken = token;\n  }\n\n  /**\n   * @typedef SetParams\n   * @type {Object}\n   * @property {SetDesc=} desc - Topic initialization parameters when creating a new topic or a new subscription.\n   * @property {SetSub=} sub - Subscription initialization parameters.\n   * @property {Array.<string>=} tags - Search tags.\n   * @property {Object} aux - Auxiliary topic data.\n   * @property {Array.<string>=} attachments - URLs of out of band attachments used in parameters.\n   */\n  /**\n   * @typedef SetDesc\n   * @type {Object}\n   * @property {DefAcs=} defacs - Default access mode.\n   * @property {Object=} public - Free-form topic description, publically accessible.\n   * @property {Object=} private - Free-form topic description accessible only to the owner.\n   * @property {Object=} trusted - Trusted user data which can be set by a root user only.\n   */\n  /**\n   * @typedef SetSub\n   * @type {Object}\n   * @property {string=} user - UID of the user affected by the request. Default (empty) - current user.\n   * @property {string=} mode - User access mode, either requested or assigned dependent on context.\n   */\n  /**\n   * Send a topic subscription request.\n   *\n   * @param {string} topic - Name of the topic to subscribe to.\n   * @param {GetQuery=} getParams - Optional subscription metadata query\n   * @param {SetParams=} setParams - Optional initialization parameters\n   *\n   * @returns {Promise} Promise which will be resolved/rejected on receiving server reply.\n   */\n  subscribe(topicName, getParams, setParams) {\n    const pkt = this.#initPacket('sub', topicName)\n    if (!topicName) {\n      topicName = Const.TOPIC_NEW;\n    }\n\n    pkt.sub.get = getParams;\n\n    if (setParams) {\n      if (setParams.sub) {\n        pkt.sub.set.sub = setParams.sub;\n      }\n\n      if (setParams.desc) {\n        const desc = setParams.desc;\n        if (Tinode.isNewGroupTopicName(topicName)) {\n          // Full set.desc params are used for new topics only\n          pkt.sub.set.desc = desc;\n        } else if (Tinode.isP2PTopicName(topicName) && desc.defacs) {\n          // Use optional default permissions only.\n          pkt.sub.set.desc = {\n            defacs: desc.defacs\n          };\n        }\n      }\n\n      // See if external objects were used in topic description.\n      if (Array.isArray(setParams.attachments) && setParams.attachments.length > 0) {\n        pkt.extra = {\n          attachments: setParams.attachments.filter(ref => isUrlRelative(ref))\n        };\n      }\n\n      if (setParams.tags) {\n        pkt.sub.set.tags = setParams.tags;\n      }\n      if (setParams.aux) {\n        pkt.sub.set.aux = setParams.aux;\n      }\n    }\n    return this.#send(pkt, pkt.sub.id);\n  }\n\n  /**\n   * Detach and optionally unsubscribe from the topic\n   *\n   * @param {string} topic - Topic to detach from.\n   * @param {boolean} unsub - If <code>true</code>, detach and unsubscribe, otherwise just detach.\n   *\n   * @returns {Promise} Promise which will be resolved/rejected on receiving server reply.\n   */\n  leave(topic, unsub) {\n    const pkt = this.#initPacket('leave', topic);\n    pkt.leave.unsub = unsub;\n\n    return this.#send(pkt, pkt.leave.id);\n  }\n\n  /**\n   * Create message draft without sending it to the server.\n   *\n   * @param {string} topic - Name of the topic to publish to.\n   * @param {Object} content - Payload to publish.\n   * @param {boolean=} noEcho - If <code>true</code>, tell the server not to echo the message to the original session.\n   *\n   * @returns {Object} new message which can be sent to the server or otherwise used.\n   */\n  createMessage(topic, content, noEcho) {\n    const pkt = this.#initPacket('pub', topic);\n\n    let dft = typeof content == 'string' ? Drafty.parse(content) : content;\n    if (dft && !Drafty.isPlainText(dft)) {\n      pkt.pub.head = {\n        mime: Drafty.getContentType()\n      };\n      content = dft;\n    }\n    pkt.pub.noecho = noEcho;\n    pkt.pub.content = content;\n    return pkt.pub;\n  }\n\n  /**\n   * Publish {data} message to topic.\n   *\n   * @param {string} topicName - Name of the topic to publish to.\n   * @param {Object} content - Payload to publish.\n   * @param {boolean=} noEcho - If <code>true</code>, tell the server not to echo the message to the original session.\n   *\n   * @returns {Promise} Promise which will be resolved/rejected on receiving server reply.\n   */\n  publish(topicName, content, noEcho) {\n    return this.publishMessage(\n      this.createMessage(topicName, content, noEcho)\n    );\n  }\n\n  /**\n   * Publish message to topic. The message should be created by {@link Tinode#createMessage}.\n   *\n   * @param {Object} pub - Message to publish.\n   * @param {Array.<string>=} attachments - array of URLs with attachments.\n   *\n   * @returns {Promise} Promise which will be resolved/rejected on receiving server reply.\n   */\n  publishMessage(pub, attachments) {\n    // Make a shallow copy. Needed in order to clear locally-assigned temp values;\n    pub = Object.assign({}, pub);\n    pub.seq = undefined;\n    pub.from = undefined;\n    pub.ts = undefined;\n    const msg = {\n      pub: pub,\n    };\n    if (attachments) {\n      msg.extra = {\n        attachments: attachments.filter(ref => isUrlRelative(ref))\n      };\n    }\n    return this.#send(msg, pub.id);\n  }\n\n  /**\n   * Out of band notification: notify topic that an external (push) notification was recived by the client.\n   *\n   * @param {object} data - notification payload.\n   * @param {string} data.what - notification type, 'msg', 'read', 'sub'.\n   * @param {string} data.topic - name of the updated topic.\n   * @param {number=} data.seq - seq ID of the affected message.\n   * @param {string=} data.xfrom - UID of the sender.\n   * @param {object=} data.given - new subscription 'given', e.g. 'ASWP...'.\n   * @param {object=} data.want - new subscription 'want', e.g. 'RWJ...'.\n   */\n  oobNotification(data) {\n    this.logger('oob: ' + (this._trimLongStrings ? JSON.stringify(data, jsonLoggerHelper) : data));\n\n    switch (data.what) {\n      case 'msg':\n        if (!data.seq || data.seq < 1 || !data.topic) {\n          // Server sent invalid data.\n          break;\n        }\n\n        if (!this.isConnected()) {\n          // Let's ignore the message if there is no connection: no connection means there are no open\n          // tabs with Tinode.\n          break;\n        }\n\n        const topic = this.#cacheGet('topic', data.topic);\n        if (!topic) {\n          // TODO: check if there is a case when a message can arrive from an unknown topic.\n          break;\n        }\n\n        if (topic.isSubscribed()) {\n          // No need to fetch: topic is already subscribed and got data through normal channel.\n          break;\n        }\n\n        if (topic.maxMsgSeq() < data.seq) {\n          if (topic.isChannelType()) {\n            topic._updateReceived(data.seq, 'fake-uid');\n          }\n\n          // New message.\n          if (data.xfrom && !this.#cacheGet('user', data.xfrom)) {\n            // Message from unknown sender, fetch description from the server.\n            // Sending asynchronously without a subscription.\n            this.getMeta(data.xfrom, new MetaGetBuilder().withDesc().build()).catch(err => {\n              this.logger(\"Failed to get the name of a new sender\", err);\n            });\n          }\n\n          topic.subscribe(null).then(_ => {\n            return topic.getMeta(new MetaGetBuilder(topic).withLaterData(24).withLaterDel(24).build());\n          }).then(_ => {\n            // Allow data fetch to complete and get processed successfully.\n            topic.leaveDelayed(false, 1000);\n          }).catch(err => {\n            this.logger(\"On push data fetch failed\", err);\n          }).finally(_ => {\n            this.getMeTopic()._refreshContact('msg', topic);\n          });\n        }\n        break;\n\n      case 'read':\n        this.getMeTopic()._routePres({\n          what: 'read',\n          seq: data.seq\n        });\n        break;\n\n      case 'sub':\n        if (!this.isMe(data.xfrom)) {\n          // TODO: handle updates from other users.\n          break;\n        }\n\n        const mode = {\n          given: data.modeGiven,\n          want: data.modeWant\n        };\n        const acs = new AccessMode(mode);\n        const pres = (!acs.mode || acs.mode == AccessMode._NONE) ?\n          // Subscription deleted.\n          {\n            what: 'gone',\n            src: data.topic\n          } :\n          // New subscription or subscription updated.\n          {\n            what: 'acs',\n            src: data.topic,\n            dacs: mode\n          };\n        this.getMeTopic()._routePres(pres);\n        break;\n\n      default:\n        this.logger(\"Unknown push type ignored\", data.what);\n    }\n  }\n\n  /**\n   * @typedef GetOptsType\n   * @type {Object}\n   * @property {Date=} ims - \"If modified since\", fetch data only it was was modified since stated date.\n   * @property {number=} limit - Maximum number of results to return. Ignored when querying topic description.\n   */\n\n  /**\n   * @typedef GetDataType\n   * @type {Object}\n   * @property {number=} since - Load messages with seq ID equal or greater than this value.\n   * @property {number=} before - Load messages with seq ID lower than this number.\n   * @property {number=} limit - Maximum number of results to return.\n   * @property {Array.<SeqRange>=} range - Ranges of seq IDs to fetch.\n   */\n\n  /**\n   * @typedef GetQuery\n   * @type {Object}\n   * @property {GetOptsType=} desc - If provided (even if empty), fetch topic description.\n   * @property {GetOptsType=} sub - If provided (even if empty), fetch topic subscriptions.\n   * @property {GetDataType=} data - If provided (even if empty), get messages.\n   */\n\n  /**\n   * Request topic metadata\n   *\n   * @param {string} topic - Name of the topic to query.\n   * @param {GetQuery} params - Parameters of the query. Use {@link Tinode.MetaGetBuilder} to generate.\n   *\n   * @returns {Promise} Promise which will be resolved/rejected on receiving server reply.\n   */\n  getMeta(topic, params) {\n    const pkt = this.#initPacket('get', topic);\n\n    pkt.get = mergeObj(pkt.get, params);\n\n    return this.#send(pkt, pkt.get.id);\n  }\n\n  /**\n   * Update topic's metadata: description, subscribtions.\n   *\n   * @param {string} topic - Topic to update.\n   * @param {SetParams} params - topic metadata to update.\n   * @returns {Promise} Promise which will be resolved/rejected on receiving server reply.\n   */\n  setMeta(topic, params) {\n    const pkt = this.#initPacket('set', topic);\n    const what = [];\n\n    if (params) {\n      ['desc', 'sub', 'tags', 'cred', 'aux', 'react'].forEach(key => {\n        if (params.hasOwnProperty(key)) {\n          what.push(key);\n          pkt.set[key] = params[key];\n        }\n      });\n\n      if (Array.isArray(params.attachments) && params.attachments.length > 0) {\n        pkt.extra = {\n          attachments: params.attachments.filter(ref => isUrlRelative(ref))\n        };\n      }\n    }\n\n    if (what.length == 0) {\n      return Promise.reject(new Error(\"Invalid {set} parameters\"));\n    }\n\n    return this.#send(pkt, pkt.set.id);\n  }\n\n  /**\n   * Range of message IDs.\n   *\n   * @typedef SeqRange\n   * @type {Object}\n   * @property {number} low - low end of the range, inclusive (closed).\n   * @property {number=} hi - high end of the range, exclusive (open).\n   */\n  /**\n   * Delete some or all messages in a topic.\n   *\n   * @param {string} topic - Topic name to delete messages from.\n   * @param {Array.<SeqRange>} list - Ranges of message IDs to delete.\n   * @param {boolean=} hard - Hard or soft delete\n   *\n   * @returns {Promise} Promise which will be resolved/rejected on receiving server reply.\n   */\n  delMessages(topic, ranges, hard) {\n    const pkt = this.#initPacket('del', topic);\n\n    pkt.del.what = 'msg';\n    pkt.del.delseq = ranges;\n    pkt.del.hard = hard;\n\n    return this.#send(pkt, pkt.del.id);\n  }\n\n  /**\n   * Delete the topic alltogether. Requires Owner permission.\n   *\n   * @param {string} topicName - Name of the topic to delete\n   * @param {boolean} hard - hard-delete topic.\n   * @returns {Promise} Promise which will be resolved/rejected on receiving server reply.\n   */\n  delTopic(topicName, hard) {\n    const pkt = this.#initPacket('del', topicName);\n    pkt.del.what = 'topic';\n    pkt.del.hard = hard;\n\n    return this.#send(pkt, pkt.del.id);\n  }\n\n  /**\n   * Delete subscription. Requires Share permission.\n   *\n   * @param {string} topicName - Name of the topic to delete\n   * @param {string} user - User ID to remove.\n   * @returns {Promise} Promise which will be resolved/rejected on receiving server reply.\n   */\n  delSubscription(topicName, user) {\n    const pkt = this.#initPacket('del', topicName);\n    pkt.del.what = 'sub';\n    pkt.del.user = user;\n\n    return this.#send(pkt, pkt.del.id);\n  }\n\n  /**\n   * Delete credential. Always sent on <code>'me'</code> topic.\n   *\n   * @param {string} method - validation method such as <code>'email'</code> or <code>'tel'</code>.\n   * @param {string} value - validation value, i.e. <code>'alice@example.com'</code>.\n   * @returns {Promise} Promise which will be resolved/rejected on receiving server reply.\n   */\n  delCredential(method, value) {\n    const pkt = this.#initPacket('del', Const.TOPIC_ME);\n    pkt.del.what = 'cred';\n    pkt.del.cred = {\n      meth: method,\n      val: value\n    };\n\n    return this.#send(pkt, pkt.del.id);\n  }\n\n  /**\n   * Request to delete account of the current user.\n   *\n   * @param {boolean} hard - hard-delete user.\n   * @returns {Promise} Promise which will be resolved/rejected on receiving server reply.\n   */\n  delCurrentUser(hard) {\n    const pkt = this.#initPacket('del', null);\n    pkt.del.what = 'user';\n    pkt.del.hard = hard;\n\n    return this.#send(pkt, pkt.del.id).then(_ => {\n      this._myUID = null;\n    });\n  }\n\n  /**\n   * Notify server that a message or messages were read or received. Does NOT return promise.\n   *\n   * @param {string} topicName - Name of the topic where the mesage is being aknowledged.\n   * @param {string} what - Action being aknowledged, either <code>\"read\"</code> or <code>\"recv\"</code>.\n   * @param {number} seq - Maximum id of the message being acknowledged.\n   * @throws {Error} if <code>seq</code> is invalid.\n   */\n  note(topicName, what, seq) {\n    if (seq <= 0 || seq >= Const.LOCAL_SEQID) {\n      throw new Error(`Invalid message id ${seq}`);\n    }\n\n    const pkt = this.#initPacket('note', topicName);\n    pkt.note.what = what;\n    pkt.note.seq = seq;\n    this.#send(pkt);\n  }\n\n  /**\n   * Broadcast a key-press notification to topic subscribers. Used to show\n   * typing notifications \"user X is typing...\".\n   *\n   * @param {string} topicName - Name of the topic to broadcast to.\n   * @param {string=} type - notification to send, default is 'kp'.\n   */\n  noteKeyPress(topicName, type) {\n    const pkt = this.#initPacket('note', topicName);\n    pkt.note.what = type || 'kp';\n    this.#send(pkt);\n  }\n\n  /**\n   * Send a video call notification to topic subscribers (including dialing,\n   * hangup, etc.).\n   *\n   * @param {string} topicName - Name of the topic to broadcast to.\n   * @param {number} seq - ID of the call message the event pertains to.\n   * @param {string} evt - Call event.\n   * @param {string} payload - Payload associated with this event (e.g. SDP string).\n   */\n  videoCall(topicName, seq, evt, payload) {\n    const pkt = this.#initPacket('note', topicName);\n    pkt.note.seq = seq;\n    pkt.note.what = 'call';\n    pkt.note.event = evt;\n    pkt.note.payload = payload;\n    this.#send(pkt);\n  }\n\n  /**\n   * Send a 'react' note to indicate the user reacted to (or removed reaction from) a message.\n   *\n   * @param {string} topicName - Name of the topic where the message to react to was posted.\n   * @param {int} seq - ID of the message to react to.\n   * @param {string} emo - Emoji string to add as reaction, or Tinode.DEL_CHAR to remove reaction.\n   */\n  react(topicName, seq, emo) {\n    const pkt = this.#initPacket('note', topicName);\n    pkt.note.seq = seq;\n    pkt.note.what = 'react';\n    pkt.note.payload = {\n      emo\n    };\n    this.#send(pkt);\n  }\n\n  /**\n   * Get a named topic, either pull it from cache or create a new instance.\n   * There is a single instance of topic for each name.\n   *\n   * @param {string} topicName - Name of the topic to get.\n   *\n   * @returns {Topic} Requested or newly created topic or <code>undefined</code> if topic name is invalid.\n   */\n  getTopic(topicName) {\n    let topic = this.#cacheGet('topic', topicName);\n    if (!topic && topicName) {\n      if (topicName == Const.TOPIC_ME) {\n        topic = new TopicMe();\n      } else if (topicName == Const.TOPIC_FND) {\n        topic = new TopicFnd();\n      } else {\n        topic = new Topic(topicName);\n      }\n      // Cache management.\n      this.#attachCacheToTopic(topic);\n      topic._cachePutSelf();\n      // Don't save to DB here: a record will be added when the topic is subscribed.\n    }\n    return topic;\n  }\n\n  /**\n   * Get a named topic from cache.\n   *\n   * @param {string} topicName - Name of the topic to get.\n   *\n   * @returns {Topic} Requested topic or <code>undefined</code> if topic is not found in cache.\n   */\n  cacheGetTopic(topicName) {\n    return this.#cacheGet('topic', topicName);\n  }\n\n  /**\n   * Remove named topic from cache.\n   *\n   * @param {string} topicName - Name of the topic to remove from cache.\n   */\n  cacheRemTopic(topicName) {\n    this.#cacheDel('topic', topicName);\n  }\n\n  /**\n   * Iterate over cached topics.\n   *\n   * @param {Function} func - callback to call for each topic.\n   * @param {Object} context - 'this' inside the 'func'.\n   */\n  mapTopics(func, context) {\n    this.#cacheMap('topic', func, context);\n  }\n\n  /**\n   * Check if named topic is already present in cache.\n   *\n   * @param {string} topicName - Name of the topic to check.\n   * @returns {boolean} true if topic is found in cache, false otherwise.\n   */\n  isTopicCached(topicName) {\n    return !!this.#cacheGet('topic', topicName);\n  }\n\n  /**\n   * Generate unique name like <code>'new123456'</code> suitable for creating a new group topic.\n   *\n   * @param {boolean} isChan - if the topic is channel-enabled.\n   * @returns {string} name which can be used for creating a new group topic.\n   */\n  newGroupTopicName(isChan) {\n    return (isChan ? Const.TOPIC_NEW_CHAN : Const.TOPIC_NEW) + this.getNextUniqueId();\n  }\n\n  /**\n   * Instantiate <code>'me'</code> topic or get it from cache.\n   *\n   * @returns {TopicMe} Instance of <code>'me'</code> topic.\n   */\n  getMeTopic() {\n    return this.getTopic(Const.TOPIC_ME);\n  }\n\n  /**\n   * Instantiate <code>'fnd'</code> (find) topic or get it from cache.\n   *\n   * @returns {Topic} Instance of <code>'fnd'</code> topic.\n   */\n  getFndTopic() {\n    return this.getTopic(Const.TOPIC_FND);\n  }\n\n  /**\n   * Create a new {@link LargeFileHelper} instance\n   *\n   * @returns {LargeFileHelper} instance of a {@link Tinode.LargeFileHelper}.\n   */\n  getLargeFileHelper() {\n    return new LargeFileHelper(this, Const.PROTOCOL_VERSION);\n  }\n\n  /**\n   * Get the UID of the the current authenticated user.\n   *\n   * @returns {string} UID of the current user or <code>undefined</code> if the session is not yet\n   * authenticated or if there is no session.\n   */\n  getCurrentUserID() {\n    return this._myUID;\n  }\n\n  /**\n   * Check if the given user ID is equal to the current user's UID.\n   *\n   * @param {string} uid - UID to check.\n   *\n   * @returns {boolean} true if the given UID belongs to the current logged in user.\n   */\n  isMe(uid) {\n    return this._myUID === uid;\n  }\n\n  /**\n   * Get login used for last successful authentication.\n   *\n   * @returns {string} login last used successfully or <code>undefined</code>.\n   */\n  getCurrentLogin() {\n    return this._login;\n  }\n\n  /**\n   * Return information about the server: protocol version and build timestamp.\n   *\n   * @returns {Object} build and version of the server or <code>null</code> if there is no connection or\n   * if the first server response has not been received yet.\n   */\n  getServerInfo() {\n    return this._serverInfo;\n  }\n\n  /**\n   * Report a topic for abuse. Wrapper for {@link Tinode#publish}.\n   *\n   * @param {string} action - the only supported action is 'report'.\n   * @param {string} target - name of the topic being reported.\n   *\n   * @returns {Promise} Promise to be resolved/rejected when the server responds to request.\n   */\n  report(action, target) {\n    return this.publish(Const.TOPIC_SYS, Drafty.attachJSON(null, {\n      'action': action,\n      'target': target\n    }));\n  }\n\n  /**\n   * Return server-provided configuration value.\n   *\n   * @param {string} name - name of the value to return.\n   * @param {Object} defaultValue - value to return in case the parameter is not set or not found.\n   *\n   * @returns {Object} named value.\n   */\n  getServerParam(name, defaultValue) {\n    return this._serverInfo && this._serverInfo[name] || defaultValue;\n  }\n\n  /**\n   * Toggle console logging. Logging is off by default.\n   *\n   * @param {boolean} enabled - Set to <code>true</code> to enable logging to console.\n   * @param {boolean} trimLongStrings - Set to <code>true</code> to trim long strings.\n   */\n  enableLogging(enabled, trimLongStrings) {\n    this._loggingEnabled = enabled;\n    this._trimLongStrings = enabled && trimLongStrings;\n  }\n\n  /**\n   * Set UI language to report to the server. Must be called before <code>'hi'</code> is sent, otherwise it will not be used.\n   *\n   * @param {string} hl - human (UI) language, like <code>\"en_US\"</code> or <code>\"zh-Hans\"</code>.\n   */\n  setHumanLanguage(hl) {\n    if (hl) {\n      this._humanLanguage = hl;\n    }\n  }\n\n  /**\n   * Check if given topic is online.\n   *\n   * @param {string} name - name of the topic to test.\n   * @returns {boolean} true if topic is online, false otherwise.\n   */\n  isTopicOnline(name) {\n    const topic = this.#cacheGet('topic', name);\n    return topic && topic.online;\n  }\n\n  /**\n   * Get access mode for the given contact.\n   *\n   * @param {string} name - name of the topic to query.\n   * @returns {AccessMode} access mode if topic is found, null otherwise.\n   */\n  getTopicAccessMode(name) {\n    const topic = this.#cacheGet('topic', name);\n    return topic ? topic.acs : null;\n  }\n\n  /**\n   * Include message ID into all subsequent messages to server instructing it to send acknowledgements.\n   * Required for promises to function. Default is <code>\"on\"</code>.\n   *\n   * @param {boolean} status - Turn acknowledgements on or off.\n   * @deprecated\n   */\n  wantAkn(status) {\n    if (status) {\n      this._messageId = Math.floor((Math.random() * 0xFFFFFF) + 0xFFFFFF);\n    } else {\n      this._messageId = 0;\n    }\n  }\n\n  // Callbacks:\n  /**\n   * Callback to report when the websocket is opened. The callback has no parameters.\n   *\n   * @type {onWebsocketOpen}\n   */\n  onWebsocketOpen = undefined;\n\n  /**\n   * @typedef ServerParams\n   *\n   * @type {Object}\n   * @property {string} ver - Server version\n   * @property {string} build - Server build\n   * @property {string=} sid - Session ID, long polling connections only.\n   */\n\n  /**\n   * @callback onConnect\n   * @param {number} code - Result code\n   * @param {string} text - Text epxplaining the completion, i.e \"OK\" or an error message.\n   * @param {ServerParams} params - Parameters returned by the server.\n   */\n  /**\n   * Callback to report when connection with Tinode server is established.\n   * @type {onConnect}\n   */\n  onConnect = undefined;\n\n  /**\n   * Callback to report when connection is lost. The callback has no parameters.\n   * @type {onDisconnect}\n   */\n  onDisconnect = undefined;\n\n  /**\n   * @callback onLogin\n   * @param {number} code - NUmeric completion code, same as HTTP status codes.\n   * @param {string} text - Explanation of the completion code.\n   */\n  /**\n   * Callback to report login completion.\n   * @type {onLogin}\n   */\n  onLogin = undefined;\n\n  /**\n   * Callback to receive <code>{ctrl}</code> (control) messages.\n   * @type {onCtrlMessage}\n   */\n  onCtrlMessage = undefined;\n\n  /**\n   * Callback to recieve <code>{data}</code> (content) messages.\n   * @type {onDataMessage}\n   */\n  onDataMessage = undefined;\n\n  /**\n   * Callback to receive <code>{pres}</code> (presence) messages.\n   * @type {onPresMessage}\n   */\n  onPresMessage = undefined;\n\n  /**\n   * Callback to receive all messages as objects.\n   * @type {onMessage}\n   */\n  onMessage = undefined;\n\n  /**\n   * Callback to receive all messages as unparsed text.\n   * @type {onRawMessage}\n   */\n  onRawMessage = undefined;\n\n  /**\n   * Callback to receive server responses to network probes. See {@link Tinode#networkProbe}\n   * @type {onNetworkProbe}\n   */\n  onNetworkProbe = undefined;\n\n  /**\n   * Callback to be notified when exponential backoff is iterating.\n   * @type {onAutoreconnectIteration}\n   */\n  onAutoreconnectIteration = undefined;\n};\n\n// Exported constants\nTinode.MESSAGE_STATUS_NONE = Const.MESSAGE_STATUS_NONE;\nTinode.MESSAGE_STATUS_QUEUED = Const.MESSAGE_STATUS_QUEUED;\nTinode.MESSAGE_STATUS_SENDING = Const.MESSAGE_STATUS_SENDING;\nTinode.MESSAGE_STATUS_FAILED = Const.MESSAGE_STATUS_FAILED;\nTinode.MESSAGE_STATUS_FATAL = Const.MESSAGE_STATUS_FATAL;\nTinode.MESSAGE_STATUS_SENT = Const.MESSAGE_STATUS_SENT;\nTinode.MESSAGE_STATUS_RECEIVED = Const.MESSAGE_STATUS_RECEIVED;\nTinode.MESSAGE_STATUS_READ = Const.MESSAGE_STATUS_READ;\nTinode.MESSAGE_STATUS_TO_ME = Const.MESSAGE_STATUS_TO_ME;\n\n// Unicode [del] symbol.\nTinode.DEL_CHAR = Const.DEL_CHAR;\n\n// Names of keys to server-provided configuration limits.\nTinode.MAX_MESSAGE_SIZE = Const.MAX_MESSAGE_SIZE;\nTinode.MAX_SUBSCRIBER_COUNT = Const.MAX_SUBSCRIBER_COUNT;\nTinode.MIN_TAG_LENGTH = Const.MIN_TAG_LENGTH;\nTinode.MAX_TAG_LENGTH = Const.MAX_TAG_LENGTH;\nTinode.MAX_TAG_COUNT = Const.MAX_TAG_COUNT;\nTinode.MAX_FILE_UPLOAD_SIZE = Const.MAX_FILE_UPLOAD_SIZE;\nTinode.REQ_CRED_VALIDATORS = Const.REQ_CRED_VALIDATORS;\nTinode.MSG_DELETE_AGE = Const.MSG_DELETE_AGE;\nTinode.REACTION_LIST = Const.REACTION_LIST;\nTinode.MAX_REACTIONS = Const.MAX_REACTIONS;\n\n// Tinode URI topic ID prefix, 'scheme:path/'.\nTinode.URI_TOPIC_ID_PREFIX = 'tinode:topic/';\nTinode.URI_TOPIC_ALIAS_PREFIX = 'tinode:alias/';\n\n// Tag prefixes for alias, email, phone.\nTinode.TAG_ALIAS = Const.TAG_ALIAS;\nTinode.TAG_EMAIL = Const.TAG_EMAIL;\nTinode.TAG_PHONE = Const.TAG_PHONE;\n"],"names":["AccessMode","constructor","acs","given","decode","want","mode","checkFlag","#checkFlag","val","side","flag","includes","Error","str","_BITMASK","_NONE","bitmask","_JOIN","_READ","_WRITE","_PRES","_APPROVE","_SHARE","_DELETE","_OWNER","m0","i","length","bit","charAt","toUpperCase","encode","_INVALID","res","update","upd","action","val0","parts","split","diff","a1","a2","toString","jsonHelper","setMode","m","updateMode","u","getMode","setGiven","g","updateGiven","getGiven","setWant","w","updateWant","getWant","getMissing","getExcessive","updateAll","isOwner","isPresencer","isMuted","isJoiner","isReader","isWriter","isApprover","isAdmin","isSharer","isDeleter","CBuffer","comparator","undefined","unique","buffer","compare_","unique_","a","b","findNearest","#findNearest","elem","arr","exact","start","end","pivot","found","idx","insertSorted","#insertSorted","count","splice","getAt","at","getLast","filter","findLast","put","insert","arguments","Array","isArray","delAt","r","delRange","since","before","reset","forEach","callback","startIdx","beforeIdx","context","Math","max","min","call","find","nearest","isEmpty","CommError","message","code","name","PACKAGE_VERSION","PROTOCOL_VERSION","VERSION","LIBRARY","TOPIC_NEW","TOPIC_NEW_CHAN","TOPIC_ME","TOPIC_FND","TOPIC_SYS","TOPIC_SLF","TOPIC_CHAN","TOPIC_GRP","TOPIC_P2P","USER_NEW","LOCAL_SEQID","MESSAGE_STATUS_NONE","MESSAGE_STATUS_QUEUED","MESSAGE_STATUS_SENDING","MESSAGE_STATUS_FAILED","MESSAGE_STATUS_FATAL","MESSAGE_STATUS_SENT","MESSAGE_STATUS_RECEIVED","MESSAGE_STATUS_READ","MESSAGE_STATUS_TO_ME","EXPIRE_PROMISES_TIMEOUT","EXPIRE_PROMISES_PERIOD","RECV_TIMEOUT","DEFAULT_MESSAGES_PAGE","DEL_CHAR","MAX_PINNED_COUNT","TAG_ALIAS","TAG_EMAIL","TAG_PHONE","BACKOFF_BASE","BACKOFF_MAX_ITER","BACKOFF_JITTER","MAX_MESSAGE_SIZE","MAX_SUBSCRIBER_COUNT","MIN_TAG_LENGTH","MAX_TAG_LENGTH","MAX_TAG_COUNT","MAX_FILE_UPLOAD_SIZE","REQ_CRED_VALIDATORS","MSG_DELETE_AGE","REACTION_LIST","MAX_REACTIONS","jsonParseHelper","WebSocketProvider","XHRProvider","NETWORK_ERROR","NETWORK_ERROR_TEXT","NETWORK_USER","NETWORK_USER_TEXT","makeBaseUrl","host","protocol","version","apiKey","url","Connection","log","_","boffTimer","boffIteration","boffClosed","socket","secure","autoreconnect","initialized","config","version_","autoreconnect_","transport","init_lp","init_ws","setNetworkProviders","wsProvider","xhrProvider","logger","l","connect","host_","force","Promise","reject","reconnect","disconnect","sendText","msg","isConnected","probe","backoffReset","boffReset","boffReconnect","#boffReconnect","clearTimeout","timeout","pow","random","onAutoreconnectIteration","setTimeout","prom","catch","boffStop","#boffStop","#boffReset","#init_lp","XDR_UNSENT","XDR_OPENED","XDR_HEADERS_RECEIVED","XDR_LOADING","XDR_DONE","_lpURL","_poller","_sender","lp_sender","url_","sender","onreadystatechange","evt","readyState","status","open","lp_poller","resolve","poller","promiseCompleted","pkt","JSON","parse","responseText","ctrl","params","sid","send","onOpen","onMessage","onDisconnect","text","abort","err","#init_ws","OPEN","close","conn","onerror","onopen","onclose","onmessage","data","DB_VERSION","DB_NAME","IDBProvider","DB","onError","db","disabled","mapObjects","#mapObjects","source","trx","transaction","event","target","error","objectStore","getAll","onsuccess","result","topic","initDatabase","req","onversionchange","onupgradeneeded","objectStoreNames","contains","createObjectStore","keyPath","dellog","indexNames","createIndex","deleteDatabase","onblocked","isReady","updTopic","oncomplete","get","serializeTopic","commit","markTopicAsDeleted","deleted","_deleted","remTopic","delete","IDBKeyRange","only","bound","Number","MAX_SAFE_INTEGER","mapTopics","deserializeTopic","src","updUser","uid","pub","public","remUser","mapUsers","getUser","user","updSubscription","topicName","sub","serializeSubscription","mapSubscriptions","addMessage","add","serializeMessage","updMessageStatus","seq","_status","updMessageReact","react","remMessages","from","to","range","readMessages","query","ranges","key","hi","low","msgs","concat","push","limit","openCursor","cursor","value","continue","addDelLog","delId","clear","readDelLog","entries","map","entry","maxDelId","index","topic_fields","#deserializeTopic","f","hasOwnProperty","tags","_tags","setAccessMode","read","unread","#serializeTopic","dst","getAccessMode","#serializeSubscription","fields","#serializeMessage","setDatabaseProvider","idbProvider","MAX_FORM_ELEMENTS","MAX_PREVIEW_ATTACHMENTS","MAX_PREVIEW_DATA_SIZE","DRAFTY_MIME_TYPE","DRAFTY_FR_MIME_TYPE","DRAFTY_FR_MIME_TYPE_LEGACY","ALLOWED_ENT_FIELDS","segmenter","Intl","Segmenter","INLINE_STYLES","FMT_WEIGHT","ENTITY_TYPES","dataName","pack","test","re","slice","FORMAT_TAGS","AU","html_tag","md_tag","isVoid","BN","BR","CO","DL","EM","EX","FM","HD","HL","HT","IM","LN","MN","RW","QQ","ST","TC","VC","VD","base64toObjectUrl","b64","contentType","bin","atob","buf","ArrayBuffer","Uint8Array","charCodeAt","URL","createObjectURL","Blob","type","base64toDataUrl","DECORATORS","props","href","id","act","ref","mime","Drafty","duration","size","tmpPreviewUrl","_tempPreview","previewUrl","downloadUrl","width","height","title","alt","fn","state","preview","premime","poster","preref","txt","fmt","ent","init","plainText","content","lines","entityMap","entityIndex","blx","line","spans","entities","tag","spannify","block","sort","toSpanTree","chunks","chunkify","drafty","draftify","extractEntities","entity","tp","offset","len","segments","segment","ele","toGraphemeValues","stringToGraphemes","s","correctAt","correctLen","isEmptyObject","append","first","second","insertImage","imageDesc","ex","refurl","bits","filename","urlPromise","_processing","then","insertVideo","videoDesc","urls","insertAudio","audioDesc","videoCall","audioOnly","aonly","updateVideoCall","Object","assign","quote","header","body","appendLineBreak","mention","appendLink","linkData","appendImage","appendAudio","attachFile","attachmentDesc","wrapInto","style","wrapAsForm","insertButton","actionType","actionValue","refUrl","indexOf","appendButton","attachJSON","appendTheCard","theCardData","UNSAFE_toHTML","doc","tree","draftyToTree","htmlFormatter","values","join","treeBottomUp","format","original","formatter","shorten","light","shortenTree","lightEntity","treeToDrafty","forwardedContent","rmMention","node","parent","treeTopDown","lTrim","replyContent","convMNnQQnBR","startsWith","children","attachmentsToEnd","forwarding","toPlainText","isPlainText","toMarkdown","mdFormatter","def","isValid","txt_type","hasAttachments","attachments","hasEntities","styles","sanitizeEntities","copyEntData","getDownloadUrl","entData","isFormResponseType","isProcessing","getPreviewUrl","getEntitySize","getEntityMimeType","tagName","attrValue","getContentType","mimeType","span","chunk","chld","re_start","re_end","exec","start_offset","lastIndexOf","end_offset","last","graphemes","spansToTree","flatten","child","addNode","n","att","subspans","inner","keymap","c","keys","newKey","transformer","stack","pop","tail","shortener","allow","lightCopy","trimStart","shift","match","extracted","el","startAt","plain","dc","obj","graphemeIndices","graphemeIndex","charIndex","indices","module","exports","Const","Topic","mergeToCache","TopicFnd","_contacts","callbacks","_processMetaSubs","subs","updateCount","getOwnPropertyNames","indexBy","onMetaSub","onSubsUpdated","publish","setMeta","getPrototypeOf","prototype","checkTagUniqueness","caller","subscribe","desc","getMeta","startMetaQuery","withTags","build","meta","t","contacts","cb","isUrlRelative","addURLParam","relUrl","window","location","origin","searchParams","substring","LargeFileHelper","tinode","_tinode","_version","_apiKey","_authToken","getAuthToken","xhr","uploadWithBaseUrl","baseUrl","avatarFor","onProgress","onSuccess","onFailure","base","endsWith","instance","setRequestHeader","token","toResolve","toReject","upload","onprogress","e","lengthComputable","loaded","total","onload","response","statusText","onabort","form","FormData","set","getNextUniqueId","_secure","_host","download","relativeUrl","mimetype","responseType","link","document","createElement","display","setAttribute","appendChild","click","removeChild","revokeObjectURL","reader","FileReader","readAsText","cancel","setNetworkProvider","mergeObj","TopicMe","onContactUpdate","_processMetaDesc","turnOff","_db","_updateCachedUser","_myUID","cont","online","seen","when","Date","_refreshContact","onMetaDesc","cacheRemTopic","recv","getTopic","_new","isP2PTopicName","_cachePutUser","_noForwarding","_processMetaCreds","creds","cr","_credentials","findIndex","meth","done","resp","onCredsUpdated","_routePres","pres","what","_resetSub","withDesc","cacheGetTopic","_updateReceived","withLaterOneSub","tgt","dacs","touched","ua","_attached","_processMetaReact","mrrid","id2","actor","withOneSub","dummy","onPres","delCredential","method","isCommType","getContact","isArchived","private","arch","getCredentials","pinTopic","pin","isCommTopicName","tpin","unshift","pinnedTopicRank","listToRanges","normalizeRanges","MetaGetBuilder","get_desc_ims","#get_desc_ims","updated","get_subs_ims","#get_subs_ims","isP2PType","_lastSubsUpdate","withData","withLaterData","_maxSeq","withDataRanges","withDataList","list","withEarlierData","_minSeq","ims","withLaterDesc","withSub","userOrTopic","opts","getType","withLaterSub","withCred","withAux","withDel","withLaterDel","_maxDel","extract","THE_CARD_MIME_TYPE","TheCard","imageUrl","imageMimeType","note","theCard","merge","that","stringify","setFn","card","trim","getFn","setNote","setPhoto","matches","photo","ext","extLower","toLowerCase","mimeMap","getPhotoUrl","getOrg","org","setPhone","phone","addOrSetComm","setEmail","email","setTinodeID","tinodeID","addPhone","addEmail","addTinodeID","clearPhone","clearComm","clearEmail","clearTinodeID","getComm","proto","comm","getEmails","getPhones","getFirstTinodeID","comms","exportVCard","vcard","surname","additional","prefix","suffix","bday","d","year","y","String","padStart","month","day","types","des","importVCard","vcardStr","rawLines","currentLine","commMap","Map","unescapeValue","replace","char","decodeQuotedPrintable","bytes","hex","parseInt","uint8Array","TextDecoder","fromCharCode","keyPart","valueParts","keyParams","isQuotedPrintable","some","param","processedValue","dateStr","noHyphens","yy","cleaned","isValidMonth","isValidDay","isValidYear","encoding","pKey","pValue","typeParams","flatMap","equalIndex","valuesPart","mapKey","has","Set","isFileSupported","setOnly","normalizeArray","created","trusted","_users","_queuedSeqId","_noEarlierMsgs","_mrrSeen","_recvNotificationTimer","_aux","_messageVersions","_messages","_delayedLeaveTimer","onData","onMeta","onInfo","onTagsUpdated","onAuxUpdated","onReact","onDeleteTopic","onAllMessagesReceived","topicType","isMeTopicName","isSelfTopicName","isGroupTopicName","isNewGroupTopicName","isChannelTopicName","isReplacementMsg","#isReplacementMsg","head","isSubscribed","getParams","setParams","_cacheDelSelf","_cachePutSelf","ts","me","getMeTopic","createMessage","noEcho","publishMessage","_sending","_failed","swapMessageId","_maybeUpdateMessageVersionsCache","_routeData","publishDraft","_getQueuedSeqId","getCurrentUserID","noecho","_cancelled","_fatal","leave","unsub","_gone","leaveDelayed","delay","getMessagesPage","gaps","newer","_loadMessages","msgHasMoreMessages","getPinnedMessages","pins","aux","remains","_processMetaTags","cred","_processMetaAux","subscriber","am","invite","archive","pinMessage","pinned","changed","emo","curr","msgMyReaction","reactions","vals","getServerParam","maxReactions","markReactionsSeen","delMessages","hard","tosend","del","rec","flushMessageRange","flushMessage","delMessagesAll","hardDel","_all","delMessagesList","delMessagesEdits","messageVersions","delTopic","delSubscription","_updateMyReadRecv","noteRecv","noteRead","noteKeyPress","noteRecording","payload","oldVal","doUpdate","userDesc","_cacheGetUser","p2pPeerDesc","subscribers","alias","origSeq","versions","messages","sinceId","beforeId","unused1","unused2","latest","latestMsgVersion","_origTs","_origSeq","findMessage","latestMessage","maxMsgSeq","minMsgSeq","maxClearId","messageCount","queuedMessages","msgReceiptCount","msgReadCount","msgRecvCount","msgReactions","users","hasUnseenReactions","maxSeq","gap","prev","p","expected","isNewMessage","seqId","fromId","untilId","newSeqId","numMessages","cancelSend","msgStatus","getDefaultAccess","defacs","isMeType","isSelfType","isChannelType","isGroupType","isMe","targetSeq","targetMsg","outgoing","webrtc","incoming","vc","maxReact","_routeInfo","_routeMeta","_processDelMessages","delseq","isTopicCached","info","subcnt","_handleReactionDiff","delta","reacts","existing","userIdx","emoIndex","oneReaction","_diff","seqIds","mr","reduce","_allMessagesReceived","_maxReact","cached","date","isNaN","isValidDate","getTime","rfc3339DateString","pad","sp","repeat","millis","getUTCMilliseconds","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","prop","console","warn","cache","newval","simplify","out","item","pos","ary","r1","r2","clipOutRange","clip","clipInRange","DBCache","WebSocket","XMLHttpRequest","IndexedDBProvider","indexedDB","initForNonBrowserApp","chars","btoa","global","input","output","charCode","bc","bs","detectTransport","b64EncodeUnicode","encodeURIComponent","toSolidBytes","p1","jsonBuildHelper","jsonLoggerHelper","getBrowserInfo","product","reactnative","priority","tmp","substr","tokens","m2","v","minor","Tinode","_appName","_browser","_platform","_hwos","_humanLanguage","_loggingEnabled","_trimLongStrings","_authenticated","_login","_inPacketCount","_messageId","floor","_serverInfo","_deviceToken","_pendingPromises","_expirePromises","_connection","_persist","_cache","onComplete","appName","platform","navigator","userAgent","language","dispatchMessage","connectionOpen","disconnected","promise","persist","cacheGet","attachCacheToTopic","cachePut","all","args","dateString","makePromise","#makePromise","execPromise","#execPromise","onOK","errorText","#send","#dispatchMessage","onRawMessage","onNetworkProbe","onCtrlMessage","onMetaMessage","onDataMessage","onPresMessage","onInfoMessage","#connectionOpen","setInterval","expires","hello","#disconnected","clearInterval","cacheMap","getUserAgent","#getUserAgent","initPacket","#initPacket","#cachePut","#cacheGet","cacheDel","#cacheDel","#cacheMap","func","#attachCacheToTopic","_cacheDelUser","loginSuccessful","#loginSuccessful","onLogin","credential","getVersion","getLibrary","isNullValue","isServerAssignedSeq","isValidTagValue","ALIAS_REGEX","tagSplit","splitAt","setUniqueTag","uniqueTag","clearTagPrefix","tagByPrefix","clearStorage","initStorage","networkProbe","isAuthenticated","authorizeURL","parsed","account","scheme","secret","login","acc","tmpscheme","tmpsecret","extra","createAccount","createAccountBasic","username","password","updateAccountBasic","onConnect","setDeviceToken","dt","sent","loginBasic","uname","loginToken","requestResetAuthSecret","now","setAuthToken","dft","oobNotification","xfrom","finally","modeGiven","modeWant","delCurrentUser","newGroupTopicName","isChan","getFndTopic","getLargeFileHelper","getCurrentLogin","getServerInfo","report","defaultValue","enableLogging","enabled","trimLongStrings","setHumanLanguage","hl","isTopicOnline","getTopicAccessMode","wantAkn","onWebsocketOpen","URI_TOPIC_ID_PREFIX","URI_TOPIC_ALIAS_PREFIX"],"ignoreList":[],"sourceRoot":""}