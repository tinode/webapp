{"version":3,"file":"src_widgets_video-preview_jsx.dev.js","mappings":"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","sources":["webpack://tinode-webapp/./src/widgets/video-preview.jsx"],"sourcesContent":["import React from 'react';\nimport { FormattedMessage, defineMessages, injectIntl } from 'react-intl';\nimport SendMessage from './send-message.jsx';\n\nimport { bytesToHumanSize } from '../lib/strformat.js';\n\nconst messages = defineMessages({\n  unrecognized_video_format: {\n    id: 'unrecognized_video_format',\n    defaultMessage: 'Format of this video is not recognized',\n    description: 'Error message when uploaded video is invalid',\n  }\n});\n\nclass VideoPreview extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.videoRef = React.createRef();\n\n    this.handleSendVideo = this.handleSendVideo.bind(this);\n    this.handleKeyDown = this.handleKeyDown.bind(this);\n  }\n\n  componentDidMount() {\n    document.addEventListener('keydown', this.handleKeyDown);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('keydown', this.handleKeyDown);\n  }\n\n  handleKeyDown(e) {\n    if (this.props.onSendMessage) {\n      return;\n    }\n\n    e.preventDefault();\n    if (e.key === 'Escape') {\n      this.props.onClose();\n    }\n  }\n\n  handleSendVideo(caption) {\n    this.props.onClose();\n    const params = {\n      width: this.videoRef.current.videoWidth,\n      height: this.videoRef.current.videoHeight,\n      duration: (this.videoRef.current.duration * 1000) | 0,\n      mime: this.props.content.mime,\n      name: this.props.content.filename\n    }\n\n    if (params.width == 0 || params.height == 0) {\n      this.props.onError(this.props.intl.formatMessage(messages.unrecognized_video_format), 'err');\n      return;\n    }\n\n    // Capture screen from a video.\n    const canvas = document.createElement('canvas');\n    canvas.width = params.width;\n    canvas.height = params.height;\n    const ctx = canvas.getContext('2d');\n    ctx.drawImage(this.videoRef.current, 0, 0, canvas.width, canvas.height);\n    ctx.canvas.toBlob(\n        preview => this.props.onSendMessage(caption, this.props.content.blob, preview, params),\n        'image/jpeg', 0.75\n    );\n  }\n\n  render() {\n    if (!this.props.content) {\n      return null;\n    }\n\n    const width = this.props.content.width || '-';\n    const height = this.props.content.height || '-';\n\n    const controlist = this.props.onSendMessage ? 'nodownload' : '';\n    const autoPlay = !this.props.onSendMessage;\n\n    return (\n      <div id=\"image-preview\">\n        <div id=\"preview-caption-panel\">\n          <span>{this.props.content.filename}</span>\n          <a href=\"#\" onClick={e => {e.preventDefault(); this.props.onClose();}}><i className=\"material-icons gray\">close</i></a>\n        </div>\n        <div id=\"image-preview-container\">\n          <video\n            className=\"image-preview\"\n            controls controlsList={controlist}\n            disablePictureInPicture ref={this.videoRef}\n            autoPlay={autoPlay}\n            src={this.props.tinode.authorizeURL(this.props.content.url)}\n            poster={this.props.content.preview}\n            alt={this.props.content.filename} />\n        </div>\n        {this.props.onSendMessage ?\n        <SendMessage\n          messagePrompt=\"add_image_caption\"\n          acceptBlank={true}\n          tinode={this.props.tinode}\n          reply={this.props.reply}\n          onCancelReply={this.props.onCancelReply}\n          onSendMessage={this.handleSendVideo}\n          onError={this.props.onError} />\n          :\n          <div id=\"image-preview-footer\">\n            <div>\n              <div><b><FormattedMessage id=\"label_file_name\" defaultMessage=\"File name:\"\n                description=\"Label for a file name\" /></b></div>\n              <div><span title={this.props.content.filename}>{this.props.content.filename}</span></div>\n            </div>\n            <div>\n              <div><b><FormattedMessage id=\"label_content_type\" defaultMessage=\"Content type:\"\n                description=\"Label for file content type (mime)\" /></b></div>\n              <div>{this.props.content.type}</div>\n            </div>\n            <div>\n              <div><b><FormattedMessage id=\"label_size\" defaultMessage=\"Size:\"\n                description=\"Label for file size\" /></b></div>\n              <div>{width} &times; {height} px; {bytesToHumanSize(this.props.content.size)}</div>\n            </div>\n          </div>}\n      </div>\n    );\n  }\n};\n\nexport default injectIntl(VideoPreview);\n"],"names":["React","FormattedMessage","defineMessages","injectIntl","SendMessage","bytesToHumanSize","messages","unrecognized_video_format","id","defaultMessage","VideoPreview","PureComponent","constructor","props","videoRef","createRef","handleSendVideo","bind","handleKeyDown","componentDidMount","document","addEventListener","componentWillUnmount","removeEventListener","e","onSendMessage","preventDefault","key","onClose","caption","params","width","current","videoWidth","height","videoHeight","duration","mime","content","name","filename","onError","intl","formatMessage","canvas","createElement","ctx","getContext","drawImage","toBlob","preview","blob","render","controlist","autoPlay","href","onClick","className","controls","controlsList","disablePictureInPicture","ref","src","tinode","authorizeURL","url","poster","alt","messagePrompt","acceptBlank","reply","onCancelReply","title","type","size"],"ignoreList":[],"sourceRoot":""}