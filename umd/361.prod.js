"use strict";(self.webpackChunktinode_webapp=self.webpackChunktinode_webapp||[]).push([[361],{1361:function(e,t,s){s.r(t),s.d(t,{default:function(){return R}});var a=s(1594),n=s.n(a),i=s(8181),l=s(4532),r=s(9418),o=s(635),c=s(1166),d=s(4152),p=s(1334),h=s(5874);const m=(0,i.defineMessages)({no_contacts:{id:"no_contacts",defaultMessage:[{type:0,value:"You have no contacts :-("}]},contacts_not_found_short:{id:"contacts_not_found_short",defaultMessage:[{type:0,value:"No contacts match '"},{type:1,value:"query"},{type:0,value:"'"}]}});class u extends n().Component{constructor(e){super(e),this.state={members:e.members,index:u.indexMembers(e.members),staticMembers:u.staticMembers(e.members,e.keepInitialMembers,e.requiredMember),contactFilter:"",noContactsMessage:e.intl.formatMessage(m.no_contacts),selectedContacts:u.selectedContacts(e.members)},this.handleContactSelected=this.handleContactSelected.bind(this),this.handleMemberRemoved=this.handleMemberRemoved.bind(this),this.handleContactFilter=this.handleContactFilter.bind(this),this.handleSubmit=this.handleSubmit.bind(this),this.handleCancel=this.handleCancel.bind(this)}static indexMembers(e){let t={};return e.forEach(e=>{t[e.user]={delta:0,present:!0}}),t}static staticMembers(e,t,s){let a=[];return e.forEach(e=>{(t||e.user==s)&&a.push(e.user)}),a}static selectedContacts(e){let t=[];return e.forEach(e=>{t.push(e.user)}),t}handleContactSelected(e,t){let s=this.state.index[e];if(s){if(s.present)return;s.delta+=1,s.present=!0}else s={delta:1,present:!0};let a=this.state.members.slice();a.push(this.props.contacts[t]);const n=u.selectedContacts(a),i=this.state.index;i[e]=s,this.setState({members:a,index:i,selectedContacts:n})}handleMemberRemoved(e,t){const s=this.state.index[e];if(!s||!s.present)return;s.present=!1,s.delta-=1;let a=this.state.members.slice();a.splice(t,1);const n=u.selectedContacts(a),i=this.state.index;i[e]=s,this.setState({members:a,index:i,selectedContacts:n})}handleContactFilter(e){const{formatMessage:t}=this.props.intl,s=e?t(m.contacts_not_found_short,{query:e}):t(m.no_contacts);this.setState({contactFilter:e,noContactsMessage:s})}static doContactFiltering(e,t){if(e){for(let s=0;s<t.length;s++)if(t[s].indexOf(e)>=0)return!0;return!1}return!0}handleSubmit(){const e=[],t=[],s=[];Object.keys(this.state.index).forEach(a=>{this.state.index[a].present&&e.push(a),this.state.index[a].delta>0?t.push(a):this.state.index[a].delta<0&&s.push(a)}),this.props.onSubmit(e,t,s)}handleCancel(){this.props.onCancel()}render(){return n().createElement("div",{id:"group-manager"},n().createElement("div",{className:"panel-form-row"},n().createElement("label",{className:"small"},n().createElement(i.FormattedMessage,{id:"title_group_members",defaultMessage:[{type:0,value:"Group Members"}]}))),n().createElement("div",{className:"panel-form-row"},n().createElement(h.A,{tinode:this.props.tinode,chips:this.state.members,staticMembers:this.state.staticMembers,prompt:"add members",filterFunc:this.handleContactFilter,onChipRemoved:this.handleMemberRemoved})),n().createElement("div",{className:"panel-form-row"},n().createElement("label",{className:"small"},n().createElement(i.FormattedMessage,{id:"title_all_contacts",defaultMessage:[{type:0,value:"All Contacts"}]}))),n().createElement(d.A,{tinode:this.props.tinode,contacts:this.props.contacts,myUserId:this.props.myUserId,topicSelected:this.state.selectedContacts,filter:this.state.contactFilter,filterFunc:u.doContactFiltering,emptyListMessage:this.state.noContactsMessage,showOnline:!1,showUnread:!1,onTopicSelected:this.handleContactSelected}),n().createElement("div",{id:"group-manager-buttons",className:"panel-form-row"},n().createElement("button",{className:"secondary",onClick:this.handleCancel},n().createElement(i.FormattedMessage,{id:"button_cancel",defaultMessage:[{type:0,value:"Cancel"}]})),n().createElement("button",{className:"primary",onClick:this.handleSubmit},n().createElement(i.FormattedMessage,{id:"button_ok",defaultMessage:[{type:0,value:"OK"}]}))))}}var g=(0,i.injectIntl)(u),v=s(3913),b=s(6235),f=s(9593),E=s.n(f),M=s(9027);class _ extends n().PureComponent{constructor(e){super(e),this.qrCodeRef=n().createRef()}componentDidMount(){new(E())(this.qrCodeRef.current,{text:this.props.uri,width:M.Tn,height:M.Tn})}render(){return n().createElement("div",{className:"panel-form-column"},n().createElement("br",null),n().createElement("div",{className:"qr-code",ref:this.qrCodeRef}),n().createElement("div",null,n().createElement("tt",null,this.props.uri)),n().createElement("div",{className:"dialog-buttons"},n().createElement("button",{className:"outline",onClick:this.props.onCancel},n().createElement(i.FormattedMessage,{id:"button_ok",defaultMessage:[{type:0,value:"OK"}]}))))}}var y=s(8089);const C=(0,i.defineMessages)({clear_messages:{id:"action_clear_messages",defaultMessage:[{type:0,value:"Clear Messages"}]},clear_messages_warning:{id:"clear_messages_warning",defaultMessage:[{type:0,value:"Are you sure you want to clear all messages? It cannot be undone."}]},delete_messages:{id:"action_delete_messages",defaultMessage:[{type:0,value:"Clear Messages for All"}]},delete_messages_warning:{id:"delete_messages_warning",defaultMessage:[{type:0,value:"Are you sure you want to delete all messages for everyone? It cannot be undone."}]},topic_delete:{id:"topic_delete",defaultMessage:[{type:0,value:"Delete Conversation"}]},topic_delete_warning:{id:"topic_delete_warning",defaultMessage:[{type:0,value:"Are you sure you want to delete this conversation? It cannot be undone."}]},leave_chat:{id:"action_leave_chat",defaultMessage:[{type:0,value:"Leave Conversation"}]},leave_chat_warning:{id:"leave_chat_warning",defaultMessage:[{type:0,value:"Are you sure you want to leave this conversation?"}]},block_contact:{id:"action_block_contact",defaultMessage:[{type:0,value:"Block Contact"}]},block_contact_warning:{id:"block_contact_warning",defaultMessage:[{type:0,value:"Are you sure you want to block this contact?"}]},report_chat:{id:"action_report_chat",defaultMessage:[{type:0,value:"Report Conversation"}]},report_chat_warning:{id:"report_chat_warning",defaultMessage:[{type:0,value:"Are you sure you want to block and report this conversation?"}]},other_user:{id:"label_other_user",defaultMessage:[{type:0,value:"Other"}]}});class N extends n().PureComponent{constructor(e){super(e),this.handleDeleteTopic=this.handleDeleteTopic.bind(this),this.handleDeleteMessages=this.handleDeleteMessages.bind(this),this.handleLeave=this.handleLeave.bind(this),this.handleBlock=this.handleBlock.bind(this),this.handleReport=this.handleReport.bind(this)}handleDeleteTopic(e){e.preventDefault();const{formatMessage:t}=this.props.intl;this.props.onShowAlert(t(C.topic_delete),t(C.topic_delete_warning),e=>this.props.onDeleteTopic(this.props.topic),null,!0,null)}handleDeleteMessages(e){e.preventDefault();const{formatMessage:t}=this.props.intl;this.props.onShowAlert(t(this.props.deleter?C.delete_messages:C.clear_messages),t(this.props.deleter?C.delete_messages_warning:C.clear_messages_warning),e=>this.props.onDeleteMessages(this.props.topic),null,!0,null)}handleLeave(e){e.preventDefault();const{formatMessage:t}=this.props.intl;this.props.onShowAlert(t(C.leave_chat),t(C.leave_chat_warning),e=>this.props.onLeaveTopic(this.props.topic),null,!0,null)}handleBlock(e){e.preventDefault();const{formatMessage:t}=this.props.intl;this.props.onShowAlert(t(C.block_contact),t(C.block_contact_warning),e=>this.props.onBlockTopic(this.props.topic),null,!0,null)}handleReport(e){e.preventDefault();const{formatMessage:t}=this.props.intl;this.props.onShowAlert(t(C.report_chat),t(C.report_chat_warning),e=>{this.props.onReportTopic(this.props.topic)},null,!0,null)}render(){const{formatMessage:e}=this.props.intl;return n().createElement("div",{className:"scrollable-panel"},n().createElement("div",{className:"panel-form-column"},this.props.channel?null:n().createElement("a",{href:"#",className:"flat-button",onClick:this.handleDeleteMessages},n().createElement("i",{className:"m-icon"},"delete_outline"),"  ",e(this.props.deleter?C.delete_messages:C.clear_messages)),this.props.owner?n().createElement("a",{href:"#",className:"danger flat-button",onClick:this.handleDeleteTopic},n().createElement("i",{className:"m-icon"},"delete"),"  ",e(C.topic_delete)):n().createElement("a",{href:"#",className:"danger flat-button",onClick:this.handleLeave},n().createElement("i",{className:"m-icon"},"exit_to_app"),"  ",e(C.leave_chat)),this.props.groupTopic?null:n().createElement("a",{href:"#",className:"danger flat-button",onClick:this.handleBlock},n().createElement("i",{className:"m-icon"},"block"),"  ",e(C.block_contact)),this.props.owner?null:n().createElement("a",{href:"#",className:"danger flat-button",onClick:this.handleReport},n().createElement("i",{className:"m-icon"},"report"),"  ",e(C.report_chat))),n().createElement("div",{className:"hr"}),n().createElement("div",{className:"panel-form-column"},this.props.groupTopic?n().createElement(n().Fragment,null,n().createElement("div",{className:"group"},n().createElement("label",null,n().createElement(i.FormattedMessage,{id:"label_your_permissions",defaultMessage:[{type:0,value:"Your permissions:"}]}))," ",n().createElement("tt",{className:"clickable",onClick:e=>{e.preventDefault(),this.props.onLaunchPermissionsEditor("want")}},this.props.access)),this.props.channel?null:n().createElement("div",{className:"group"},n().createElement("div",null,n().createElement("label",{className:"small"},n().createElement(i.FormattedMessage,{id:"label_default_access_mode",defaultMessage:[{type:0,value:"Default access mode:"}]}))),n().createElement("div",{className:"quoted"},n().createElement("div",null,"Auth: ",n().createElement("tt",{className:this.props.owner?"clickable":null,onClick:e=>{e.preventDefault(),this.props.owner&&this.props.onLaunchPermissionsEditor("auth")}},this.props.auth)),n().createElement("div",null,"Anon: ",n().createElement("tt",{className:this.props.owner?"clickable":null,onClick:e=>{e.preventDefault(),this.props.owner&&this.props.onLaunchPermissionsEditor("anon")}},this.props.anon))))):n().createElement("div",{className:"group"},n().createElement("div",null,n().createElement("label",{className:"small"},n().createElement(i.FormattedMessage,{id:"label_permissions",defaultMessage:[{type:0,value:"Permissions:"}]}))),n().createElement("div",{className:"quoted"},n().createElement("div",null,n().createElement(i.FormattedMessage,{id:"label_you",defaultMessage:[{type:0,value:"You:"}]})," ",n().createElement("tt",{className:"clickable",onClick:e=>{e.preventDefault(),this.props.onLaunchPermissionsEditor("want")}},this.props.access)),n().createElement("div",null,this.props.fullName?this.props.fullName:e(C.other_user),":  ",n().createElement("tt",{className:"clickable",onClick:e=>{e.preventDefault(),this.props.onLaunchPermissionsEditor("given")}},this.props.modeGiven2))))))}}var S=(0,i.injectIntl)(N);class w extends n().PureComponent{constructor(e){super(e);const t=e.react&&e.react.vals||[],s=e.react&&e.react.max||null;this.state={selectedReactions:[...t],maxPerMessage:s},this.handleReactionToggle=this.handleReactionToggle.bind(this),this.handleMaxChange=this.handleMaxChange.bind(this),this.handleSave=this.handleSave.bind(this)}handleMaxChange(e){const t=parseInt(e.target.value),s=this.state.selectedReactions.length||1;this.setState({maxPerMessage:t>=s?null:t})}handleReactionToggle(e){const t=[...this.state.selectedReactions],s=t.indexOf(e);if(s>=0)t.splice(s,1);else{if(!(t.length<this.props.maxReactions))return;t.push(e)}this.setState({selectedReactions:t})}handleSave(){let e=null;(this.state.selectedReactions.length>0||null!==this.state.maxPerMessage)&&(e={},this.state.selectedReactions.length>0&&(e.vals=this.state.selectedReactions),null!==this.state.maxPerMessage&&(e.max=this.state.maxPerMessage)),this.props.onUpdateReactions(e)}render(){const{availableReactions:e,maxReactions:t}=this.props,{selectedReactions:s,maxPerMessage:a}=this.state,l=this.props.react&&this.props.react.vals||[],r=this.props.react&&this.props.react.max||null,o=JSON.stringify(s)!==JSON.stringify(l)||a!==r,c=s.length||1,d=null===a?c:Math.min(a,c);return n().createElement("div",{id:"topic-reactions",className:"scrollable-panel"},n().createElement("div",{className:"panel-form-column"},n().createElement("div",{className:"group"},n().createElement("label",{className:"small",htmlFor:"max-per-message"},n().createElement(i.FormattedMessage,{id:"label_max_reactions_per_message",defaultMessage:[{type:0,value:"Maximum reaction types per message"}]}),null!==a&&n().createElement("span",null,": ",a)),n().createElement("p",{className:"small"},n().createElement(i.FormattedMessage,{id:"max_reactions_per_message_description",defaultMessage:[{type:0,value:"Limit how many different reaction types can be added to a single message."}]})),n().createElement("input",{type:"range",id:"max-per-message",min:"1",max:c,value:d,onChange:this.handleMaxChange,disabled:0===s.length})),n().createElement("div",{className:"group"},n().createElement("label",{className:"small"},n().createElement(i.FormattedMessage,{id:"label_reaction_settings",defaultMessage:[{type:0,value:"Selected reactions"}]}))),n().createElement("div",{className:"group"},n().createElement("div",{className:"selected-reactions-palette"},0===s.length?n().createElement("span",{className:"selected-reactions-empty"},n().createElement(i.FormattedMessage,{id:"no_reactions_selected",defaultMessage:[{type:0,value:"No reactions selected"}]})):s.map(e=>n().createElement("div",{key:e,onClick:()=>this.handleReactionToggle(e),className:"selected-reaction",title:`Click to remove ${e}`},e)))),n().createElement("div",{className:"group"},n().createElement("label",{className:"small"},n().createElement(i.FormattedMessage,{id:"label_available_reactions",defaultMessage:[{type:0,value:"Available reactions"}]})),n().createElement("div",{className:"available-reactions-grid"},e&&e.map(e=>{const a=s.includes(e),i=!a&&s.length>=t;return n().createElement("div",{key:e,onClick:()=>!i&&this.handleReactionToggle(e),className:`available-reaction${a?" selected":""}${i?" disabled":""}`},e)}))),n().createElement("div",{className:"dialog-buttons"},n().createElement("button",{className:"secondary",onClick:this.props.onCancel},n().createElement(i.FormattedMessage,{id:"button_cancel",defaultMessage:[{type:0,value:"Cancel"}]})),n().createElement("button",{className:"primary",onClick:this.handleSave,disabled:!o},n().createElement(i.FormattedMessage,{id:"button_save",defaultMessage:[{type:0,value:"Save"}]})))))}}var k=s(6110),T=s(8589);const D=(0,i.defineMessages)({info:{id:"panel_title_info",defaultMessage:[{type:0,value:"Info"}]},general:{id:"panel_title_general",defaultMessage:[{type:0,value:"General"}]},security:{id:"panel_title_security",defaultMessage:[{type:0,value:"Security"}]},members:{id:"panel_title_members",defaultMessage:[{type:0,value:"Members"}]},crop:{id:"panel_title_crop",defaultMessage:[{type:0,value:"Drag to Adjust"}]},perm_want:{id:"requested_permissions",defaultMessage:[{type:0,value:"Requested"}]},perm_given:{id:"granted_permissions",defaultMessage:[{type:0,value:"Granted"}]},perm_auth:{id:"permissions_authenticated",defaultMessage:[{type:0,value:"Authenticated"}]},perm_anon:{id:"permissions_anonymous",defaultMessage:[{type:0,value:"Anonymous"}]},perm_user:{id:"permissions_user",defaultMessage:[{type:0,value:"User's Permissions"}]},edit_permissions:{id:"menu_item_edit_permissions",defaultMessage:[{type:0,value:"Edit permissions"}]},qrcode:{id:"scan_qr_code",defaultMessage:[{type:0,value:"Scan QR Code"}]},reactions:{id:"panel_title_reactions",defaultMessage:[{type:0,value:"Reactions"}]},text_copied:{id:"text_copied",defaultMessage:[{type:0,value:"Copied to clipboard"}]},self_topic_name:{id:"self_topic_name",defaultMessage:[{type:0,value:"Saved messages"}]},self_topic_comment:{id:"self_topic_comment",defaultMessage:[{type:0,value:"Notes, messages, links, files saved for posterity"}]}});class x extends n().Component{constructor(e){super(e),this.state={topic:null,owner:!1,admin:!1,sharer:!1,deleter:!1,muted:!1,address:null,groupTopic:void 0,isSelf:!1,channel:void 0,fullName:void 0,description:void 0,avatar:null,private:null,selectedContact:null,access:null,modeGiven:null,modeWant:null,modeGiven2:null,modeWant2:null,auth:null,anon:null,contactList:[],trustedBadges:[],previousMetaDesc:void 0,previousSubsUpdated:void 0},this.propsUpdated=this.propsUpdated.bind(this),this.resetSubs=this.resetSubs.bind(this),this.resetDesc=this.resetDesc.bind(this),this.resetTags=this.resetTags.bind(this),this.onMetaDesc=this.onMetaDesc.bind(this),this.onSubsUpdated=this.onSubsUpdated.bind(this),this.handleImageChanged=this.handleImageChanged.bind(this),this.handleMuted=this.handleMuted.bind(this),this.handleUnarchive=this.handleUnarchive.bind(this),this.handlePermissionsChanged=this.handlePermissionsChanged.bind(this),this.handleLaunchPermissionsEditor=this.handleLaunchPermissionsEditor.bind(this),this.handleShowQRCode=this.handleShowQRCode.bind(this),this.handleCopyToClipboard=this.handleCopyToClipboard.bind(this),this.handleShare=this.handleShare.bind(this),this.handleShowAddMembers=this.handleShowAddMembers.bind(this),this.handleMemberUpdateRequest=this.handleMemberUpdateRequest.bind(this),this.handleMemberSelected=this.handleMemberSelected.bind(this),this.handleUpdateReactions=this.handleUpdateReactions.bind(this),this.handleContextMenu=this.handleContextMenu.bind(this),this.handleBackNavigate=this.handleBackNavigate.bind(this)}propsUpdated(e){const t=this.props.tinode.getTopic(e.topic);t&&(this.onMetaDesc!=t.onMetaDesc&&(this.previousMetaDesc=t.onMetaDesc,t.onMetaDesc=this.onMetaDesc,this.previousSubsUpdated=t.onSubsUpdated,t.onSubsUpdated=this.onSubsUpdated),this.state.topic!=e.topic&&(this.setState({topic:e.topic}),this.resetDesc(t,e),this.resetSubs(t,e),this.resetTags(t)))}componentDidMount(){this.propsUpdated(this.props)}componentDidUpdate(e){this.propsUpdated(e)}componentWillUnmount(){const e=this.props.tinode.getTopic(this.props.topic);e&&(this.setState({topic:null}),e.onMetaDesc=this.previousMetaDesc,e.onSubsUpdated=this.previousSubsUpdated)}resetSubs(e,t){const s={contactList:[]};if("p2p"==e.getType()){const a=e.subscriber(t.topic);a?(s.modeGiven2=a.acs.getGiven(),s.modeWant2=a.acs.getWant()):(s.modeGiven2=M.D3,s.modeWant2=M.D3)}else e.subscribers(e=>{s.contactList.push(e)},this);this.setState(s)}resetDesc(e,t){const s=e.getDefaultAccess()||{},a=e.getAccessMode(),n=[];if(e.trusted)for(const[t,s]of Object.entries(e.trusted))s&&n.push(t);const i=e.isSelfType();this.setState({owner:a&&a.isOwner(),admin:a&&a.isAdmin(),sharer:a&&a.isSharer(),deleter:a&&a.isDeleter(),muted:a&&a.isMuted(),fullName:i?t.intl.formatMessage(D.self_topic_name):(0,T.W5)(e.public&&e.public.fn,M.tS),description:i?t.intl.formatMessage(D.self_topic_comment):(0,T.W5)(e.public&&e.public.note,M.lQ),avatar:(0,k.to)(e.public?e.public.photo:null),trustedBadges:n,private:(0,T.W5)(e.private&&e.private.comment,M.tS),archived:e.isArchived(),address:e.name,groupTopic:e.isGroupType(),isSelf:i,channel:e.isChannelType()||e.chan,access:a?a.getMode():void 0,modeGiven:a?a.getGiven():void 0,modeWant:a?a.getWant():void 0,auth:s.auth,anon:s.anon})}resetTags(e){if("grp"!=e.getType())return;const t=e.getAccessMode();t&&t.isOwner()&&e.getMeta(e.startMetaQuery().withTags().build())}onMetaDesc(e){const t=this.props.tinode.getTopic(this.props.topic);t&&(this.resetDesc(t,this.props),this.previousMetaDesc&&this.previousMetaDesc!=this.onMetaDesc&&this.previousMetaDesc(e))}onSubsUpdated(e){const t=this.props.tinode.getTopic(this.props.topic);t&&(this.resetSubs(t,this.props),this.previousSubsUpdated&&this.previousSubsUpdated!=this.onSubsUpdated&&this.previousSubsUpdated(e))}handleImageChanged(e,t){this.setState({avatar:t}),this.props.onTopicDescUpdate(this.props.topic,new l.TheCard(null,t||l.Tinode.DEL_CHAR),null)}handleMuted(e,t){this.setState({muted:t}),this.props.onChangePermissions(this.props.topic,t?"-P":"+P")}handleUnarchive(e,t){this.props.onTopicUnArchive(this.props.topic)}handlePermissionsChanged(e,t){switch(e){case"auth":this.props.onTopicDescUpdateRequest(this.props.topic,null,null,{auth:t});break;case"anon":this.props.onTopicDescUpdateRequest(this.props.topic,null,null,{anon:t});break;case"mode":case"want":this.props.onChangePermissions(this.props.topic,t);break;case"given":this.props.onChangePermissions(this.props.topic,t,this.props.topic);break;case"user":this.props.onChangePermissions(this.props.topic,t,this.state.userPermissionsEdited)}this.handleBackNavigate()}handleLaunchPermissionsEditor(e,t){const{formatMessage:s}=this.props.intl;let a,n,i,r,o,c,d;switch(e){case"mode":a=this.state.access;break;case"want":a=this.state.modeWant,n=this.state.modeGiven,this.state.owner?i="O":(i=l.AccessMode.encode(l.AccessMode.diff("ASDO",this.state.modeGiven)),this.state.channel&&(i+="W")),r=s(D.perm_want),o=s(D.perm_given);break;case"given":a=this.state.modeGiven2,n=this.state.modeWant2,i=this.state.groupTopic?this.state.owner?"":"O":"ASDO",r=s(D.perm_given),o=s(D.perm_want);break;case"auth":a=this.state.auth,i="O";break;case"anon":a=this.state.anon,i="O";break;case"user":{const e=this.props.tinode.getTopic(this.props.topic);if(!e)return;const l=e.subscriber(t);if(!l||!l.acs)return;a=l.acs.getGiven(),n=l.acs.getWant(),i=this.state.owner?"":"O",r=s(D.perm_given),o=s(D.perm_want),l.public&&(c=l.public.fn,d=l.public.photo);break}default:return void console.error("Unknown permission editing mode '"+e+"'")}this.setState({userPermissionsEdited:t,userPermissionsTitle:c,userPermissionsAvatar:d,editedPermissions:a,immutablePermissions:n,editedPermissionsTitle:r,immutablePermissionsTitle:o,editedPermissionsSkipped:i}),this.props.onNavigate(`perm/${e}`)}handleShowQRCode(e){e.preventDefault(),this.props.onNavigate("qrcode")}handleCopyToClipboard(e,t){e.preventDefault(),navigator.clipboard.writeText(t).then(e=>{this.setState({toast:this.props.intl.formatMessage(D.text_copied)}),setTimeout(e=>{this.setState({toast:""})},M.bn)})}handleShare(e){e.preventDefault();const t=new l.TheCard(this.state.fullName,this.state.avatar,null,this.state.description);l.TheCard.setTinodeID(t,l.Tinode.URI_TOPIC_ID_PREFIX+this.props.topic),this.props.onShareTheCard(t)}handleShowAddMembers(e){e.preventDefault(),this.props.onInitFind(),this.props.onNavigate("members")}handleMemberUpdateRequest(e,t,s){this.props.onMemberUpdateRequest(this.props.topic,t,s),this.props.onNavigate("info")}handleMemberSelected(e){this.setState({selectedContact:e})}handleUpdateReactions(e){const t=this.props.tinode.getTopic(this.props.topic);t&&t.setMeta({aux:{react:e}}).then(()=>{this.props.onNavigate("info")}).catch(e=>{this.props.onError(e.message,"err")})}handleBackNavigate(){const e=(this.props.panel||"info").split("/");"info"==e[0]?this.props.onNavigate(null):"perm"==e[0]?"user"==e[1]?this.props.onNavigate("info"):this.props.onNavigate("security"):this.props.onNavigate("info")}handleContextMenu(e){const{formatMessage:t}=this.props.intl,s=this.props.tinode.getTopic(this.props.topic);if(!s)return;const a=s.subscriber(e.topicName);if(!a||!a.acs)return;const n=this.props.tinode.isMe(e.topicName),i=[{title:t(D.edit_permissions),handler:t=>this.handleLaunchPermissionsEditor(n?"want":"user",e.topicName)}];n||i.push("member_delete"),i.push(a.acs.isMuted()?"member_unmute":"member_mute"),n||i.push(a.acs.isJoiner()?"member_block":"member_unblock"),this.props.showContextMenu({topicName:this.props.topic,x:e.x,y:e.y,user:e.topicName},i)}render(){const e=(this.props.panel||"info").split("/"),t=e[0];e.shift();const{formatMessage:s}=this.props.intl,a=s(("perm"==t?D["perm_"+e[0]]:D[t])||D.info),h=this.props.tinode.getTopic(this.state.topic),m=h&&h.alias(),u=this.props.tinode.getServerParam("reactions");return n().createElement("div",{id:"info-view"},n().createElement("div",{className:"toast"+(this.state.toast?" show":"")},this.state.toast),n().createElement("div",{className:"caption-panel",id:"info-caption-panel"},n().createElement("div",{className:"panel-title",id:"info-title"},a),n().createElement("div",null,n().createElement(v.A,{onCancel:this.handleBackNavigate}))),this.props.displayMobile?n().createElement(p.A,{level:this.props.errorLevel,text:this.props.errorText,onClearError:this.props.onError}):null,"members"==t?n().createElement(g,{tinode:this.props.tinode,members:this.state.contactList,requiredMember:this.props.myUserId,keepInitialMembers:!this.state.admin&&!this.state.owner,myUserId:this.props.myUserId,contacts:this.props.searchableContacts,onCancel:this.handleBackNavigate,onSubmit:this.handleMemberUpdateRequest}):"perm"==t&&e.length>0?n().createElement(b.A,{tinode:this.props.tinode,mode:this.state.editedPermissions,compare:this.state.immutablePermissions,skip:this.state.editedPermissionsSkipped,modeTitle:this.state.editedPermissionsTitle,compareTitle:this.state.immutablePermissionsTitle,userTitle:this.state.userPermissionsTitle,item:this.state.userPermissionsEdited,userAvatar:this.state.userPermissionsAvatar,onSubmit:t=>this.handlePermissionsChanged(e[0],t),onCancel:this.handleBackNavigate}):"general"==t?n().createElement(y.A,{tinode:this.props.tinode,topic:this.props.topic,reqCredMethod:this.props.reqCredMethod,onCredAdd:this.props.onCredAdd,onUpdateTagsRequest:this.props.onTopicTagsUpdateRequest,onCredConfirm:this.props.onCredConfirm,onCredDelete:this.props.onCredDelete,onUpdateTopicDesc:this.props.onTopicDescUpdateRequest,onError:this.props.onError}):"security"==t?n().createElement(S,{topic:this.props.topic,owner:this.state.owner,admin:this.state.admin,sharer:this.state.sharer,deleter:this.state.deleter,muted:this.state.muted,groupTopic:this.state.groupTopic,channel:this.state.channel,access:this.state.access,modeGiven:this.state.modeGiven,modeWant:this.state.modeWant,modeGiven2:this.state.modeGiven2,modeWant2:this.state.modeWant2,auth:this.state.auth,anon:this.state.anon,onShowAlert:this.props.onShowAlert,onDeleteMessages:this.props.onDeleteMessages,onLeaveTopic:this.props.onLeaveTopic,onBlockTopic:this.props.onBlockTopic,onReportTopic:this.props.onReportTopic,onLaunchPermissionsEditor:this.handleLaunchPermissionsEditor,onNavigate:this.props.onNavigate}):"qrcode"==t?n().createElement(_,{uri:l.Tinode.URI_TOPIC_ID_PREFIX+this.props.topic,onCancel:this.handleBackNavigate}):"reactions"==t?n().createElement(w,{react:h?h.aux("react"):null,availableReactions:u,maxReactions:this.props.tinode.getServerParam("maxReactions"),onUpdateReactions:this.handleUpdateReactions,onCancel:this.handleBackNavigate}):n().createElement("div",{id:"info-view-content",className:"scrollable-panel"},n().createElement("div",{className:"panel-form-column"},this.state.isSelf?null:n().createElement("a",{href:"#",className:"flat-button float-right",onClick:e=>{e.preventDefault(),this.props.onNavigate("general")}},n().createElement("i",{className:"m-icon"},"edit")," ",n().createElement(i.FormattedMessage,{id:"button_edit",defaultMessage:[{type:0,value:"Edit"}]})),n().createElement("center",null,n().createElement(r.A,{tinode:this.props.tinode,avatar:this.state.avatar,readOnly:!0,uid:this.props.topic,title:this.state.fullName})),n().createElement("div",{className:"group"},n().createElement("div",null,n().createElement("label",{className:"small"},n().createElement(i.FormattedMessage,{id:"label_topic_name",defaultMessage:[{type:0,value:"Name"}]}))),n().createElement("div",{className:"large ellipsized"},this.state.fullName," ",this.state.channel?n().createElement("i",{className:"m-icon"},"podcasts"):null)),this.state.private?n().createElement("div",{className:"group"},n().createElement("div",null,n().createElement("label",{className:"small"},n().createElement(i.FormattedMessage,{id:"label_private",defaultMessage:[{type:0,value:"Private comment"}]}))),n().createElement("div",{className:"large ellipsized"},this.state.private)):null,this.state.isSelf?null:n().createElement(n().Fragment,null,n().createElement("div",{className:"panel-form-row"},n().createElement("div",null,n().createElement("label",{className:"small"},n().createElement(i.FormattedMessage,{id:"label_user_id",defaultMessage:[{type:0,value:"ID:"}]}))," ",n().createElement("tt",null,this.state.address)),n().createElement("div",{style:{marginLeft:"auto"}}," ",n().createElement("a",{href:"#",onClick:e=>{this.handleCopyToClipboard(e,this.state.address)}},n().createElement("i",{className:"m-icon"},"content_copy")),"   ",n().createElement("a",{href:"#",onClick:this.handleShowQRCode},n().createElement("i",{className:"m-icon"},"qr_code")),"   ",n().createElement("a",{href:"#",onClick:this.handleShare},n().createElement("i",{className:"material-icons"},"share"))," ")),m?n().createElement("div",{className:"panel-form-row"},n().createElement("div",null,n().createElement("label",{className:"small"},n().createElement(i.FormattedMessage,{id:"label_alias",defaultMessage:[{type:0,value:"Alias:"}]}))," ",n().createElement("tt",null,m)),n().createElement("div",{style:{marginLeft:"auto"}}," ",n().createElement("a",{href:"#",onClick:e=>{this.handleCopyToClipboard(e,m)}},n().createElement("i",{className:"m-icon"},"content_copy")),"   ",n().createElement("i",{className:"m-icon",style:{opacity:0}},"qr_code")," ")):null),this.state.trustedBadges.length>0?n().createElement("div",{className:"group"},n().createElement(o.A,{trustedBadges:this.state.trustedBadges})):null,this.state.groupTopic&&h.subcnt>0?n().createElement("div",{className:"group"},n().createElement("label",{className:"small"},this.state.channel?n().createElement(i.FormattedMessage,{id:"label_subscriber_count",defaultMessage:[{type:0,value:"Subscribers:"}]}):n().createElement(i.FormattedMessage,{id:"label_member_count",defaultMessage:[{type:0,value:"Members:"}]}))," ",n().createElement(i.FormattedNumber,{value:h.subcnt})):null,this.state.description?n().createElement("div",{className:"group"},n().createElement("label",{className:"small"},n().createElement(i.FormattedMessage,{id:"label_description",defaultMessage:[{type:0,value:"Description"}]})),n().createElement("div",null,this.state.description)):null),this.state.isSelf?null:n().createElement(n().Fragment,null,n().createElement("div",{className:"hr"}),n().createElement("div",{className:"panel-form-row"},n().createElement("label",null,n().createElement(i.FormattedMessage,{id:"label_muting_topic",defaultMessage:[{type:0,value:"Muted:"}]})),n().createElement(c.A,{name:"P",checked:this.state.muted,onChange:this.handleMuted}))),this.state.archived?n().createElement("div",{className:"panel-form-row"},n().createElement("label",null,n().createElement(i.FormattedMessage,{id:"label_unarchive_topic",defaultMessage:[{type:0,value:"Archived:"}]})),n().createElement(c.A,{name:"archived",checked:!0,onChange:this.handleUnarchive})):null,this.state.isSelf?null:n().createElement(n().Fragment,null,n().createElement("div",{className:"hr"}),this.state.groupTopic&&this.state.admin&&u?n().createElement("div",{className:"panel-form-row"},n().createElement("a",{href:"#",className:"flat-button",onClick:e=>{e.preventDefault(),this.props.onNavigate("reactions")}},n().createElement("i",{className:"m-icon"},"thumb_up_off_alt")," ",n().createElement(i.FormattedMessage,{id:"button_reactions",defaultMessage:[{type:0,value:"Reactions"}]}))):null,n().createElement("div",{className:"panel-form-row"},n().createElement("a",{href:"#",className:"flat-button",onClick:e=>{e.preventDefault(),this.props.onNavigate("security")}},n().createElement("i",{className:"m-icon"},"security")," ",n().createElement(i.FormattedMessage,{id:"button_security",defaultMessage:[{type:0,value:"Security"}]})))),this.state.groupTopic&&this.state.sharer?n().createElement(n().Fragment,null,n().createElement("div",{className:"hr"}),n().createElement("div",{className:"panel-form-row"},n().createElement("label",{className:"small"},n().createElement(i.FormattedMessage,{id:"label_group_members",defaultMessage:[{type:0,value:"Group members:"}]}))),n().createElement("div",{className:"panel-form-row"},n().createElement("a",{href:"#",className:"flat-button",onClick:this.handleShowAddMembers},n().createElement("i",{className:"m-icon"},"person_add"),"  ",n().createElement(i.FormattedMessage,{id:"button_add_members",defaultMessage:[{type:0,value:"Add members"}]}))),n().createElement(i.FormattedMessage,{id:"group_has_no_members",defaultMessage:[{type:0,value:"No members"}]},e=>n().createElement(d.A,{tinode:this.props.tinode,contacts:this.state.contactList,myUserId:this.props.myUserId,emptyListMessage:e,topicSelected:this.state.selectedContact,showOnline:!1,showUnread:!1,showMode:!0,noScroll:!0,onTopicSelected:this.handleMemberSelected,showContextMenu:!!this.state.admin&&this.handleContextMenu}))):null))}}var R=(0,i.injectIntl)(x)},6235:function(e,t,s){var a=s(1594),n=s.n(a),i=s(8181),l=s(1166),r=s(4881),o=s(6110);const c=(0,i.defineMessages)({joiner:{id:"permission_join",defaultMessage:[{type:0,value:"Join ("},{type:1,value:"val"},{type:0,value:")"}]},reader:{id:"permission_read",defaultMessage:[{type:0,value:"Read ("},{type:1,value:"val"},{type:0,value:")"}]},writer:{id:"permission_write",defaultMessage:[{type:0,value:"Write ("},{type:1,value:"val"},{type:0,value:")"}]},preser:{id:"permission_pres",defaultMessage:[{type:0,value:"Get notified ("},{type:1,value:"val"},{type:0,value:")"}]},approver:{id:"permission_admin",defaultMessage:[{type:0,value:"Approve ("},{type:1,value:"val"},{type:0,value:")"}]},sharer:{id:"permission_share",defaultMessage:[{type:0,value:"Share ("},{type:1,value:"val"},{type:0,value:")"}]},deleter:{id:"permission_delete",defaultMessage:[{type:0,value:"Delete ("},{type:1,value:"val"},{type:0,value:")"}]},owner:{id:"permission_owner",defaultMessage:[{type:0,value:"Owner ("},{type:1,value:"val"},{type:0,value:")"}]}});class d extends n().Component{constructor(e){super(e),this.state={mode:(e.mode||"").replace("N","")},this.handleChange=this.handleChange.bind(this),this.handleSubmit=this.handleSubmit.bind(this),this.handleCancel=this.handleCancel.bind(this)}handleChange(e){let t=this.state.mode;-1==t.indexOf(e)?t+=e:t=t.replace(e,""),this.setState({mode:t})}handleSubmit(){const e=(this.state.mode||"N").split("").sort().join("");e!==(this.props.mode||"N").split("").sort().join("")?this.props.onSubmit(e):this.props.onCancel()}handleCancel(){this.props.onCancel()}render(){const{formatMessage:e}=this.props.intl,t="JRWPASDO",s={J:e(c.joiner,{val:"J"}),R:e(c.reader,{val:"R"}),W:e(c.writer,{val:"W"}),P:e(c.preser,{val:"P"}),A:e(c.approver,{val:"A"}),S:e(c.sharer,{val:"S"}),D:e(c.deleter,{val:"D"}),O:e(c.owner,{val:"O"})};let a=this.props.skip||"",d=this.state.mode,p=(this.props.compare||"").replace("N",""),h=[];for(let e=0;e<8;e++){let i=t.charAt(e);a.indexOf(i)>=0&&d.indexOf(i)<0||h.push(n().createElement("tr",{key:i},n().createElement("td",null,s[i]),n().createElement("td",{className:"checkbox"},a.indexOf(i)<0?n().createElement(l.A,{name:i,checked:d.indexOf(i)>=0,onChange:this.handleChange}):n().createElement(l.A,{name:i,checked:d.indexOf(i)>=0})),this.props.compare?n().createElement("td",{className:"checkbox"},n().createElement(l.A,{name:i,checked:p.indexOf(i)>=0})):null))}return n().createElement("div",{className:"panel-form-column"},this.props.userTitle?n().createElement("ul",{className:"contact-box small"},n().createElement(r.A,{tinode:this.props.tinode,item:this.props.item,title:this.props.userTitle,small:!0,avatar:(0,o.to)(this.props.userAvatar?this.props.userAvatar:null)})):null,n().createElement("label",{className:"small"},n().createElement(i.FormattedMessage,{id:"title_permissions",defaultMessage:[{type:0,value:"Permissions"}]})),n().createElement("table",{className:"permission-editor"},this.props.compare?n().createElement("thead",null,n().createElement("tr",null,n().createElement("th",null),n().createElement("th",null,this.props.modeTitle),n().createElement("th",null,this.props.compareTitle))):null,n().createElement("tbody",null,h)),n().createElement("br",null),n().createElement("div",{className:"dialog-buttons"},n().createElement("button",{className:"outline",onClick:this.handleCancel},n().createElement(i.FormattedMessage,{id:"button_cancel",defaultMessage:[{type:0,value:"Cancel"}]})),n().createElement("button",{className:"primary",onClick:this.handleSubmit},n().createElement(i.FormattedMessage,{id:"button_ok",defaultMessage:[{type:0,value:"OK"}]}))))}}t.A=(0,i.injectIntl)(d)}}]);
//# sourceMappingURL=361.prod.js.map