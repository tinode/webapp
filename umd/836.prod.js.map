{"version":3,"file":"836.prod.js","mappings":"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","sources":["webpack://tinode-webapp/./src/widgets/call-panel.jsx"],"sourcesContent":["// CallPanel displays call in progress: local and remote viewports and controls.\nimport React from 'react';\nimport { FormattedMessage, defineMessages, injectIntl } from 'react-intl';\n\nimport LetterTile from './letter-tile.jsx';\n\nimport { MAX_PEER_TITLE_LENGTH } from '../config.js';\nimport { CALL_STATE_OUTGOING_INITATED, CALL_STATE_IN_PROGRESS } from '../constants.js';\nimport { truncateString } from '../lib/strformat.js';\n\nconst RING_SOUND = new Audio('audio/call-out.m4a');\nRING_SOUND.loop = true;\nconst CALL_ENDED_SOUND = new Audio('audio/call-end.m4a');\nCALL_ENDED_SOUND.loop = true;\nconst DIALING_SOUND = new Audio('audio/dialing.m4a');\n\nconst VIDEO_MUTED_EVENT = 'video:muted';\nconst VIDEO_UNMUTED_EVENT = 'video:unmuted';\n\nconst messages = defineMessages({\n  already_in_call: {\n    id: 'already_in_call',\n    defaultMessage: 'You already in an ongoing call!',\n    description: 'Error message when the user tried to accept a new call without finishing pervious one',\n  }\n});\n\nclass CallPanel extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      localStream: undefined,\n      remoteStream: undefined,\n      pc: undefined,\n      dataChannel: undefined,\n\n      previousOnInfo: undefined,\n      waitingForPeer: false,\n      // If true, the client has received a remote SDP from the peer and has sent a local SDP to the peer.\n      callInitialSetupComplete: false,\n      audioOnly: props.callAudioOnly,\n      // Video mute/unmute in progress.\n      videoToggleInProgress: false,\n      // Indicates if the remote peer has informed us that their camera is on.\n      remoteVideoLive: false,\n    };\n\n    this.localStreamConstraints = {\n      audio: true,\n      video: !props.callAudioOnly\n    };\n    this.isOutgoingCall = props.callState == CALL_STATE_OUTGOING_INITATED;\n\n    this.containerRef = React.createRef();\n    this.localRef = React.createRef();\n    this.remoteRef = React.createRef();\n\n    // Cache for remote ice candidates until initial setup gets completed.\n    this.remoteIceCandidatesCache = [];\n\n    this.onInfo = this.onInfo.bind(this);\n    this.start = this.start.bind(this);\n    this.stop = this.stop.bind(this);\n\n    this.createPeerConnection = this.createPeerConnection.bind(this);\n    this.canSendOffer = this.canSendOffer.bind(this);\n    this.drainRemoteIceCandidatesCache = this.drainRemoteIceCandidatesCache.bind(this);\n\n    this.handleNegotiationNeededEvent = this.handleNegotiationNeededEvent.bind(this);\n    this.handleICECandidateEvent = this.handleICECandidateEvent.bind(this);\n    this.handleNewICECandidateMsg = this.handleNewICECandidateMsg.bind(this);\n    this.handleICEConnectionStateChangeEvent = this.handleICEConnectionStateChangeEvent.bind(this);\n    this.handleSignalingStateChangeEvent = this.handleSignalingStateChangeEvent.bind(this);\n    this.handleICEGatheringStateChangeEvent = this.handleICEGatheringStateChangeEvent.bind(this);\n    this.handleIceCandidateErrorEvent = this.handleIceCandidateErrorEvent.bind(this);\n    this.handleTrackEvent = this.handleTrackEvent.bind(this);\n\n    this.handleVideoOfferMsg = this.handleVideoOfferMsg.bind(this);\n    this.handleVideoAnswerMsg = this.handleVideoAnswerMsg.bind(this);\n    this.handleNewICECandidateMsg = this.handleNewICECandidateMsg.bind(this);\n\n    this.reportError = this.reportError.bind(this);\n    this.handleGetUserMediaError = this.handleGetUserMediaError.bind(this);\n\n    this.stopTracks = this.stopTracks.bind(this);\n    this.disconnectMedia = this.disconnectMedia.bind(this);\n\n    this.handleCloseClick = this.handleCloseClick.bind(this);\n    this.handleToggleCameraClick = this.handleToggleCameraClick.bind(this);\n    this.handleToggleMicClick = this.handleToggleMicClick.bind(this);\n\n    this.handleRemoteHangup = this.handleRemoteHangup.bind(this);\n    this.handleVideoCallAccepted = this.handleVideoCallAccepted.bind(this);\n\n    this.muteVideo = this.muteVideo.bind(this);\n    this.unmuteVideo = this.unmuteVideo.bind(this);\n    this.emptyVideoTrack = this.emptyVideoTrack.bind(this);\n\n    this.handleDataChannelEvent = this.handleDataChannelEvent.bind(this);\n    this.handleDataChannelError = this.handleDataChannelError.bind(this);\n    this.handleDataChannelMessage = this.handleDataChannelMessage.bind(this);\n    this.handleDataChannelOpen = this.handleDataChannelOpen.bind(this);\n    this.handleDataChannelClose = this.handleDataChannelClose.bind(this);\n\n    this.bounds = {};\n\n    this.dragStart = (event) => {\n      if (!event.target.classList.contains('draggable')) {\n        // Prevent dragging when clicking on buttons or other non-draggable elements.\n        return;\n      }\n      if (window.matchMedia('(width<=640px)')) {\n        // No dragging on small screens.\n        return;\n      }\n      if (this.props.minimized && this.containerRef) {\n        event.stopPropagation();\n        this.containerRef.current.setPointerCapture(event.pointerId);\n        this.containerRef.current.style.cursor = 'grabbing';\n        this.bounds.left = this.containerRef.current.offsetLeft;\n        this.bounds.top = this.containerRef.current.offsetTop;\n        this.bounds.width = this.containerRef.current.offsetWidth;\n        this.bounds.height = this.containerRef.current.offsetHeight;\n\n        const parent = this.containerRef.current.offsetParent;\n        this.bounds.maxX = parent.offsetWidth;\n        this.bounds.maxY = parent.offsetHeight;\n      }\n    };\n    this.drag = (event) => {\n      event.stopPropagation();\n      const el = this.containerRef.current;\n      if (this.props.minimized && this.containerRef && el.hasPointerCapture(event.pointerId)) {\n        // Calculate new position. Restrict to the visible area of the parent element.\n        this.bounds.left = Math.min(Math.max(this.bounds.left + event.movementX, 0),\n          this.bounds.maxX - this.bounds.width);\n        this.bounds.top = Math.min(Math.max(this.bounds.top + event.movementY, 0),\n          this.bounds.maxY - this.bounds.height);\n\n        el.style.left = `${this.bounds.left}px`;\n        el.style.top = `${this.bounds.top}px`;\n      }\n    };\n    this.dragEnd = (event) => {\n      event.stopPropagation();\n      if (this.props.minimized && this.containerRef) {\n        this.containerRef.current.releasePointerCapture(event.pointerId);\n        this.containerRef.current.style.cursor = 'grab';\n      }\n    };\n  }\n\n  componentDidMount() {\n    const topic = this.props.tinode.getTopic(this.props.topic);\n    this.previousOnInfo = topic.onInfo;\n    topic.onInfo = this.onInfo;\n    if ((this.props.callState == CALL_STATE_OUTGOING_INITATED ||\n         this.props.callState == CALL_STATE_IN_PROGRESS) && this.localRef.current) {\n      this.start();\n    }\n\n    if (this.containerRef) {\n      this.containerRef.current.addEventListener('pointerdown', this.dragStart);\n      this.containerRef.current.addEventListener('pointermove', this.drag);\n      this.containerRef.current.addEventListener('pointerup', this.dragEnd);\n    }\n  }\n\n  componentWillUnmount() {\n    const topic = this.props.tinode.getTopic(this.props.topic);\n    topic.onInfo = this.previousOnInfo;\n    this.stop();\n\n    if (this.containerRef) {\n      this.containerRef.current.removeEventListener('pointerdown', this.dragStart);\n      this.containerRef.current.removeEventListener('pointermove', this.drag);\n      this.containerRef.current.removeEventListener('pointerup', this.dragEnd);\n    }\n  }\n\n  handleVideoCallAccepted(info) {\n    RING_SOUND.pause();\n    // Create peer connection with a data channel.\n    const pc = this.createPeerConnection(true);\n    const stream = this.state.localStream;\n    stream.getTracks().forEach(track => {\n      pc.addTrack(track, stream);\n\n      if (track.kind == 'video' && this.state.audioOnly) {\n        // This is an audio-only call.\n        // Remove dummy video track (placeholder remains).\n        track.enabled = false;\n        track.stop();\n        stream.removeTrack(track);\n      }\n    });\n  }\n\n  onInfo(info) {\n    if (info.what != 'call') {\n      return;\n    }\n    switch (info.event) {\n      case 'accept':\n        this.handleVideoCallAccepted(info);\n        break;\n      case 'answer':\n        this.handleVideoAnswerMsg(info);\n        break;\n      case 'ice-candidate':\n        this.handleNewICECandidateMsg(info);\n        break;\n      case 'hang-up':\n        this.handleRemoteHangup(info);\n        break;\n      case 'offer':\n        this.handleVideoOfferMsg(info);\n        break;\n      case 'ringing':\n        // play() throws if the user did not click the app first: https://goo.gl/xX8pDD.\n        RING_SOUND.play().catch(_ => {});\n        break;\n      default:\n        console.warn(\"Unknown call event\", info.event);\n        break;\n    }\n  }\n\n  // Creates an empty video track placeholder.\n  emptyVideoTrack() {\n    const width = 640;\n    const height = 480;\n    const canvas = Object.assign(document.createElement(\"canvas\"), {width, height});\n    canvas.getContext('2d').fillRect(0, 0, width, height);\n    const stream = canvas.captureStream(0);\n    return Object.assign(stream.getVideoTracks()[0], {enabled: false});\n  }\n\n  start() {\n    if (this.state.localStream) {\n      this.props.onError(this.props.intl.formatMessage(messages.already_in_call), 'info');\n      return;\n    }\n\n    if (this.props.callState == CALL_STATE_IN_PROGRESS) {\n      // We apparently just accepted the call.\n      this.props.onInvite(this.props.topic, this.props.seq, CALL_STATE_IN_PROGRESS, this.props.callAudioOnly);\n      return;\n    }\n\n    // This is an outgoing call waiting for the other side to pick up.\n    // Start local video.\n    navigator.mediaDevices.getUserMedia(this.localStreamConstraints)\n      .then(stream => {\n        if (!this.localStreamConstraints.video) {\n          // Starting an audio-only call. Create a dummy video track\n          // (so video can be enabled during the call if the user desires).\n          stream.addTrack(this.emptyVideoTrack());\n        }\n        this.setState({localStream: stream, waitingForPeer: true});\n        this.localRef.current.srcObject = stream;\n\n        DIALING_SOUND.play();\n\n        // Send call invitation.\n        this.props.onInvite(this.props.topic, this.props.seq, this.props.callState, this.props.callAudioOnly);\n      })\n      .catch(this.handleGetUserMediaError);\n  }\n\n  stop() {\n    CALL_ENDED_SOUND.pause();\n    CALL_ENDED_SOUND.currentTime = 0;\n    RING_SOUND.pause();\n    RING_SOUND.currentTime = 0;\n\n    this.stopTracks(this.state.localStream);\n    this.stopTracks(this.state.remoteStream);\n    this.disconnectMedia(this.localRef.current);\n    this.disconnectMedia(this.remoteRef.current);\n    if (this.state.pc) {\n      this.state.pc.ontrack = null;\n      this.state.pc.onremovetrack = null;\n      this.state.pc.onremovestream = null;\n      this.state.pc.onicecandidate = null;\n      this.state.pc.oniceconnectionstatechange = null;\n      this.state.pc.onsignalingstatechange = null;\n      this.state.pc.onicegatheringstatechange = null;\n      this.state.pc.onnegotiationneeded = null;\n      this.state.pc.onicecandidateerror = null;\n      this.state.pc.ondatachannel = null;\n\n      if (this.state.dataChannel && (this.state.dataChannel.readyState == 'open' || this.state.dataChannel.readyState == 'connecting')) {\n        this.state.dataChannel.close();\n      }\n      this.state.pc.close();\n    }\n    this.setState({pc: null, waitingForPeer: false});\n  }\n\n  disconnectMedia(el) {\n    if (!el) {\n      return;\n    }\n\n    el.srcObject = null;\n    el.src = '';\n  }\n\n  stopTracks(stream) {\n    if (!stream) {\n      return;\n    }\n\n    let tracks = stream.getTracks();\n    if (tracks) {\n      tracks.forEach(track => {\n        track.stop();\n        track.enabled = false;\n      });\n    }\n  }\n\n  handleDataChannelError(error) {\n    console.error('data channel error', error);\n  }\n\n  handleDataChannelMessage(event) {\n    switch (event.data) {\n    case VIDEO_MUTED_EVENT:\n      this.setState({remoteVideoLive: false}, _ => { this.remoteRef.current.srcObject = this.state.remoteStream; });\n      break;\n    case VIDEO_UNMUTED_EVENT:\n      this.setState({remoteVideoLive: true}, _ => { this.remoteRef.current.srcObject = this.state.remoteStream; });\n      break;\n    default:\n      break;\n    }\n  }\n\n  handleDataChannelOpen(event) {\n    if (!this.state.audioOnly) {\n      event.target.send(VIDEO_UNMUTED_EVENT);\n    }\n  }\n\n  handleDataChannelClose(event) {\n    console.info('close data channel:', event);\n  }\n\n  handleDataChannelEvent(event) {\n    console.info('data channel event:', event);\n    const channel = event.channel;\n    channel.onerror = this.handleDataChannelError;\n    channel.onmessage = this.handleDataChannelMessage;\n    channel.onopen = this.handleDataChannelOpen;\n    channel.onclose = this.handleDataChannelClose;\n    this.setState({dataChannel: channel});\n  }\n\n  createPeerConnection(withDataChannel) {\n    const iceServers = this.props.tinode.getServerParam('iceServers', null);\n    const pc = iceServers ? new RTCPeerConnection({iceServers: iceServers}) : new RTCPeerConnection();\n\n    pc.onicecandidate = this.handleICECandidateEvent;\n    pc.oniceconnectionstatechange = this.handleICEConnectionStateChangeEvent;\n    pc.onicegatheringstatechange = this.handleICEGatheringStateChangeEvent;\n    pc.onsignalingstatechange = this.handleSignalingStateChangeEvent;\n    pc.onnegotiationneeded = this.handleNegotiationNeededEvent;\n    pc.onicecandidateerror = this.handleIceCandidateErrorEvent;\n    pc.ontrack = this.handleTrackEvent;\n    pc.ondatachannel = this.handleDataChannelEvent;\n\n    let stateUpdate = {pc: pc, waitingForPeer: false};\n    if (withDataChannel) {\n      // Create data channel for exchanging events.\n      const channel = pc.createDataChannel(\"events\", {ordered: true});\n      channel.onerror = this.handleDataChannelError;\n      channel.onmessage = this.handleDataChannelMessage;\n      channel.onopen = this.handleDataChannelOpen;\n      channel.onclose = this.handleDataChannelClose;\n      stateUpdate.dataChannel = channel;\n    }\n    this.setState(stateUpdate);\n    return pc;\n  }\n\n  handleVideoAnswerMsg(info) {\n    // Configure the remote description, which is the SDP payload\n    // in 'info' message.\n    const desc = new RTCSessionDescription(info.payload);\n    this.state.pc.setRemoteDescription(desc)\n      .then(_ => {\n        this.setState({ callInitialSetupComplete: true }, _ => this.drainRemoteIceCandidatesCache());\n      })\n      .catch(err => this.reportError(err));\n  }\n\n  reportError(err) {\n    this.props.onError(err.message, 'err');\n  }\n\n  canSendOffer() {\n    return this.isOutgoingCall || this.state.callInitialSetupComplete;\n  }\n\n  handleNegotiationNeededEvent(event) {\n    const pc = event.target;\n    if (!this.canSendOffer()) {\n      return;\n    }\n    pc.createOffer().then(offer => {\n      return pc.setLocalDescription(offer);\n    })\n    .then(_ => {\n      this.props.onSendOffer(this.props.topic, this.props.seq, pc.localDescription.toJSON());\n    })\n    .catch(err => this.reportError(err));\n  }\n\n  handleIceCandidateErrorEvent(event) {\n    console.warn(\"ICE candidate error:\", event);\n  }\n\n  handleICECandidateEvent(event) {\n    if (event.candidate) {\n      this.props.onIceCandidate(this.props.topic, this.props.seq, event.candidate.toJSON());\n    }\n  }\n\n  handleNewICECandidateMsg(info) {\n    const candidate = new RTCIceCandidate(info.payload);\n    if (this.state.callInitialSetupComplete) {\n      this.state.pc.addIceCandidate(candidate)\n        .catch(err => {\n          if (candidate.candidate) {\n            this.reportError(err);\n          }\n          console.warn(\"Error adding new ice candidate\", candidate, err);\n        });\n    } else {\n      this.remoteIceCandidatesCache.push(candidate);\n    }\n  }\n\n  drainRemoteIceCandidatesCache() {\n    this.remoteIceCandidatesCache.forEach(candidate => {\n      this.state.pc.addIceCandidate(candidate)\n        .catch(err => {\n          if (candidate.candidate) {\n            this.reportError(err);\n          }\n          console.warn(\"Error adding cached ice candidate\", candidate, err);\n        });\n    });\n    this.remoteIceCandidatesCache = [];\n  }\n\n  handleICEConnectionStateChangeEvent(event) {\n    switch (event.target.iceConnectionState) {\n      case 'closed':\n      case 'failed':\n        this.handleCloseClick();\n        break;\n    }\n  }\n\n  handleSignalingStateChangeEvent(event) {\n    if (event.target.signalingState == 'closed') {\n      this.handleCloseClick();\n    }\n  }\n\n  handleICEGatheringStateChangeEvent(event) {\n    // ICE gathering change state\n  }\n\n  handleTrackEvent(event) {\n    // Remote video becomes available.\n    this.remoteRef.current.srcObject = event.streams[0];\n    this.setState({remoteStream: event.streams[0]});\n  }\n\n  handleGetUserMediaError(e) {\n    console.error(\"Error opening camera and/or microphone\", e);\n    switch(e.name) {\n      case 'NotFoundError':\n        // Cannot start the call b/c no camera and/or microphone found.\n        this.reportError(e);\n        break;\n      case 'SecurityError':\n      case 'PermissionDeniedError':\n        // Do nothing; this is the same as the user canceling the call.\n        break;\n      default:\n        this.reportError(e);\n        break;\n    }\n\n    // Make sure we shut down our end of the RTCPeerConnection so we're\n    // ready to try again.\n    this.handleCloseClick();\n  }\n\n  handleVideoOfferMsg(info) {\n    let localStream = null;\n    // If needed, create peer connection.\n    // Not creating data channel since it should be created by the peer.\n    const pc = this.state.pc ? this.state.pc : this.createPeerConnection(false);\n    const desc = new RTCSessionDescription(info.payload);\n\n    pc.setRemoteDescription(desc).then(_ => {\n      return navigator.mediaDevices.getUserMedia(this.localStreamConstraints);\n    })\n    .then(stream => {\n      let dummyVideo;\n      if (!this.localStreamConstraints.video) {\n        // Starting an audio-only call. Create an empty video track so\n        // so the user can enable the video during the call.\n        dummyVideo = this.emptyVideoTrack();\n        stream.addTrack(dummyVideo);\n      }\n      localStream = stream;\n      this.localRef.current.srcObject = stream;\n      this.setState({localStream: stream});\n\n      localStream.getTracks().forEach(track => {\n        pc.addTrack(track, localStream);\n      });\n\n      if (dummyVideo) {\n        dummyVideo.enabled = false;\n        dummyVideo.stop();\n        stream.removeTrack(dummyVideo);\n      }\n    })\n    .then(_ => {\n      return pc.createAnswer();\n    })\n    .then(answer => {\n      return pc.setLocalDescription(answer);\n    })\n    .then(_ => {\n      this.props.onSendAnswer(this.props.topic, this.props.seq, pc.localDescription.toJSON());\n      this.setState({ callInitialSetupComplete: true }, _ => this.drainRemoteIceCandidatesCache());\n    })\n    .catch(this.handleGetUserMediaError);\n  }\n\n  // Call disconnected by remote.\n  handleRemoteHangup() {\n    if (!this.state.waitingForPeer) {\n      // This is live call, just hang up.\n      this.handleCloseClick();\n    } else {\n      // This is a call which is not yet connected.\n      // Stop pulse animation.\n      this.setState({waitingForPeer: false});\n      // Change sound and wait a bit before ending it.\n      RING_SOUND.pause();\n      RING_SOUND.currentTime = 0;\n      CALL_ENDED_SOUND.loop = true;\n      CALL_ENDED_SOUND.play().catch(_ => {});\n      setTimeout(_ => {\n        this.handleCloseClick();\n      }, 2000);\n    }\n  }\n\n  handleCloseClick() {\n    this.stop();\n    this.props.onHangup(this.props.topic, this.props.seq);\n  }\n\n  // Ends video track and turns off the camera.\n  muteVideo() {\n    if (!this.state.pc || !this.state.dataChannel) {\n      return;\n    }\n\n    const stream = this.state.localStream;\n    const t = stream.getVideoTracks()[0];\n    t.enabled = false;\n    t.stop();\n\n    stream.removeTrack(t);\n    this.state.dataChannel.send(VIDEO_MUTED_EVENT);\n    this.setState({videoToggleInProgress: false});\n  }\n\n  unmuteVideo() {\n    if (!this.state.pc || !this.state.dataChannel) {\n      return;\n    }\n    navigator.mediaDevices.getUserMedia({ video: true })\n      .then(stream => {\n        // Will extract video track from stream and throw stream away,\n        // and replace video track in the media sender.\n        this.localRef.current.srcObject = null;\n        const sender = this.state.pc.getSenders().find(s => s.track.kind == 'video');\n        const track = stream.getVideoTracks()[0];\n        // Remote track from new stream.\n        stream.removeTrack(track);\n        // Add this track to the existing local stream.\n        this.state.localStream.addTrack(track);\n        return sender.replaceTrack(track);\n      })\n      .then(_ => {\n        this.localRef.current.srcObject = this.state.localStream;\n        this.state.dataChannel.send(VIDEO_UNMUTED_EVENT);\n      })\n      .catch(err => this.handleGetUserMediaError(err))\n      .finally(_ => { this.setState({videoToggleInProgress: false}); }); // Make sure we redraw the mute/unmute icons (e.g. camera -> camera_off).\n  }\n\n  handleToggleCameraClick() {\n    if (this.state.videoToggleInProgress) {\n      // Toggle currently in progress.\n      return;\n    }\n    const tracks = this.state.localStream.getVideoTracks();\n    this.setState({videoToggleInProgress: true}, _ => {\n      if (tracks && tracks.length > 0 && tracks[0].enabled && tracks[0].readyState == 'live') {\n        this.muteVideo();\n      } else {\n        this.unmuteVideo();\n      }\n      this.setState({audioOnly: !this.state.audioOnly});\n    });\n  }\n\n  handleToggleMicClick() {\n    const stream = this.state.localStream;\n    const t = stream.getAudioTracks()[0];\n    t.enabled = !t.enabled;\n    // Make sure we redraw the mute/unmute icons (e.g. mic -> mic_off).\n    this.forceUpdate();\n  }\n\n  render() {\n    const audioTracks = this.state.localStream && this.state.localStream.getAudioTracks();\n    const videoTracks = !this.state.audioOnly && this.state.localStream && this.state.localStream.getVideoTracks();\n    const disabled = !this.state.pc || !this.state.dataChannel || !(audioTracks && audioTracks[0]);\n    const audioIcon = audioTracks && audioTracks[0] && audioTracks[0].enabled ? 'mic' : 'mic_off';\n    const videoIcon = videoTracks && videoTracks[0] && videoTracks[0].enabled && videoTracks[0].readyState == 'live' ? 'videocam' : 'videocam_off';\n    const peerTitle = truncateString(this.props.title, MAX_PEER_TITLE_LENGTH);\n    const pulseAnimation = this.state.waitingForPeer ? ' pulse' : '';\n\n    let remoteActive = false;\n    if (this.remoteRef.current && this.remoteRef.current.srcObject && this.state.remoteVideoLive) {\n      const rstream = this.remoteRef.current.srcObject;\n      if (rstream.getVideoTracks().length > 0) {\n        const t = rstream.getVideoTracks()[0];\n        remoteActive = t.enabled && t.readyState == 'live';\n      }\n    }\n\n    const minimizedClass = this.props.minimized ? 'minimized' : null;\n    const fullScreen = this.props.minimized ? 'fullscreen' : 'fullscreen_exit';\n\n    return (\n      <div id=\"video-container\" className={minimizedClass} ref={this.containerRef}>\n        <div id=\"video-container-panel\">\n          <div className=\"call-party self\" disabled={this.state.audioOnly || this.props.minimized}>\n            <video ref={this.localRef} autoPlay muted playsInline />\n            <div className=\"caller-name inactive\">\n              <FormattedMessage id=\"calls_you_label\"\n                defaultMessage=\"You\" description=\"Shown over the local video screen\" />\n            </div>\n          </div>\n          <div className=\"call-party peer\" disabled={!remoteActive}>\n            {remoteActive ?\n              <>\n                <video ref={this.remoteRef} autoPlay playsInline />\n                <div className=\"caller-name inactive\">{peerTitle}</div>\n              </> :\n              <>\n                <audio ref={this.remoteRef} autoPlay />\n                <div className={`caller-card${pulseAnimation} draggable`}>\n                  <div className=\"avatar-box\">\n                    <LetterTile\n                      authorizeURL={this.props.tinode.authorizeURL}\n                      avatar={this.props.avatar}\n                      topic={this.props.topic}\n                      title={this.props.title} />\n                  </div>\n                  <div className=\"caller-name\">{peerTitle}</div>\n                </div>\n              </>\n            }\n          </div>\n        </div>\n        <button className=\"full-screen\" onClick={this.props.onToggleMinimize}>\n          <i className=\"m-icon\">{fullScreen}</i>\n        </button>\n        <div id=\"controls\" className={minimizedClass}>\n          <button className=\"danger\" onClick={this.handleCloseClick}>\n            <i className=\"m-icon\">call_end</i>\n          </button>\n          <button className=\"secondary\" onClick={this.handleToggleCameraClick} disabled={disabled}>\n            <i className=\"m-icon\">{videoIcon}</i>\n          </button>\n          <button className=\"secondary\" onClick={this.handleToggleMicClick} disabled={disabled}>\n            <i className=\"m-icon\">{audioIcon}</i>\n          </button>\n        </div>\n      </div>\n    );\n  }\n};\n\nexport default injectIntl(CallPanel);\n"],"names":["RING_SOUND","Audio","loop","CALL_ENDED_SOUND","DIALING_SOUND","VIDEO_MUTED_EVENT","VIDEO_UNMUTED_EVENT","messages","defineMessages","already_in_call","id","defaultMessage","CallPanel","React","constructor","props","super","this","state","localStream","undefined","remoteStream","pc","dataChannel","previousOnInfo","waitingForPeer","callInitialSetupComplete","audioOnly","callAudioOnly","videoToggleInProgress","remoteVideoLive","localStreamConstraints","audio","video","isOutgoingCall","callState","CALL_STATE_OUTGOING_INITATED","containerRef","localRef","remoteRef","remoteIceCandidatesCache","onInfo","bind","start","stop","createPeerConnection","canSendOffer","drainRemoteIceCandidatesCache","handleNegotiationNeededEvent","handleICECandidateEvent","handleNewICECandidateMsg","handleICEConnectionStateChangeEvent","handleSignalingStateChangeEvent","handleICEGatheringStateChangeEvent","handleIceCandidateErrorEvent","handleTrackEvent","handleVideoOfferMsg","handleVideoAnswerMsg","reportError","handleGetUserMediaError","stopTracks","disconnectMedia","handleCloseClick","handleToggleCameraClick","handleToggleMicClick","handleRemoteHangup","handleVideoCallAccepted","muteVideo","unmuteVideo","emptyVideoTrack","handleDataChannelEvent","handleDataChannelError","handleDataChannelMessage","handleDataChannelOpen","handleDataChannelClose","bounds","dragStart","event","target","classList","contains","window","matchMedia","minimized","stopPropagation","current","setPointerCapture","pointerId","style","cursor","left","offsetLeft","top","offsetTop","width","offsetWidth","height","offsetHeight","parent","offsetParent","maxX","maxY","drag","el","hasPointerCapture","Math","min","max","movementX","movementY","dragEnd","releasePointerCapture","componentDidMount","topic","tinode","getTopic","CALL_STATE_IN_PROGRESS","addEventListener","componentWillUnmount","removeEventListener","info","pause","stream","getTracks","forEach","track","addTrack","kind","enabled","removeTrack","what","play","catch","_","console","warn","canvas","Object","assign","document","createElement","getContext","fillRect","captureStream","getVideoTracks","onError","intl","formatMessage","navigator","mediaDevices","getUserMedia","then","setState","srcObject","onInvite","seq","currentTime","ontrack","onremovetrack","onremovestream","onicecandidate","oniceconnectionstatechange","onsignalingstatechange","onicegatheringstatechange","onnegotiationneeded","onicecandidateerror","ondatachannel","readyState","close","src","tracks","error","data","send","channel","onerror","onmessage","onopen","onclose","withDataChannel","iceServers","getServerParam","RTCPeerConnection","stateUpdate","createDataChannel","ordered","desc","RTCSessionDescription","payload","setRemoteDescription","err","message","createOffer","offer","setLocalDescription","onSendOffer","localDescription","toJSON","candidate","onIceCandidate","RTCIceCandidate","addIceCandidate","push","iceConnectionState","signalingState","streams","e","name","dummyVideo","createAnswer","answer","onSendAnswer","setTimeout","onHangup","t","sender","getSenders","find","s","replaceTrack","finally","length","getAudioTracks","forceUpdate","render","audioTracks","videoTracks","disabled","audioIcon","videoIcon","peerTitle","truncateString","title","MAX_PEER_TITLE_LENGTH","pulseAnimation","remoteActive","rstream","minimizedClass","fullScreen","className","ref","autoPlay","muted","playsInline","FormattedMessage","LetterTile","authorizeURL","avatar","onClick","onToggleMinimize","injectIntl"],"ignoreList":[],"sourceRoot":""}