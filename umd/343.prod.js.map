{"version":3,"file":"343.prod.js","mappings":"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","sources":["webpack://tinode-webapp/./src/widgets/send-message.jsx","webpack://tinode-webapp/./src/widgets/attachment.jsx","webpack://tinode-webapp/./src/widgets/reaction-strip.jsx","webpack://tinode-webapp/./src/widgets/received-marker.jsx","webpack://tinode-webapp/./src/widgets/reaction-picker.jsx","webpack://tinode-webapp/./src/widgets/chat-message.jsx","webpack://tinode-webapp/./src/widgets/group-subs.jsx","webpack://tinode-webapp/./src/widgets/invitation.jsx","webpack://tinode-webapp/./src/views/logo-view.jsx","webpack://tinode-webapp/./src/widgets/meta-message.jsx","webpack://tinode-webapp/./src/widgets/pinned-messages.jsx","webpack://tinode-webapp/./src/views/messages-view.jsx"],"sourcesContent":["// Send message form.\nimport React, { Suspense } from 'react';\nimport { FormattedMessage, defineMessages, injectIntl } from 'react-intl';\nimport { Drafty } from 'tinode-sdk';\n\n// Lazy-loading AudioRecorder because it's quite large due to\n// a dependency on webm-duration-fix.\nconst AudioRecorder = React.lazy(_ => import('./audio-recorder.jsx'));\n\nimport { KEYPRESS_DELAY } from '../config.js';\nimport { filePasted } from '../lib/blob-helpers.js';\nimport { replyFormatter } from '../lib/formatters.js';\n\nconst messages = defineMessages({\n  messaging_disabled: {\n    id: 'messaging_disabled_prompt',\n    defaultMessage: 'Messaging disabled',\n    description: 'Prompt in SendMessage in read-only topic'\n  },\n  type_new_message: {\n    id: 'new_message_prompt',\n    defaultMessage: 'New message',\n    description: 'Prompt in send message field'\n  },\n  add_image_caption: {\n    id: 'image_caption_prompt',\n    defaultMessage: 'Image caption',\n    description: 'Prompt in SendMessage for attached image'\n  },\n  file_attachment_too_large: {\n    id: 'file_attachment_too_large',\n    defaultMessage: 'The file size {size} exceeds the {limit} limit.',\n    description: 'Error message when attachment is too large'\n  },\n  cannot_initiate_upload: {\n    id: 'cannot_initiate_file_upload',\n    defaultMessage: 'Cannot initiate file upload.',\n    description: 'Generic error messagewhen attachment fails'\n  },\n  icon_title_record_voice: {\n    id: 'icon_title_record_voice',\n    defaultMessage: 'Record voice message',\n    description: 'Icon tool tip for recording a voice message'\n  },\n  icon_title_attach_file: {\n    id: 'icon_title_attach_file',\n    defaultMessage: 'Attach file',\n    description: 'Icon tool tip for attaching a file'\n  },\n  icon_title_add_image: {\n    id: 'icon_title_add_image',\n    defaultMessage: 'Add image',\n    description: 'Icon tool tip for attaching an image'\n  },\n  icon_title_send: {\n    id: 'icon_title_send',\n    defaultMessage: 'Send message',\n    description: 'Icon tool tip for sending a message'\n  },\n});\n\nclass SendMessage extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      quote: null,\n      message: '',\n      audioRec: false,\n      audioAvailable: !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia),\n    };\n\n    // Timestamp when the previous key press was sent to the server.\n    this.keypressTimestamp = 0;\n\n    this.handlePasteEvent = this.handlePasteEvent.bind(this);\n    this.handleAttachImage = this.handleAttachImage.bind(this);\n    this.handleAttachFile = this.handleAttachFile.bind(this);\n    this.handleAttachAudio = this.handleAttachAudio.bind(this);\n    this.handleSend = this.handleSend.bind(this);\n    this.handleKeyPress = this.handleKeyPress.bind(this);\n    this.handleMessageTyping = this.handleMessageTyping.bind(this);\n    this.handleDropAttach = this.handleDropAttach.bind(this);\n\n    this.handleQuoteClick = this.handleQuoteClick.bind(this);\n\n    this.formatReply = this.formatReply.bind(this);\n  }\n\n  componentDidMount() {\n    if (this.messageEditArea) {\n      this.messageEditArea.addEventListener('paste', this.handlePasteEvent, false);\n      if (window.getComputedStyle(this.messageEditArea).getPropertyValue('transition-property') == 'all') {\n        // Set focus on desktop, but not on mobile: focus causes soft keyboard to pop up.\n        this.messageEditArea.focus();\n      }\n    }\n\n    this.setState({quote: this.formatReply()});\n  }\n\n  componentWillUnmount() {\n    if (this.messageEditArea) {\n      this.messageEditArea.removeEventListener('paste', this.handlePasteEvent, false);\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    if (this.messageEditArea) {\n      if (window.getComputedStyle(this.messageEditArea).getPropertyValue('transition-property') == 'all') {\n        // Set focus on desktop, but not on mobile: focus causes soft keyboard to pop up.\n        this.messageEditArea.focus();\n      }\n\n      // Adjust height of the message area for the amount of text.\n      this.messageEditArea.style.height = '0px';\n      this.messageEditArea.style.height = this.messageEditArea.scrollHeight + 'px';\n    }\n\n    if (prevProps.topicName != this.props.topicName) {\n      this.setState({message: this.props.initMessage || '', audioRec: false, quote: null});\n    } else if (prevProps.initMessage != this.props.initMessage) {\n      const msg = this.props.initMessage || '';\n      this.setState({message: msg}, _ => {\n        // If there is text, scroll to bottom and set caret to the end.\n        this.messageEditArea.scrollTop = this.messageEditArea.scrollHeight;\n        this.messageEditArea.setSelectionRange(msg.length, msg.length);\n      });\n    }\n    if (prevProps.reply != this.props.reply) {\n      this.setState({quote: this.formatReply()});\n    }\n  }\n\n  formatReply() {\n    return this.props.reply ?\n      Drafty.format(this.props.reply.content, replyFormatter, {\n        formatMessage: this.props.intl.formatMessage.bind(this.props.intl),\n        authorizeURL: this.props.tinode.authorizeURL.bind(this.props.tinode)\n      }) : null;\n  }\n\n  handlePasteEvent(e) {\n    if (this.props.disabled) {\n      return;\n    }\n    // FIXME: handle large files too.\n    if (filePasted(e,\n      file => { this.props.onAttachImage(file); },\n      file => { this.props.onAttachFile(file); },\n      this.props.onError)) {\n\n      // If a file was pasted, don't paste base64 data into input field.\n      e.preventDefault();\n    }\n  }\n\n  handleAttachImage(e) {\n    if (e.target.files && e.target.files.length > 0) {\n      this.props.onAttachImage(e.target.files[0]);\n    }\n    // Clear the value so the same file can be uploaded again.\n    e.target.value = '';\n  }\n\n  handleAttachFile(e) {\n    if (e.target.files && e.target.files.length > 0) {\n      this.props.onAttachFile(e.target.files[0]);\n    }\n    // Clear the value so the same file can be uploaded again.\n    e.target.value = '';\n  }\n\n  handleDropAttach(files) {\n    if (files && files.length > 0) {\n      this.props.onAttachFile(files[0]);\n    }\n  }\n\n  handleAttachAudio(url, preview, duration) {\n    this.setState({audioRec: false});\n    this.props.onAttachAudio(url, preview, duration);\n  }\n\n  handleSend(e) {\n    e.preventDefault();\n    const message = this.state.message.trim();\n    if (message || this.props.acceptBlank || this.props.noInput) {\n      this.props.onSendMessage(message);\n      this.setState({message: ''});\n    }\n  }\n\n  /* Send on Enter key */\n  handleKeyPress(e) {\n    if (this.state.audioRec) {\n      // Ignore key presses while audio is being recorded.\n      e.preventDefault();\n      e.stopPropagation();\n      return;\n    }\n\n    // Enter pressed: either send, or enter a new line.\n    if (e.key === 'Enter') {\n      if (this.props.sendOnEnter == 'plain') {\n        // Have Shift-Enter insert a line break instead\n        if (!e.shiftKey) {\n          e.preventDefault();\n          e.stopPropagation();\n\n          this.handleSend(e);\n        }\n      } else {\n        if (e.ctrlKey || e.metaKey) {\n          e.preventDefault();\n          e.stopPropagation();\n\n          this.handleSend(e);\n        }\n      }\n    }\n  }\n\n  handleMessageTyping(e) {\n    this.setState({message: e.target.value});\n    if (this.props.onKeyPress) {\n      const now = new Date().getTime();\n      if (now - this.keypressTimestamp > KEYPRESS_DELAY) {\n        this.props.onKeyPress();\n        this.keypressTimestamp = now;\n      }\n    }\n  }\n\n  handleQuoteClick(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    if (this.props.reply && this.props.onQuoteClick) {\n      const replyToSeq = this.props.reply.seq;\n      this.props.onQuoteClick(replyToSeq);\n    }\n  }\n\n  render() {\n    const { formatMessage } = this.props.intl;\n    const prompt = this.props.disabled ?\n      formatMessage(messages.messaging_disabled) :\n      (this.props.messagePrompt ?\n        formatMessage(messages[this.props.messagePrompt]) :\n        formatMessage(messages.type_new_message));\n\n    const sendIcon = (this.props.reply && this.props.reply.editing) ?\n      'check_circle' : 'send';\n\n    const quote = this.state.quote ?\n      (<div id=\"reply-quote-preview\">\n        <div className=\"cancel\">\n          <a href=\"#\" onClick={e => {e.preventDefault(); this.props.onCancelReply();}}><i className=\"m-icon gray\">close</i></a>\n        </div>\n        {this.state.quote}\n      </div>) : null;\n    const audioEnabled = this.state.audioAvailable && this.props.onAttachAudio;\n    return (\n      <div id=\"send-message-wrapper\">\n        {!this.props.noInput ? quote : null}\n        <div id=\"send-message-panel\">\n          {!this.props.disabled ?\n            <>\n              {this.props.onAttachFile && !this.state.audioRec ?\n                <>\n                  <a href=\"#\" onClick={e => {e.preventDefault(); this.attachImage.click();}} title={formatMessage(messages.icon_title_add_image)}>\n                    <i className=\"m-icon secondary\">photo</i>\n                  </a>\n                  <a href=\"#\" onClick={e => {e.preventDefault(); this.attachFile.click();}} title={formatMessage(messages.icon_title_attach_file)}>\n                    <i className=\"m-icon secondary\">attach_file</i>\n                  </a>\n                </>\n                :\n                null}\n              {this.props.noInput ?\n                (quote || <div className=\"hr thin\" />) :\n                (this.state.audioRec ?\n                  (<Suspense fallback={<div><FormattedMessage id=\"loading_note\" defaultMessage=\"Loading...\"\n                  description=\"Message shown when component is loading\"/></div>}>\n                    <AudioRecorder\n                      onRecordingProgress={_ => this.props.onKeyPress(true)}\n                      onDeleted={_ => this.setState({audioRec: false})}\n                      onFinished={this.handleAttachAudio}/>\n                  </Suspense>) :\n                  <textarea id=\"send-message-input\" placeholder={prompt}\n                    value={this.state.message} onChange={this.handleMessageTyping}\n                    onKeyDown={this.handleKeyPress}\n                    ref={ref => {this.messageEditArea = ref;}} />)}\n              {this.state.message || !audioEnabled ?\n                <a href=\"#\" onClick={this.handleSend} title={formatMessage(messages.icon_title_send)}>\n                  <i className=\"m-icon fill\">{sendIcon}</i>\n                </a> :\n                !this.state.audioRec ?\n                  <a href=\"#\" onClick={e => {e.preventDefault(); this.setState({audioRec: true})}} title={formatMessage(messages.icon_title_record_voice)}>\n                    <i className=\"m-icon fill\">mic</i>\n                  </a> :\n                  null\n              }\n              <input type=\"file\" ref={ref => {this.attachFile = ref}}\n                onChange={this.handleAttachFile} style={{display: 'none'}} />\n              <input type=\"file\" ref={ref => {this.attachImage = ref}} accept=\"image/*, video/*\"\n                onChange={this.handleAttachImage} style={{display: 'none'}} />\n            </>\n            :\n            <div id=\"writing-disabled\">{prompt}</div>\n          }\n        </div>\n      </div>\n    );\n  }\n};\n\nexport default injectIntl(SendMessage);\n","import React from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nimport FileProgress from './file-progress.jsx';\nimport { bytesToHumanSize } from '../lib/strformat.js';\nimport { isUrlRelative, sanitizeUrl } from '../lib/utils.js';\n\nexport default class Attachment extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      downloader: null,\n      progress: 0\n    };\n\n    this.downloadFile = this.downloadFile.bind(this);\n    this.handleCancel = this.handleCancel.bind(this);\n  }\n\n  downloadFile(url, filename, mimetype) {\n    if (!url) {\n      this.props.onError(\"Invalid download URL '\" + url + \"'\");\n      return;\n    }\n\n    const downloader = this.props.tinode.getLargeFileHelper();\n    this.setState({downloader: downloader});\n    downloader.download(url, filename, mimetype,\n      loaded => this.setState({progress: loaded / this.props.size}),\n      err => this.props.onError(err, 'err')\n    )\n    .then(_ => this.setState({downloader: null, progress: 0}))\n    .catch(err => {\n      if (err) {\n        this.props.onError(\"Error downloading file: \" + err.message, 'err');\n      }\n      this.setState({downloader: null, progress: 0});\n    });\n  }\n\n  handleCancel() {\n    if (this.props.uploading) {\n      this.props.onCancelUpload();\n    } else if (this.state.downloader) {\n      this.state.downloader.cancel();\n    }\n  }\n\n  render() {\n    let filename = this.props.filename || 'file_attachment';\n    if (filename.length > 36) {\n      filename = filename.substr(0, 16) + '...' + filename.substr(-16);\n    }\n    let size = this.props.size > 0 ?\n      <span className=\"small gray\">({bytesToHumanSize(this.props.size)})</span> :\n      null;\n\n    // Detect if the download URL is relative or absolute.\n    // If the URL is relative use LargeFileHelper to attach authentication\n    // credentials to the request.\n    let url, helperFunc;\n    if (!this.props.uploading && !this.state.downloader && isUrlRelative(this.props.downloadUrl)) {\n      // Relative URL. Use download helper.\n      url = '#';\n      helperFunc = (e) => {\n        e.preventDefault();\n        this.downloadFile(this.props.downloadUrl, this.props.filename, this.props.mimetype);\n      };\n    } else {\n      url = sanitizeUrl(this.props.downloadUrl);\n      helperFunc = null;\n    }\n    const downloadWidget = <><i className=\"m-icon\">file_download</i> <FormattedMessage id=\"save_attachment\"\n      defaultMessage=\"save\" description=\"Call to save an attachment\" /></>;\n    return (\n      <div className=\"attachment\">\n        <div><i className=\"m-icon big gray thin\">draft</i></div>\n        <div className=\"flex-column\">\n          <div>{filename} {size}</div>\n          {this.props.uploading || this.state.downloader ?\n            <FileProgress progress={this.props.uploading ? this.props.progress : this.state.progress}\n              onCancel={this.handleCancel} />\n            :\n            <div>{url ?\n              <a href={url} download={this.props.filename} onClick={helperFunc}>{downloadWidget}</a>\n              :\n              <span className=\"light-gray\">{downloadWidget}</span>\n            }</div>\n          }\n        </div>\n      </div>\n    );\n  }\n};\n","import React from 'react';\n\nimport { shortenCount } from '../lib/strformat';\n\nclass ReactionStrip extends React.PureComponent {\n  render() {\n    const more = this.props.reactions.length - this.props.maxReactions;\n    return (\n      <div className=\"reactions\">\n        {/* Invisible zero-width element to prevent layout shift */}\n        <div style={{opacity:0, userSelect: 'none', width: '0.01rem'}}>0</div>\n        {this.props.reactions.slice(0, this.props.maxReactions).map(r => {\n          const you = r.users && this.props.myUserId && r.users.includes(this.props.myUserId);\n          return (\n            <div key={r.val}\n              data-testid={`reaction-${r.val}`}\n              className={'reaction' + (you ? ' active' : '')}\n              onClick={(e) => this.props.onReactionSelected(e, r.val)}>\n              <span className=\"emoji\">{r.val}</span>\n              {r.count > 1 && <span className=\"count\">{shortenCount(r.count)}</span>}\n            </div>\n          );\n        })}\n        <div className={`reaction-add${(this.props.pickerShown || more > 0) ? ' active' : ''}`}\n          data-testid=\"reaction-add\"\n          onMouseDown={(e) => { e.stopPropagation(); }}\n          onClick={this.props.onTogglePicker}>\n            <i className=\"m-icon\">{more > 0 ? 'more_horiz' : 'thumb_up_off_alt'}</i>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default ReactionStrip;\n","// Received/read indicator.\nimport React from 'react';\nimport { defineMessages, injectIntl } from 'react-intl';\n\nimport { Tinode } from 'tinode-sdk';\n\nimport { deliveryMarker } from '../lib/utils.js';\n\nconst messages = defineMessages({\n  message_sending: {\n    id: 'message_sending',\n    defaultMessage: 'sending...',\n    description: 'Message being sent, in place of time stamp'\n  },\n  message_sending_failed: {\n    id: 'message_sending_failed',\n    defaultMessage: 'failed',\n    description: 'Failed to send message, in place of time stamp'\n  },\n  message_edited_marker: {\n    id: 'message_edited_marker',\n    defaultMessage: ', edited',\n    description: 'Marker indicating that the message was edited'\n  }\n});\n\nclass ReceivedMarker extends React.PureComponent {\n  render() {\n    const {formatMessage} = this.props.intl;\n    let timestamp;\n    if (this.props.received <= Tinode.MESSAGE_STATUS_SENDING) {\n      timestamp = formatMessage(messages.message_sending);\n    } else if (this.props.received == Tinode.MESSAGE_STATUS_FAILED ||\n        this.props.received == Tinode.MESSAGE_STATUS_FATAL) {\n      timestamp = formatMessage(messages.message_sending_failed);\n    } else {\n      timestamp = this.props.timestamp.toLocaleTimeString(this.props.intl.locale, { timeStyle: 'short' });\n    }\n\n    const icon = deliveryMarker(this.props.received);\n    const marker = icon ? <i className={'m-icon small ' + icon.color}>{icon.name}</i> : null;\n    const edited = this.props.edited ? formatMessage(messages.message_edited_marker) : null;\n\n    return (\n      <span className=\"timestamp\" style={this.props.style}>\n        {timestamp}{edited}{'\\u00a0'}{marker}\n      </span>\n    );\n  }\n};\n\nexport default injectIntl(ReceivedMarker);\n","import React from 'react';\n\nimport { objectEqual } from '../lib/utils';\nimport CountBadge from './count-badge.jsx';\n\n// Number of emojis to show in collapsed panel.\nconst REACTIONS_COLLAPSED_COUNT = 6;\n// Maximum number of emojis to show in a panel (expanded).\nconst MAX_EMOJIS = 40;\n// Where to show the picker all else being equal: 'top', 'left', 'right', 'bottom'\nconst DISPLAY_PREFERENCE = 'top';\nconst PANEL_MARGIN = 8;\nconst TIP_SIZE = 7;\n// Width/height of the reaction-add button.\nconst BUTTON_SIZE = 14;\n// Distance from edge to tip point\nconst TIP_STOP = 12;\n// Right-side visible message bubble has a margin on the left.\nconst BUBBLE_MARGIN_LEFT = 23;\n\n// Compact emoji picker styled like Telegram/WhatsApp\n// Props:\n// - reactionList: array of emoji strings that can be used.\n// - anchor: { // Position of the click which launched the picker.\n//     offsetX: number, // X coordinate relative to message bubble.\n//     offsetY: number, // Y coordinate relative to message bubble.\n//     viewX: number,   // X coordinate relative to viewport\n//     viewY: number    // Y coordinate relative to viewport\n//   }\n// - viewportBounds: { width: number, height: number } size of the viewport\n// - onSelect: (emo) => void\n// - onClose: () => void\n// - dataTestPrefix: optional prefix for data-testid\nclass ReactionPicker extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      // position is an inline style object for the panel.\n      position: { marginLeft: '0', marginTop: '0' },\n      tipLeft: '12px',\n      placeAbove: 'top',\n      expanded: false\n    };\n    this.rootRef = React.createRef();\n    this.emojiRefs = [];\n    this.handleOutsideClick = this.handleOutsideClick.bind(this);\n    this.handleKeyDown = this.handleKeyDown.bind(this);\n    this.selectEmoji = this.selectEmoji.bind(this);\n    this.updatePosition = this.updatePosition.bind(this);\n  }\n\n  componentDidMount() {\n    document.addEventListener('mousedown', this.handleOutsideClick);\n    document.addEventListener('keydown', this.handleKeyDown);\n    // Focus first emoji for keyboard users\n    setTimeout(() => { if (this.emojiRefs[0]) this.emojiRefs[0].focus(); }, 0);\n    // Position picker so it's fully visible\n    this.updatePosition();\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    // Reposition if anchor or viewportBounds changed or expanded state changed.\n    if (prevProps.anchor !== this.props.anchor ||\n        prevProps.viewportBounds !== this.props.viewportBounds ||\n        prevState.expanded !== this.state.expanded) {\n      // Use a timeout so DOM updates (expanded grid) are applied before measuring.\n      setTimeout(() => this.updatePosition(), 0);\n    }\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('mousedown', this.handleOutsideClick);\n    document.removeEventListener('keydown', this.handleKeyDown);\n  }\n\n  handleOutsideClick(e) {\n    e.stopPropagation();\n    e.preventDefault();\n    if (this.rootRef.current && !this.rootRef.current.contains(e.target)) {\n      this.props.onClose();\n    }\n  }\n\n  handleKeyDown(e) {\n    // Global handler only processes navigation keys when picker is open\n    if (e.key === 'Escape') {\n      this.props.onClose();\n      return;\n    }\n\n    const active = document.activeElement;\n    const idx = this.emojiRefs.findIndex(el => el === active);\n    if (e.key === 'ArrowRight') {\n      if (idx == -1) {\n        this.emojiRefs[0] && this.emojiRefs[0].focus();\n      } else {\n        const next = (idx + 1) % this.emojiRefs.length;\n        this.emojiRefs[next] && this.emojiRefs[next].focus();\n      }\n      e.preventDefault();\n    } else if (e.key === 'ArrowLeft') {\n      if (idx == -1) {\n        const last = this.emojiRefs.length - 1;\n        this.emojiRefs[last] && this.emojiRefs[last].focus();\n      } else {\n        const prev = (idx - 1 + this.emojiRefs.length) % this.emojiRefs.length;\n        this.emojiRefs[prev] && this.emojiRefs[prev].focus();\n      }\n      e.preventDefault();\n    } else if ((e.key === 'Enter' || e.key === ' ') && idx >= 0) {\n      const emojis = this.props.reactionList || [];\n      const emo = emojis[idx];\n      this.selectEmoji(emo);\n      e.preventDefault();\n    }\n  }\n\n  selectEmoji(emo) {\n    this.props.onSelect(emo);\n    this.props.onClose();\n  }\n\n  updatePosition() {\n    if (!this.rootRef.current) {\n      return;\n    }\n\n    const panelRect = this.rootRef.current.getBoundingClientRect();\n    const hSize = panelRect.width;\n    const vSize = panelRect.height;\n\n    // Choose maximum available space around click point to display the panel.\n    const spaceLeft = this.props.anchor.viewX - hSize - PANEL_MARGIN * 2 - TIP_SIZE - BUTTON_SIZE / 2;\n    const spaceRight = this.props.viewportBounds.width - this.props.anchor.viewX - hSize - PANEL_MARGIN * 2 - TIP_SIZE - BUTTON_SIZE / 2;\n    const spaceTop = this.props.anchor.viewY - vSize - PANEL_MARGIN * 2 - TIP_SIZE - BUTTON_SIZE / 2;\n    const spaceBottom = this.props.viewportBounds.height - this.props.anchor.viewY - vSize - PANEL_MARGIN * 2 - TIP_SIZE / 2 ;\n\n    const bubbleMargin = this.props.leftBubble ? 0 : BUBBLE_MARGIN_LEFT;\n    let preferred = DISPLAY_PREFERENCE;\n    let space = spaceTop;\n    if (space < 0 && space < spaceBottom) {\n      preferred = 'bottom';\n      space = spaceBottom;\n    }\n    if (space < 0 && space < spaceLeft) {\n      preferred = 'left';\n      space = spaceLeft;\n    }\n    if (space < 0 && space < spaceRight) {\n      preferred = 'right';\n      space = spaceRight;\n    }\n\n    // Calculate position so the panel is fully visible within the message view bounds.\n    let marginTop, marginLeft;\n    if (preferred == 'top' || preferred == 'bottom') {\n      // Place panel in such a way than anchor point is under/above the panel.\n      if (hSize > this.props.viewportBounds.width) {\n        // The panel wider than viewport: align to the exact middle.\n        marginLeft = (this.props.viewportBounds.width - hSize) / 2;\n      } else {\n        // Desired position if panel is fully visible:\n        // 1. if click point is on left side, place panel 1/3 to the left of the click point.\n        // 2. if click point is on right side, place panel 2/3 to the left of the click point.\n        // Then make sure panel is fully visible.\n        if (spaceRight > spaceLeft) {\n          // Clickpoint on left  of center (bubble is probably on the left).\n          // Margin space available to the left of click point, positive value.\n          const availableLeft = this.props.anchor.viewX - this.props.anchor.offsetX - PANEL_MARGIN;\n          // Preferred margin: 1/3 of panel width to the left of click point, could be negative.\n          const preferredX = this.props.anchor.offsetX - hSize * 0.33;\n          // Make sure panel is fully visible: availableLeft + offsetX > 0.\n          marginLeft = Math.max(-availableLeft, preferredX);\n        } else {\n          // Clickpoint on right of center (bubble is probably on the right).\n          // Preferred position: 2/3 of panel width to the left of click point, but make sure panel is fully visible.\n          const availableRight = this.props.viewportBounds.width - this.props.anchor.viewX - PANEL_MARGIN - BUTTON_SIZE / 2;\n          const offsetX = this.props.anchor.offsetX - hSize * 0.67;\n          marginLeft = offsetX + Math.min(0, bubbleMargin + availableRight - hSize * 0.33);\n        }\n      }\n      // Horizontal placement of tail: place close to click position.\n      this.setState({ tipLeft: Math.max(TIP_STOP, Math.min(hSize - TIP_STOP - TIP_SIZE * 2,\n        this.props.anchor.offsetX - marginLeft + bubbleMargin)) + 'px' });\n      // Fixed vertical positioning: above or below the button.\n      if (preferred == 'top') {\n        marginTop = this.props.anchor.offsetY - vSize - TIP_SIZE - PANEL_MARGIN;\n      } else {\n        marginTop = this.props.anchor.offsetY + TIP_SIZE + PANEL_MARGIN + BUTTON_SIZE;\n      }\n      marginTop = marginTop + 'px';\n      marginLeft = marginLeft + 'px';\n    } else {\n      // Left or right placement: panel is too tall to completely display above or below the anchor point.\n      if (preferred == 'left') {\n        marginLeft = this.props.anchor.offsetX - hSize - TIP_SIZE - PANEL_MARGIN + bubbleMargin;\n      } else { // right\n        marginLeft = this.props.anchor.offsetX + PANEL_MARGIN + TIP_SIZE + BUTTON_SIZE;\n      }\n      if (vSize > this.props.viewportBounds.height) {\n        // The panel is taller than viewport: align to the exact middle.\n        marginTop = (this.props.viewportBounds.height - vSize) / 2 - this.props.anchor.viewY;\n      } else {\n        // Click above or below center of viewport?\n        const above = this.props.viewportBounds.height / 2 > this.props.anchor.viewY;\n        if (above) {\n          // More space below the anchor point (message is close to top).\n          // Keep panel close to top.\n          marginTop = -this.props.anchor.viewY + this.props.anchor.offsetY + PANEL_MARGIN + BUTTON_SIZE / 2;\n        } else {\n          // More space above the anchor point (message is close to bottom).\n          // Keep panel close to top.\n          marginTop = spaceBottom - PANEL_MARGIN + this.props.anchor.offsetY + BUTTON_SIZE / 2;\n        }\n      }\n      // Vertical placement of tip: place close to the anchor position.\n      this.setState({ tipTop: Math.max(TIP_STOP, Math.min(vSize - TIP_STOP - TIP_SIZE * 2,\n         this.props.anchor.offsetY - marginTop)) + 'px' });\n      marginTop = marginTop + 'px';\n      marginLeft = marginLeft + 'px';\n    }\n\n    // Tail placement above or below the panel depends on whether panel is above or below click point.\n    this.setState({ placeAbove: preferred });\n\n    // Only update state if values changed to avoid rerenders: new object triggers rerender.\n    let newPos = { marginLeft: marginLeft, marginTop: marginTop };\n    if (!objectEqual(this.state.position, newPos)) {\n      this.setState({ position: newPos });\n    }\n  }\n\n  render() {\n    const prefix = this.props.dataTestPrefix || 'reaction-picker';\n    const style = { ...this.state.position };\n    if (this.state.placeAbove == 'top' || this.state.placeAbove == 'bottom') {\n      style['--tip-left'] = this.state.tipLeft;\n      style['--tip-top'] = 'unset';\n    } else {\n      style['--tip-left'] = 'unset';\n      style['--tip-top'] = this.state.tipTop;\n    }\n    return (\n      <div ref={this.rootRef}\n          className={`reaction-picker ${this.state.placeAbove}${this.state.expanded ? ' expanded' : ''} `}\n          role=\"dialog\" aria-label=\"emoji picker\" style={style}>\n        {(this.props.reactionList || [])\n            .slice(0, this.state.expanded ? MAX_EMOJIS : REACTIONS_COLLAPSED_COUNT)\n            .map((emo, i) => {\n              const applied = (this.props.reactions || []).find(r => r.val == emo);\n              const count = (applied && applied.count > 1) ? (applied.count | 0) : false;\n              const mine = applied && applied.users.includes(this.props.myUserId);\n              return <div\n                key={emo}\n                ref={el => this.emojiRefs[i] = el}\n                className={`reaction-picker-btn${mine ? ' mine' : applied ? ' applied' : ''}`}\n                data-testid={`${prefix}-${emo}`}\n                onClick={() => { this.selectEmoji(emo); }}\n                onKeyDown={(e) => { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); this.selectEmoji(emo); } }}\n                role=\"button\"\n                tabIndex={0}\n                aria-label={`react ${emo}`}>\n                {emo}\n                {count && <CountBadge rect={true} count={count} size=\"medium\"\n                  style={{ position: 'absolute', right: '-2px',bottom: '-2px' }} />\n                }\n              </div>;\n        })}\n        {(!this.state.expanded && (this.props.reactionList || []).length > REACTIONS_COLLAPSED_COUNT) &&\n          <>\n          <div className=\"divider\"/>\n          <div className=\"reaction-picker-btn\" role=\"button\" data-testid=\"reaction-expand\"\n              onClick={() => this.setState({expanded: true}, () => this.updatePosition())}>\n            <i className=\"m-icon\">expand_more</i>\n          </div>\n          </>}\n      </div>\n    );\n  }\n}\n\nexport default ReactionPicker;\n","// Single chat message bubble, sent or received.\n\nimport React from 'react';\nimport { FormattedMessage, injectIntl } from 'react-intl';\nimport { Drafty, Tinode, TheCard } from 'tinode-sdk';\n\nimport Attachment from './attachment.jsx';\nimport LetterTile from './letter-tile.jsx';\nimport ReactionStrip from './reaction-strip.jsx';\nimport ReceivedMarker from './received-marker.jsx'\n\nimport { fullFormatter } from '../lib/formatters.js';\nimport { sanitizeUrl } from '../lib/utils.js';\nimport ReactionPicker from './reaction-picker.jsx';\nimport HashNavigation from '../lib/navigation.js';\n\n/*\nconst testReactions = [\n  {val: '', count: 2, users: ['user1', 'user2']},\n  {val: '', count: 1, users: ['user3']},\n  {val: '', count: 5, users: ['user4', 'user5', 'user6', 'user7', 'user8']},\n  {val: '', count: 3, users: ['user9', 'user10', 'user11']},\n  {val: \"\", count: 1, users: ['user1']},\n  {val: \"\", count: 2, users: ['user1', 'user2']},\n  {val: \"\", count: 1, users: ['user1']},\n  {val: \"\", count: 1, users: ['user1']},\n  {val: \"\", count: 4, users: ['user1', 'user2', 'user3', 'user4']},\n  {val: \"\", count: 1, users: ['user1']},\n  {val: \"\", count: 2, users: ['user1', 'user2']},\n  {val: \"\", count: 1, users: ['user1']}\n];\n*/\n\nclass BaseChatMessage extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      progress: 0\n    };\n\n    if (props.uploader) {\n      props.uploader.onProgress = this.handleProgress.bind(this);\n    }\n\n    this.handleExpandImage = this.handleExpandImage.bind(this);\n    this.handlePlayVideo = this.handlePlayVideo.bind(this);\n    this.handleFormButtonClick = this.handleFormButtonClick.bind(this);\n    this.handleQuoteClick = this.handleQuoteClick.bind(this);\n    this.handleContextClick = this.handleContextClick.bind(this);\n    this.handleCancelUpload = this.handleCancelUpload.bind(this);\n    this.handleQuoteClick = this.handleQuoteClick.bind(this);\n    this.handleTogglePicker = this.handleTogglePicker.bind(this);\n    this.handleReactionSelected = this.handleReactionSelected.bind(this);\n    this.handleDraftyClick = this.handleDraftyClick.bind(this);\n\n    this.formatterContext = {\n      formatMessage: props.intl.formatMessage.bind(props.intl),\n      viewportWidth: props.viewportWidth,\n      authorizeURL: props.tinode.authorizeURL.bind(props.tinode),\n\n      onHandleClick: this.handleDraftyClick\n    };\n  }\n\n  handleDraftyClick = (e, action) => {\n    switch (action) {\n      case 'image':\n        this.handleExpandImage(e);\n        break;\n      case 'video':\n        this.handlePlayVideo(e);\n        break;\n      case 'form_button':\n        this.handleFormButtonClick(e);\n        break;\n      case 'quote':\n        this.handleQuoteClick(e);\n        break;\n      case 'contact_chat':\n        e.preventDefault();\n        try {\n          // tinode:id/usr123abc -> usr123abc\n          const pathname = new URL(e.target.dataset.val)?.pathname;\n          const parts = pathname.split('/').filter(Boolean);\n          HashNavigation.navigateTo(HashNavigation.setUrlTopic('', parts.pop() || ''));\n        } catch (error) {\n          console.error(\"Invalid URL:\", error);\n        }\n        break;\n      case 'contact_find':\n        e.preventDefault();\n        let hashUrl = HashNavigation.setUrlSidePanel(window.location.hash, 'newtpk');\n        hashUrl = HashNavigation.addUrlParam(hashUrl, 'q', e.target.dataset.val);\n        hashUrl = HashNavigation.addUrlParam(hashUrl, 'tab', 'find');\n        HashNavigation.navigateTo(hashUrl);\n        break;\n      default:\n        // No special handling; let the browser deal with it.\n        console.info('Unhandled drafty action.', action, e.target.dataset);\n        break;\n    }\n  }\n\n  handleExpandImage(e) {\n    e.preventDefault();\n    this.props.onExpandMedia({\n      url: e.target.src,\n      filename: e.target.dataset.name,\n      width: e.target.dataset.width,\n      height: e.target.dataset.height,\n      size: e.target.dataset.size,\n      type: e.target.dataset.mime\n    });\n  }\n\n  handlePlayVideo(e) {\n    e.preventDefault();\n    this.props.onExpandMedia({\n      video: true,\n      url: e.target.dataset.src,\n      preview: e.target.src,\n      filename: e.target.dataset.name,\n      width: e.target.dataset.width,\n      height: e.target.dataset.height,\n      duration: e.target.dataset.duration,\n      size: e.target.dataset.size,\n      type: e.target.dataset.mime\n    });\n  }\n\n  handleFormButtonClick(e) {\n    e.preventDefault();\n    const data = {\n      seq: this.props.seq\n    };\n    data.resp = {};\n    if (e.target.dataset.name) {\n      data.resp[e.target.dataset.name] = e.target.dataset.val ? e.target.dataset.val :\n        e.target.dataset.val === undefined ? 1 : '' + e.target.dataset.val;\n    }\n    if (e.target.dataset.act == 'url') {\n      data.ref = sanitizeUrl(e.target.dataset.ref) || 'about:blank';\n    }\n    const text = e.target.dataset.title || 'unknown';\n    this.props.onFormResponse(e.target.dataset.act, text, data);\n  }\n\n  handleContextClick(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    const menuItems = [];\n    if (this.props.received == Tinode.MESSAGE_STATUS_FAILED) {\n      menuItems.push('menu_item_send_retry');\n    }\n    if (this.props.received > Tinode.MESSAGE_STATUS_FATAL) {\n      if (this.props.userIsWriter) {\n        menuItems.push('menu_item_reply');\n        if (!this.props.response) {\n          let immutable = false;\n          Drafty.entities(this.props.content, (_0, _1, tp) => {\n            immutable = ['AU', 'EX', 'FM', 'IM', 'TC', 'VC', 'VD'].includes(tp);\n            return immutable;\n          });\n          if (!immutable) {\n            Drafty.styles(this.props.content, tp => {\n              immutable = ['QQ'].includes(tp);\n              return immutable;\n            });\n          }\n          if (!immutable) {\n            menuItems.push('menu_item_edit');\n          }\n        }\n      }\n      if (this.props.userIsAdmin) {\n        menuItems.push(this.props.pinned ? 'menu_item_unpin' : 'menu_item_pin');\n      }\n    }\n    menuItems.push('menu_item_forward');\n\n    this.props.showContextMenu({\n      seq: this.props.seq,\n      replace: this.props.edited ? parseInt(this.props.edited.split(':')[1]) : 0,\n      content: this.props.content,\n      userFrom: this.props.userFrom,\n      userName: this.props.userName,\n      y: e.pageY,\n      x: e.pageX,\n      pickReply: this.props.pickReply,\n      editMessage: this.props.editMessage,\n      timestamp: this.props.timestamp,\n    }, menuItems);\n  }\n\n  handleProgress(ratio) {\n    this.setState({progress: ratio});\n  }\n\n  handleCancelUpload() {\n    this.props.onCancelUpload(this.props.seq, this.props.uploader);\n  }\n\n  handleQuoteClick(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    const replyToSeq = this.props.replyToSeq;\n    if (replyToSeq) {\n      this.props.onQuoteClick(replyToSeq);\n    }\n  }\n\n  handleTogglePicker(e) {\n    e.preventDefault();\n\n    if (this.props.showPicker) {\n      this.props.onToggleReactionPicker(-1);\n      return;\n    }\n\n    // Capture app bounds so the picker can position itself.\n    // Center of the button is used as the click coordinates.\n    const parentRect = this.props.parentRef.getBoundingClientRect();\n    const buttonRect = e.target.getBoundingClientRect();\n    this.setState({\n      pickerAnchor: {\n        viewX: buttonRect.left + buttonRect.width / 2 - parentRect.left,\n        viewY: buttonRect.top + buttonRect.height / 2 - parentRect.top,\n        offsetX: e.target.offsetLeft,\n        offsetY: e.target.offsetTop\n      },\n      parentBounds: {\n        width: parentRect.right - parentRect.left,\n        height: parentRect.bottom - parentRect.top,\n      }\n    });\n\n    this.props.onToggleReactionPicker(this.props.seq);\n  }\n\n  handleReactionSelected(e, emo) {\n    this.props.onReact(this.props.seq, emo);\n  }\n\n  render() {\n    const sideClass = this.props.sequence + ' ' + (this.props.response ? 'left' : 'right');\n    const bubbleClass = (this.props.sequence == 'single' || this.props.sequence == 'last') ? 'bubble tip' : 'bubble';\n    const avatar = this.props.userAvatar || true;\n    let textSizeClass = 'message-content';\n    const fullDisplay = (this.props.isGroup && this.props.response &&\n      (this.props.sequence == 'single' || this.props.sequence == 'last'));\n\n    let content = this.props.content;\n    const attachments = [];\n    if (this.props.mimeType == Drafty.getContentType() && Drafty.isValid(content)) {\n      Drafty.attachments(content, (att, i) => {\n        if (Drafty.isFormResponseType(att.mime)) {\n          // Don't show json drafty form response objects as attachments.\n          // They are not meant for users.\n          return;\n        }\n        attachments.push(<Attachment\n          tinode={this.props.tinode}\n          downloadUrl={Drafty.getDownloadUrl(att)}\n          filename={att.name}\n          uploading={Drafty.isProcessing(att)}\n          mimetype={att.mime}\n          size={Drafty.getEntitySize(att)}\n          progress={this.state.progress}\n          onCancelUpload={this.handleCancelUpload}\n          onError={this.props.onError}\n          key={i} />);\n      }, this);\n      const tree = Drafty.format(content, fullFormatter, this.formatterContext);\n      content = React.createElement(React.Fragment, null, tree);\n    } else if (typeof content == 'string') {\n      // Make font bigger for emoji-only messages.\n      // Must use 'new RegExp(...)' because React does not like /{1-5}/.\n      if (new RegExp('^\\\\p{RGI_Emoji}{1,5}$', 'v').test(content || '')) {\n        // Content consists of 1-5 emoji characters. Count how many and use it to increase the font size.\n        textSizeClass += ' emoji-' + (content || '').match(/\\p{RGI_Emoji}/vg).length;\n      }\n    } else {\n      content = <><i className=\"m-icon gray\">warning_amber</i> <i className=\"gray\">\n        <FormattedMessage id=\"invalid_content\"\n          defaultMessage=\"invalid content\" description=\"Shown when the message is unreadable\" /></i></>\n    }\n\n    return (\n      <li ref={this.props.innerRef} className={sideClass}>\n        {this.props.isGroup && this.props.response ?\n          <div className=\"avatar-box\">\n            {fullDisplay ?\n              <LetterTile\n                authorizeURL={this.props.tinode.authorizeURL}\n                topic={this.props.userFrom}\n                title={this.props.userName}\n                avatar={avatar} /> :\n              null}\n          </div> :\n          null}\n        <div>\n          <div className={bubbleClass}>\n            <div className=\"content-meta\">\n              <div className={textSizeClass}>\n                {content}\n                {attachments}\n              </div>\n              {this.props.reactionList ?\n                <ReactionStrip\n                  reactions={this.props.reactions}\n                  reactionList={this.props.reactionList}\n                  maxReactions={this.props.maxReactions}\n                  myUserId={this.props.myUserId}\n                  pickerShown={this.props.showPicker}\n                  onTogglePicker={this.handleTogglePicker}\n                  onReactionSelected={this.handleReactionSelected} />\n                : <div style={{height: '0.25rem'}}></div>\n              }\n              {this.props.timestamp ?\n                <ReceivedMarker\n                  edited={this.props.edited}\n                  timestamp={this.props.timestamp}\n                  received={this.props.received}\n                  style={{ marginBottom: this.props.reactionList ? 'unset' : '0.25rem' }} />\n                : null}\n            </div>\n            {this.props.showContextMenu ?\n              <span className=\"menuTrigger\">\n                <a href=\"#\" onClick={this.handleContextClick}>\n                  <i className=\"m-icon\">expand_more</i>\n                </a>\n              </span> : null\n            }\n          </div>\n          {this.props.showPicker ?\n            <ReactionPicker\n              reactions={this.props.reactions}\n              reactionList={this.props.reactionList}\n              maxReactions={this.props.maxReactions}\n              myUserId={this.props.myUserId}\n              leftBubble={this.props.response}\n              anchor={this.state.pickerAnchor}\n              viewportBounds={this.state.parentBounds}\n              onSelect={(emo) => this.handleReactionSelected(null, emo)}\n              onClose={() => this.props.onToggleReactionPicker(-1)}\n              dataTestPrefix=\"reaction-picker\" />\n            : null}\n          {fullDisplay ?\n            <div className=\"author\">\n              {this.props.userName ||\n                <i><FormattedMessage id=\"user_not_found\" defaultMessage=\"Not found\"\n                  description=\"In place of a user's full name when the user is not found.\" /></i>\n              }\n            </div>\n            : null\n          }\n        </div>\n      </li>\n    );\n  }\n};\n\nconst IntlChatMessage = injectIntl(BaseChatMessage);\nconst ChatMessage = React.forwardRef((props, ref) => <IntlChatMessage innerRef = {ref} {...props} />);\n\nexport default ChatMessage;\n","// GroupSubs: a list of group subscribers currently online.\n// Show in the topic title bar\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nimport { MAX_ONLINE_IN_TOPIC } from '../config.js'\n\nimport LetterTile from './letter-tile.jsx';\nimport { makeImageUrl } from '../lib/blob-helpers.js';\n\nexport default class GroupSubs extends React.Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    const usersOnline = [];\n    const totalCount = (this.props.subscribers || []).length;\n    const countToShow = Math.min(MAX_ONLINE_IN_TOPIC, totalCount);\n\n    (this.props.subscribers || []).some((sub) => {\n      usersOnline.push(\n        <div className=\"avatar-box\" key={sub.user}>\n          <LetterTile\n            authorizeURL={this.props.tinode.authorizeURL}\n            topic={sub.user}\n            avatar={makeImageUrl(sub.public ? sub.public.photo : null) || true}\n            title={sub.public ? sub.public.fn : null} />\n        </div>\n      );\n      return usersOnline.length == countToShow;\n    });\n    if (usersOnline.length == 0) {\n      return null;\n    }\n    return (\n      <div id=\"topic-users\">{usersOnline} {totalCount > countToShow ?\n        <span>\n          <FormattedMessage id=\"more_online_members\" defaultMessage=\"+{overflow} more\"\n              description=\"Shown in MessagesView title bar when the number of online subscribers exceeds MAX_ONLINE_IN_TOPIC\"\n              values={{ overflow: (totalCount - countToShow) }} />\n        </span> : null}\n      </div>\n    );\n  }\n};\n","// A single topic or user.\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nexport default class Invitation extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.handleButtonAction = this.handleButtonAction.bind(this);\n  }\n\n  handleButtonAction(evt, data) {\n    evt.preventDefault();\n    this.props.onAction(data);\n  }\n\n  render() {\n    return (\n      <div className=\"accept-invite-panel\">\n        <div className=\"title\">\n          <FormattedMessage id=\"chat_invitation\"\n            defaultMessage=\"You are invited to start a new chat. What would you like to do?\"\n            description=\"New chat invitation message: [Accept] [Ignore] [Block].\" />\n        </div>\n        <div className=\"footer\">\n          <button className=\"primary\" onClick={event => { this.handleButtonAction(event, \"accept\"); }}>\n            <FormattedMessage id=\"chat_invitation_accept\"\n              defaultMessage=\"Accept\" description=\"Action [Accept] for chat invitation.\" />\n          </button>\n          <button className=\"secondary\" onClick={event => { this.handleButtonAction(event, \"delete\"); }}>\n            <FormattedMessage id=\"chat_invitation_ignore\"\n              defaultMessage=\"Ignore\" description=\"Action [Ignore] for chat invitation.\" />\n          </button>\n          <button className=\"secondary\" onClick={event => { this.handleButtonAction(event, \"block\"); }}>\n            <FormattedMessage id=\"chat_invitation_block\"\n              defaultMessage=\"Block\" description=\"Action [Block] for chat invitation.\" />\n          </button>\n        </div>\n      </div>\n    );\n  }\n};\n","/* This is just a static page to display when no conversation is selected. */\nimport React from 'react';\nimport { FormattedMessage } from 'react-intl';\n\nimport { Tinode } from 'tinode-sdk';\n\nimport { APP_NAME } from '../config.js';\n\nexport default class LogoView extends React.PureComponent {\n  render() {\n    const version = APP_NAME + ' (' + Tinode.getLibrary() + ')';\n    return (\n      <div id=\"dummy-view\">\n        <div>\n          <a href=\"https://github.com/tinode/chat/\">\n            <img id=\"logo\" alt=\"logo\" src=\"img/logo.svg\" />\n            <h2>Tinode Web</h2>\n          </a>\n          <p><FormattedMessage id=\"label_client\" defaultMessage=\"Client:\"\n            description=\"Label for a client version\" /> {version}</p>\n          <p><FormattedMessage id=\"label_server\" defaultMessage=\"Server:\"\n            description=\"Label for a server version\" /> {this.props.serverVersion} ({this.props.serverAddress})</p>\n        </div>\n      </div>\n    );\n  }\n};\n","// Message bubble with non-payload content, such as an indicator of deleted content or a date stamp.\n\nimport React from 'react';\n\nexport default class MetaMessage extends React.PureComponent {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    let content = null;\n    let bubbleClass = 'bubble';\n    if (this.props.date) {\n      // A date badge.\n      content = <>{this.props.date}</>\n      bubbleClass += ' date';\n    }\n\n    if (!content) {\n      return <>{null}</>\n    }\n\n    return (\n      <li className=\"meta\">\n        <div className={bubbleClass}>\n          <div className=\"message-content\">\n            {content}\n          </div>\n        </div>\n      </li>\n    );\n  }\n};\n","// Send message form.\nimport React from 'react';\nimport { defineMessages, injectIntl } from 'react-intl';\nimport { Drafty } from 'tinode-sdk';\n\nimport { previewFormatter } from '../lib/formatters.js';\nimport { MIN_SWIPE_DISTANCE } from '../config.js';\n\nconst messages = defineMessages({\n  message_not_found: {\n    id: 'message_not_found',\n    defaultMessage: 'message not found',\n    description: 'Pinned message is not found'\n  },\n  message_deleted: {\n    id: 'message_deleted',\n    defaultMessage: 'message deleted',\n    description: 'Pinned message is deleted'\n  }\n});\n\nclass PinnedMessages extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    // Starting location of the touch gesture.\n    this.touchX = null;\n    this.touchY = null;\n\n    this.touchSurface = React.createRef();\n\n    this.getSelectedIndex = this.getSelectedIndex.bind(this);\n    this.handleCancel = this.handleCancel.bind(this);\n    this.handleSelected = this.handleSelected.bind(this);\n    this.handleMoveNext = this.handleMoveNext.bind(this);\n    this.handleMovePrev = this.handleMovePrev.bind(this);\n    this.handleTouchEventStart = this.handleTouchEventStart.bind(this);\n    this.handleTouchEventEnd = this.handleTouchEventEnd.bind(this);\n    this.handleTouchCancel = this.handleTouchCancel.bind(this);\n  }\n\n  componentDidMount() {\n    this.touchSurface.current.addEventListener('touchstart', this.handleTouchEventStart, {passive: true});\n    this.touchSurface.current.addEventListener('touchend', this.handleTouchEventEnd, {passive: true});\n    this.touchSurface.current.addEventListener('touchcancel', this.handleTouchCancel, {passive: true});\n  }\n\n  componentWillUnmount() {\n    this.touchSurface.current.removeEventListener('touchstart', this.handleTouchEventStart);\n    this.touchSurface.current.removeEventListener('touchend', this.handleTouchEventEnd);\n    this.touchSurface.current.removeEventListener('touchcancel', this.handleTouchCancel);\n  }\n  getSelectedIndex() {\n    const list = (this.props.pins || []);\n    return list.length - this.props.selected - 1;\n  }\n\n  handleCancel(e) {\n    e.preventDefault();\n    this.props.onCancel(this.props.pins[this.getSelectedIndex()]);\n  }\n\n  handleSelected(e) {\n    e.preventDefault();\n    this.props.onSelected(this.props.pins[this.getSelectedIndex()]);\n  }\n\n  handleMoveNext(e, isTouch) {\n    // Don't call preventDefault for touch events.\n    isTouch || e.preventDefault();\n    e.stopPropagation();\n    const idx = Math.max(this.props.selected - 1, 0);\n    if (idx != this.props.selected) {\n      this.props.setSelected(idx);\n    }\n  }\n\n  handleMovePrev(e, isTouch) {\n    // Don't call preventDefault for touch events.\n    isTouch || e.preventDefault();\n    e.stopPropagation();\n    const idx = Math.min(this.props.selected + 1, (this.props.pins || []).length - 1);\n    if (idx != this.props.selected) {\n      this.props.setSelected(idx);\n    }\n  }\n\n  handleTouchEventStart(e) {\n    if (e.touches.length == 1) {\n      this.touchX = e.touches[0].clientX;\n      this.touchY = e.touches[0].clientY;\n    }\n  }\n\n  handleTouchEventEnd(e) {\n    if (this.touchX === null || e.changedTouches.length != 1) {\n      this.touchX = null;\n      return;\n    }\n\n    const dX = this.touchX - e.changedTouches[0].clientX;\n    const dY = this.touchY - e.changedTouches[0].clientY;\n    this.touchX = null;\n\n    if (Math.abs(dX) > Math.abs(dY) || Math.abs(dY) < MIN_SWIPE_DISTANCE) {\n      // Horizontal swipe or too short vertical swipe.\n      return;\n    }\n\n    if (dY > 0) {\n      this.handleMovePrev(e, true);\n    } else {\n      this.handleMoveNext(e, true);\n    }\n  }\n\n  handleTouchCancel() {\n    this.touchX = null;\n  }\n\n  render() {\n    const selected = this.getSelectedIndex();\n    let messageShown = (this.props.messages || [])[selected];\n    messageShown = messageShown ?\n        messageShown._deleted ?\n        <i className=\"gray\">{this.props.intl.formatMessage(messages.message_deleted)}</i>\n        :\n        Drafty.format(messageShown.content, previewFormatter, {\n          formatMessage: this.props.intl.formatMessage.bind(this.props.intl),\n          authorizeURL: this.props.tinode.authorizeURL.bind(this.props.tinode)\n        })\n      :\n      <i className=\"gray\">{this.props.intl.formatMessage(messages.message_not_found)}</i>;\n\n    const dots = [];\n    this.props.pins.forEach(seq => {\n      const cn = dots.length == selected ? 'adot' : 'dot';\n      dots.push(<div key={seq} className={cn} />);\n    });\n\n    return (\n      <div id=\"pinned-wrapper\" ref={this.touchSurface}>\n        {this.props.isAdmin ?\n          <div className=\"cancel\">\n            <a href=\"#\" onClick={this.handleCancel}><i className=\"m-icon gray\">close</i></a>\n          </div> :\n          <div><i className=\"m-icon gray\">push_pin</i></div>\n        }\n        <div className=\"pinned-scroll\">{dots}</div>\n        <div className=\"pinned\" onClick={this.handleSelected}><p>{messageShown}</p></div>\n        <div className=\"pinned-menu\">\n          <span className=\"menuTrigger upper\">\n            {selected > 0 ?\n              <a href=\"#\" onClick={this.handleMovePrev}>\n                <i className=\"m-icon\">expand_less</i>\n              </a>\n              : null\n            }\n          </span>\n          <span className=\"menuTrigger lower\">\n            {this.props.selected > 0 ?\n              <a href=\"#\" onClick={this.handleMoveNext}>\n                <i className=\"m-icon\">expand_more</i>\n              </a>\n              : null\n            }\n          </span>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default injectIntl(PinnedMessages);\n","// Panel with a chat.\n\nimport React, { Suspense } from 'react';\nimport { FormattedMessage, defineMessages, injectIntl } from 'react-intl';\n\nimport { Drafty, Tinode, TheCard } from 'tinode-sdk';\n\nconst CallPanel = React.lazy(_ => import('../widgets/call-panel.jsx'));\nimport ChatMessage from '../widgets/chat-message.jsx';\nimport ContactBadges from '../widgets/contact-badges.jsx';\nconst DocPreview = React.lazy(_ => import('../widgets/doc-preview.jsx'));\nimport ErrorPanel from '../widgets/error-panel.jsx';\nimport GroupSubs from '../widgets/group-subs.jsx';\nconst ImagePreview = React.lazy(_ => import('../widgets/image-preview.jsx'));\nimport Invitation from '../widgets/invitation.jsx';\nimport LetterTile from '../widgets/letter-tile.jsx';\nimport LoadSpinner from '../widgets/load-spinner.jsx';\nimport LogoView from './logo-view.jsx';\nimport MetaMessage from '../widgets/meta-message.jsx';\nimport PinnedMessages from '../widgets/pinned-messages.jsx';\nimport SendMessage from '../widgets/send-message.jsx';\nconst TheCardPreview = React.lazy(_ => import('../widgets/the-card-preview.jsx'));\nconst VideoPreview = React.lazy(_ => import('../widgets/video-preview.jsx'));\n\nimport { DEFAULT_P2P_ACCESS_MODE, EDIT_PREVIEW_LENGTH, IMAGE_PREVIEW_DIM, IMMEDIATE_P2P_SUBSCRIPTION,\n  DRAFTY_FR_MIME_TYPE_LEGACY, KEYPRESS_DELAY, MESSAGES_PAGE, MAX_EXTERN_ATTACHMENT_SIZE, MAX_IMAGE_DIM,\n  MAX_INBAND_ATTACHMENT_SIZE, READ_DELAY, QUOTED_REPLY_LENGTH, VIDEO_PREVIEW_DIM } from '../config.js';\nimport { CALL_STATE_OUTGOING_INITATED, CALL_STATE_IN_PROGRESS } from '../constants.js';\nimport { blobToBase64, fileToBase64, imageScaled, importVCard, makeImageUrl } from '../lib/blob-helpers.js';\nimport HashNavigation from '../lib/navigation.js';\nimport { bytesToHumanSize, relativeDateFormat, shortDateFormat } from '../lib/strformat.js';\n\n// Run timer with this frequency (ms) for checking notification queue.\nconst NOTIFICATION_EXEC_INTERVAL = 300;\n// Scroll distance before [go to latest message] button is shown.\nconst SHOW_GO_TO_LAST_DIST = 100;\n// Sctoll distance from the top when fetching the page of earlier messages is triggered.\nconst FETCH_PAGE_TRIGGER = 40;\n\nconst messages = defineMessages({\n  online_now: {\n    id: 'online_now',\n    defaultMessage: 'online now',\n    description: 'Indicator that the user or topic is currently online',\n  },\n  last_seen: {\n    id: 'last_seen_timestamp',\n    defaultMessage: 'Last seen: {timestamp}',\n    description: 'Label for the timestamp of when the user or topic was last online'\n  },\n  not_found: {\n    id: 'title_not_found',\n    defaultMessage: 'Not found',\n    description: 'Title shown when topic is not found'\n  },\n  channel: {\n    id: 'channel',\n    defaultMessage: 'channel',\n    description: 'Subtitle shown for channels in MessagesView instead of last seen'\n  },\n  file_attachment_too_large: {\n    id: 'file_attachment_too_large',\n    defaultMessage: 'The file size {size} exceeds the {limit} limit.',\n    description: 'Error message when attachment is too large'\n  },\n  invalid_content: {\n    id: 'invalid_content',\n    defaultMessage: 'invalid content',\n    description: 'Shown when the message is unreadable'\n  },\n  editing_message: {\n    id: 'editing_message',\n    defaultMessage: 'Editing',\n    description: 'Title over message editing preview'\n  },\n  drag_file: {\n    id: 'drag_file',\n    defaultMessage: 'Drag file here',\n    description: 'Prompt on the file drag-n-drop overlay banner'\n  },\n  self_topic_name: {\n    id: 'self_topic_name',\n    defaultMessage: 'Saved messages',\n    description: 'Name of self topic for UI'\n  },\n  subscriber_count: {\n    id: 'subscriber_count',\n    defaultMessage: '{count, plural, ' +\n      'one {{count, number} subscriber} ' +\n      'two {{count, number} subscribers} ' +\n      'three {{count, number} subscribers} ' +\n      'few {{count, number} subscribers} ' +\n      'many {{count, number} subscribers} ' +\n      'other {{count, number} subscribers}}',\n    description: 'Count of channel subscribers'\n  },\n  member_count: {\n    id: 'member_count',\n    defaultMessage: '{count, plural, ' +\n      'one {{count, number} member} ' +\n      'two {{count, number} members} ' +\n      'three {{count, number} members} ' +\n      'few {{count, number} members} ' +\n      'many {{count, number} members} ' +\n      'other {{count, number} members}}',\n    description: 'Count of group topic members'\n  },\n  cannot_parse_vcard: {\n    id: 'cannot_parse_vcard',\n    defaultMessage: 'Cannot parse vCard file.',\n    description: 'Error message when vCard file cannot be parsed'\n  }\n});\n\n// Checks if the access permissions are granted but not yet accepted.\nfunction isUnconfirmed(acs) {\n  if (acs) {\n    const ex = acs.getExcessive() || '';\n    return acs.isJoiner('given') && (ex.includes('R') || ex.includes('W'));\n  }\n  return false;\n}\n\nfunction isPeerRestricted(acs) {\n  if (acs) {\n    const ms = acs.getMissing() || '';\n    return acs.isJoiner('want') && (ms.includes('R') || ms.includes('W'));\n  }\n  return false;\n}\n\nfunction shouldPresentCallPanel(callState) {\n  // Show call panel if either:\n  // - call is outgoing (and the client is waiting for the other side to pick up) or,\n  // - call is already in progress.\n  return callState == CALL_STATE_OUTGOING_INITATED || callState == CALL_STATE_IN_PROGRESS;\n}\n\nclass MessagesView extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.state = MessagesView.getDerivedStateFromProps(props, {});\n\n    this.componentSetup = this.componentSetup.bind(this);\n    this.leave = this.leave.bind(this);\n    this.sendMessage = this.sendMessage.bind(this);\n    this.retrySend = this.retrySend.bind(this);\n    this.sendImageAttachment = this.sendImageAttachment.bind(this);\n    this.sendVideoAttachment = this.sendVideoAttachment.bind(this);\n    this.sendFileAttachment = this.sendFileAttachment.bind(this);\n    this.sendAudioAttachment = this.sendAudioAttachment.bind(this);\n    this.sendTheCardAttachment = this.sendTheCardAttachment.bind(this);\n    this.sendKeyPress = this.sendKeyPress.bind(this);\n    this.subscribe = this.subscribe.bind(this);\n    this.handleScrollReference = this.handleScrollReference.bind(this);\n    this.mountComponentEvents = this.mountComponentEvents.bind(this);\n    this.handleScrollEvent = this.handleScrollEvent.bind(this);\n    this.handleDescChange = this.handleDescChange.bind(this);\n    this.handleSubsUpdated = this.handleSubsUpdated.bind(this);\n    this.handleMessageUpdate = this.handleMessageUpdate.bind(this);\n    this.handleReactUpdate = this.handleReactUpdate.bind(this);\n    this.handleAuxUpdate = this.handleAuxUpdate.bind(this);\n    this.handleAllMessagesReceived = this.handleAllMessagesReceived.bind(this);\n    this.handleInfoReceipt = this.handleInfoReceipt.bind(this);\n    this.handleExpandMedia = this.handleExpandMedia.bind(this);\n    this.handleClosePreview = this.handleClosePreview.bind(this);\n    this.handleCallPanelToggle = this.handleCallPanelToggle.bind(this);\n    this.handleFormResponse = this.handleFormResponse.bind(this);\n    this.handleContextClick = this.handleContextClick.bind(this);\n    this.handleShowMessageContextMenu = this.handleShowMessageContextMenu.bind(this);\n    this.handleNewChatAcceptance = this.handleNewChatAcceptance.bind(this);\n    this.handleEnablePeer = this.handleEnablePeer.bind(this);\n    this.handleAttachFile = this.handleAttachFile.bind(this);\n    this.handleAttachImageOrVideo = this.handleAttachImageOrVideo.bind(this);\n    this.handleCancelUpload = this.handleCancelUpload.bind(this);\n    this.postReadNotification = this.postReadNotification.bind(this);\n    this.clearNotificationQueue = this.clearNotificationQueue.bind(this);\n    this.goToLatestMessage = this.goToLatestMessage.bind(this);\n    this.handleFileDrop = this.handleFileDrop.bind(this);\n\n    this.handlePickReply = this.handlePickReply.bind(this);\n    this.handleEditMessage = this.handleEditMessage.bind(this);\n    this.handleCancelReply = this.handleCancelReply.bind(this);\n    this.handleQuoteClick = this.handleQuoteClick.bind(this);\n    this.handleUnpinMessage = this.handleUnpinMessage.bind(this);\n    this.handleCallHangup = this.handleCallHangup.bind(this);\n\n    this.isDragEnabled = this.isDragEnabled.bind(this);\n\n    this.handleReact = this.handleReact.bind(this);\n    this.handleToggleReactionPicker = this.handleToggleReactionPicker.bind(this);\n\n    this.handleDragStart = this.handleDragStart.bind(this);\n    this.handleDragIn = this.handleDragIn.bind(this);\n    this.handleDragOut = this.handleDragOut.bind(this);\n    this.handleDrag = this.handleDrag.bind(this);\n    this.handleDrop = this.handleDrop.bind(this);\n\n    this.chatMessageRefs = [];\n    this.getOrCreateMessageRef = this.getOrCreateMessageRef.bind(this);\n    this.getVisibleMessageRange = this.getVisibleMessageRange.bind(this);\n\n    // Keeps track of the drag event.\n    // Need a counter b/c the browser's 'drag' events may fire multiple times\n    // when the user takes the mouse pointer over the container:\n    // for the component itself and for all nested/child elements.\n    this.dragCounter = 0;\n    this.componentRef = null;\n\n    this.readNotificationQueue = [];\n    this.readNotificationTimer = null;\n\n    this.keyPressTimer = null;\n  }\n\n  getOrCreateMessageRef(seqId) {\n    if (this.chatMessageRefs[seqId]) {\n      return this.chatMessageRefs[seqId];\n    }\n    const ref = React.createRef();\n    this.chatMessageRefs[seqId] = ref;\n    return ref;\n  }\n\n  getVisibleMessageRange(holderRect) {\n    let min = Number.MAX_SAFE_INTEGER, max = -1;\n    let visibilityStatus = false;\n    this.chatMessageRefs.every((ref, seq) => {\n      if (ref.current) {\n        const { top, bottom, height } = ref.current.getBoundingClientRect();\n        const visible = top <= holderRect.top ? holderRect.top - top <= height : bottom - holderRect.bottom <= height;\n        if (visible) {\n          visibilityStatus = true;\n          min = Math.min(min, seq);\n          max = Math.max(max, seq);\n        } else if (visibilityStatus) {\n          // The remaining elements are no longer visible, no need to iterate them.\n          return false;\n        }\n      }\n      return true;\n    });\n\n    return max >= min ? {min: min, max: max} : {min: 0, max: 0};\n  }\n\n  componentDidMount() {\n    if (this.messagesScroller) {\n      this.messagesScroller.addEventListener('scroll', this.handleScrollEvent);\n    }\n\n    // Drag and drop events\n    this.mountComponentEvents(this.componentRef);\n\n    this.componentSetup({}, {});\n  }\n\n  componentWillUnmount() {\n    if (this.messagesScroller) {\n      this.messagesScroller.removeEventListener('scroll', this.handleScrollEvent);\n    }\n\n    // Flush all notifications.\n    this.clearNotificationQueue();\n\n    // Drag and drop events\n    if (this.componentRef) {\n      this.componentRef.removeEventListener('dragstart', this.handleDragStart);\n      this.componentRef.removeEventListener('dragenter', this.handleDragIn);\n      this.componentRef.removeEventListener('dragleave', this.handleDragOut);\n      this.componentRef.removeEventListener('dragover', this.handleDrag);\n      this.componentRef.removeEventListener('drop', this.handleDrop);\n    }\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    // Scroll last message into view on component update e.g. on message received\n    // or vertical shrinking.\n    if (this.messagesScroller &&\n      (prevState.topic != this.state.topic || prevState.maxSeqId != this.state.maxSeqId ||\n        prevState.minSeqId != this.state.minSeqId)) {\n      // New message.\n      if (this.state.scrollPosition < SHOW_GO_TO_LAST_DIST) {\n        this.messagesScroller.scrollTop = this.messagesScroller.scrollHeight -\n          this.state.scrollPosition - this.messagesScroller.offsetHeight;\n      }\n    }\n\n    if (!this.props.applicationVisible) {\n      // If application is not visible, flush all unsent 'read' notifications.\n      this.clearNotificationQueue();\n    } else {\n      // Otherwise assume there are unread messages.\n      this.postReadNotification(0);\n    }\n\n    this.componentSetup(prevProps, prevState);\n  }\n\n  componentSetup(prevProps, prevState) {\n    const topic = this.props.tinode ? this.props.tinode.getTopic(this.state.topic) : undefined;\n    if (this.state.topic != prevState.topic) {\n      if (prevState.topic && !Tinode.isNewGroupTopicName(prevState.topic)) {\n        this.leave(prevState.topic);\n        if (prevState.rtcPanel) {\n          this.handleCallHangup(prevState.topic, prevProps.callSeq);\n        }\n      }\n\n      if (topic) {\n        topic.onData = this.handleMessageUpdate;\n        topic.onAllMessagesReceived = this.handleAllMessagesReceived;\n        topic.onInfo = this.handleInfoReceipt;\n        topic.onMetaDesc = this.handleDescChange;\n        topic.onSubsUpdated = this.handleSubsUpdated;\n        topic.onPres = this.handleSubsUpdated;\n        topic.onAuxUpdated = this.handleAuxUpdate;\n        topic.onReact = this.handleReactUpdate;\n      }\n    }\n\n    if (topic) {\n      if ((this.state.topic != prevState.topic) || (this.props.myUserId && !prevProps.myUserId)) {\n        // Don't immediately subscribe to a new p2p topic, wait for the first message.\n        const newTopic = (this.props.newTopicParams && this.props.newTopicParams._topicName == this.props.topic);\n        if (topic.isP2PType() && newTopic && !IMMEDIATE_P2P_SUBSCRIPTION) {\n          topic.getMeta(topic.startMetaQuery().withDesc().build());\n        } else if (this.props.myUserId) {\n          this.subscribe(topic);\n        }\n      } else if (topic.isSubscribed() && this.state.isReader && !prevState.isReader) {\n        // If reader status has changed and data became available.\n        topic.getMeta(topic.startMetaQuery().withLaterData().build());\n      }\n    }\n  }\n\n  static getDerivedStateFromProps(nextProps, prevState) {\n    let nextState = {};\n    if (!nextProps.topic) {\n      // Default state: no topic.\n      nextState = {\n        minSeqId: -1,\n        maxSeqId: -1,\n        latestClearId: -1,\n        onlineSubs: [],\n        topic: null,\n        title: '',\n        avatar: null,\n        isVerified: false,\n        isStaff: false,\n        isDangerous: false,\n        deleted: false,\n        docPreview: null,\n        imagePreview: null,\n        imagePostview: null,\n        videoPreview: null,\n        videoPostview: null,\n        rtcPanel: null,\n        minimizedCallPanel: false,\n        typingIndicator: false,\n        scrollPosition: 0,\n        fetchingMessages: false,\n        peerMessagingDisabled: false,\n        channel: false,\n        reply: null,\n        contentToEdit: null,\n        showGoToLastButton: false,\n        dragging: false,\n        pins: [],\n        pinsLoaded: false,\n        selectedPin: 0,\n        subsVersion: 0,\n        reactionPickerShownFor: -1,\n        reactionList: null,\n        maxReactions: 0,\n      };\n    } else if (nextProps.topic != prevState.topic) {\n      nextState = {\n        topic: nextProps.topic,\n        docPreview: null,\n        imagePreview: null,\n        imagePostview: null,\n        videoPreview: null,\n        videoPostview: null,\n        rtcPanel: null,\n        minimizedCallPanel: false,\n        typingIndicator: false,\n        scrollPosition: 0,\n        fetchingMessages: false,\n        showGoToLastButton: false,\n        contentToEdit: null,\n        dragging: false,\n        selectedPin: 0,\n        reactionPickerShownFor: -1,\n      };\n\n      if (nextProps.forwardMessage) {\n        if (nextProps.forwardMessage.content) {\n          const content = nextProps.forwardMessage.content;\n          const size = content?.length || (content?.size || 0);\n          nextState.docPreview = {\n            object: content,\n            type: nextProps.forwardMessage.type,\n            size: size\n          };\n        } else {\n          // We are forwarding a message. Show preview.\n          nextState.reply = {\n            content: nextProps.forwardMessage.preview,\n            seq: null\n          };\n        }\n      } else {\n        nextState.reply = null;\n      }\n\n      const topic = nextProps.tinode.getTopic(nextProps.topic);\n      if (topic) {\n        // Topic exists.\n        nextState.deleted = topic._deleted;\n\n        const subs = [];\n        if (nextProps.connected) {\n          topic.subscribers((sub) => {\n            if (sub.online && sub.user != nextProps.myUserId) {\n              subs.push(sub);\n            }\n          });\n        }\n\n        Object.assign(nextState, {\n          onlineSubs: subs\n        });\n\n        if (topic.isSelfType()) {\n          Object.assign(nextState, {\n            title: nextProps.intl.formatMessage(messages.self_topic_name),\n            avatar: true\n          });\n        } else if (topic.public) {\n          Object.assign(nextState, {\n            title: topic.public.fn,\n            avatar: makeImageUrl(topic.public.photo)\n          });\n        } else {\n          Object.assign(nextState, {\n            title: '',\n            avatar: null\n          });\n        }\n\n        const peer = topic.p2pPeerDesc();\n        if (peer) {\n          Object.assign(nextState, {\n            peerMessagingDisabled: isPeerRestricted(peer.acs)\n          });\n        } else if (prevState.peerMessagingDisabled) {\n          Object.assign(nextState, {\n            peerMessagingDisabled: false\n          });\n        }\n        Object.assign(nextState, {\n          minSeqId: topic.minMsgSeq(),\n          maxSeqId: topic.maxMsgSeq(),\n          latestClearId: topic.maxClearId(),\n          channel: topic.isChannelType(),\n          pins: (topic.aux('pins') || []).slice(),\n          pinsLoaded: false\n        });\n\n        if (nextProps.callTopic == topic.name && shouldPresentCallPanel(nextProps.callState)) {\n          nextState.rtcPanel = nextProps.callTopic;\n        }\n\n        nextState.reactionList = topic.reactions();\n        nextState.maxReactions = topic.maxReactions();\n      } else {\n        // Invalid topic.\n        Object.assign(nextState, {\n          minSeqId: -1,\n          maxSeqId: -1,\n          latestClearId: -1,\n          onlineSubs: [],\n          title: '',\n          avatar: null,\n          peerMessagingDisabled: false,\n          channel: false,\n          pins: [],\n          pinsLoaded: false\n        });\n      }\n    } else {\n      // We are still in same topic. Show the call panel if necessary.\n      if (nextProps.callTopic == prevState.topic && !prevState.rtcPanel &&\n          shouldPresentCallPanel(nextProps.callState)) {\n        nextState.rtcPanel = nextProps.callTopic;\n      }\n    }\n\n    if (nextProps.acs) {\n      if (nextProps.acs.isWriter() != prevState.isWriter) {\n        nextState.isWriter = !prevState.isWriter;\n      }\n      if (nextProps.acs.isReader() != prevState.isReader) {\n        nextState.isReader = !prevState.isReader;\n      }\n      if (nextProps.acs.isAdmin() != prevState.isAdmin) {\n        nextState.isAdmin = !prevState.isAdmin;\n      }\n      if (!nextProps.acs.isReader('given') != prevState.readingBlocked) {\n        nextState.readingBlocked = !prevState.readingBlocked;\n      }\n      if (nextProps.acs.isSharer() != prevState.isSharer) {\n        nextState.isSharer = !prevState.isSharer;\n      }\n    } else {\n      if (prevState.isWriter) {\n        nextState.isWriter = false;\n      }\n      if (prevState.isReader) {\n        nextState.isReader = false;\n      }\n      if (prevState.isAdmin) {\n        nextState.isAdmin = false;\n      }\n      if (!prevState.readingBlocked) {\n        prevState.readingBlocked = true;\n      }\n      if (prevState.isSharer) {\n        nextState.isSharer = false;\n      }\n    }\n\n    if (isUnconfirmed(nextProps.acs) == !prevState.unconformed) {\n      nextState.unconfirmed = !prevState.unconformed;\n    }\n\n    // Clear subscribers online when there is no connection.\n    if (!nextProps.connected && prevState.onlineSubs && prevState.onlineSubs.length > 0) {\n      nextState.onlineSubs = [];\n    }\n\n    return nextState;\n  }\n\n  subscribe(topic) {\n    if (topic.isSubscribed() || !this.props.ready) {\n      return;\n    }\n\n    // Is this a new topic?\n    const newTopic = (this.props.newTopicParams && this.props.newTopicParams._topicName == this.props.topic);\n    // Don't request the tags. They are useless unless the user\n    // is the owner and is editing the topic.\n    let getQuery = topic.startMetaQuery().withLaterDesc().withLaterSub().withAux();\n    if (this.state.isReader || newTopic) {\n      // Reading is either permitted or we don't know because it's a new topic. Ask for messages.\n      getQuery = getQuery.withLaterData(MESSAGES_PAGE);\n      if (this.state.isReader) {\n        getQuery = getQuery.withLaterDel();\n      }\n      // And show \"loading\" spinner.\n      this.setState({ fetchingMessages: true });\n    }\n\n    const setQuery = newTopic ? this.props.newTopicParams : undefined;\n    topic.subscribe(getQuery.build(), setQuery)\n      .then(ctrl => {\n        if (ctrl.code == 303) {\n          // Redirect to another topic requested.\n          HashNavigation.navigateTo(HashNavigation.setUrlTopic('', ctrl.params.topic));\n          return;\n        }\n        if (this.state.topic != ctrl.topic) {\n          this.setState({topic: ctrl.topic});\n        }\n        if (this.state.deleted) {\n          this.setState({deleted: false});\n        }\n        this.props.onNewTopicCreated(this.props.topic, ctrl.topic);\n        // If there are unsent messages (except hard-failed and video call messages),\n        // try sending them now. Hard-failed and unsent video call messages will be dropped.\n        let discard = [];\n        topic.queuedMessages(pub => {\n          if (pub._sending) {\n            return;\n          }\n          if (pub._fatal || (pub.head && pub.head.webrtc)) {\n            // Filter out unsent failed & video call messages.\n            discard.push(pub.seq);\n            return;\n          }\n          if (topic.isSubscribed()) {\n            this.retrySend(pub);\n          }\n        });\n        if (discard.length > 0) {\n          topic.delMessagesList(discard, true);\n        }\n      })\n      .catch(err => {\n        console.error(\"Failed subscription to\", this.state.topic, err);\n        this.props.onError(err.message, 'err');\n        const blankState = MessagesView.getDerivedStateFromProps({}, {});\n        blankState.title = this.props.intl.formatMessage(messages.not_found);\n        this.setState(blankState);\n      });\n  }\n\n  leave(oldTopicName) {\n    if (!oldTopicName || !this.props.tinode.isTopicCached(oldTopicName)) {\n      return;\n    }\n\n    const oldTopic = this.props.tinode.getTopic(oldTopicName);\n    if (oldTopic && oldTopic.isSubscribed()) {\n      oldTopic.leave(false)\n        .catch(_ => { /* do nothing here */ })\n        .finally(_ => {\n          // We don't care if the request succeeded or failed.\n          // The topic is dead regardless.\n          this.setState({fetchingMessages: false});\n          oldTopic.onData = undefined;\n          oldTopic.onAllMessagesReceived = undefined;\n          oldTopic.onInfo = undefined;\n          oldTopic.onMetaDesc = undefined;\n          oldTopic.onSubsUpdated = undefined;\n          oldTopic.onPres = undefined;\n          oldTopic.onAuxUpdated = undefined;\n        });\n    }\n  }\n\n  // Don't use React.createRef as the ref.current is not available in componentDidMount in this component.\n  handleScrollReference(node) {\n    if (node) {\n      node.addEventListener('scroll', this.handleScrollEvent);\n      this.messagesScroller = node;\n      this.messagesScroller.scrollTop = this.messagesScroller.scrollHeight -\n        this.state.scrollPosition - this.messagesScroller.offsetHeight;\n    }\n  }\n\n  // Get older messages and show/hide [go to latest message] button.\n  handleScrollEvent(event) {\n    const pos = event.target.scrollHeight - event.target.scrollTop - event.target.offsetHeight;\n    this.setState({\n      scrollPosition: pos,\n      // Show [go to latest message] if far enough from bottom and scrolling down.\n      showGoToLastButton: (pos > SHOW_GO_TO_LAST_DIST) && (pos < this.state.scrollPosition),\n    });\n\n    if (this.state.fetchingMessages || this.processingScrollEvent) {\n      return;\n    }\n\n    if (event.target.scrollTop <= FETCH_PAGE_TRIGGER) {\n      const topic = this.props.tinode.getTopic(this.state.topic);\n      if (topic && topic.isSubscribed()) {\n        this.processingScrollEvent = true;\n        const {min, max} = this.getVisibleMessageRange(event.target.getBoundingClientRect());\n        const gaps = topic.msgHasMoreMessages(min, max, false);\n        if (gaps.length > 0) {\n          this.setState({fetchingMessages: true}, _ => {\n            topic.getMessagesPage(MESSAGES_PAGE, gaps, min, max)\n              .catch(err => this.props.onError(err.message, 'err'))\n              .finally(_ => this.setState({fetchingMessages: false}));\n            });\n        }\n      }\n    }\n    this.processingScrollEvent = false;\n  }\n\n  /* Mount drag and drop events */\n  mountComponentEvents(componentRef) {\n    if (componentRef) {\n      componentRef.addEventListener('dragstart', this.handleDragStart);\n      componentRef.addEventListener('dragenter', this.handleDragIn);\n      componentRef.addEventListener('dragleave', this.handleDragOut);\n      componentRef.addEventListener('dragover', this.handleDrag);\n      componentRef.addEventListener('drop', this.handleDrop);\n      this.componentRef = componentRef;\n    }\n  }\n\n  goToLatestMessage() {\n    this.setState({scrollPosition: 0});\n    if (this.messagesScroller) {\n      this.messagesScroller.scrollTop = this.messagesScroller.scrollHeight - this.messagesScroller.offsetHeight;\n    }\n  }\n\n  handleDescChange(desc) {\n    if (Tinode.isSelfTopicName(this.props.topic)) {\n      this.setState({\n        title: this.props.intl.formatMessage(messages.self_topic_name),\n        avatar: true\n      });\n    } else if (desc.public) {\n      this.setState({\n        title: desc.public.fn,\n        avatar: makeImageUrl(desc.public.photo)\n      });\n    } else {\n      this.setState({\n        title: '',\n        avatar: null\n      });\n    }\n\n    if (desc.acs) {\n      this.setState({\n        isWriter: desc.acs.isWriter(),\n        isReader: desc.acs.isReader(),\n        isAdmin: desc.acs.isAdmin(),\n        readingBlocked: !desc.acs.isReader('given'),\n        unconfirmed: isUnconfirmed(desc.acs),\n      });\n    }\n  }\n\n  postReadNotification(seq) {\n    // Ignore notifications if the app is invisible or topic is not yet available.\n    if (!this.props.applicationVisible || !this.state.topic) {\n      return;\n    }\n\n    // Set up the timer if it's not running already.\n    if (!this.readNotificationTimer) {\n      this.readNotificationTimer = setInterval(_ => {\n        const topic = this.props.tinode.getTopic(this.state.topic);\n        if (topic) {\n          topic.markReactionsSeen();\n        }\n        if (this.readNotificationQueue.length == 0) {\n          // Shut down the timer if the queue is empty.\n          clearInterval(this.readNotificationTimer);\n          this.readNotificationTimer = null;\n          return;\n        }\n\n        let seq = -1;\n        while (this.readNotificationQueue.length > 0) {\n          const n = this.readNotificationQueue[0];\n          if (n.topicName != this.state.topic) {\n            // Topic has changed. Drop the notification.\n            this.readNotificationQueue.shift();\n            continue;\n          }\n\n          const now = new Date();\n          if (n.sendAt <= now) {\n            // Remove expired notification from queue.\n            this.readNotificationQueue.shift();\n            if (n.seq == 0 || Tinode.isServerAssignedSeq(n.seq)) {\n              seq = Math.max(seq, n.seq);\n            }\n          } else {\n            break;\n          }\n        }\n\n        // Send only one notification for the whole batch of messages.\n        if (seq >= 0) {\n          try {\n            topic.noteRead(seq);\n          } catch (err) {\n            console.error(\"Failed to send read notification\", err);\n          }\n        }\n      }, NOTIFICATION_EXEC_INTERVAL);\n    }\n\n    const now = new Date();\n    this.readNotificationQueue.push({\n      topicName: this.state.topic,\n      seq: seq,\n      sendAt: now.setMilliseconds(now.getMilliseconds() + READ_DELAY)\n    });\n  }\n\n  // Clear notification queue and timer.\n  clearNotificationQueue() {\n    this.readNotificationQueue = [];\n    if (this.readNotificationTimer) {\n      clearInterval(this.readNotificationTimer);\n      this.readNotificationTimer = null;\n    }\n  }\n\n  handleSubsUpdated() {\n    if (this.state.topic) {\n      const subs = [];\n      const topic = this.props.tinode.getTopic(this.state.topic);\n      topic.subscribers(sub => {\n        if (sub.online && sub.user != this.props.myUserId) {\n          subs.push(sub);\n        }\n      });\n      const newState = {onlineSubs: subs, subsVersion: this.state.subsVersion + 1};\n      const peer = topic.p2pPeerDesc();\n      if (peer) {\n        Object.assign(newState, {\n          peerMessagingDisabled: isPeerRestricted(peer.acs)\n        });\n      } else if (this.state.peerMessagingDisabled) {\n        Object.assign(newState, {\n          peerMessagingDisabled: false\n        });\n      }\n      this.setState(newState);\n    }\n  }\n\n  // The 'msg' could be false-ish if some message ranges were deleted.\n  handleMessageUpdate(msg) {\n    if (!this.state.topic) {\n      return;\n    }\n    const topic = this.props.tinode.getTopic(this.state.topic);\n    if (!msg) {\n      // msg could be null if one or more messages were deleted.\n      // Updating state to force redraw.\n      this.setState({latestClearId: topic.maxClearId()});\n      return;\n    }\n\n    clearTimeout(this.keyPressTimer)\n    this.setState({maxSeqId: topic.maxMsgSeq(), minSeqId: topic.minMsgSeq(), typingIndicator: false}, _ => {\n      // Scroll to the bottom if the message is added to the end of the message\n      // list if already at the bottom, otherwise show [go to latest] button.\n      // Implemented as a callback to be sure the scroll height has been updated.\n      if (topic.isNewMessage(msg.seq)) {\n        if (this.state.scrollPosition > SHOW_GO_TO_LAST_DIST) {\n          this.setState({showGoToLastButton: true});\n        } else {\n          this.goToLatestMessage();\n        }\n      } else {\n        if (this.messagesScroller) {\n          this.messagesScroller.scrollTop = this.messagesScroller.scrollHeight - this.state.scrollPosition -\n            this.messagesScroller.offsetHeight;\n        }\n      }\n    });\n\n    // Aknowledge messages except own messages. They are\n    // automatically assumed to be read and recived.\n    const status = topic.msgStatus(msg, true);\n    if (status >= Tinode.MESSAGE_STATUS_SENT && msg.from != this.props.myUserId) {\n      this.postReadNotification(msg.seq);\n    }\n  }\n\n  handleReactUpdate(seqIds) {\n    if (!this.state.topic) {\n      return;\n    }\n    this.forceUpdate();\n  }\n\n\n  // Send or remove a reaction on a message.\n  handleReact(seq, emo) {\n    const topic = this.props.tinode.getTopic(this.state.topic);\n    topic.react(seq, emo);\n    this.setState({\n      reactionPickerShownFor: -1\n    });\n  }\n\n  handleToggleReactionPicker(seqId) {\n    this.setState({\n      reactionPickerShownFor: (seqId == -1 || this.state.reactionPickerShownFor == seqId) ? -1 : seqId\n    });\n  }\n\n  handleAllMessagesReceived(count) {\n    this.setState({fetchingMessages: false});\n    if (!count) {\n      // All messages received. Nothing left to receive.\n      const topic = this.props.tinode.getTopic(this.state.topic);\n      if (topic) {\n        // Send read notification for the absolute last message.\n        this.postReadNotification(topic.seq);\n      }\n      return;\n    }\n\n    // Load pinned message too (if any);\n    if (!this.state.pinsLoaded) {\n      // This needs to be guarded to avoid an infinite loop.\n      // The loop may happen if some pinned messages are deleted.\n      const topic = this.props.tinode.getTopic(this.state.topic);\n      this.setState({pinsLoaded: true}, _ => {\n        topic.getPinnedMessages();\n      });\n    } else {\n      this.setState({pinsLoaded: false});\n    }\n  }\n\n  handleAuxUpdate(aux) {\n    const pins = (aux['pins'] || []).slice();\n    let selectedPin = this.state.selectedPin;\n    if (pins.length > this.state.pins.length) {\n      // New pins added, show the latest.\n      selectedPin = 0;\n    } else if (selectedPin >= pins.length) {\n      selectedPin =  Math.max(0, pins.length - 1);\n    }\n    this.setState({pins: pins, selectedPin: selectedPin});\n  }\n\n  handleInfoReceipt(info) {\n    switch (info.what) {\n      case 'kp': {\n        clearTimeout(this.keyPressTimer);\n        this.keyPressTimer = setTimeout(_ => this.setState({typingIndicator: false}), KEYPRESS_DELAY + 1000);\n        if (!this.state.typingIndicator) {\n          this.setState({typingIndicator: true});\n        }\n        break;\n      }\n      case 'read':\n      case 'recv':\n        // Redraw due to changed recv/read status.\n        this.forceUpdate();\n        break;\n      default:\n        console.info(\"Other change in topic: \", info.what);\n    }\n  }\n\n  handleExpandMedia(content) {\n    if (!content) {\n      return;\n    }\n\n    if (content.video) {\n      this.setState({videoPostview: content});\n    } else {\n      this.setState({imagePostview: content});\n    }\n  }\n\n  handleClosePreview() {\n    if (this.state.imagePreview && this.state.imagePreview.url) {\n      URL.revokeObjectURL(this.state.imagePreview.url);\n    }\n    if (this.state.videoPreview && this.state.videoPreview.url) {\n      URL.revokeObjectURL(this.state.videoPreview.url);\n    }\n    this.setState({\n      imagePostview: null,\n      imagePreview: null,\n      docPreview: null,\n      videoPreview: null,\n      videoPostview: null,\n    });\n    this.props.onCancelForwardMessage();\n  }\n\n  handleFormResponse(action, text, data) {\n    if (action == 'pub') {\n      this.sendMessage(Drafty.attachJSON(Drafty.parse(text), data));\n    } else if (action == 'url') {\n      const url = new URL(data.ref);\n      const params = url.searchParams;\n      for (let key in data.resp) {\n        if (data.resp.hasOwnProperty(key)) {\n          params.set(key, data.resp[key]);\n        }\n      }\n      ['name', 'seq'].forEach(key => {\n        if (data[key]) {\n          params.set(key, data[key]);\n        }\n      });\n      params.set('uid', this.props.myUserId);\n      params.set('topic', this.state.topic);\n      url.search = params;\n      window.open(url, '_blank');\n    } else {\n      console.info(\"Unknown action in form\", action);\n    }\n  }\n\n  handleContextClick(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    this.props.showContextMenu({ topicName: this.state.topic, y: e.pageY, x: e.pageX });\n  }\n\n  handleShowMessageContextMenu(params, messageSpecificMenuItems) {\n    if (params.userFrom == 'chan') {\n      params.userFrom = this.state.topic;\n      params.userName = this.state.title;\n    }\n    params.topicName = this.state.topic;\n    const menuItems = messageSpecificMenuItems || [];\n    const topic = this.props.tinode.getTopic(params.topicName);\n    if (topic) {\n      // Self -> (1) always hard-delete with [Delete] title.\n      // P2P -> (1) hard-delete if allowed and not too old, (2) always soft-delete.\n      // Group -> (1) hard-delete if allowed and not too old or owner, (2) always soft-delete.\n      if (topic.isSelfType()) {\n        // Hard-delete with plain [Delete] title.\n        menuItems.push('message_delete_generic');\n      } else {\n        if (!topic.isChannelType()) {\n          // P2P or normal group: always allow to soft-delete.\n          menuItems.push('message_delete');\n        }\n\n        const acs = topic.getAccessMode();\n        if (acs && acs.isDeleter()) {\n          // Owner can always hard-delete regardless of age.\n          let canDelete = acs.isOwner();\n          if (!canDelete) {\n            // Not owner: check message age if configured on the server.\n            const maxDelAge = this.props.tinode.getServerParam(Tinode.MSG_DELETE_AGE, 0) | 0;\n            // Make sure the message is not too old. This check is here just to make the UI\n            // more user-friendly. The server will enforce the limit regardless of this.\n            canDelete = maxDelAge == 0 || (maxDelAge > 0 && params.timestamp ?\n              params.timestamp.getTime() > (new Date().getTime() - maxDelAge * 1000) : false);\n          }\n          if (canDelete) {\n            // [Delete for All] title.\n            menuItems.push('message_delete_hard');\n          }\n        }\n      }\n    }\n    this.props.showContextMenu(params, menuItems);\n  }\n\n  handleNewChatAcceptance(action) {\n    this.props.onNewChat(this.state.topic, action);\n  }\n\n  handleEnablePeer(e) {\n    e.preventDefault();\n    this.props.onChangePermissions(this.state.topic, DEFAULT_P2P_ACCESS_MODE, this.state.topic);\n  }\n\n  sendKeyPress(audio) {\n    const topic = this.props.tinode.getTopic(this.state.topic);\n    if (topic.isSubscribed()) {\n      if (audio) {\n        topic.noteRecording(true);\n      } else {\n        topic.noteKeyPress();\n      }\n    }\n  }\n\n  // sendMessage sends the message with an optional subscription to topic first.\n  sendMessage(msg, uploadCompletionPromise, uploader) {\n    let head;\n    if (!msg && this.props.forwardMessage) {\n      // We are forwarding a message.\n      msg = this.props.forwardMessage.msg;\n      head = this.props.forwardMessage.head;\n      this.handleCancelReply();\n    } else if (this.state.reply) {\n      if (this.state.reply.editing) {\n        if (msg == this.state.contentToEdit) {\n          // Message unchanged.\n          this.handleCancelReply();\n          return;\n        }\n        // Editing an existing message.\n        head = {replace: ':' + this.state.reply.seq};\n      } else if (this.state.reply.content) {\n        // Replying to a message in this topic.\n        // Turn it into Drafty so we can make a quoted Drafty object later.\n        head = {reply: '' + this.state.reply.seq};\n        if (typeof msg == 'string') {\n          msg = Drafty.parse(msg);\n        }\n        msg = Drafty.append(Drafty.sanitizeEntities(this.state.reply.content), msg);\n      }\n      this.handleCancelReply();\n    }\n    this.props.sendMessage(msg, uploadCompletionPromise, uploader, head);\n  }\n\n  // Retry sending a message.\n  retrySend(pub) {\n    this.props.sendMessage(pub.content, undefined, undefined, pub.head)\n      .then(_ => {\n        // All good. Remove the original message draft from the cache.\n        const topic = this.props.tinode.getTopic(this.state.topic);\n        topic.delMessagesList([pub.seq], true);\n      });\n  }\n\n  // sendFileAttachment sends the file as Drafty message:\n  // - if file is too large, upload it and send a s link.\n  // - if file is small enough, just send it in-band.\n  sendFileAttachment(file) {\n    // Server-provided limit reduced for base64 encoding and overhead.\n    const maxInbandAttachmentSize = (this.props.tinode.getServerParam('maxMessageSize',\n      MAX_INBAND_ATTACHMENT_SIZE) * 0.75 - 1024) | 0;\n\n    if (TheCard.isFileSupported(file.type, file.name) || file.type == TheCard.contentType) {\n      // This is a vCard file, try to convert and send as TheCard.\n      if (this.sendTheCardAttachment(file, maxInbandAttachmentSize)) {\n        // Successfully sent as TheCard.\n        return;\n      }\n      // Sending as TheCard failed, fall through to sending as generic file attachment.\n    }\n\n    // If the attachment is a JSON file, then use 'application/octet-stream' instead of 'application/json'.\n    // This is a temporary workaround for the collision with the 'application/json' MIME type of form responses.\n    // Remove this code in 2026 or so.\n    const jsonMimeConverter = (fileType) => fileType === DRAFTY_FR_MIME_TYPE_LEGACY ? 'application/octet-stream' : fileType;\n\n    if (file.size > maxInbandAttachmentSize) {\n      // Too large to send inband - uploading out of band and sending as a link.\n      const uploader = this.props.tinode.getLargeFileHelper();\n      if (!uploader) {\n        this.props.onError(this.props.intl.formatMessage(messages.cannot_initiate_upload));\n        return;\n      }\n      const uploadCompletionPromise = uploader.upload(file);\n      const msg = Drafty.attachFile(null, {\n        mime: jsonMimeConverter(file.type),\n        filename: file.name,\n        size: file.size,\n        urlPromise: uploadCompletionPromise\n      });\n      // Pass data and the uploader to the TinodeWeb.\n      this.sendMessage(msg, uploadCompletionPromise, uploader);\n    } else {\n      // Small enough to send inband.\n      fileToBase64(file)\n        .then(b64 => this.sendMessage(Drafty.attachFile(null, {\n          mime: jsonMimeConverter(b64.mime),\n          data: b64.bits,\n          filename: b64.name,\n          size: file.size\n        })))\n        .catch(err => this.props.onError(err.message, 'err'));\n    }\n  }\n\n  // Convert attached vCard to TheCard and send.\n  sendTheCardAttachment(file, maxInbandAttachmentSize) {\n    if (file.size > maxInbandAttachmentSize) {\n      // Cannot convert to TheCard, send as a generic file attachment instead.\n      return false;\n    }\n\n    if (file.type == TheCard.contentType) {\n      // Already TheCard, no need to convert.\n      this.sendMessage(Drafty.appendTheCard(null, file.object));\n      return true;\n    }\n\n    importVCard(file)\n      .then(card => {\n        this.sendMessage(Drafty.appendTheCard(null, card));\n      })\n      .catch(err => {\n        this.props.onError(this.props.intl.formatMessage(messages.cannot_parse_vcard, {error: err.message}), 'err');\n      });\n    return true;\n  }\n\n  // handleAttachFile method is called when [Attach file] button is clicked: launch attachment preview.\n  handleAttachFile(file) {\n    const maxExternAttachmentSize = this.props.tinode.getServerParam('maxFileUploadSize', MAX_EXTERN_ATTACHMENT_SIZE);\n\n    if (file.size > maxExternAttachmentSize) {\n      // Too large.\n      this.props.onError(this.props.intl.formatMessage(messages.file_attachment_too_large,\n        {size: bytesToHumanSize(file.size), limit: bytesToHumanSize(maxExternAttachmentSize)}), 'err');\n    } else {\n      this.setState({\n        docPreview: {\n          file: file,\n          name: file.name,\n          size: file.size,\n          type: file.type\n        }\n      });\n    }\n  }\n\n  handleCallHangup(topic, seq) {\n    this.props.onVideoCallClosed();\n    this.setState({\n      rtcPanel: null\n    });\n    this.props.onCallHangup(topic, seq);\n  }\n\n  handleCallPanelToggle() {\n    this.setState({minimizedCallPanel: !this.state.minimizedCallPanel});\n  }\n\n  // sendImageAttachment sends the image bits as Drafty message.\n  sendImageAttachment(caption, blob) {\n    const mime = this.state.imagePreview.mime;\n    const width = this.state.imagePreview.width;\n    const height = this.state.imagePreview.height;\n    const fname = this.state.imagePreview.filename;\n\n    // Server-provided limit reduced for base64 encoding and overhead.\n    const maxInbandAttachmentSize = (this.props.tinode.getServerParam('maxMessageSize',\n      MAX_INBAND_ATTACHMENT_SIZE) * 0.75 - 1024) | 0;\n\n    if (blob.size > maxInbandAttachmentSize) {\n      // Too large to send inband - uploading out of band and sending as a link.\n      const uploader = this.props.tinode.getLargeFileHelper();\n      if (!uploader) {\n        this.props.onError(this.props.intl.formatMessage(messages.cannot_initiate_upload));\n        return;\n      }\n      const uploadCompletionPromise = uploader.upload(blob);\n\n      // Make small preview to show while uploading.\n      imageScaled(blob, IMAGE_PREVIEW_DIM, IMAGE_PREVIEW_DIM, -1, false)\n        // Convert tiny image into base64 for serialization and previewing.\n        .then(scaled => blobToBase64(scaled.blob))\n        .then(b64 => {\n          let msg = Drafty.insertImage(null, 0, {\n            mime: mime,\n            _tempPreview: b64.bits, // This preview will not be serialized.\n            bits: b64.bits, // Image thumbnail.\n            width: width,\n            height: height,\n            filename: fname,\n            size: blob.size,\n            urlPromise: uploadCompletionPromise\n          });\n          if (caption) {\n            msg = Drafty.appendLineBreak(msg);\n            msg = Drafty.append(msg, Drafty.parse(caption));\n          }\n          // Pass data and the uploader to the TinodeWeb.\n          this.sendMessage(msg, uploadCompletionPromise, uploader);\n        })\n        .catch(err => this.props.onError(err, 'err'));\n      return;\n    }\n\n    // Send the image inband if it's not too big. The image has been scaled already\n    // in image preview.\n    blobToBase64(blob)\n      .then(b64 => {\n        let msg = Drafty.insertImage(null, 0, {\n          mime: b64.mime,\n          bits: b64.bits,\n          width: width,\n          height: height,\n          filename: fname,\n          size: blob.size\n        });\n        if (caption) {\n          msg = Drafty.appendLineBreak(msg);\n          msg = Drafty.append(msg, Drafty.parse(caption));\n        }\n        this.sendMessage(msg);\n      });\n  }\n\n  // sendVideoAttachment sends the video bits as Drafty message.\n  sendVideoAttachment(caption, videoBlob, previewBlob, params) {\n    const width = params.width;\n    const height = params.height;\n\n    // Server-provided limit reduced for base64 encoding and overhead.\n    const maxInbandAttachmentSize = (this.props.tinode.getServerParam('maxMessageSize',\n      MAX_INBAND_ATTACHMENT_SIZE) * 0.75 - 1024) | 0;\n\n    const uploads = [];\n    let uploader;\n    if ((videoBlob.size + previewBlob.size) > maxInbandAttachmentSize) {\n      // One or both are too large to send inband. Uploading out of band and sending as a link.\n      uploader = this.props.tinode.getLargeFileHelper();\n      if (!uploader) {\n        this.props.onError(this.props.intl.formatMessage(messages.cannot_initiate_upload));\n        return;\n      }\n\n      uploads[0] = videoBlob.size > maxInbandAttachmentSize * 0.675 ? uploader.upload(videoBlob) : null;\n      uploads[1] = previewBlob.size > maxInbandAttachmentSize * 0.275 ? uploader.upload(previewBlob) : null;\n    }\n\n    if (uploads.length == 0) {\n      // Both video and preview are small enough to send inband.\n      Promise.all([blobToBase64(videoBlob), blobToBase64(previewBlob)])\n        .then(b64s => {\n          const [v64, i64] = b64s;\n          let msg = Drafty.insertVideo(null, 0, {\n            mime: v64.mime,\n            bits: v64.bits,\n            preview: i64.bits,\n            premime: i64.mime,\n            width: width,\n            height: height,\n            duration: params.duration,\n            filename: params.name,\n            size: videoBlob.size\n          });\n          if (caption) {\n            msg = Drafty.appendLineBreak(msg);\n            msg = Drafty.append(msg, Drafty.parse(caption));\n          }\n          this.sendMessage(msg);\n      });\n      return;\n    }\n\n    const uploadCompletionPromise = Promise.all(uploads);\n\n    const b64conv = [];\n    // Small video converted to base64.\n    b64conv[0] = uploads[0] ? null : blobToBase64(videoBlob);\n    // Full-size preview fits inline.\n    b64conv[1] = uploads[1] ? null : imageScaled(previewBlob, MAX_IMAGE_DIM, MAX_IMAGE_DIM, -1, false)\n      .then(scaled => blobToBase64(scaled.blob));\n    // Small preview to show while uploading.\n    b64conv[2] = imageScaled(previewBlob, VIDEO_PREVIEW_DIM, VIDEO_PREVIEW_DIM, -1, false)\n      .then(scaled => blobToBase64(scaled.blob));\n    // Convert tiny image into base64 for serialization and previewing.\n    Promise.all(b64conv)\n      .then(b64s => {\n        const [video, img, preview] = b64s;\n        let msg = Drafty.insertVideo(null, 0, {\n          mime: params.mime,\n          bits: video ? video.bits : null,\n          _tempPreview: preview.bits,\n          preview: img ? img.bits : preview.bits,\n          premime: img ? img.mime : preview.mime,\n          width: width,\n          height: height,\n          duration: params.duration,\n          filename: params.name,\n          size: videoBlob.size,\n          urlPromise: uploadCompletionPromise\n        });\n\n        if (caption) {\n          msg = Drafty.appendLineBreak(msg);\n          msg = Drafty.append(msg, Drafty.parse(caption));\n        }\n        // Pass data and the uploader to the TinodeWeb.\n        this.sendMessage(msg, uploadCompletionPromise, uploader);\n      })\n      .catch(err => this.props.onError(err.message, 'err'));\n  }\n\n  // handleAttachImageOrVideo method is called when [Attach image or video] button is clicked: launch image or video preview.\n  handleAttachImageOrVideo(file) {\n    const maxExternAttachmentSize = this.props.tinode.getServerParam('maxFileUploadSize', MAX_EXTERN_ATTACHMENT_SIZE);\n\n    if (file.type.startsWith('video/')) {\n      this.setState({videoPreview: {\n        url: URL.createObjectURL(file),\n        blob: file,\n        filename: file.name,\n        size: file.size,\n        mime: file.type\n      }});\n      return;\n    }\n\n    // Get image dimensions and size, optionally scale it down.\n    imageScaled(file, MAX_IMAGE_DIM, MAX_IMAGE_DIM, maxExternAttachmentSize, false)\n      .then(scaled => {\n        this.setState({imagePreview: {\n          url: URL.createObjectURL(scaled.blob),\n          blob: scaled.blob,\n          filename: scaled.name,\n          width: scaled.width,\n          height: scaled.height,\n          size: scaled.blob.size,\n          mime: scaled.mime\n        }});\n      }).catch(err => {\n        this.props.onError(err.message, 'err');\n      });\n  }\n\n  // handleFileDrop is called when the user drags & drops a file upon the message view.\n  handleFileDrop(files) {\n    if (!files || files.length == 0) {\n      return;\n    }\n    const file = files[0];\n    if (file.type && file.type.startsWith('image/')) {\n      this.handleAttachImageOrVideo(file);\n    } else {\n      this.handleAttachFile(file);\n    }\n  }\n\n  // sendAudioAttachment sends audio bits inband as Drafty message (no preview).\n  sendAudioAttachment(url, preview, duration) {\n    fetch(url)\n      .then(result => result.blob())\n      .then(blob => {\n        // Server-provided limit reduced for base64 encoding and overhead.\n        const maxInbandAttachmentSize = this.props.tinode.getServerParam('maxMessageSize', MAX_INBAND_ATTACHMENT_SIZE) * 0.75 - 1024;\n        if (blob.size > maxInbandAttachmentSize) {\n          // Too large to send inband - uploading out of band and sending as a link.\n          const uploader = this.props.tinode.getLargeFileHelper();\n          if (!uploader) {\n            this.props.onError(this.props.intl.formatMessage(messages.cannot_initiate_upload));\n            return;\n          }\n          const uploadCompletionPromise = uploader.upload(blob);\n          const msg = Drafty.appendAudio(null, {\n            mime: blob.type,\n            size: blob.size,\n            duration: duration,\n            preview: preview,\n            urlPromise: uploadCompletionPromise\n          });\n          // Pass data and the uploader to the TinodeWeb.\n          this.sendMessage(msg, uploadCompletionPromise, uploader);\n        } else {\n          // Small enough to send inband.\n          blobToBase64(blob)\n            .then(b64 => {\n              this.sendMessage(Drafty.appendAudio(null, {\n                mime: b64.mime,\n                bits: b64.bits,\n                size: blob.size,\n                duration: duration,\n                preview: preview,\n              }))\n            })\n        }\n      })\n      .catch(err => {this.props.onError(err.message, 'err')});;\n  }\n\n  handleCancelUpload(seq, uploader) {\n    const topic = this.props.tinode.getTopic(this.state.topic);\n    const found = topic.findMessage(seq);\n    if (found) {\n      found._cancelled = true;\n    }\n    uploader.cancel();\n  }\n\n  // seq: seq ID of the source message\n  // context: message content.\n  // senderId: UID of the sender of the source message.\n  // senderName: full name of the sender of the original message.\n  handlePickReply(seq, content, senderId, senderName) {\n    if (!seq || !content) {\n      this.setState({reply: null});\n      return;\n    }\n\n    content = typeof content == 'string' ? Drafty.init(content) : content;\n    if (Drafty.isValid(content)) {\n      content = Drafty.replyContent(content, QUOTED_REPLY_LENGTH);\n    } else {\n      // /!\\ invalid content.\n      content = Drafty.append(Drafty.init('\\u26A0 '),\n        Drafty.wrapInto(this.props.intl.formatMessage(messages.invalid_content), 'EM'));\n    }\n\n    this.setState({\n      reply: {\n        content: Drafty.quote(senderName, senderId, content),\n        seq: seq\n      }\n    });\n    this.props.onCancelForwardMessage();\n  }\n\n  // seq: seq ID of the message to edit.\n  // context: message content.\n  handleEditMessage(seq, content) {\n    if (!seq || !content) {\n      this.setState({reply: null});\n      return;\n    }\n\n    content = typeof content == 'string' ? Drafty.init(content) : content;\n    const editable = Drafty.toMarkdown(content);\n    if (Drafty.isValid(content)) {\n      content = Drafty.replyContent(content, EDIT_PREVIEW_LENGTH);\n    } else {\n      // /!\\ invalid content.\n      content = Drafty.append(Drafty.init('\\u26A0 '),\n        Drafty.wrapInto(this.props.intl.formatMessage(messages.invalid_content), 'EM'));\n    }\n\n    this.setState({\n      reply: {\n        content: Drafty.quote(this.props.intl.formatMessage(messages.editing_message), null, content),\n        seq: seq,\n        editing: true\n      },\n      contentToEdit: editable\n    });\n    this.props.onCancelForwardMessage();\n  }\n\n  handleCancelReply() {\n    this.setState({reply: null, contentToEdit: null});\n    this.props.onCancelForwardMessage();\n  }\n\n  handleQuoteClick(replyToSeq) {\n    const ref = this.getOrCreateMessageRef(replyToSeq);\n    if (ref && ref.current) {\n      ref.current.scrollIntoView({block: \"center\", behavior: \"smooth\"});\n      ref.current.classList.add('flash');\n      setTimeout(_ => {ref.current.classList.remove('flash')} , 1000);\n    } else {\n      console.error(\"Unresolved message ref\", replyToSeq);\n    }\n  }\n\n  handleUnpinMessage(seq) {\n    const topic = this.props.tinode.getTopic(this.state.topic);\n    topic.pinMessage(seq, false);\n  }\n\n  isDragEnabled() {\n    return this.state.isWriter && !this.state.unconfirmed && !this.props.forwardMessage && !this.state.peerMessagingDisabled;\n  }\n\n  handleDragStart(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    e.dataTransfer.clearData();\n  }\n\n  handleDragIn(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    this.dragCounter++;\n    if (e.dataTransfer.items && e.dataTransfer.items.length > 0) {\n      this.setState({dragging: true});\n    }\n  }\n\n  handleDragOut(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    this.dragCounter--;\n    if (this.dragCounter <= 0) {\n      this.setState({dragging: false});\n    }\n  }\n\n  handleDrag(e) {\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  handleDrop(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    this.setState({dragging: false});\n    if (this.isDragEnabled() && e.dataTransfer.files && e.dataTransfer.files.length > 0) {\n      this.handleFileDrop(e.dataTransfer.files);\n      this.dragCounter = 0;\n    }\n  }\n\n  render() {\n    const {formatMessage} = this.props.intl;\n\n    // P2P call is an overlay, not a separate component because it cannot be\n    // re-mounted between full screen/minimized.\n    const overlay = this.state.rtcPanel &&\n        <Suspense fallback={<div><FormattedMessage id=\"loading_note\" defaultMessage=\"Loading...\"\n            description=\"Message shown when component is loading\"/></div>}>\n          <CallPanel\n            topic={this.state.topic}\n            seq={this.props.callSeq}\n            callState={this.props.callState}\n            callAudioOnly={this.props.callAudioOnly}\n            tinode={this.props.tinode}\n            title={this.state.title}\n            avatar={this.state.avatar || true}\n            minimized={this.state.minimizedCallPanel}\n            onError={this.props.onError}\n            onHangup={this.handleCallHangup}\n            onToggleMinimize={this.handleCallPanelToggle}\n            onInvite={this.props.onCallInvite}\n            onSendOffer={this.props.onCallSendOffer}\n            onIceCandidate={this.props.onCallIceCandidate}\n            onSendAnswer={this.props.onCallSendAnswer} />\n        </Suspense>;\n\n    let component;\n    if (!this.state.topic) {\n      component = <LogoView\n          serverVersion={this.props.serverVersion}\n          serverAddress={this.props.serverAddress} />;\n\n    } else {\n      let component2;\n      if (this.state.imagePreview) {\n        // Preview image before sending.\n        component2 = (\n          <Suspense fallback={<div><FormattedMessage id=\"loading_note\" defaultMessage=\"Loading...\"\n            description=\"Message shown when component is loading\"/></div>}>\n            <ImagePreview\n              content={this.state.imagePreview}\n              tinode={this.props.tinode}\n              reply={this.state.reply}\n              onCancelReply={this.handleCancelReply}\n              onClose={this.handleClosePreview}\n              onSendMessage={this.sendImageAttachment} />\n          </Suspense>\n        );\n      } else if (this.state.videoPreview) {\n          // Preview video.\n        component2 = <Suspense fallback={<div><FormattedMessage id=\"loading_note\" defaultMessage=\"Loading...\"\n            description=\"Message shown when component is loading\"/></div>}>\n            <VideoPreview\n              content={this.state.videoPreview}\n              tinode={this.props.tinode}\n              reply={this.state.reply}\n              onError={this.props.onError}\n              onCancelReply={this.handleCancelReply}\n              onClose={this.handleClosePreview}\n              onSendMessage={this.sendVideoAttachment} />\n          </Suspense>;\n\n      } else if (this.state.imagePostview) {\n        // Expand received image.\n        component2 = <Suspense fallback={<div><FormattedMessage id=\"loading_note\" defaultMessage=\"Loading...\"\n            description=\"Message shown when component is loading\"/></div>}>\n            <ImagePreview\n              content={this.state.imagePostview}\n              onClose={this.handleClosePreview} />\n          </Suspense>;\n\n      } else if (this.state.videoPostview) {\n        // Play received video.\n        component2 = <Suspense fallback={<div><FormattedMessage id=\"loading_note\" defaultMessage=\"Loading...\"\n            description=\"Message shown when component is loading\"/></div>}>\n            <VideoPreview\n              content={this.state.videoPostview}\n              tinode={this.props.tinode}\n              onError={this.props.onError}\n              onClose={this.handleClosePreview} />\n          </Suspense>;\n\n      } else if (this.state.docPreview) {\n        // Preview attachment before sending.\n        if (TheCard.isFileSupported(this.state.docPreview.type, this.state.docPreview.name) ||\n            this.state.docPreview.type == TheCard.contentType) {\n          component2 = <Suspense fallback={<div><FormattedMessage id=\"loading_note\" defaultMessage=\"Loading...\"\n            description=\"Message shown when component is loading\"/></div>}>\n            <TheCardPreview\n              content={this.state.docPreview}\n              tinode={this.props.tinode}\n              reply={this.state.reply}\n              onCancelReply={this.handleCancelReply}\n              onClose={this.handleClosePreview}\n              onSendMessage={this.sendFileAttachment} />\n          </Suspense>;\n        } else {\n          component2 = <Suspense fallback={<div><FormattedMessage id=\"loading_note\" defaultMessage=\"Loading...\"\n              description=\"Message shown when component is loading\"/></div>}>\n              <DocPreview\n                content={this.state.docPreview}\n                tinode={this.props.tinode}\n                reply={this.state.reply}\n                onCancelReply={this.handleCancelReply}\n                onClose={this.handleClosePreview}\n                onSendMessage={this.sendFileAttachment} />\n            </Suspense>;\n        }\n      } else {\n        const topic = this.props.tinode.getTopic(this.state.topic);\n        const isChannel = topic.isChannelType() || topic.chan;\n        const groupTopic = topic.isGroupType() && !isChannel;\n        const icon_badges = [];\n        if (topic.trusted) {\n          if (topic.trusted.verified) {\n            icon_badges.push({icon: 'verified', color: 'badge-inv'});\n          }\n          if (topic.trusted.staff) {\n            icon_badges.push({icon: 'staff', color: 'badge-inv'});\n          }\n          if (topic.trusted.danger) {\n            icon_badges.push({icon: 'dangerous', color: 'badge-inv'});\n          }\n        }\n\n        const pinnedMessages = [];\n        this.state.pins.forEach(seq => pinnedMessages.push(topic.latestMsgVersion(seq) || topic.findMessage(seq)));\n\n        const messageNodes = [];\n        let previousFrom = null;\n        let prevDate = null;\n        let chatBoxClass = null;\n        topic.messages((msg, prev, next, i) => {\n          let nextFrom = next ? (next.from || 'chan') : null;\n\n          let sequence = 'single';\n          let thisFrom = msg.from || 'chan';\n          if (thisFrom == previousFrom) {\n            if (thisFrom == nextFrom) {\n              sequence = 'middle';\n            } else {\n              sequence = 'last';\n            }\n          } else if (thisFrom == nextFrom) {\n            sequence = 'first';\n          }\n          previousFrom = thisFrom;\n\n          const isReply = !(thisFrom == this.props.myUserId);\n          const deliveryStatus = topic.msgStatus(msg, true);\n\n          let userFrom = thisFrom, userName, userAvatar;\n          const user = topic.userDesc(thisFrom);\n          if (user && user.public) {\n            userName = user.public.fn;\n            userAvatar = makeImageUrl(user.public.photo);\n          }\n          chatBoxClass = groupTopic ? 'chat-box group' : 'chat-box';\n\n          // Ref for this chat message.\n          const ref = this.getOrCreateMessageRef(msg.seq);\n          let replyToSeq = msg.head ? parseInt(msg.head.reply) : null;\n          if (!replyToSeq || isNaN(replyToSeq)) {\n            replyToSeq = null;\n          }\n\n          if (msg.hi) {\n            // Deleted message.\n            messageNodes.push(\n              <MetaMessage\n                deleted={true}\n                key={msg.seq} />\n              );\n          } else {\n            const thisDate = new Date(msg.ts);\n            // This message was sent on a different date than the previous.\n            if (!prevDate || prevDate.toDateString() != thisDate.toDateString()) {\n              messageNodes.push(\n                <MetaMessage\n                  date={relativeDateFormat(msg.ts)}\n                  locale={this.props.intl.locale}\n                  key={'date-' + msg.seq} />\n              );\n              prevDate = thisDate;\n            }\n            messageNodes.push(\n              <ChatMessage\n                tinode={this.props.tinode}\n                topic={this.state.topic}\n                content={msg.content}\n                mimeType={msg.head && msg.head.mime}\n                replyToSeq={replyToSeq}\n                edited={msg.head && !msg.head.webrtc && msg.head.replace}\n                timestamp={msg.ts}\n                response={isReply}\n                seq={msg.seq}\n                isGroup={groupTopic}\n                isChan={this.state.channel}\n                userFrom={userFrom}\n                userName={userName}\n                userAvatar={userAvatar}\n                sequence={sequence}\n                received={deliveryStatus}\n                uploader={msg._uploader}\n                userIsWriter={this.state.isWriter}\n                userIsAdmin={this.state.isAdmin}\n                showPicker={this.state.reactionPickerShownFor == msg.seq}\n                pinned={this.state.pins.includes(msg.seq)}\n                viewportWidth={this.props.viewportWidth}  // Used by `formatter`.\n                reactions={topic.msgReactions(msg.seq)}\n                reactionList={this.state.reactionList}\n                maxReactions={this.state.maxReactions}\n                showContextMenu={this.handleShowMessageContextMenu}\n                onExpandMedia={this.handleExpandMedia}\n                onFormResponse={this.handleFormResponse}\n                onCancelUpload={this.handleCancelUpload}\n                pickReply={this.handlePickReply}\n                editMessage={this.handleEditMessage}\n                onQuoteClick={this.handleQuoteClick}\n                onAcceptCall={this.props.onAcceptCall}\n                onError={this.props.onError}\n                onReact={this.handleReact}\n                onToggleReactionPicker={this.handleToggleReactionPicker}\n                myUserId={this.props.myUserId}\n                parentRef={this.messagesScroller}\n                ref={ref}\n                key={msg.seq} />\n            );\n          }\n        });\n\n        let lastSeen = null;\n        if (isChannel) {\n          if (topic.subcnt) {\n            lastSeen = formatMessage(messages.subscriber_count, {count: topic.subcnt});\n          }\n        } else {\n          const cont = this.props.tinode.getMeTopic().getContact(this.state.topic);\n          if (cont) {\n            if (Tinode.isP2PTopicName(cont.topic)) {\n              if (cont.online) {\n                lastSeen = formatMessage(messages.online_now);\n              } else if (cont.seen) {\n                lastSeen = formatMessage(messages.last_seen,\n                  {timestamp: shortDateFormat(cont.seen.when, this.props.intl.locale)});\n                // TODO: also handle user agent in c.seen.ua\n              }\n            } else if (Tinode.isGroupTopicName(cont.topic)) {\n              if (topic.subcnt) {\n                lastSeen = formatMessage(messages.member_count, {count: topic.subcnt});\n              }\n            }\n          }\n        }\n        const avatar = this.state.avatar || true;\n        const online = this.state.deleted || topic.isSelfType() ? null :\n          this.props.online ? 'online' + (this.state.typingIndicator ? ' typing' : '') : 'offline';\n\n        const titleClass = 'panel-title' + (this.state.deleted ? ' deleted' : '');\n        const darkModeClass = this.props.colorSchema == 'dark' ? 'dark' : '';\n\n        let messagesComponent = (\n          <>\n            <div id=\"messages-container\" className={darkModeClass}>\n              <button id=\"go-to-latest\" className={'action-button' + (this.state.showGoToLastButton ? '' : ' hidden')}\n                onClick={this.goToLatestMessage}>\n                <i className=\"m-icon\">arrow_downward</i>\n              </button>\n              <div id=\"messages-panel\" ref={this.handleScrollReference}>\n                <ul id=\"scroller\" className={chatBoxClass}>\n                  {messageNodes}\n                </ul>\n              </div>\n              {!this.state.isReader ?\n              <div id=\"write-only-background\">\n                {this.state.readingBlocked ?\n                <div id=\"write-only-note\">\n                  <FormattedMessage id=\"messages_not_readable\" defaultMessage=\"no access to messages\"\n                    description=\"Message shown in topic without the read access\" />\n                </div>\n                : null }\n              </div>\n              : null }\n            </div>\n            {this.state.peerMessagingDisabled && !this.state.unconfirmed ?\n              <div id=\"peer-messaging-disabled-note\">\n                <i className=\"m-icon secondary\">block</i> <FormattedMessage\n                  id=\"peers_messaging_disabled\" defaultMessage=\"Peer's messaging is disabled.\"\n                  description=\"Shown when the p2p peer's messaging is disabled\" /> <a href=\"#\"\n                    onClick={this.handleEnablePeer}><FormattedMessage id=\"enable_peers_messaging\"\n                    defaultMessage=\"Enable\" description=\"Call to action to enable peer's messaging\" /></a>.\n              </div> : null}\n            {this.state.unconfirmed ?\n              <Invitation onAction={this.handleNewChatAcceptance} />\n              :\n              <SendMessage\n                tinode={this.props.tinode}\n                topicName={this.state.topic}\n                noInput={!!this.props.forwardMessage}\n                disabled={!this.state.isWriter || this.state.deleted}\n                reply={this.state.reply}\n                initMessage={this.state.contentToEdit}\n                sendOnEnter={this.props.sendOnEnter}\n                onKeyPress={this.sendKeyPress}\n                onRecordingProgress={this.sendKeyPress}\n                onSendMessage={this.sendMessage}\n                onAttachFile={this.props.forwardMessage ? null : this.handleAttachFile}\n                onAttachImage={this.props.forwardMessage ? null : this.handleAttachImageOrVideo}\n                onAttachAudio={this.props.forwardMessage ? null : this.sendAudioAttachment}\n                onError={this.props.onError}\n                onQuoteClick={this.handleQuoteClick}\n                onCancelReply={this.handleCancelReply} />}\n          </>\n        );\n\n        component2 = (\n          <>\n            <div id=\"topic-caption-panel\" className=\"caption-panel\">\n              {this.props.displayMobile ?\n                <a href=\"#\" id=\"hide-message-view\" onClick={(e) => {e.preventDefault(); this.leave(this.state.topic); this.props.onHideMessagesView();}}>\n                  <i className=\"m-icon\">arrow_back</i>\n                </a>\n                :\n                null}\n              <div className=\"avatar-box\">\n                <LetterTile\n                  authorizeURL={this.props.tinode.authorizeURL}\n                  avatar={avatar}\n                  topic={this.state.topic}\n                  title={this.state.title}\n                  deleted={this.state.deleted} />\n                {!isChannel ? <span className={online} /> : null}\n              </div>\n              <div id=\"topic-title-group\">\n                <div id=\"topic-title\" className={titleClass}>{\n                  this.state.title ||\n                  <i><FormattedMessage id=\"unnamed_topic\" defaultMessage=\"Unnamed\"\n                    description=\"Title shown when the topic has no name\" /></i>\n                }<ContactBadges badges={icon_badges} /></div>\n                <div id=\"topic-last-seen\">{lastSeen}</div>\n              </div>\n              <div style={{marginLeft: 'auto'}}/>\n              {!this.props.displayMobile && this.state.pins.length > 0 ?\n                <PinnedMessages\n                  tinode={this.props.tinode}\n                  pins={this.state.pins}\n                  messages={pinnedMessages}\n                  selected={this.state.selectedPin}\n                  isAdmin={this.state.isAdmin}\n                  setSelected={index => this.setState({selectedPin: index})}\n                  onSelected={this.handleQuoteClick}\n                  onCancel={this.handleUnpinMessage} />\n                : null}\n              {groupTopic ?\n                <GroupSubs\n                  tinode={this.props.tinode}\n                  subscribers={this.state.onlineSubs} /> :\n                null\n              }\n              <div>\n                <a href=\"#\" onClick={this.handleContextClick}>\n                  <i className=\"m-icon\">more_vert</i>\n                </a>\n              </div>\n            </div>\n            {this.props.displayMobile ?\n              <>\n                {this.state.pins.length > 0 ?\n                  <PinnedMessages\n                    tinode={this.props.tinode}\n                    pins={this.state.pins}\n                    messages={pinnedMessages}\n                    selected={this.state.selectedPin}\n                    isAdmin={this.state.isAdmin}\n                    setSelected={index => this.setState({selectedPin: index})}\n                    onSelected={this.handleQuoteClick}\n                    onCancel={this.handleUnpinMessage} />\n                    : null\n                }\n                <ErrorPanel\n                  level={this.props.errorLevel}\n                  text={this.props.errorText}\n                  onClearError={this.props.onError} />\n              </>\n              : null}\n            <LoadSpinner show={this.state.fetchingMessages} />\n            {messagesComponent}\n            {this.state.dragging && this.isDragEnabled() ?\n              <div className=\"drag-n-drop\">{formatMessage(messages.drag_file)}</div>\n            : null}\n          </>\n        );\n      }\n      component = <div id=\"topic-view\" ref={this.mountComponentEvents}>{component2}{overlay}</div>\n    }\n    return component;\n  }\n};\n\nexport default injectIntl(MessagesView);\nexport { MessagesView as UnwrappedMessagesView };\n"],"names":["AudioRecorder","React","_","messages","defineMessages","messaging_disabled","id","defaultMessage","type_new_message","add_image_caption","file_attachment_too_large","cannot_initiate_upload","icon_title_record_voice","icon_title_attach_file","icon_title_add_image","icon_title_send","SendMessage","constructor","props","super","this","state","quote","message","audioRec","audioAvailable","navigator","mediaDevices","getUserMedia","keypressTimestamp","handlePasteEvent","bind","handleAttachImage","handleAttachFile","handleAttachAudio","handleSend","handleKeyPress","handleMessageTyping","handleDropAttach","handleQuoteClick","formatReply","componentDidMount","messageEditArea","addEventListener","window","getComputedStyle","getPropertyValue","focus","setState","componentWillUnmount","removeEventListener","componentDidUpdate","prevProps","style","height","scrollHeight","topicName","initMessage","msg","scrollTop","setSelectionRange","length","reply","Drafty","format","content","replyFormatter","formatMessage","intl","authorizeURL","tinode","e","disabled","filePasted","file","onAttachImage","onAttachFile","onError","preventDefault","target","files","value","url","preview","duration","onAttachAudio","trim","acceptBlank","noInput","onSendMessage","stopPropagation","key","sendOnEnter","shiftKey","ctrlKey","metaKey","onKeyPress","now","Date","getTime","KEYPRESS_DELAY","onQuoteClick","replyToSeq","seq","render","prompt","messagePrompt","sendIcon","editing","className","href","onClick","onCancelReply","audioEnabled","attachImage","click","title","attachFile","Suspense","fallback","FormattedMessage","onRecordingProgress","onDeleted","onFinished","placeholder","onChange","onKeyDown","ref","type","display","accept","injectIntl","Attachment","downloader","progress","downloadFile","handleCancel","filename","mimetype","getLargeFileHelper","download","loaded","size","err","then","catch","uploading","onCancelUpload","cancel","substr","helperFunc","bytesToHumanSize","isUrlRelative","downloadUrl","sanitizeUrl","downloadWidget","FileProgress","onCancel","ReactionStrip","more","reactions","maxReactions","opacity","userSelect","width","slice","map","r","you","users","myUserId","includes","val","onReactionSelected","count","shortenCount","pickerShown","onMouseDown","onTogglePicker","message_sending","message_sending_failed","message_edited_marker","ReceivedMarker","timestamp","received","Tinode","MESSAGE_STATUS_SENDING","MESSAGE_STATUS_FAILED","MESSAGE_STATUS_FATAL","toLocaleTimeString","locale","timeStyle","icon","deliveryMarker","marker","color","name","edited","BUTTON_SIZE","ReactionPicker","position","marginLeft","marginTop","tipLeft","placeAbove","expanded","rootRef","emojiRefs","handleOutsideClick","handleKeyDown","selectEmoji","updatePosition","document","setTimeout","prevState","anchor","viewportBounds","current","contains","onClose","active","activeElement","idx","findIndex","el","next","last","prev","emo","reactionList","onSelect","panelRect","getBoundingClientRect","hSize","vSize","spaceLeft","viewX","PANEL_MARGIN","spaceRight","spaceTop","viewY","spaceBottom","TIP_SIZE","bubbleMargin","leftBubble","preferred","space","availableLeft","offsetX","preferredX","Math","max","availableRight","min","offsetY","tipTop","newPos","objectEqual","prefix","dataTestPrefix","role","i","applied","find","mine","tabIndex","CountBadge","rect","right","bottom","BaseChatMessage","uploader","onProgress","handleProgress","handleExpandImage","handlePlayVideo","handleFormButtonClick","handleContextClick","handleCancelUpload","handleTogglePicker","handleReactionSelected","handleDraftyClick","formatterContext","viewportWidth","onHandleClick","action","pathname","URL","dataset","parts","split","filter","Boolean","HashNavigation","navigateTo","setUrlTopic","pop","error","console","hashUrl","setUrlSidePanel","location","hash","addUrlParam","info","onExpandMedia","src","mime","video","data","resp","undefined","act","text","onFormResponse","menuItems","push","userIsWriter","response","immutable","entities","_0","_1","tp","styles","userIsAdmin","pinned","showContextMenu","replace","parseInt","userFrom","userName","y","pageY","x","pageX","pickReply","editMessage","ratio","showPicker","onToggleReactionPicker","parentRect","parentRef","buttonRect","pickerAnchor","left","top","offsetLeft","offsetTop","parentBounds","onReact","sideClass","sequence","bubbleClass","avatar","userAvatar","textSizeClass","fullDisplay","isGroup","attachments","mimeType","getContentType","isValid","att","isFormResponseType","getDownloadUrl","isProcessing","getEntitySize","tree","fullFormatter","RegExp","test","match","innerRef","LetterTile","topic","marginBottom","IntlChatMessage","_extends","GroupSubs","usersOnline","totalCount","subscribers","countToShow","MAX_ONLINE_IN_TOPIC","some","sub","user","makeImageUrl","public","photo","fn","values","overflow","Invitation","handleButtonAction","evt","onAction","event","LogoView","version","APP_NAME","getLibrary","alt","serverVersion","serverAddress","MetaMessage","date","message_not_found","message_deleted","PinnedMessages","touchX","touchY","touchSurface","getSelectedIndex","handleSelected","handleMoveNext","handleMovePrev","handleTouchEventStart","handleTouchEventEnd","handleTouchCancel","passive","pins","selected","onSelected","isTouch","setSelected","touches","clientX","clientY","changedTouches","dX","dY","abs","MIN_SWIPE_DISTANCE","messageShown","_deleted","previewFormatter","dots","forEach","cn","isAdmin","CallPanel","DocPreview","ImagePreview","TheCardPreview","VideoPreview","online_now","last_seen","not_found","channel","invalid_content","editing_message","drag_file","self_topic_name","subscriber_count","member_count","cannot_parse_vcard","isUnconfirmed","acs","ex","getExcessive","isJoiner","isPeerRestricted","ms","getMissing","shouldPresentCallPanel","callState","CALL_STATE_OUTGOING_INITATED","CALL_STATE_IN_PROGRESS","MessagesView","getDerivedStateFromProps","componentSetup","leave","sendMessage","retrySend","sendImageAttachment","sendVideoAttachment","sendFileAttachment","sendAudioAttachment","sendTheCardAttachment","sendKeyPress","subscribe","handleScrollReference","mountComponentEvents","handleScrollEvent","handleDescChange","handleSubsUpdated","handleMessageUpdate","handleReactUpdate","handleAuxUpdate","handleAllMessagesReceived","handleInfoReceipt","handleExpandMedia","handleClosePreview","handleCallPanelToggle","handleFormResponse","handleShowMessageContextMenu","handleNewChatAcceptance","handleEnablePeer","handleAttachImageOrVideo","postReadNotification","clearNotificationQueue","goToLatestMessage","handleFileDrop","handlePickReply","handleEditMessage","handleCancelReply","handleUnpinMessage","handleCallHangup","isDragEnabled","handleReact","handleToggleReactionPicker","handleDragStart","handleDragIn","handleDragOut","handleDrag","handleDrop","chatMessageRefs","getOrCreateMessageRef","getVisibleMessageRange","dragCounter","componentRef","readNotificationQueue","readNotificationTimer","keyPressTimer","seqId","holderRect","Number","MAX_SAFE_INTEGER","visibilityStatus","every","messagesScroller","maxSeqId","minSeqId","scrollPosition","offsetHeight","applicationVisible","getTopic","isNewGroupTopicName","rtcPanel","callSeq","onData","onAllMessagesReceived","onInfo","onMetaDesc","onSubsUpdated","onPres","onAuxUpdated","newTopic","newTopicParams","_topicName","isP2PType","IMMEDIATE_P2P_SUBSCRIPTION","getMeta","startMetaQuery","withDesc","build","isSubscribed","isReader","withLaterData","nextProps","nextState","docPreview","imagePreview","imagePostview","videoPreview","videoPostview","minimizedCallPanel","typingIndicator","fetchingMessages","showGoToLastButton","contentToEdit","dragging","selectedPin","reactionPickerShownFor","forwardMessage","object","deleted","subs","connected","online","Object","assign","onlineSubs","isSelfType","peer","p2pPeerDesc","peerMessagingDisabled","minMsgSeq","maxMsgSeq","latestClearId","maxClearId","isChannelType","aux","pinsLoaded","callTopic","isVerified","isStaff","isDangerous","subsVersion","isWriter","readingBlocked","isSharer","unconformed","unconfirmed","ready","getQuery","withLaterDesc","withLaterSub","withAux","MESSAGES_PAGE","withLaterDel","setQuery","ctrl","code","params","onNewTopicCreated","discard","queuedMessages","pub","_sending","_fatal","head","webrtc","delMessagesList","blankState","oldTopicName","isTopicCached","oldTopic","finally","node","pos","processingScrollEvent","gaps","msgHasMoreMessages","getMessagesPage","desc","isSelfTopicName","setInterval","markReactionsSeen","clearInterval","n","shift","sendAt","isServerAssignedSeq","noteRead","setMilliseconds","getMilliseconds","READ_DELAY","newState","clearTimeout","isNewMessage","msgStatus","MESSAGE_STATUS_SENT","from","seqIds","forceUpdate","react","getPinnedMessages","what","revokeObjectURL","onCancelForwardMessage","attachJSON","parse","searchParams","hasOwnProperty","set","search","open","messageSpecificMenuItems","getAccessMode","isDeleter","canDelete","isOwner","maxDelAge","getServerParam","MSG_DELETE_AGE","onNewChat","onChangePermissions","DEFAULT_P2P_ACCESS_MODE","audio","noteRecording","noteKeyPress","uploadCompletionPromise","append","sanitizeEntities","maxInbandAttachmentSize","MAX_INBAND_ATTACHMENT_SIZE","TheCard","isFileSupported","contentType","jsonMimeConverter","fileType","DRAFTY_FR_MIME_TYPE_LEGACY","upload","urlPromise","fileToBase64","b64","bits","appendTheCard","importVCard","card","maxExternAttachmentSize","MAX_EXTERN_ATTACHMENT_SIZE","limit","onVideoCallClosed","onCallHangup","caption","blob","fname","imageScaled","IMAGE_PREVIEW_DIM","scaled","blobToBase64","insertImage","_tempPreview","appendLineBreak","videoBlob","previewBlob","uploads","Promise","all","b64s","v64","i64","insertVideo","premime","b64conv","MAX_IMAGE_DIM","VIDEO_PREVIEW_DIM","img","startsWith","createObjectURL","fetch","result","appendAudio","found","findMessage","_cancelled","senderId","senderName","init","replyContent","QUOTED_REPLY_LENGTH","wrapInto","editable","toMarkdown","EDIT_PREVIEW_LENGTH","scrollIntoView","block","behavior","classList","add","remove","pinMessage","dataTransfer","clearData","items","overlay","callAudioOnly","minimized","onHangup","onToggleMinimize","onInvite","onCallInvite","onSendOffer","onCallSendOffer","onIceCandidate","onCallIceCandidate","onSendAnswer","onCallSendAnswer","component","component2","isChannel","chan","groupTopic","isGroupType","icon_badges","trusted","verified","staff","danger","pinnedMessages","latestMsgVersion","messageNodes","previousFrom","prevDate","chatBoxClass","nextFrom","thisFrom","isReply","deliveryStatus","userDesc","isNaN","hi","thisDate","ts","toDateString","relativeDateFormat","ChatMessage","isChan","_uploader","msgReactions","onAcceptCall","lastSeen","subcnt","cont","getMeTopic","getContact","isP2PTopicName","seen","shortDateFormat","when","isGroupTopicName","titleClass","darkModeClass","colorSchema","messagesComponent","displayMobile","onHideMessagesView","ContactBadges","badges","index","ErrorPanel","level","errorLevel","errorText","onClearError","LoadSpinner","show"],"ignoreList":[],"sourceRoot":""}