{"version":3,"file":"889.prod.js","mappings":"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","sources":["webpack://tinode-webapp/./src/widgets/image-preview.jsx"],"sourcesContent":["import React from 'react';\nimport { FormattedMessage } from 'react-intl';\nimport SendMessage from './send-message.jsx';\n\nimport { REM_SIZE } from '../config.js';\nimport { fitImageSize } from '../lib/blob-helpers.js';\nimport { bytesToHumanSize, shortenFileName } from '../lib/strformat.js';\nimport { urlAsAttachment } from '../lib/utils.js';\n\nexport default class ImagePreview extends React.PureComponent {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      width: 0,\n      height: 0\n    };\n\n    this.handleSendImage = this.handleSendImage.bind(this);\n    this.handleKeyDown = this.handleKeyDown.bind(this);\n  }\n\n  componentDidMount() {\n    document.addEventListener('keydown', this.handleKeyDown);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('keydown', this.handleKeyDown);\n  }\n\n  handleKeyDown(e) {\n    if (this.props.onSendMessage) {\n      return;\n    }\n\n    e.preventDefault();\n    if (e.key === 'Escape') {\n      this.props.onClose();\n    }\n  }\n\n  assignWidth(node) {\n    if (node && !this.state.width) {\n      const bounds = node.getBoundingClientRect();\n      this.setState({\n        width: bounds.width | 0,\n        height: bounds.height | 0\n      });\n    }\n  }\n\n  handleSendImage(caption) {\n    this.props.onClose();\n    this.props.onSendMessage(caption, this.props.content.blob);\n  }\n\n  render() {\n    if (!this.props.content) {\n      return null;\n    }\n\n    const dim = fitImageSize(this.props.content.width, this.props.content.height,\n      this.state.width, this.state.height, false);\n    const size = dim ? { width: dim.dstWidth + 'px', height: dim.dstHeight + 'px' } :\n      ((this.props.content.width > this.props.content.height) ? {width: '100%'} : {height: '100%'});\n    size.maxWidth = '100%';\n    size.maxHeight = '100%';\n\n    // Average font aspect ratio is ~0.5; File name takes 1/3 of the viewport width.\n    const maxlength = Math.max(((this.state.width / REM_SIZE / 1.5) | 0) - 2, 12);\n    const fname = shortenFileName(this.props.content.filename, maxlength) || '-';\n\n    const width = this.props.content.width || '-';\n    const height = this.props.content.height || '-';\n\n    const download_url = urlAsAttachment(this.props.content.url);\n\n    return (\n      <div id=\"image-preview\">\n        <div id=\"preview-caption-panel\">\n          {this.props.onSendMessage ?\n            <span>{fname}</span>\n            :\n            <a href={download_url} download={this.props.content.filename}>\n              <i className=\"m-icon\">file_download</i> <FormattedMessage\n                id=\"download_action\" defaultMessage=\"download\" description=\"Call to action [download]\" />\n            </a>\n          }\n          <a href=\"#\" onClick={(e) => {e.preventDefault(); this.props.onClose();}}><i className=\"m-icon gray\">close</i></a>\n        </div>\n        <div id=\"image-preview-container\" ref={node => this.assignWidth(node)}>\n          <img src={this.props.content.url} style={size} className=\"image-preview\" alt={this.props.content.filename} />\n        </div>\n        {this.props.onSendMessage ?\n          <SendMessage\n            messagePrompt=\"add_image_caption\"\n            acceptBlank={true}\n            tinode={this.props.tinode}\n            reply={this.props.reply}\n            onCancelReply={this.props.onCancelReply}\n            onSendMessage={this.handleSendImage}\n            onError={this.props.onError} />\n          :\n          <div id=\"image-preview-footer\">\n            <div>\n              <div><b><FormattedMessage id=\"label_file_name\" defaultMessage=\"File name:\"\n                description=\"Label for a file name\" /></b></div>\n              <div><span title={this.props.content.filename}>{fname}</span></div>\n            </div>\n            <div>\n              <div><b><FormattedMessage id=\"label_content_type\" defaultMessage=\"Content type:\"\n                description=\"Label for file content type (mime)\" /></b></div>\n              <div>{this.props.content.type}</div>\n            </div>\n            <div>\n              <div><b><FormattedMessage id=\"label_size\" defaultMessage=\"Size:\"\n                description=\"Label for file size\" /></b></div>\n              <div>{width} &times; {height} px; {bytesToHumanSize(this.props.content.size)}</div>\n            </div>\n          </div>}\n      </div>\n    );\n  }\n};\n"],"names":["ImagePreview","React","constructor","props","super","this","state","width","height","handleSendImage","bind","handleKeyDown","componentDidMount","document","addEventListener","componentWillUnmount","removeEventListener","e","onSendMessage","preventDefault","key","onClose","assignWidth","node","bounds","getBoundingClientRect","setState","caption","content","blob","render","dim","fitImageSize","size","dstWidth","dstHeight","maxWidth","maxHeight","maxlength","Math","max","REM_SIZE","fname","shortenFileName","filename","download_url","urlAsAttachment","url","id","href","download","className","FormattedMessage","defaultMessage","onClick","ref","src","style","alt","SendMessage","messagePrompt","acceptBlank","tinode","reply","onCancelReply","onError","title","type","bytesToHumanSize"],"ignoreList":[],"sourceRoot":""}